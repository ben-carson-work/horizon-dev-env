<?xml version="1.0" encoding="UTF-8" standalone="no"?><DOEnt_DocTemplate><Header><EntityType>37</EntityType><EntityId>0DCF21C1-915C-D5D7-03F1-016537D37B52</EntityId><LastUpdate>2024-03-11T10:53:00.000+0100</LastUpdate></Header><DocTemplate><IconName>rpt-dataexport.png</IconName><EntityType>37</EntityType><DocTemplateId>0DCF21C1-915C-D5D7-03F1-016537D37B52</DocTemplateId><DocTemplateName>Access Right Security Roles</DocTemplateName><DocTemplateCode>G2M6D8QVDRX8EWM</DocTemplateCode><CategoryId>56E73AC4-0538-494A-B661-345BBBDE739D</CategoryId><DocEnabled>true</DocEnabled><ExecRequireLogin>true</ExecRequireLogin><DocTemplateType>5</DocTemplateType><DocEditorType>6</DocEditorType><SystemCode>RightRolesDtEx</SystemCode><DocContexts/><SaleForApproval>false</SaleForApproval><SaleOpen>false</SaleOpen><SalePaid>false</SalePaid><SaleCompleted>false</SaleCompleted><IndividualPAH>false</IndividualPAH><DataExportOutputFormat/><CsvFieldSeparator/><CsvQuoteCharacter/><CsvIncludeHeaderLine/><LogCount>4</LogCount><DataSourceSelection>false</DataSourceSelection><DataSourceId/><MaxDateRangeDays/><MediaEncoderPluginId/><ProductDocumentTagIDs/><AttachDocTemplateIDs/><MediaRfidOptionType/><DataSourceList><DataSource><Name>Default</Name><Code>6UF3MJHJM0X8X2W</Code><SQL unescaped="true"><![CDATA[DECLARE @sql NVARCHAR(MAX), @roleName VARCHAR(MAX), @tableCursor cursor;

set @sql = 'select tmp.RightName, tmp.RightType' + Stuff((
  select ', Min(Case tmp.RoleName When ''' + ROL.RoleName + ''' Then tmp.RightValue End) ''' + ROL.RoleName + ''''
  from tbRole ROL
  FOR XML PATH('')
), 1, 0, '');


SET @sql = CONCAT(@sql, '
  from
    (
      select
        X.RoleName,
        X.RightType,
        X.RightName,
        
		(case
                  
          when X.RightDecodeLookupTable is not null
          then (
            select stuff((
              select '', '' + X.ItemName
              from dbo.fnDecodeLookupArray(X.RightValue, X.RightDecodeLookupTable) X
              FOR XML PATH('''')
            ), 1, 2, '''')
          )
                  
          when X.RightDecodeEntityType is not null
          then (
            select stuff((
              select '', '' + dbo.fnEntityDesc(X.RightDecodeEntityType, ARR.Value)
              from dbo.fnDecodeUuidArray(X.RightValue) ARR
              FOR XML PATH('''')
            ), 1, 2, '''')
          )
          
          else X.RightValue end) AS ''RightValue''
      from
        (
          select 
            ROL.RoleName,
            LKI.ItemCode as RightType,
            LKI.ItemName as RightName,
            LKI.RightDecodeLookupTable,
            LKI.RightDecodeEntityType,
            Coalesce(RGT.RightValue, LKI.DefaultValue) as RightValue
          from
            tbRole ROL left join
            tbLookupItem LKI on 
              LKI.TableCode=34 and
              Coalesce(LKI.RightIsSetup, 0)=0 left join
            tbRight RGT on
              RGT.EntityId=ROL.RoleId and
              RGT.RightType=LKI.ItemCode 
          where
	        Coalesce(RGT.RightValue, LKI.DefaultValue) is not null
        ) X
    ) as tmp
  where
    tmp.RightName IS NOT NULL
  group by
     tmp.RightType,
     tmp.RightName
');

EXECUTE sp_executesql @sql;

]]></SQL></DataSource></DataSourceList><RightList><Right><IconName>station.png</IconName><UsrEntityType>3</UsrEntityType><UsrEntityId>20A03348-9A17-4EEF-A1EE-02E59B9E2911</UsrEntityId><UsrEntityCode>BKOFFICE</UsrEntityCode><UsrEntityName>Back Office</UsrEntityName><RightLevel>5</RightLevel></Right><Right><IconName>account_prs.png</IconName><UsrEntityType>15</UsrEntityType><UsrEntityId>A0000131-0000-0000-0000-000000000015</UsrEntityId><UsrEntityCode/><UsrEntityName>Every user</UsrEntityName><RightLevel>5</RightLevel></Right></RightList></DocTemplate></DOEnt_DocTemplate>
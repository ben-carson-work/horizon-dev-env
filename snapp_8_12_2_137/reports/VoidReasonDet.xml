<?xml version="1.0" encoding="UTF-8" standalone="no"?><DOEnt_DocTemplate><Header><EntityType>37</EntityType><EntityId>6273206D-C5A9-4908-0713-0163F3ACBA3C</EntityId><LastUpdate>2020-10-01T15:23:00.000+0200</LastUpdate></Header><DocTemplate><IconName>rpt-dataexport.png</IconName><EntityType>37</EntityType><DocTemplateId>6273206D-C5A9-4908-0713-0163F3ACBA3C</DocTemplateId><DocTemplateName>Void reason details</DocTemplateName><DocTemplateCode>FY4KS5P5MBFGA90</DocTemplateCode><CategoryId>588BF595-7BC8-A2F1-02F1-0163F3ACA8FC</CategoryId><DocEnabled>true</DocEnabled><ExecRequireLogin>true</ExecRequireLogin><DocTemplateType>5</DocTemplateType><DocEditorType>6</DocEditorType><SystemCode>VoidReasonDet</SystemCode><DocContexts/><SaleForApproval>false</SaleForApproval><SaleOpen>false</SaleOpen><SalePaid>false</SalePaid><SaleCompleted>false</SaleCompleted><LogCount>0</LogCount><DataSourceSelection>false</DataSourceSelection><DataSourceId/><MaxDateRangeDays/><MediaEncoderPluginId/><MediaRfidOptionType/><ParamList><Param><DocParamId>45872CEC-E057-9523-01D4-0174E41ABB7C</DocParamId><DocTemplateId>6273206D-C5A9-4908-0713-0163F3ACBA3C</DocTemplateId><DocParamType>4</DocParamType><DocParamName>DateFrom</DocParamName><DocParamCaption>@Common.FromDate</DocParamCaption><DocParamDefault>[@CurrentDate]</DocParamDefault><Mandatory>false</Mandatory></Param><Param><DocParamId>CE04B6FA-F5D2-15A1-01D5-0174E41ABB7C</DocParamId><DocTemplateId>6273206D-C5A9-4908-0713-0163F3ACBA3C</DocTemplateId><DocParamType>4</DocParamType><DocParamName>DateTo</DocParamName><DocParamCaption>@Common.ToDate</DocParamCaption><DocParamDefault>[@CurrentDate]</DocParamDefault><Mandatory>false</Mandatory></Param><Param><DocParamId>DECBE8FE-29F9-79DF-01D6-0174E41ABB7D</DocParamId><DocTemplateId>6273206D-C5A9-4908-0713-0163F3ACBA3C</DocTemplateId><DocParamType>1001</DocParamType><DocParamName>LocationId</DocParamName><DocParamCaption>@Account.Location</DocParamCaption><DocParamDefault>[@CurrentLocationId]</DocParamDefault><Mandatory>false</Mandatory></Param><Param><DocParamId>05BD3728-73B7-B491-01D7-0174E41ABB7D</DocParamId><DocTemplateId>6273206D-C5A9-4908-0713-0163F3ACBA3C</DocTemplateId><DocParamType>1002</DocParamType><DocParamName>OpAreaId</DocParamName><DocParamCaption>@Account.OpArea</DocParamCaption><DocParamDefault>[@CurrentOpAreaId]</DocParamDefault><Mandatory>false</Mandatory></Param><Param><DocParamId>B3B17120-4544-23A4-01D8-0174E41ABB7E</DocParamId><DocTemplateId>6273206D-C5A9-4908-0713-0163F3ACBA3C</DocTemplateId><DocParamType>1004</DocParamType><DocParamName>UserId</DocParamName><DocParamCaption>@Common.User</DocParamCaption><DocParamDefault>[@CurrentUserId]</DocParamDefault><Mandatory>false</Mandatory></Param><Param><DocParamId>F5080CA4-6FC5-80A2-01D9-0174E41ABB7F</DocParamId><DocTemplateId>6273206D-C5A9-4908-0713-0163F3ACBA3C</DocTemplateId><DocParamType>1003</DocParamType><DocParamName>WorkstationId</DocParamName><DocParamCaption>@Common.Workstation</DocParamCaption><DocParamDefault>[@CurrentWorkstationId]</DocParamDefault><Mandatory>false</Mandatory></Param></ParamList><DataSourceList><DataSource><Name>Default</Name><Code>3BKYF7CPWRY0H1D</Code><SQL><![CDATA[select §§n  tbLkTransactionType.ItemName as TransactionType,§§n  T.TransactionDateTime,§§n  ('T:' + CONVERT(varchar(10), T.LicenseId) + '.' + CONVERT(varchar(5), W.StationSerial) + '.' + CONVERT(VARCHAR(6),T.TransactionFiscalDate, 12) + '.' + CONVERT(varchar(5), T.TransactionSerial)) as [TDSSN],§§n  T.TransactionId,§§n  TCK.UnitAmount * TCK.GroupQuantity as TotalAmount,§§n  ('P:' + CONVERT(varchar(10), TCK.LicenseId) + '.' + CONVERT(varchar(5), TCK.StationSerial) + '.' + CONVERT(VARCHAR(6),TCK.EncodeFiscalDate, 12) + '.' + CONVERT(varchar(5), TCK.TicketSerial)) as [TicketTDSSN],§§n  TCK.GroupQuantity as Quantity,§§n  TCK.TicketId,§§n  P.ProductName,§§n  PG.TagName as PrintGroup,§§n  FG.TagName as FinanceGroup,§§n  S.SaleCode,§§n  UsrLogin.UserName,§§n  UsrEmail.UserName as LoginEmail,§§n  Usr.DisplayName as [User],§§n  SupLogin.UserName as AuthorisedByUserName,§§n  SupEmail.UserName as AuthorisedByLoginEmail,§§n  Sup.DisplayName as AuthorisedBy,§§n  Stuff((§§n      select ' | ' + MF.MetaFieldName + ': ' + coalesce(MFI.MetaFieldItemName, MD.ShortValue)§§n      from§§n		tbMetaData MD left join§§n		tbMetaField MF on MF.MetaFieldId=MD.MetaFieldId left join§§n		tbMetaFieldItem MFI on (MF.MetaFieldId=MFI.MetaFieldId and MD.ShortValue=MFI.MetaFieldItemCode)§§n      where§§n        MD.EntityId=T.TransactionId§§n      order by§§n        MF.MetaFieldCode§§n      FOR XML PATH('')§§n    ), 1, 1, '') as Reason§§nfrom  §§n  tbTransaction T inner join§§n  tbEntityLink EL on EL.SrcEntityId=T.TransactionId inner join§§n  tbTicket TCK on TCK.TicketId=EL.DstEntityId left join§§n  tbLookupItem tbLkTransactionType on tbLkTransactionType.TableCode=3 and tbLkTransactionType.ItemCode=T.TransactionType left join§§n  tbSale S on S.SaleId=T.SaleId left join§§n  tbProduct P on P.ProductId=TCK.ProductId left join§§n  tbTag PG on PG.TagId=P.PrintGroupTagId left join§§n  tbTag FG on FG.TagId=P.FinanceGroupTagId left join§§n  tbWorkstation W on T.WorkstationId=W.WorkstationId left join§§n  tbAccount OPA on OPA.AccountId=T.OpAreaId left join§§n  tbAccount Usr on Usr.AccountId=T.UserAccountId left join§§n  tbAccount Sup on Sup.AccountId=T.SupAccountId  left join§§n  tbLoginAlias UsrLogin on UsrLogin.AccountId=Usr.AccountId and UsrLogin.LoginAliasType=0 left join§§n  tbLoginAlias UsrEmail on UsrEmail.AccountId=Usr.AccountId and UsrEmail.LoginAliasType=1 left join§§n  tbLoginAlias SupLogin on SupLogin.AccountId=Sup.AccountId and SupLogin.LoginAliasType=0 left join§§n  tbLoginAlias SupEmail on SupEmail.AccountId=Sup.AccountId and SupEmail.LoginAliasType=1§§nwhere§§n  T.TransactionType in (12,13,14,22,47,48) and§§n  T.TransactionFiscalDate>=:@DateFrom and§§n  T.TransactionFiscalDate<=:@DateTo and§§n  (:@WorkstationId is null or W.WorkstationId=:@WorkstationId) and§§n  (:@OpAreaId is null or OPA.AccountId=:@OpAreaId) and§§n  (:@LocationId is null or OPA.ParentAccountId=:@LocationId) and§§n  (:@UserId is null or T.UserAccountId=:@UserId)§§n§§nunion§§n§§nselect §§n  tbLkTransactionType.ItemName as TransactionType,§§n  T.TransactionDateTime,§§n  null,§§n  T.TransactionId,§§n  -(SI.UnitAmount * SI.Quantity) as TotalAmount,§§n  null,§§n  -SI.Quantity as Quantity,§§n  null,§§n  P.ProductName,§§n  PG.TagName as PrintGroup,§§n  FG.TagName as FinanceGroup,§§n  S.SaleCode,§§n  UsrLogin.UserName,§§n  UsrEmail.UserName as LoginEmail,§§n  Usr.DisplayName as [User],§§n  SupLogin.UserName as AuthorisedByUserName,§§n  SupEmail.UserName as AuthorisedByLoginEmail,§§n  Sup.DisplayName as AuthorisedBy,§§n  Stuff((§§n      select ' | ' + MF.MetaFieldName + ': ' + coalesce(MFI.MetaFieldItemName, MD.ShortValue)§§n      from§§n		tbMetaData MD left join§§n		tbMetaField MF on MF.MetaFieldId=MD.MetaFieldId left join§§n		tbMetaFieldItem MFI on (MF.MetaFieldId=MFI.MetaFieldId and MD.ShortValue=MFI.MetaFieldItemCode)§§n      where§§n        MD.EntityId=T.TransactionId§§n      order by§§n        MF.MetaFieldCode§§n      FOR XML PATH('')§§n    ), 1, 1, '') as Reason§§nfrom  §§n  tbTransaction T inner join§§n  tbTransactionItem TI on TI.TransactionId=T.TransactionId left join§§n  tbSaleItem SI on SI.SaleItemId=TI.SaleItemId left join§§n  tbLookupItem tbLkTransactionType on tbLkTransactionType.TableCode=3 and tbLkTransactionType.ItemCode=T.TransactionType left join§§n  tbSale S on S.SaleId=T.SaleId left join§§n  tbProduct P on P.ProductId=SI.ProductId left join§§n  tbTag PG on PG.TagId=P.PrintGroupTagId left join§§n  tbTag FG on FG.TagId=P.FinanceGroupTagId left join§§n  tbWorkstation W on T.WorkstationId=W.WorkstationId left join§§n  tbAccount OPA on OPA.AccountId=T.OpareaId left join§§n  tbAccount Usr on Usr.AccountId=T.UserAccountId left join§§n  tbAccount Sup on Sup.AccountId=T.SupAccountId  left join§§n  tbLoginAlias UsrLogin on UsrLogin.AccountId=Usr.AccountId and UsrLogin.LoginAliasType=0 left join§§n  tbLoginAlias UsrEmail on UsrEmail.AccountId=Usr.AccountId and UsrEmail.LoginAliasType=1 left join§§n  tbLoginAlias SupLogin on SupLogin.AccountId=Sup.AccountId and SupLogin.LoginAliasType=0 left join§§n  tbLoginAlias SupEmail on SupEmail.AccountId=Sup.AccountId and SupEmail.LoginAliasType=1§§nwhere§§n  T.TransactionType=46 and§§n  T.TransactionFiscalDate>=:@DateFrom and§§n  T.TransactionFiscalDate<=:@DateTo and§§n  (:@WorkstationId is null or W.WorkstationId=:@WorkstationId) and§§n  (:@OpAreaId is null or OPA.AccountId=:@OpAreaId) and§§n  (:@LocationId is null or OPA.ParentAccountId=:@LocationId) and§§n  (:@UserId is null or T.UserAccountId=:@UserId)§§norder by §§n  T.TransactionDateTime§§n				]]></SQL></DataSource></DataSourceList></DocTemplate></DOEnt_DocTemplate>
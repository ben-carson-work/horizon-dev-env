<?xml version="1.0" encoding="UTF-8" standalone="no"?><DOEnt_DocTemplate><Header><EntityType>37</EntityType><EntityId>345A29D9-8883-18E3-000E-0153CC2334DE</EntityId><LastUpdate>2023-12-13T17:16:00.000+0100</LastUpdate></Header><DocTemplate><IconName>rpt-dataexport.png</IconName><EntityType>37</EntityType><DocTemplateId>345A29D9-8883-18E3-000E-0153CC2334DE</DocTemplateId><DocTemplateName>@Stats.LedgerLog</DocTemplateName><DocTemplateCode>DOC43</DocTemplateCode><CategoryId>56E73AC4-0538-494A-B661-345BBBDE739D</CategoryId><DocEnabled>true</DocEnabled><ExecRequireLogin>true</ExecRequireLogin><DocTemplateType>5</DocTemplateType><DocEditorType>6</DocEditorType><SystemCode>LedgerLog</SystemCode><DocContexts/><SaleForApproval>false</SaleForApproval><SaleOpen>false</SaleOpen><SalePaid>false</SalePaid><SaleCompleted>false</SaleCompleted><IndividualPAH>false</IndividualPAH><DataExportOutputFormat/><CsvFieldSeparator/><CsvQuoteCharacter/><CsvIncludeHeaderLine/><LogCount>2</LogCount><DataSourceSelection>false</DataSourceSelection><DataSourceId/><MaxDateRangeDays/><MediaEncoderPluginId/><ProductDocumentTagIDs/><AttachDocTemplateIDs/><MediaRfidOptionType/><ParamList><Param><DocParamId>55ECBBCC-A3D6-8BDC-0445-018BF0F683B7</DocParamId><DocTemplateId>345A29D9-8883-18E3-000E-0153CC2334DE</DocTemplateId><DocParamType>4</DocParamType><DocParamName>DateFrom</DocParamName><DocParamCaption>@Common.FromDate</DocParamCaption><DocParamDefault>[@CurrentDate]</DocParamDefault><Mandatory>false</Mandatory></Param><Param><DocParamId>DCFC17E9-AD8F-6FC1-0446-018BF0F683B8</DocParamId><DocTemplateId>345A29D9-8883-18E3-000E-0153CC2334DE</DocTemplateId><DocParamType>4</DocParamType><DocParamName>DateTo</DocParamName><DocParamCaption>@Common.ToDate</DocParamCaption><DocParamDefault>[@CurrentDate]</DocParamDefault><Mandatory>false</Mandatory></Param></ParamList><DataSourceList><DataSource><Name>Default</Name><Code>JQD8XMSTH5YACKD</Code><SQL unescaped="true"><![CDATA[declare @DateFrom date;
declare @DateTo date;

set @DateFrom=:@DateFrom;
set @DateTo=:@DateTo;

select
  convert(varchar, L.LedgerFiscalDate, 103) as [FiscalDate],
  SubString(convert(varchar, L.LedgerDateTime, 103), 1, 10) as [Date],
  SubString(convert(varchar, L.LedgerDateTime, 8), 1, 5) as [Time],
  coalesce(cast(L.LedgerAccountId as varchar(max)), '-') as [LedgerAccountId],
  coalesce(LA.LedgerAccountCode, '-') as [LedgerAccountCode],
  coalesce(LA.LedgerAccountName, '-') as [LedgerAccountName],
  coalesce(cast(LOC.AccountId as varchar(max)), '-') as [AccountId],
  coalesce(LOC.DisplayName, '-') as [DisplayName],
  coalesce(LA.LedgerAccountType, '-') as [LedgerAccountType],
  LedgerAccountType.ItemName as [LedgerAccountTypeName],
  coalesce(L.LedgerType, '-') as [LedgerTriggerType],    
  LedgerType.ItemName as [LedgerTriggerTypeName],
  coalesce(LR.LedgerRefAmount, L.LedgerAmount) as [LedgerAmount],
  coalesce(L.GroupEntityType, '') as [GroupEntityType],
  LedgerGroupEntityType.ItemName as [GroupEntityTypeName],
  coalesce(cast(L.GroupEntityId as varchar(max)), '-') as [GroupEntityId],
  coalesce(LR.EntityType, '-') as [EntityType],
  LedgerEntityType.ItemName as [EntityTypeName],
  coalesce(cast(LR.EntityId as varchar(max)), '-') as [EntityId],
  (case
     when L.LedgerType=111 then cast(LR.EntityId as varchar(max))
     when L.LedgerType=112 then cast((select TU.SourceTicketId from tbTicketUpgrade TU where TU.TicketId=LR.EntityId) as varchar(max))
     else '-'
	 end
   ) as [SourceEntityId],
   (case
     when L.LedgerType=111 then cast((select TU.TicketId from tbTicketUpgrade TU where TU.SourceTicketId=LR.EntityId) as varchar(max))
     when L.LedgerType=112 then cast(LR.EntityId as varchar(max))
     else '-'
	 end
   ) as [TargetEntityId],
   LR.UsedTicket
from 
  tbLedger L WITH(INDEX(IX_Ledger_FiscalDate)) left join
  tbLedgerAccount LA WITH(FORCESEEK) on LA.LedgerAccountId=L.LedgerAccountId left join
  tbLedgerRef LR WITH(INDEX(PK_LedgerRef)) on LR.GroupEntityId=L.GroupEntityId and LR.LedgerSerial=L.LedgerSerial left join
  tbLookupItem LedgerType WITH(FORCESEEK) on LedgerType.ItemCode=L.LedgerType and LedgerType.TableCode=183 left join
  tbLookupItem LedgerAccountType WITH(FORCESEEK) on LedgerAccountType.ItemCode=LA.LedgerAccountType and LedgerAccountType.TableCode=186 left join
  tbLookupItem LedgerGroupEntityType WITH(FORCESEEK) on LedgerGroupEntityType.ItemCode=L.GroupEntityType and LedgerGroupEntityType.TableCode=131 left join
  tbLookupItem LedgerEntityType WITH(FORCESEEK) on LedgerEntityType.ItemCode=LR.EntityType and LedgerEntityType.TableCode=131 left join
  tbAccount LOC WITH(FORCESEEK) on LOC.AccountId=L.AccountId
where
  L.LedgerFiscalDate>=@DateFrom and  
  L.LedgerFiscalDate<=@DateTo
order by 
  [Date] DESC,
  [Time] DESC,
  [GroupEntityId],
  [LedgerAmount]]]></SQL></DataSource></DataSourceList><RightList><Right><IconName>station.png</IconName><UsrEntityType>3</UsrEntityType><UsrEntityId>20A03348-9A17-4EEF-A1EE-02E59B9E2911</UsrEntityId><UsrEntityCode>BKOFFICE</UsrEntityCode><UsrEntityName>Back Office</UsrEntityName><RightLevel>5</RightLevel></Right><Right><IconName>account_prs.png</IconName><UsrEntityType>15</UsrEntityType><UsrEntityId>A0000131-0000-0000-0000-000000000015</UsrEntityId><UsrEntityCode/><UsrEntityName>Every user</UsrEntityName><RightLevel>5</RightLevel></Right></RightList></DocTemplate></DOEnt_DocTemplate>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><DOEnt_DocTemplate><Header><EntityType>37</EntityType><EntityId>cab41494-6397-58b3-001b-0196a5c682e4</EntityId><LastUpdate>2025-05-07T17:09:00.000+0200</LastUpdate><EntityChangeId>11576792</EntityChangeId></Header><DocTemplate><IconName>doctemplate_page.png</IconName><EntityType>37</EntityType><DocTemplateId>CAB41494-6397-58B3-001B-0196A5C682E4</DocTemplateId><DocTemplateName>Mobile Waiver From Ticket</DocTemplateName><DocTemplateCode>PG-AccTckWaiver</DocTemplateCode><CategoryId>56E73AC4-0538-494A-B661-345BBBDE739D</CategoryId><DocEnabled>true</DocEnabled><ExecRequireLogin>true</ExecRequireLogin><DocTemplateType>24</DocTemplateType><DocEditorType>8</DocEditorType><DocData unescaped="true"><![CDATA[<!DOCTYPE html>
<html>
  <head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    
    <style>
      body {background:white; padding:50px}
      .logo-container {height:300px; background-image:url(imagecache?name=horizon-color-med.png&size=400); background-repeat:no-repeat; background-position:center}
      .field-list {margin-top:20px}
      .button-list {margin-top:50px; text-align:center}
      .hidden {display:none}
      body:not(.with-ticket) .visible-with-ticket {display:none}
      canvas {border: 1px solid #000;}
      #modal-success .account-temp-code {font-size:40px; font-weight:bold}
      #wait-glass {position:fixed; top:0; bottom:0; left:0; right:0; z-index:10000; text-align:center; color:white; background:rgba(0,0,0,0.4); padding-top:50px}
    </style>
    
    <script>
      $(document).ready(function() {
        $("#btn-ticket").click(onTicketClick);
        $("#btn-submit").click(onSubmitClick);
        $("#btn-reset").click(onResetClick);
        $("#cb-waiver").click(refreshWaiverVisibility);
      
        let ticket = null;

        function onTicketClick() {
          let $dlg = $("#modal-lookup");
          $dlg.modal("show");
          $dlg.find("#btn-lookup").click(function() {
            let $barcode = $("#txt-barcode");
            snpAPI("Ticket", "Search", {"TicketCode":$barcode.val()})
              .then(ansDO => {
                if (((ansDO.SearchRecap || []).TotalRecordCount || 0) == 0)
                  throw "Ticket not found!";

                ticket = ansDO.TicketList[0];
                $barcode.val("");
                $("#txt-ticketcode").val(ticket.TicketCode);
                $("body").addClass("with-ticket");
                if (ticket.PortfolioAccountId)
                  fillAccountData(ticket.PortfolioAccountId);
              })
              .catch(error => showErrorDialog(error));
          });
        }

        function onSubmitClick() {
          let reqDO = {
            "Account": {
              "EntityType": 15,
              "MetaDataList": [
                {"MetaFieldCode": "FT1",  "Value": $("#txt-firstname").val()},
                {"MetaFieldCode": "FT3",  "Value": $("#txt-lastname").val()},
                {"MetaFieldCode": "FT60", "Value": $("#txt-email").val()},
                {"MetaFieldCode": "FT15", "Value": $("#txt-phone").val()},
                {"MetaFieldCode": "MC",   "Value": $("#cb-comm").is(":checked") ? 1 : 0},
                {"MetaFieldCode": "TC",   "Value": $("#cb-terms").is(":checked") ? 1 : 0}
              ]
            }
          };
          
          if (ticket == null) {
            reqDO.Account.AccountStatus = 4; // TempAccount
            reqDO.TempAccountOpArea = {"OpAreaCode":"MEDIO-TBOOTH"};
          }
          else {
            reqDO.Account.AccountId = ticket.PortfolioAccountId;
            if (ticket.PortfolioAccountId == null)
              reqDO.PortfolioAssign = {"PortfolioList": [{"PortfolioId":ticket.PortfolioId}]};
          }
          
          if ($("#cb-waiver:checked").length > 0) {
            reqDO.CreateDocumentList = [{
              "DocTemplate": {"DocTemplateCode":"DOC-TestWaiver"},
              "MetaDataList": [
                {"MetaFieldCode": "SIGNATURE", "Value": $("#signature-pad")[0].toDataURL()}
              ]
            }]
          }
        
          snpAPI("Account", "SaveAccount2", reqDO)
            .then(ansDO => {
              let $dlg = $("#modal-success");
              $dlg.on("hidden.bs.modal", function() {
                onResetClick();
                location.reload();
              });
              $dlg.modal("show");
              
              if (ansDO.AccountTempCode)
                $("#success-message").html("Your reference number is <h1>" + ansDO.AccountTempCode + "</h1>");
            })
            .catch(error => showErrorDialog(error));
        }

        function onResetClick() {
          ticket = null;
          $(".field-container input").val("").prop("checked", false);
          clearCanvas();
        }
        
        function showErrorDialog(message) {
          var $dlg = $("#modal-failure");
          $dlg.find(".error-message").text(message); 
          $dlg.modal("show");
        }
        
        function refreshWaiverVisibility() {
          if ($("#cb-waiver:checked").length > 0)
            $("#waiver-container").removeClass("hidden");
          else
            $("#waiver-container").addClass("hidden");
        }

        function fillAccountData(accountId) {
          snpAPI("MetaData", "LoadMetaData", {"EntityId":accountId})
            .then(ansDO => {
              let map = {"FT1":$("#txt-firstname"), "FT3":$("#txt-lastname"), "FT60":$("#txt-email"), "FT15":$("#txt-phone")};
              for (const mdi of ansDO.MetaDataList || []) {
                let $field = map[mdi.MetaFieldCode];
                if ($field)
                  $field.val(mdi.Value);
              }
            })
            .catch(error => showErrorDialog(error));
        }
        
        
        
        
        
        
        
        //--- BEGIN - COMMON API UTILS ---//
        setInterval(renewToken, 59000);
        function renewToken() {
          snpAPI("Session", "RenewToken", {}, false)
            .then(ansDO => {
              if (ansDO.Renewed !== true)
                location.reload();
            })
            .catch(error => location.reload());
        }

        function getVgsServiceError(ans) {
          if (ans.status == 0)
            return "Server is unreacheable or the request timed out.\nPlease try again.";
          else if ((ans.status != null) && (ans.status != 200)) 
            return ans.status + ": " + ans.statusText;
          else if (ans.Header == null)
            return "Unreadable response";
          else if (ans.Header.StatusCode != 200)
            return (ans.Header.ErrorMessage || "unknown error");
          else
            return null;
        }

        function snpAPI(service, command, reqDO, showWaitGlass) {
          if (showWaitGlass !== false)
            $("#wait-glass").removeClass("hidden");
            
          return new Promise((resolve, reject) => {
            let req = {
              "Header": {"WorkstationId": "[@Rights.EntityId]"},
              "Request": {"Command": command}
            };

            req.Request[command] = reqDO;

            $.ajax({
              url: "service?cmd=" + service + "&format=json&ts=" + (new Date()).getTime(),
              type: "POST",
              data: JSON.stringify(req),
              dataType: "json"
            }).always(function(ans) {
              $("#wait-glass").addClass("hidden");
              let errorMsg = getVgsServiceError(ans);
              if (errorMsg) 
                reject(new Error(errorMsg));
              else
                resolve((ans.Answer || {})[command]);
            });
          });
        }

        //--- END - COMMON API UTILS ---//
        
        
        
        
        
        
        //--- BEGIN - SIGNATURE CANVAS ---//
        const canvas = document.getElementById('signature-pad');
        const ctx = canvas.getContext('2d');
        let drawing = false;
        
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchend', stopDrawing);
        canvas.addEventListener('touchmove', draw);

        function startDrawing(event) {
          drawing = true;
          ctx.beginPath();
          ctx.moveTo(getX(event), getY(event));
          event.preventDefault();
        }

        function stopDrawing() {
          drawing = false;
        }

        function draw(event) {
          if (drawing) {
            ctx.lineTo(getX(event), getY(event));
            ctx.stroke();
            event.preventDefault();
          }
        }

        function getX(event) {
          if (event.touches && event.touches.length > 0)
            return event.touches[0].clientX - canvas.offsetLeft;
          return event.clientX - canvas.offsetLeft;
        }

        function getY(event) {
          const rect = canvas.getBoundingClientRect();
          if (event.touches && event.touches.length > 0)
            return event.touches[0].clientY - rect.top;
          return event.clientY - rect.top;
        }

        function clearCanvas() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        //--- END - SIGNATURE CANVAS ---//
      });
    </script>
  </head>

  <body>
    <div class="logo-container"></div>
    <div class="disclaimer-container">
      The information we collect helps us personalise your Museum of the Future visit. Please read our Privacy policy for more information. <a href="https://en.wikipedia.org/wiki/Privacy_policy">Privacy policy</a>
    </div>
    
    <div class="button-list">
      <button type="button" class="btn btn-primary" id="btn-ticket">Bind to existing ticket</button>
    </div>
    <div class="field-list">
      <div class="field-container visible-with-ticket">
        <div class="form-floating mb-3">
          <input type="text" class="form-control" id="txt-ticketcode" autocomplete="off" disabled>
          <label for="floatingInput">Ticket</label>
        </div>
      </div>
      <div class="field-container">
        <div class="form-floating mb-3">
          <input type="text" class="form-control" id="txt-firstname" autocomplete="off" placeholder="John">
          <label for="floatingInput">First Name *</label>
        </div>
      </div>
      <div class="field-container">
        <div class="form-floating mb-3">
          <input type="text" class="form-control" id="txt-lastname" autocomplete="off" placeholder="Smith">
          <label for="floatingInput">Last Name *</label>
        </div>
      </div>
      <div class="field-container">
        <div class="form-floating mb-3">
          <input type="email" class="form-control" id="txt-email" autocomplete="off" placeholder="name@example.com">
          <label for="floatingInput">Email *</label>
        </div>
      </div>
      <div class="field-container">
        <div class="form-floating mb-3">
          <input type="number" class="form-control" id="txt-phone" autocomplete="off" placeholder=" ">
          <label for="floatingInput">Phone number *</label>
        </div>
      </div>
      <div class="field-container">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="true" id="cb-comm">
          <label class="form-check-label" for="cb-comm">
            Receive email and SMS updates and promotions from Museum of the Future
          </label>
        </div>
      </div>
      <div class="field-container">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="true" id="cb-terms">
          <label class="form-check-label" for="cb-terms">
            I agree to the terms and conditions * <a href="https://en.wikipedia.org/wiki/Terms_of_service">Read more</a>
          </label>
        </div>
      </div>

      <div class="field-container" style="margin-top:30px">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="true" id="cb-waiver">
          <label class="form-check-label" for="cb-waiver">Create Waiver document</label>
        </div>
      </div>
      <div id="waiver-container" class="hidden">
        <div>Signature</div>
        <canvas id="signature-pad" width="600" height="250"></canvas>      
      </div>
    </div>
    <div class="button-list">
      <button type="button" class="btn btn-secondary" id="btn-reset">Reset</button>
      <button type="button" class="btn btn-primary" id="btn-submit">Submit</button>
    </div>
    
    <div id="modal-lookup" class="modal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Enter barcode</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p><input type="text" class="form-control" id="txt-barcode"/></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="btn-lookup">Lookup</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          </div>
        </div>
      </div>
    </div>
    
    <div id="modal-success" class="modal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Thank You!</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Your demographics were successfully submitted.</p>
            <span id="success-message"></span>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    
    <div id="modal-failure" class="modal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Something went wrong</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <span class="error-message"></span>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    
    <div id="wait-glass" class="hidden">
      <div class="spinner-grow" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

  </body>
</html>]]></DocData><SystemCode>PG-AccTckWaiver</SystemCode><DocContexts/><SaleForApproval>false</SaleForApproval><SaleOpen>false</SaleOpen><SalePaid>false</SalePaid><SaleCompleted>false</SaleCompleted><IndividualPAH>false</IndividualPAH><PayByLink>false</PayByLink><CsvIncludeHeaderLine>false</CsvIncludeHeaderLine><CsvIncludeBOM>false</CsvIncludeBOM><LogCount>0</LogCount><DataSourceSelection>false</DataSourceSelection><AutoCompleteOnPayment>false</AutoCompleteOnPayment><RightList><Right><IconName>station.png</IconName><UsrEntityType>3</UsrEntityType><UsrEntityId>20A03348-9A17-4EEF-A1EE-02E59B9E2911</UsrEntityId><UsrEntityCode>BKOFFICE</UsrEntityCode><UsrEntityName>Back Office</UsrEntityName><RightLevel>5</RightLevel></Right><Right><IconName>account_prs.png</IconName><UsrEntityType>15</UsrEntityType><UsrEntityId>92DAB1BF-123C-4BE2-9C11-80620EA83054</UsrEntityId><UsrEntityCode>SYSUSR1000</UsrEntityCode><UsrEntityName>System</UsrEntityName><RightLevel>5</RightLevel></Right></RightList><RichDescList><RichDescItem><IconName>flag_USA.png</IconName><LangISO>en</LangISO><Description>&lt;p&gt;Sample page for "Account Registration" workstation (mobile).&lt;/p&gt;&lt;p&gt;It demonstrate multiple scenarios:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;A new temp-account is created (optionally&amp;nbsp;a signed waiver is created &amp;amp; attached)&lt;/li&gt;&lt;li&gt;Scan a ticket barcode, create / update account demographic and attach it to the ticket (optionally&amp;nbsp;a signed waiver is created &amp;amp; attached&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Please make sure that:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;MetaField codes are valid for your environment&lt;/li&gt;&lt;li&gt;Change the waiver doc template code if needed&lt;/li&gt;&lt;/ul&gt;</Description></RichDescItem></RichDescList></DocTemplate></DOEnt_DocTemplate>
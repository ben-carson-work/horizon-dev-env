<?xml version="1.0" encoding="UTF-8" standalone="no"?><DOEnt_DocTemplate><Header><EntityType>37</EntityType><EntityId>3EBE23E0-2814-B4C3-06D3-0163F3ACB9A2</EntityId><LastUpdate>2020-10-01T15:20:00.000+0200</LastUpdate></Header><DocTemplate><IconName>rpt-dataexport.png</IconName><EntityType>37</EntityType><DocTemplateId>3EBE23E0-2814-B4C3-06D3-0163F3ACB9A2</DocTemplateId><DocTemplateName>@Stats.TrnTicketsExp</DocTemplateName><DocTemplateCode>P0RK9V0R6Y18EAZ</DocTemplateCode><CategoryId>588BF595-7BC8-A2F1-02F1-0163F3ACA8FC</CategoryId><DocEnabled>true</DocEnabled><ExecRequireLogin>true</ExecRequireLogin><DocTemplateType>5</DocTemplateType><DocEditorType>6</DocEditorType><SystemCode>TrnTicketsExp</SystemCode><DocContexts/><SaleForApproval>false</SaleForApproval><SaleOpen>false</SaleOpen><SalePaid>false</SalePaid><SaleCompleted>false</SaleCompleted><LogCount>0</LogCount><DataSourceSelection>false</DataSourceSelection><DataSourceId/><MaxDateRangeDays/><MediaEncoderPluginId/><MediaRfidOptionType/><ParamList><Param><DocParamId>AF655C8C-9684-A77A-01A9-0174E41ABB02</DocParamId><DocTemplateId>3EBE23E0-2814-B4C3-06D3-0163F3ACB9A2</DocTemplateId><DocParamType>4</DocParamType><DocParamName>DateFrom</DocParamName><DocParamCaption>@Common.FromDate</DocParamCaption><DocParamDefault>[@CurrentDate]</DocParamDefault><Mandatory>false</Mandatory></Param><Param><DocParamId>2C32C548-A8BF-7CD2-01AA-0174E41ABB03</DocParamId><DocTemplateId>3EBE23E0-2814-B4C3-06D3-0163F3ACB9A2</DocTemplateId><DocParamType>4</DocParamType><DocParamName>DateTo</DocParamName><DocParamCaption>@Common.ToDate</DocParamCaption><DocParamDefault>[@CurrentDate]</DocParamDefault><Mandatory>false</Mandatory></Param><Param><DocParamId>A4F414ED-042A-F67D-01AB-0174E41ABB04</DocParamId><DocTemplateId>3EBE23E0-2814-B4C3-06D3-0163F3ACB9A2</DocTemplateId><DocParamType>1001</DocParamType><DocParamName>LocationId</DocParamName><DocParamCaption>@Account.Location</DocParamCaption><DocParamDefault>[@CurrentLocationId]</DocParamDefault><Mandatory>false</Mandatory></Param><Param><DocParamId>748FE62C-20E9-FCB0-01AD-0174E41ABB05</DocParamId><DocTemplateId>3EBE23E0-2814-B4C3-06D3-0163F3ACB9A2</DocTemplateId><DocParamType>1002</DocParamType><DocParamName>OpAreaId</DocParamName><DocParamCaption>@Account.OpArea</DocParamCaption><DocParamDefault>[@CurrentOpAreaId]</DocParamDefault><Mandatory>false</Mandatory></Param></ParamList><DataSourceList><DataSource><Name>Default</Name><Code>TD3KCHEDVW1JHFS</Code><SQL><![CDATA[declare @DateFrom date;§§ndeclare @DateTo date;§§n§§nset @DateFrom=:@DateFrom;§§nset @DateTo=:@DateTo;§§n§§nselect§§n  convert(varchar, Trn.TransactionFiscalDate, 103) as [TransactionFiscalDate],§§n  convert(varchar, Trn.TransactionDateTime, 103) as [TransactionDate],§§n  SubString(convert(varchar, Trn.TransactionDateTime, 8), 1, 5) as [TransactionTime],§§n  Trn.TransactionId,§§n  ('T:' + CONVERT(varchar(10), Trn.LicenseId) + '.' + CONVERT(varchar(5), Trn.StationSerial) + '.' + CONVERT(VARCHAR(6),Trn.TransactionFiscalDate, 12) + '.' + CONVERT(varchar(5), Trn.TransactionSerial)) as [TransactionTDSSN],§§n  Sal.SaleId,§§n  Sal.SaleCode as [PNR],§§n  Trn.TransactionSerial,§§n  Trn.TransactionType,§§n  TransactionType.ItemName as TransactionTypeDesc,§§n  SID.SaleItemId,§§n  TK.TicketId,§§n  ('T:' + CONVERT(varchar(10), TK.LicenseId) + '.' + CONVERT(varchar(5), TK.StationSerial) + '.' + CONVERT(VARCHAR(6),TK.EncodeFiscalDate, 12) + '.' + CONVERT(varchar(5), TK.TicketSerial)) as [TicketDSSN],§§n  TK.TicketStatus,§§n  TicketStatus.ItemName as TicketStatusDesc,§§n  CONVERT(nvarchar(max), TK.ValidDateFrom, 103) as [ValidFrom],§§n  CONVERT(nvarchar(max), TK.ValidDateTo, 103) as [ValidTo],§§n  Portfolio.AccountId as PortfolioAccountId,§§n  Portfolio.DisplayName as PortfolioAccountName,§§n  CONVERT(nvarchar(max), TK.FirstUsageDateTime, 103) as [FirstUsageDateTime],§§n  Tk.GroupQuantity,§§n  TK.GroupTicketOption,§§n  GroupTicketOption.ItemName as GroupTicketOptionDesc,§§n  TK.Settled,§§n  TK.ManualExpiration,§§n  TK.BonusEntry,§§n  TK.UnitAmount,§§n  TK.UnitTax,§§n  TK.ClearingLimit,§§n  Tk.ClearingUsed,§§n  CONVERT(nvarchar(max), TLT.TriggerDateTime, 103) as ExpiredOn,§§n  TK.ProductId,§§n  Prod.ProductCode,§§n  Prod.ProductName,§§n  Stuff(( §§n    select '|' + Cast(AI.AttributeItemId as varchar(max)) + '#' + AI.AttributeItemName + '#' + Cast(SI2AI.OptionalPrice as varchar(max)) + '#' + cast(SI2AI.Optional as varchar(1))§§n    from§§n      tbSaleItem2AttributeItem SI2AI inner join§§n      tbAttributeItem AI on AI.AttributeItemId=SI2AI.AttributeItemId inner join§§n      tbAttribute A on A.AttributeId=AI.AttributeId§§n    where SI2AI.SaleItemId=SID.SaleItemId§§n    order by §§n      A.AttributeWeight,§§n      AI.PriorityOrder§§n    FOR XML PATH('')§§n  ), 1, 1, '') + '|' as [AttributeItems],§§n  P.PerformanceId,§§n  convert(varchar, P.DateTimeFrom, 103) as [PerfDateFrom],§§n  SubString(convert(varchar, P.DateTimeFrom, 8), 1, 5) as [PerfTimeFrom],§§n  convert(varchar, P.DateTimeTo, 103) as [PerfDateTo],§§n  SubString(convert(varchar, P.DateTimeTo, 8), 1, 5) as [PerfTimeTo],§§n  P.EventId,§§n  E.EventCode,§§n  E.EventName,§§n  TUS.SourceTicketId,§§n  ('T:' + CONVERT(varchar(10), TicketSource.LicenseId) + '.' + CONVERT(varchar(5), TicketSource.StationSerial) + '.' + CONVERT(VARCHAR(6),TicketSource.EncodeFiscalDate, 12) + '.' + CONVERT(varchar(5), TicketSource.TicketSerial)) as [SrcTckDSSN]§§nfrom§§n  tbTransaction Trn inner join§§n  tbTicket TK on TK.TransactionId=Trn.TransactionId left join§§n  tbTicketLedgerTrigger TLT on TLT.TicketId=TK.TicketId and TLT.TriggerLedgerType=301 left join /* LK[183] */§§n  tbSaleItemDetail SID on SID.SaleItemDetailId=TK.SaleItemDetailId left join§§n  tbLookupItem TransactionType on TransactionType.ItemCode=Trn.TransactionType and TransactionType.TableCode=3 left join§§n  tbLookupItem TicketStatus on TicketStatus.ItemCode=TK.TicketStatus and TicketStatus.TableCode=5 left join§§n  tbLookupItem GroupTicketOption on GroupTicketOption.ItemCode=TK.GroupTicketOption and GroupTicketOption.TableCode=153 left join§§n  tbSale Sal on Sal.SaleId=Trn.SaleId left join§§n  tbAccount OPA on OPA.AccountId=Trn.OpAreaId left join§§n  tbProduct Prod on Prod.ProductId=TK.ProductId left join§§n  tbTicketMediaMatch TMM on TMM.TicketMediaMatchId=TK.TicketMediaMatchId left join§§n  tbAccount Portfolio on Portfolio.AccountId=TMM.AccountId left join§§n  tbAccountDetail PortfolioDetail on PortfolioDetail.AccountId=Portfolio.AccountId left join§§n  tbPerformanceSetDetail PSD on PSD.PerformanceSetId=TK.PerformanceSetId left join§§n  tbPerformance P on P.PerformanceId=PSD.PerformanceId left join§§n  tbEvent E on E.EventId=P.EventId left join§§n  tbTicketUpgrade TUS on TUS.TicketId=TK.TicketId left join§§n  tbTicket TicketSource on TicketSource.TicketId=TUS.SourceTicketId§§nwhere§§n  Trn.TransactionFiscalDate>=@DateFrom and  §§n  Trn.TransactionFiscalDate<=@DateTo and§§n  (:@OpAreaId is null or OPA.AccountId=:@OpAreaId) and§§n  (:@LocationId is null or OPA.ParentAccountId=:@LocationId)§§n§§nunion§§n§§nselect§§n  convert(varchar, Trn.TransactionFiscalDate, 103) as [TransactionFiscalDate],§§n  convert(varchar, Trn.TransactionDateTime, 103) as [TransactionDate],§§n  SubString(convert(varchar, Trn.TransactionDateTime, 8), 1, 5) as [TransactionTime],§§n  Trn.TransactionId,§§n  ('T:' + CONVERT(varchar(10), Trn.LicenseId) + '.' + CONVERT(varchar(5), Trn.StationSerial) + '.' + CONVERT(VARCHAR(6),Trn.TransactionFiscalDate, 12) + '.' + CONVERT(varchar(5), Trn.TransactionSerial)) as [TransactionTDSSN],§§n  Sal.SaleId,§§n  Sal.SaleCode as [PNR],§§n  Trn.TransactionSerial,§§n  Trn.TransactionType,§§n  TransactionType.ItemName as TransactionTypeDesc,§§n  SID.SaleItemId,§§n  TK.TicketId,§§n  ('T:' + CONVERT(varchar(10), TK.LicenseId) + '.' + CONVERT(varchar(5), TK.StationSerial) + '.' + CONVERT(VARCHAR(6),TK.EncodeFiscalDate, 12) + '.' + CONVERT(varchar(5), TK.TicketSerial)) as [TicketDSSN],§§n  TK.TicketStatus,§§n  TicketStatus.ItemName as TicketStatusDesc,§§n  CONVERT(nvarchar(max), TK.ValidDateFrom, 103) as [ValidFrom],§§n  CONVERT(nvarchar(max), TK.ValidDateFrom, 103) as [ValidTo],§§n  Portfolio.AccountId as PortfolioAccountId,§§n  Portfolio.DisplayName as PortfolioAccountName,§§n  CONVERT(nvarchar(max), TK.FirstUsageDateTime, 103) as [FirstUsageDateTime],§§n  -Tk.GroupQuantity,§§n  TK.GroupTicketOption,§§n  GroupTicketOption.ItemName as GroupTicketOptionDesc,§§n  TK.Settled,§§n  TK.ManualExpiration,§§n  TK.BonusEntry,§§n  TK.UnitAmount,§§n  TK.UnitTax,§§n  TK.ClearingLimit,§§n  Tk.ClearingUsed,§§n  CONVERT(nvarchar(max), TLT.TriggerDateTime, 103) as ExpiredOn,§§n  TK.ProductId,§§n  Prod.ProductCode,§§n  Prod.ProductName,§§n  Stuff(( §§n    select '|' + Cast(AI.AttributeItemId as varchar(max)) + '#' + AI.AttributeItemName + '#' + Cast(SI2AI.OptionalPrice as varchar(max)) + '#' + cast(SI2AI.Optional as varchar(1))§§n    from§§n      tbSaleItem2AttributeItem SI2AI inner join§§n      tbAttributeItem AI on AI.AttributeItemId=SI2AI.AttributeItemId inner join§§n      tbAttribute A on A.AttributeId=AI.AttributeId§§n    where SI2AI.SaleItemId=SID.SaleItemId§§n    order by §§n      A.AttributeWeight,§§n      AI.PriorityOrder§§n    FOR XML PATH('')§§n  ), 1, 1, '') + '|' as [AttributeItems],§§n  P.PerformanceId,§§n  convert(varchar, P.DateTimeFrom, 103) as [PerfDateFrom],§§n  SubString(convert(varchar, P.DateTimeFrom, 8), 1, 5) as [PerfTimeFrom],§§n  convert(varchar, P.DateTimeTo, 103) as [PerfDateTo],§§n  SubString(convert(varchar, P.DateTimeTo, 8), 1, 5) as [PerfTimeTo],§§n  P.EventId,§§n  E.EventCode,§§n  E.EventName,§§n  TUS.SourceTicketId,§§n  ('T:' + CONVERT(varchar(10), TicketSource.LicenseId) + '.' + CONVERT(varchar(5), TicketSource.StationSerial) + '.' + CONVERT(VARCHAR(6),TicketSource.EncodeFiscalDate, 12) + '.' + CONVERT(varchar(5), TicketSource.TicketSerial)) as [SrcTckDSSN]§§nfrom§§n  tbTransaction Trn inner join§§n  tbEntityLink EL on EL.SrcEntityId=Trn.TransactionId and EL.DstEntityType=22 and EL.EntityLinkType=8 left join§§n  tbTicket TK on TK.TicketId=EL.DstEntityId left join§§n  tbTicketLedgerTrigger TLT on TLT.TicketId=TK.TicketId and TLT.TriggerLedgerType=301 left join /* LK[183] */§§n  tbSaleItemDetail SID on SID.SaleItemDetailId=TK.SaleItemDetailId left join§§n  tbLookupItem TransactionType on TransactionType.ItemCode=Trn.TransactionType and TransactionType.TableCode=3 left join§§n  tbLookupItem TicketStatus on TicketStatus.ItemCode=TK.TicketStatus and TicketStatus.TableCode=5 left join§§n  tbLookupItem GroupTicketOption on GroupTicketOption.ItemCode=TK.GroupTicketOption and GroupTicketOption.TableCode=153 left join§§n  tbSale Sal on Sal.SaleId=Trn.SaleId left join§§n  tbAccount OPA on OPA.AccountId=Trn.OpAreaId left join§§n  tbProduct Prod on Prod.ProductId=TK.ProductId left join§§n  tbTicketMediaMatch TMM on TMM.TicketMediaMatchId=TK.TicketMediaMatchId left join§§n  tbAccount Portfolio on Portfolio.AccountId=TMM.AccountId left join§§n  tbAccountDetail PortfolioDetail on PortfolioDetail.AccountId=Portfolio.AccountId left join§§n  tbPerformanceSetDetail PSD on PSD.PerformanceSetId=TK.PerformanceSetId left join§§n  tbPerformance P on P.PerformanceId=PSD.PerformanceId left join§§n  tbEvent E on E.EventId=P.EventId left join§§n  tbTicketUpgrade TUS on TUS.TicketId=TK.TicketId left join§§n  tbTicket TicketSource on TicketSource.TicketId=TUS.SourceTicketId§§nwhere§§n  Trn.TransactionFiscalDate>=@DateFrom and  §§n  Trn.TransactionFiscalDate<=@DateTo and§§n  (:@OpAreaId is null or OPA.AccountId=:@OpAreaId) and§§n  (:@LocationId is null or OPA.ParentAccountId=:@LocationId)§§n				]]></SQL></DataSource></DataSourceList></DocTemplate></DOEnt_DocTemplate>
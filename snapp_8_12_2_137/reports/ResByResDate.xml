<?xml version="1.0" encoding="UTF-8" standalone="no"?><DOEnt_DocTemplate><Header><EntityType>37</EntityType><EntityId>EBB2226F-3ED9-5721-006A-015B8108BBCD</EntityId><LastUpdate>2018-12-17T11:38:00.000+0100</LastUpdate></Header><DocTemplate><IconName>rpt-dataexport.png</IconName><EntityType>37</EntityType><DocTemplateId>EBB2226F-3ED9-5721-006A-015B8108BBCD</DocTemplateId><DocTemplateName>Reservations by reservation date</DocTemplateName><DocTemplateCode>DOC76</DocTemplateCode><CategoryId>56E73AC4-0538-494A-B661-345BBBDE739D</CategoryId><DocEnabled>true</DocEnabled><ExecRequireLogin>true</ExecRequireLogin><DocTemplateType>5</DocTemplateType><DocEditorType>6</DocEditorType><SystemCode>ResByResDate</SystemCode><DocContexts/><SaleForApproval>false</SaleForApproval><SaleOpen>false</SaleOpen><SalePaid>false</SalePaid><SaleCompleted>false</SaleCompleted><LogCount>0</LogCount><DataSourceSelection>false</DataSourceSelection><DataSourceId/><MaxDateRangeDays/><MediaRfidOptionType/><ParamList><Param><DocParamId>924C8A9F-DC61-6DC7-02B4-01669AEF8032</DocParamId><DocTemplateId>EBB2226F-3ED9-5721-006A-015B8108BBCD</DocTemplateId><DocParamType>4</DocParamType><DocParamName>DateFrom</DocParamName><DocParamCaption>Date From</DocParamCaption><DocParamDefault>[@CurrentDate]</DocParamDefault><Mandatory>false</Mandatory></Param><Param><DocParamId>F0E0144B-B5AA-3839-02B5-01669AEF8033</DocParamId><DocTemplateId>EBB2226F-3ED9-5721-006A-015B8108BBCD</DocTemplateId><DocParamType>4</DocParamType><DocParamName>DateTo</DocParamName><DocParamCaption>Date To</DocParamCaption><DocParamDefault>[@CurrentDate]</DocParamDefault><Mandatory>false</Mandatory></Param><Param><DocParamId>C5F0BD59-469A-2403-02B6-01669AEF8036</DocParamId><DocTemplateId>EBB2226F-3ED9-5721-006A-015B8108BBCD</DocTemplateId><DocParamType>1</DocParamType><DocParamName>EventCode</DocParamName><DocParamCaption>Event Code</DocParamCaption><DocParamDefault/><Mandatory>false</Mandatory></Param><Param><DocParamId>0E82AD54-E238-1CE7-02B8-01669AEF8037</DocParamId><DocTemplateId>EBB2226F-3ED9-5721-006A-015B8108BBCD</DocTemplateId><DocParamType>1001</DocParamType><DocParamName>LocationId</DocParamName><DocParamCaption>Location</DocParamCaption><DocParamDefault/><Mandatory>false</Mandatory></Param><Param><DocParamId>A9F5D725-39E5-BABC-02B9-01669AEF8038</DocParamId><DocTemplateId>EBB2226F-3ED9-5721-006A-015B8108BBCD</DocTemplateId><DocParamType>1</DocParamType><DocParamName>Z_AttributeItemCode</DocParamName><DocParamCaption>Attribute Code</DocParamCaption><DocParamDefault/><Mandatory>false</Mandatory></Param></ParamList><DataSourceList><DataSource><Name>Default</Name><Code>9Y79HDBBDQM5GWK</Code><SQL><![CDATA[select §§n  Convert(varchar, Sal.SaleFiscalDate, 103) as [Booking Date],§§n  (§§n    select Convert(varchar, Min(T.TransactionDateTime), 103)§§n    from§§n      tbTransaction T inner join§§n      tbPayment P on P.TransactionId=T.TransactionId§§n    where§§n      T.SaleId=Sal.SaleId§§n  ) as [Payment Date],§§n  Sal.SaleCode as PNR,§§n  Cast(Sal.Approved as int) as [Approved],§§n  Cast(Sal.Paid as int) as [Paid],§§n  Cast(Sal.Encoded as int) as [Encoded],§§n  Cast(Sal.Printed as int) as [Printed],§§n  Cast(Sal.Validated as int) as [Validated],§§n  Cast(Sal.Completed as int) as [Completed],§§n  Wks.WorkstationName as [Workstation Name],§§n  (§§n    select top 1 Usr.DisplayName§§n    from§§n      tbTransaction Trn inner join§§n      tbAccount Usr on Usr.AccountId=Trn.UserAccountId§§n    where§§n      Trn.SaleId=Sal.SaleId§§n    order by§§n      Trn.TransactionDateTime desc§§n  ) as [User],§§n  Stuff((§§n    select ', ' + CAT.CategoryName§§n    from§§n      tbCategory2Entity C2E inner join§§n      tbCategory CAT on CAT.CategoryId=C2E.CategoryId§§n    where C2E.EntityId=Acc.AccountId§§n    order by CAT.CategoryName§§n    FOR XML PATH('')§§n  ), 1, 2, '') as [Account Category],§§n  Acc.DisplayName as [Account],§§n  AD.Address,§§n  AD.City,§§n  AD.Country,§§n  AD.BusinessPhone,§§n  AD.MobilePHone,§§n  Loc.DisplayName as [Location Name],§§n  Evn.EventName as [Event],§§n  Prod.ProductName as [Product],§§n  Stuff((§§n      select ', ' + AttributeItemName§§n      from§§n        tbSaleItem2AttributeItem SI2AI left outer join§§n        tbAttributeItem AI on AI.AttributeItemId=SI2AI.AttributeItemId left outer join§§n        tbAttribute A on A.AttributeId=AI.AttributeId§§n      where§§n        SI2AI.SaleItemId=SI.SaleItemId and§§n        SI2AI.Optional<>0§§n      order by§§n        A.AttributeWeight,§§n        AI.AttributeItemName§§n      FOR XML PATH('')§§n    ), 1, 1, '') as [Attributes],§§n  convert(varchar, Perf.DateTimeFrom, 103) as [Performance Date],§§n  SubString(convert(varchar, Perf.DateTimeFrom, 108), 1, 5) as [Performance Time],§§n  SI.Quantity as [Quantity],§§n  SI.UnitAmount as [Unit Price],§§n  SI.TotalAmount as [Total Amount],§§n  (§§n    select top 1 Coalesce(Plg.PluginName, Drv.DriverName)§§n    from§§n      tbTransaction Trn inner join§§n      tbPayment Pay on Pay.TransactionId=Trn.TransactionId inner join§§n      tbPlugin Plg on Plg.PluginId=Pay.PluginId inner join§§n      tbDriver Drv on Drv.DriverId=Plg.DriverId§§n    where§§n      Trn.SaleId=Sal.SaleId§§n  ) as [Payment],§§n  Stuff((§§n      select distinct§§n      	'|' + SS.SaleCode§§n      from §§n    	tbEntityLink EL left join§§n    	tbSale SS on SS.SaleId=EL.SrcEntityId§§n      where §§n    	EL.DstEntityId=Sal.SaleId§§n      FOR XML PATH('')§§n    ), 1, 1, '') as [Source PNR],§§n  Stuff((§§n      select distinct§§n      	'|' + SS.SaleCode§§n      from §§n    	tbEntityLink EL left join§§n    	tbSale SS on SS.SaleId=EL.DstEntityId§§n      where §§n    	EL.SrcEntityId=Sal.SaleId and§§n        DstEntityType=21 --Sale§§n      FOR XML PATH('')§§n    ), 1, 1, '') as [Destination PNRs]§§nfrom§§n  tbSale Sal left outer join§§n  tbSale2Account S2A on S2A.SaleId=Sal.SaleId and S2A.SaleAccountType=1 left outer join§§n  tbWorkstation Wks on Wks.WorkstationId=Sal.WorkstationId left outer join§§n  tbAccount Acc on Acc.AccountId=S2A.AccountId left outer join§§n  tbAccountDetail AD on AD.AccountId=Acc.AccountId left outer join§§n  tbSaleItem SI on SI.SaleId=Sal.SaleId left outer join§§n  tbProduct Prod on Prod.ProductId=SI.ProductId left outer join§§n  tbPerformance Perf on Perf.PerformanceId=SI.PerformanceId left outer join§§n  tbEvent Evn on Evn.EventId=Perf.EventId left outer join§§n  tbAccount Loc on Loc.AccountId=Perf.LocationAccountId§§nwhere§§n  S2A.AccountId is not null and§§n  Sal.SaleStatus=1 and§§n  Sal.SaleFiscalDate >= :@DateFrom and§§n  DateAdd(day, -1, Sal.SaleFiscalDate) < :@DateTo and§§n  (§§n    :@Z_AttributeItemCode is null or§§n    :@Z_AttributeItemCode = '' or§§n    SI.SaleItemId in (§§n      select distinct SI2AI.SaleItemId §§n      from §§n        tbSaleItem2AttributeItem SI2AI inner join§§n        tbAttributeItem AI on AI.AttributeItemId=SI2AI.AttributeItemId§§n      where AI.AttributeItemCode=:@Z_AttributeItemCode§§n    )§§n  ) and§§n  (:@LocationId is null or Wks.LocationAccountId=:@LocationId) and§§n  (§§n    :@EventCode is null or§§n    :@EventCode='' or§§n    Evn.EventCode=:@EventCode§§n  )§§norder by§§n  Perf.DateTimeFrom,§§n  Acc.DisplayName,§§n  Prod.ProductName]]></SQL></DataSource></DataSourceList></DocTemplate></DOEnt_DocTemplate>
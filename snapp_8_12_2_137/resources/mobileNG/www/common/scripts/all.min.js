var COMMON_METHODS={},NativeBridge={callbacksCount:1,callbacks:{},resultForCallback:function(e,t){var M=this;try{var a=M.callbacks[e];if(!a)return;a.apply(null,t)}catch(e){alert(e)}},call:function(e,t,M){var a=this,r=M&&"function"==typeof M,O=r?a.callbacksCount++:0;r&&(a.callbacks[O]=M);var n=document.createElement("IFRAME");n.setAttribute("src","js-frame:"+e+":"+O+":"+encodeURIComponent(JSON.stringify(t))),document.documentElement.appendChild(n),n.parentNode.removeChild(n),n=null}};COMMON_METHODS.sendCommand=function(e){NativeBridge.call(e,[],null)},COMMON_METHODS.activatePlugins=function(e){NativeBridge.call("SetPlugins",[e],null)},COMMON_METHODS.keyboard=function(e){return{KEY_BACKSPACE:8,KEY_TAB:9,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_CAPSLOCK:20,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_NUM_0:96,KEY_NUM_1:97,KEY_NUM_2:98,KEY_NUM_3:99,KEY_NUM_4:100,KEY_NUM_5:101,KEY_NUM_6:102,KEY_NUM_7:103,KEY_NUM_8:104,KEY_NUM_9:105}[e]},COMMON_METHODS.leadZero=function(e,t){for(var M=""+e;M.length<t;)M="0"+M;return M},COMMON_METHODS.dateToXML=function(e){return e.getFullYear()+"-"+COMMON_METHODS.leadZero(e.getMonth()+1,2)+"-"+COMMON_METHODS.leadZero(e.getDate(),2)+"T"+COMMON_METHODS.leadZero(e.getHours(),2)+":"+COMMON_METHODS.leadZero(e.getMinutes(),2)+":"+COMMON_METHODS.leadZero(e.getSeconds(),2)+"."+COMMON_METHODS.leadZero(e.getMilliseconds(),3)},COMMON_METHODS.xmlToDate=function(e){if(e&&e.length>=10){var t=parseInt(e.substring(0,4)),M=parseInt(e.substring(5,7))-1,a=parseInt(e.substring(8,10)),r=0,O=0,n=0,l=0;return e.length>=16&&(r=parseInt(e.substring(11,13)),O=parseInt(e.substring(14,16))),e.length>=19&&(n=parseInt(e.substring(17,19))),e.length>=23&&(l=parseInt(e.substring(20,23))),new Date(t,M,a,r,O,n,l)}return new Date},COMMON_METHODS.fmtDateMonths=["January","February","March","April","May","June","July","August","September","October","November","December"],COMMON_METHODS.fmtDateWeekDays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],COMMON_METHODS.formatDate=function(e,t){if(null==e)return null;switch(parseInt(t)){case 101:return COMMON_METHODS.leadZero(e.getDate(),2)+"/"+COMMON_METHODS.leadZero(e.getMonth()+1,2)+"/"+e.getFullYear();case 102:return COMMON_METHODS.leadZero(e.getDate(),2)+"/"+COMMON_METHODS.leadZero(e.getMonth()+1,2)+"/"+(""+e.getFullYear()).substring(2,4);case 103:return COMMON_METHODS.leadZero(e.getMonth()+1,2)+"/"+COMMON_METHODS.leadZero(e.getDate(),2)+"/"+e.getFullYear();case 104:return COMMON_METHODS.leadZero(e.getMonth()+1,2)+"/"+COMMON_METHODS.leadZero(e.getDate(),2)+"/"+(""+e.getFullYear()).substring(2,4);case 201:return COMMON_METHODS.fmtDateWeekDays[e.getDay()]+" "+e.getDate()+" "+COMMON_METHODS.fmtDateMonths[e.getMonth()]+" "+e.getFullYear();case 202:return e.getDate()+" "+COMMON_METHODS.fmtDateMonths[e.getMonth()]+" "+e.getFullYear();case 203:return COMMON_METHODS.fmtDateMonths[e.getMonth()]+" "+e.getDate()+", "+e.getFullYear();case 204:return COMMON_METHODS.fmtDateWeekDays[e.getDay()]+", "+COMMON_METHODS.fmtDateMonths[e.getMonth()]+" "+e.getDate()+", "+e.getFullYear()}},COMMON_METHODS.formatTime=function(e,t){if(null==e)return null;var M=e.getHours(),a=M>=0&&M<12?"am":"pm";switch(0==M?M=12:M>12&&(M-=12),parseInt(t)){case 101:return COMMON_METHODS.leadZero(e.getHours(),2)+":"+COMMON_METHODS.leadZero(e.getMinutes(),2);case 102:return M+":"+COMMON_METHODS.leadZero(e.getMinutes(),2)+" "+a;case 201:return COMMON_METHODS.leadZero(e.getHours(),2)+":"+COMMON_METHODS.leadZero(e.getMinutes(),2)+":"+COMMON_METHODS.leadZero(e.getSeconds(),2);case 202:return M+":"+COMMON_METHODS.leadZero(e.getMinutes(),2)+":"+COMMON_METHODS.leadZero(e.getSeconds(),2)+" "+a}},COMMON_METHODS.formatShortDateTimeFromXML=function(e){var t=COMMON_METHODS.xmlToDate(e);return COMMON_METHODS.formatDate(t,COMMON_JS.dateFormat)+" "+COMMON_METHODS.formatTime(t,COMMON_JS.timeFormat)};
!function(e,t,r){angular.module("starter",["ionic","ngLodash","starter.controllers","starter.services","starter.constants","starter.directives","starter.adm","starter.pay","starter.sop"]).config(["$stateProvider","$urlRouterProvider","$httpProvider","$logProvider","$ionicConfigProvider",function(t,r,a,o,n){o.debugEnabled(COMMON_JS.debug),a.interceptors.push("httpInterceptor"),n.platform.android.tabs.position("bottom"),n.platform.android.tabs.style("standard"),n.platform.android.navBar.alignTitle("center"),n.platform.android.backButton.icon("ion-chevron-left"),t.state("app",{url:"/app",controller:"AppCtrl",abstract:!0,templateUrl:COMMON_JS.base_url+"common/templates/app.html",resolve:{INIT:["$rootScope","$q",function(t,r){var a=r.defer(),o=e.localStorage.getItem(COMMON_JS.appName+"_currentApplication");o&&(app=JSON.parse(o),t.currentApplication=app.text),a.resolve()}],LABELS:["IS",function(e){return e.labelsPromise(COMMON_JS.langISO)}]}}).state("app.menu",{url:"/menu",controller:"MenuCtrl",templateUrl:COMMON_JS.base_url+"common/templates/menu.html",resolve:{INIT:["$state","$rootScope","$q","$timeout",function(t,r,a,o){var n=a.defer(),i=e.localStorage.getItem(COMMON_JS.appName+"_currentApplication");return i&&"/info"!==t.current.url?o(function(){app=JSON.parse(i),r.currentApplication=app.text,n.reject(),t.current.name!==app.url&&t.go(app.url)},0):n.resolve(),n.promise}],LABELS:["IS",function(e){return e.labelsPromise(COMMON_JS.langISO)}],MOB_APPS:["$location","$q","lodash","LABELS",function(e,t,r,a){var o=t.defer(),n=e.$$absUrl.split("#/app")[0].split("&"),i=r.findIndex(n,function(e){if(r.startsWith(e,"apps="))return e}),p=i!=-1?n[i].replace("apps=","").split(","):[];COMMON_JS.local&&r.isEmpty(p)&&(p=r.values(COMMON_JS.mob_apps_keys));var s=[];return r.forEach(p,function(e,t){var o=r.filter(COMMON_JS.mob_apps,{key:e})[0];switch(o.text=a["System."+e],e){case COMMON_JS.mob_apps_keys.adm:o.url="app.adm.login";break;case COMMON_JS.mob_apps_keys.payment:COMMON_JS.autoLogin?o.url="app.pay.steps":o.url="app.pay.login";break;case COMMON_JS.mob_apps_keys.guest:o.url="";break;case COMMON_JS.mob_apps_keys.operator:o.url=""}s.push(o)}),o.resolve(s),o.promise}]}}),r.otherwise("/app/menu")}]).run(["$rootScope","$state","$log","$ionicPlatform","$ionicLoading","$timeout","$location","$document","LOADER","lodash","UTILS","WS",function(r,a,o,n,i,p,s,c,l,u,d,m){n.ready(function(){COMMON_JS.userValue||"app.menu"===a.current.name||""===a.current.name||s.path("/app/menu");var n=function(e){p(function(){r.pageClass=e?"page-"+e.replace(/\./g,"-"):""},0)};n(a.current.name),COMMON_METHODS.sendCommand("SetPlugins"),COMMON_METHODS.sendCommand("StartRFID"),e.onClosingApplication=function(){COMMON_METHODS.sendCommand("StopRFID"),m.logout(COMMON_JS.workstationId)},{init:function(){this.brc_reader(),this.code_read()},brc_reader:function(){var e=this,r="",a=(new Date).getTime();c.on("keydown",function(o){if(!t(":focus").length){var n=(new Date).getTime();n-a>100&&(r=""),o.keyCode>=48&&o.keyCode<=122?r+=String.fromCharCode(o.keyCode):o.keyCode==COMMON_METHODS.keyboard("KEY_ENTER")&&r.length>=6&&(e.doMediaRead(r),r=""),a=n}})},code_read:function(){var e=this;t(document).bind("VGS_CodeRead",function(t,r){r&&e.doMediaRead(r)})},doMediaRead:function(e){r.$broadcast("brcReader",e)}}.init(),r.$on("$stateChangeStart",function(e,t,r,a,o){i.show(l).then(function(){})}),r.$on("$stateChangeSuccess",function(e,t,r,a,o){n(t.name),i.hide().then(function(){})}),r.$on("$stateChangeError",function(e,t,r,a,n){o.debug("error",t),i.hide().then(function(){})})})}])}(window,jQuery);
angular.module("starter.constants",[]).constant("LOADER",{template:'<div><img ng-src="'+COMMON_JS.base_url+'common/img/snapp-mobile-redeem-spinner.gif" /></div>',duration:1e4});
angular.module("starter.controllers",[]).controller("AppCtrl",["$scope","$rootScope","$state","$log","$ionicPopup","UTILS",function(o,t,e,n,r,a){o.showAlert=function(o){var e=r.alert({title:o.title||"",template:o.msg||"",okText:o.okText||t.LABELS["Common.Ok"]});return e.then(function(o){n.debug("alert showed up")}),e},o.showConfirm=function(o){var e=r.confirm({title:o.title||"",template:o.msg||"",okText:o.okText||t.LABELS["Common.Ok"],cancelText:o.cancelText||t.LABELS["Common.Cancel"]});return e.then(function(o){}),e},o.$on("genericError",function(t,e){o.showAlert(e)}),o.formatImageUrl=a.formatImageUrl,o.formatCurrency=a.formatCurrency,o.appIcons=COMMON_JS.icons,o.amountPattern="^([+-]?[0-9]+(?:["+COMMON_JS.decimalSeparator.replace(".","\\.")+"]{1}[0-9]{1,2})?)$",o.formatShortDateTimeFromXML=COMMON_METHODS.formatShortDateTimeFromXML,o.dateToXML=COMMON_METHODS.dateToXML,o.$on("setAppCurrency",function(t,e){o.appCurrency=e})}]).controller("MenuCtrl",["$scope","$rootScope","$state","$log","MOB_APPS",function(o,t,e,n,r){o.mob_apps=r,o.goToState=function(o){t.currentApplication=o.text,window.localStorage.setItem(COMMON_JS.appName+"_currentApplication",JSON.stringify(o)),e.go(o.url)}}]).controller("InfoCtrl",["$scope","$rootScope","$state","$log","WS","$ionicLoading","LOADER","UTILS",function(o,t,e,n,r,a,i,c){o.info=c.info.get(),"app.pay.info"===e.current.name&&(o.hideGate=!0,o.hideAccessPoint=!0),o.goToGates=function(){e.go("app.adm.tab.gates")},o.goToMenu=function(){e.go("app.menu")},o.redirectAfterLogout=function(){"app.adm.info"===e.current.name?e.go("app.adm.login"):e.go("app.menu")},o.logout=function(e,c){o.showConfirm({title:e,msg:c,okText:t.LABELS["Common.Logout"],cancelText:t.LABELS["Common.Cancel"]}).then(function(t){t&&(a.show(i),r.logout(COMMON_JS.workstationId).then(function(t){200===t.Header.StatusCode&&(n.debug("logout",t),o.redirectAfterLogout())}).finally(function(){a.hide()}))})},o.resetLicense=function(e){o.showConfirm({title:t.LABELS["Common.ResetLicense"],msg:e,okText:t.LABELS["Common.Reset"],cancelText:t.LABELS["Common.Cancel"]}).then(function(t){t&&(a.show(i),r.logout(COMMON_JS.workstationId).then(function(t){200===t.Header.StatusCode&&(n.debug("logout",t),COMMON_METHODS.sendCommand("Unregister"),o.redirectAfterLogout())}).finally(function(){a.hide()}))})},t.$on("changeOperatingArea",function(t,e){o.info.operatingAreaId=e.id,o.info.accessPointGateValue=e.name})}]);
angular.module("starter.directives",[]).directive("toggleFocus",["$timeout",function(t){return{restrict:"A",link:function(i,n,u){n.bind("click",function(i){var n=!("true"===u.keyboardactive),c=$("."+u.targetid);n?t(function(){c.focus()},200):t(function(){c.blur()},200)})}}}]).directive("myAutofocus",["$timeout","$log",function(t,i){return{restrict:"A",link:function(i,n,u){t(function(){n[0].focus()},500)}}}]);
angular.module("starter.services",[]).factory("UTILS",["$rootScope","$log",function(e,t){var o={};return o.formatImageUrl=function(e,t,o){var a="";return"repository"===t?a=COMMON_JS.site_url+"repository?type="+(o||"small")+"&id="+e:"imagecache"===t&&(a=COMMON_JS.site_url+"imagecache?size="+(o||128)+"&name="+e),a},o.displayErrorMsg=function(t){t.event=t.event||"genericError",e.$broadcast(t.event,t)},o.info={get:function(){return{userValue:COMMON_JS.userValue,locationValue:COMMON_JS.locationValue,operatingAreaId:COMMON_JS.operatingAreaId,operatingAreaValue:COMMON_JS.operatingAreaValue,workstationValue:COMMON_JS.workstationName,accessPointGateValue:COMMON_JS.accessPointGateValue,accessPointValue:COMMON_JS.accessPointValue,accessPointId:COMMON_JS.accessPointId}},set:function(e){COMMON_JS.vgsSessionToken=e.SessionToken,COMMON_JS.workstationName=e.Workstation.WorkstationName,COMMON_JS.operatingAreaValue=e.Workstation.OpAreaName,COMMON_JS.operatingAreaId=e.Workstation.OpAreaId,COMMON_JS.locationId=e.Workstation.AccessPointList[0].AptLocationAccountId,COMMON_JS.locationValue=e.Workstation.AccessPointList[0].AptLocationDisplayName,COMMON_JS.accessPointGateValue=e.Workstation.AccessPointList[0].AptOperAreaDisplayName,COMMON_JS.accessPointValue=e.Workstation.AccessPointList[0].AptName,COMMON_JS.accessPointId=e.Workstation.AccessPointList[0].AccessPointId,COMMON_JS.userValue=e.User.AccountName}},o.activatePlugins=function(e){e&&COMMON_METHODS.activatePlugins(e)},o}]).factory("IS",["$rootScope","$http","$log","$q","lodash",function(e,t,o,a,n){var r={};return r.getLabels=function(e){var e=e||"en";return t({method:"GET",url:COMMON_JS.site_url+"admin?page=itl&langiso="+e}).then(function(e){return e},function(e){o.debug(e)})},r.labelsPromise=function(t){if(n.isEmpty(e.LABELS))return r.getLabels(t).then(function(t){return e.LABELS=t?t.data:{},e.LABELS});var o=a.defer();return o.resolve(e.LABELS),o.promise},r}]).factory("WS",["$http","$log",function(e,t){var o={},a=function(o,a,n){var n=n||{Header:{Token:COMMON_JS.vgsSessionToken},Request:a};return e({method:"POST",url:COMMON_JS.site_url+"service?cmd="+o+"&format=json",data:n}).then(function(e){return e?e.data:e},function(e){t.debug(e)})};return o.workstation=function(e){return a("WORKSTATION",{Command:"LoadEntWorkstation",LoadEntWorkstation:{WorkstationId:e}})},o.login=function(e){var t={Command:"Login",Login:{WorkstationId:e.workstationId,ReturnDetails:e.details||!1,ReturnRights:e.rights||!1}};return e.mediaCode?t.Login.MediaCode=e.mediaCode:(t.Login.UserName=e.username,t.Login.Password=e.password),a("LOGIN",t)},o.logout=function(e){return a("LOGIN",{Command:"Logout",Logout:{WorkstationId:e}})},o.gates=function(e,t){return a("COMMONLIST",{EntityType:e,OpArea:{LocationId:t}})},o.catalog=function(e){return a("CATALOG",{Command:"LoadEntCatalog",LoadEntCatalog:{CatalogId:e}})},o.account=function(e){return a("ACCOUNT",{Command:"LoadEntAccount",LoadEntAccount:{AccountId:e}})},o.category=function(e){return a("CATEGORY",{Command:"LoadEntCategory",LoadEntCategory:{CategoryId:e}})},o.event=function(e){return a("EVENT",{Command:"LoadEntEvent",LoadEntEvent:{EventId:e}})},o.product=function(e){return a("PRODUCT",{Command:"LoadEntProduct",LoadEntProduct:{ProductId:e}})},o.performance=function(e){return a("PERFORMANCE",{Command:"SearchDate",SearchDate:{EventId:e,DateFrom:"2016-05-25",DateTo:"2016-06-26"}})},o.performanceTime=function(e,t,o,n,r){return a("PERFORMANCE",{Command:"Search",Search:{EventId:e,CatalogId:t,PerformingFromDateTime:o,PerformingToDateTime:n,RecordPerPage:r}})},o.performanceSellTime=function(e,t,o,n,r){return a("PERFORMANCE",{Command:"Search",Search:{EventId:e,CatalogId:t,SellableDateTimeFrom:o,ToDateTime:n,RecordPerPage:r}})},o.searchPerformance=function(e,t,o,n,r){return a("PERFORMANCE",{Command:"Search",Search:{EventId:e,CatalogId:t,PerformingFromDateTime:o,PerformingToDateTime:n,RecordPerPage:r}})},o.getSellableProducts=function(e,t,o){return a("PERFORMANCE",{Command:"GetSellableProducts",GetSellableProducts:{PerformanceId:e,SaleChannelId:o}})},o.searchPerformanceByAccessPoint=function(e,t,o,n,r){return a("PERFORMANCE",{Command:"Search",Search:{AccessPointId:e,PerformingFromDateTime:t,PerformingToDateTime:o,PagePos:n||1,RecordPerPage:r||10}})},o.saleschannel=function(e){return a("SALECHANNEL",{Command:"Search",Search:{SaleChannelType:e}})},o.lookupPortfolio=function(e){return a("PORTFOLIO",{Command:"Lookup",Lookup:{MediaCode:e}})},o.searchTicketUsage=function(e){return a("PORTFOLIO",{Command:"SearchTicketUsage",SearchTicketUsage:{PortfolioMediaId:e}})},o.searchTicket=function(e){return a("TICKET",{Command:"Search",Search:{PortfolioId:e}})},o.searchMedia=function(e){return a("MEDIA",{Command:"Search",Search:{PortfolioId:e}})},o.searchPortfolio=function(e){return a("PORTFOLIO",{Command:"Search",Search:{AccountId:e}})},o.searchEvents=function(e,t,o,n){return a("EVENT",{Command:"Search",Search:{CatalogId:e,RecordPerPage:n,OnSaleFrom:t,OnSaleTo:o}})},o.searchMediaCode=function(e,t){return a("MEDIA",{Command:"Search",Search:{MediaCode:e,DefaultTicketId:t||null}})},o.addToCart=function(e,t,o){var n={Command:"AddToCart",AddToCart:{ProductId:e,QuantityDelta:t?t:1}};return n.ShopCart=o,a("SHOPCART",n)},o.removeItem=function(e,t){var o={Command:"RemoveItem",RemoveItem:{ShopCartItemId:e}};return o.ShopCart=t,a("SHOPCART",o)},o.editItemQuantity=function(e,t,o){var n={Command:"EditItemQuantity",EditItemQuantity:{ShopCartItemId:e,QuantityDelta:t?t:1}};return n.ShopCart=o,a("SHOPCART",n)},o.changeOperatingArea=function(e,t){return a("WORKSTATION",{Command:"ChangeOperatingArea",ChangeOperatingArea:{WorkstationId:e,OperatingAreaId:t}})},o.validate=function(e,t,o){return a("VALIDATE",{MediaCode:t,MediaCodeType:0,SkipBiometricCheck:!0,RedemptionPoint:{AccessPointId:e,UsageType:"exit"===o?COMMON_JS.usageTypeCodes.exit:COMMON_JS.usageTypeCodes.entry,OperatorCmd:"simulate"===o||"lookup"===o?COMMON_JS.accessPointOperator.none:COMMON_JS.accessPointOperator.ticket}})},o.walletPayment=function(e){return a("PORTFOLIO",{Command:"WalletPayment",WalletPayment:{MediaCode:e.mediaCode,Amount:e.amount||0,Notes:e.notes||"",ReturnReceipt:e.receipt||!1}})},o.getParsedTransactionReceipt=function(e){return a("Transaction",{Command:"GetParsedTransactionReceipt",GetParsedTransactionReceipt:{TransactionId:e,DocTemplateId:null}})},o}]).factory("httpInterceptor",["$rootScope","$q","$log","$location","$timeout","lodash","$injector","UTILS",function(e,t,o,a,n,r,i,c){var s=function(e,t){return e.RequestCode.toLowerCase()===t&&200!==e.StatusCode},u=function(t){if(r.isEmpty(e.LABELS)){i.get("IS").getLabels(COMMON_JS.langISO).then(function(o){e.LABELS=o?o.data:{},c.displayErrorMsg({title:e.LABELS["Common.Error"],msg:t.ErrorMessage})})}else c.displayErrorMsg({title:e.LABELS["Common.Error"],msg:t.ErrorMessage})};return{request:function(e){return e},requestError:function(e){return o.debug("request error",e),t.reject(e)},response:function(e){var t=e.data.Header;if(r.startsWith(e.config.url,COMMON_JS.site_url+"service")){if(("/app/adm/login"===a.$$path||"/app/sop/login"===a.$$path||"/app/pay/login"===a.$$path&&!COMMON_JS.autoLogin)&&s(t,"login"))return e;if(401===t.StatusCode||1203===t.StatusCode)u(t),r.startsWith(a.$$path,"/app/adm/")?n(function(){a.path("/app/adm/login")},0):r.startsWith(a.$$path,"/app/pay/")?COMMON_JS.autoLogin||n(function(){a.path("/app/pay/login")},0):r.startsWith(a.$$path,"/app/sop/")&&n(function(){a.path("/app/sop/login")},0);else if(200!==t.StatusCode){if("/app/pay/steps"===a.$$path&&s(t,"portfolio"))return e;u(t)}}return e},responseError:function(e){return o.debug("response error",e),t.reject(e)}}}]);
angular.module("starter.adm",["starter.adm_controllers","starter.adm_directives"]).config(["$stateProvider",function(t){t.state("app.adm",{url:"/adm",abstract:!0,controller:"AdmCtrl",templateUrl:COMMON_JS.base_url+"mob_adm/templates/adm.html"}).state("app.adm.login",{url:"/login",templateUrl:COMMON_JS.base_url+"common/templates/login.html",controller:"AdmLoginCtrl"}).state("app.adm.tab",{url:"/tab",abstract:!0,templateUrl:COMMON_JS.base_url+"mob_adm/templates/adm_tabs.html",controller:"AdmTabsCtrl"}).state("app.adm.tab.redemption",{url:"/redemption",views:{"tab-redemption":{templateUrl:COMMON_JS.base_url+"mob_adm/templates/adm_tab-redemption.html",controller:"AdmRedemptionCtrl"}}}).state("app.adm.tab.media",{url:"/media/:media/:ticket?",views:{"tab-redemption":{templateUrl:COMMON_JS.base_url+"mob_adm/templates/adm_media.html",controller:"AdmMediaCtrl"}},resolve:{MEDIA:["WS","$stateParams",function(t,e){return t.searchMediaCode(e.media,e.ticket).then(function(t){return t.Answer?t.Answer.Search:[]})}]}}).state("app.adm.tab.mediadetail",{url:"/mediadetail",params:{media:null},views:{"tab-redemption":{templateUrl:COMMON_JS.base_url+"mob_adm/templates/adm_media-detail.html",controller:"AdmMediaDetailCtrl"}}}).state("app.adm.tab.mediaproduct",{url:"/mediaproduct",params:{media:null},views:{"tab-redemption":{templateUrl:COMMON_JS.base_url+"mob_adm/templates/adm_media-product.html",controller:"AdmMediaProductCtrl"}}}).state("app.adm.tab.ticketusage",{url:"/ticketusage/:media",views:{"tab-redemption":{templateUrl:COMMON_JS.base_url+"mob_adm/templates/adm_ticket-usage.html",controller:"AdmTicketUsageCtrl"}},resolve:{TICKET_USAGE:["WS","$stateParams",function(t,e){return t.searchTicketUsage(e.media).then(function(t){return t.Answer?t.Answer.SearchTicketUsage:[]})}]}}).state("app.adm.tab.portfoliomedias",{url:"/portfoliomedias/:id",views:{"tab-redemption":{templateUrl:COMMON_JS.base_url+"mob_adm/templates/adm_portfolio-medias.html",controller:"AdmPortfolioMediasCtrl"}},resolve:{MEDIA:["WS","$stateParams",function(t,e){return t.searchMedia(e.id).then(function(t){return t.Answer?t.Answer.Search:[]})}]}}).state("app.adm.tab.portfoliotickets",{url:"/portfoliotickets/:id",views:{"tab-redemption":{templateUrl:COMMON_JS.base_url+"mob_adm/templates/adm_portfolio-tickets.html",controller:"AdmPortfolioTicketsCtrl"}},resolve:{TICKETS:["WS","$stateParams",function(t,e){return t.searchTicket(e.id).then(function(t){return t.Answer?t.Answer.Search:[]})}]}}).state("app.adm.tab.attendance",{url:"/attendance",views:{"tab-attendance":{templateUrl:COMMON_JS.base_url+"mob_adm/templates/adm_tab-attendance.html",controller:"AdmAttendanceCtrl"}}}).state("app.adm.tab.info",{url:"/info",views:{"tab-info":{templateUrl:COMMON_JS.base_url+"common/templates/info.html",controller:"AdmInfoCtrl"}}}).state("app.adm.tab.gates",{url:"/gates",views:{"tab-info":{templateUrl:COMMON_JS.base_url+"mob_adm/templates/adm_gates.html",controller:"AdmGatesCtrl"}},resolve:{GATES:["WS",function(t){return t.gates(COMMON_JS.operatingAreaCode,COMMON_JS.locationId).then(function(t){return t.Answer?t.Answer.ItemList:[]})}]}})}]);
angular.module("starter.adm_controllers",[]).controller("AdmCtrl",["$scope","$log",function(e,t){e.$on("redemptionKeyboard",function(t,o){e.manualBarcode=o.keyboardIsActive})}]).controller("AdmLoginCtrl",["$scope","$log","$state","WS","$ionicLoading","LOADER","$window","$timeout","lodash","UTILS",function(e,t,o,a,n,i,d,s,c,r){e.login={username:"",password:""},e.logo=COMMON_JS.logo,e.doLogin=function(d){n.show(i),a.login({workstationId:COMMON_JS.workstationId,username:e.login.username,password:e.login.password,mediaCode:d,details:!0,rights:!0}).then(function(a){if(t.debug(a),200===a.Header.StatusCode){e.loginError=!1,r.info.set(a.Answer.Login),r.activatePlugins(a.Answer.Login.Workstation.PluginList);var n=c.filter(a.Answer.Login.Workstation.CurrencyList,{CurrencyId:a.Answer.Login.Workstation.MainCurrencyId});e.$emit("setAppCurrency",n[0]),o.go("app.adm.tab.redemption")}else e.loginError=!0,e.loginErrorMsg=a.Header.ErrorMessage}).finally(function(){n.hide()})},e.$on("brcReader",function(t,o){e.doLogin(o)}),e.userkeydown=function(e){e.keyCode===COMMON_METHODS.keyboard("KEY_ENTER")&&s(function(){$("#txt-password").focus()},0)}}]).controller("AdmTabsCtrl",["$scope","$rootScope",function(e,t){}]).controller("AdmRedemptionCtrl",["$scope","$rootScope","$state","$ionicModal","$ionicLoading","LOADER","WS","$log","lodash",function(e,t,o,a,n,i,d,s,c){e.init=function(){e.data={mediaCode:""},e.validateData=[]},e.init(),e.mediaNotFoundCode=COMMON_JS.mediaNotFound,e.toggleKeyboard=function(t){e.keyboardIsActive=void 0!=t?t:!e.keyboardIsActive,e.$emit("redemptionKeyboard",{keyboardIsActive:e.keyboardIsActive})},e.scan={types:c.keys(COMMON_JS.usageTypes),usageTypes:COMMON_JS.usageTypes,buttons:[t.LABELS["Entitlement.Entry"],t.LABELS["AccessPoint.SimulatedEntry"],t.LABELS["Common.Exit"],t.LABELS["Common.Lookup"],t.LABELS["Common.Cancel"]]},e.scan.selected=COMMON_JS.initScanType(),a.fromTemplateUrl(COMMON_JS.base_url+"mob_adm/templates/adm_tab-redemption-scanModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.openModal=function(){e.modal.show()},e.closeModal=function(){e.modal.hide()},e.$on("$destroy",function(){e.modal.remove()}),e.$on("modal.hidden",function(){}),e.$on("modal.removed",function(){}),e.scanUsageType=function(){e.openModal()},e.clickedScanButton=function(t){t<e.scan.types.length&&(e.scan.selected=COMMON_JS.setScanType(e.scan.types[t])),e.closeModal()},e.validateService=function(){n.show(i),d.validate(COMMON_JS.accessPointId,e.data.mediaCode,e.scan.selected).then(function(t){s.debug(t),c.isEmpty(t.Answer)||(e.validateSubmitted=!0,e.validateData.unshift(t.Answer),e.validateData[0].usedMediaCode=angular.copy(e.data.mediaCode),e.data.mediaCode="")}).finally(function(){n.hide()})},e.lookupService=function(t,a){var t=t||e.data.mediaCode;o.go("app.adm.tab.media",{media:t,ticket:a})},e.validate=function(){e.validateSubmitted=!1,"lookup"===e.scan.selected?e.lookupService():e.validateService()},e.$on("brcReader",function(t,o){e.data.mediaCode=o,e.validate()}),e.$on("$ionicView.beforeEnter",function(e){}),e.$on("$ionicView.beforeLeave",function(t){e.toggleKeyboard(!1)})}]).controller("AdmAttendanceCtrl",["$scope","$ionicLoading","LOADER","WS","$log",function(e,t,o,a,n){e.$on("$ionicView.beforeEnter",function(i){var d=new Date,s=new Date;d.setMinutes(d.getMinutes()-30),s.setHours(s.getHours()+10),t.show(o),n.debug(d),n.debug(s),a.searchPerformanceByAccessPoint(COMMON_JS.accessPointId,COMMON_METHODS.dateToXML(d),COMMON_METHODS.dateToXML(s),1).then(function(t){n.debug(t),e.attendance=t.Answer?t.Answer.Search:{}}).finally(function(){t.hide()})})}]).controller("AdmInfoCtrl",["$scope",function(e){e.dataPage="adm_info"}]).controller("AdmGatesCtrl",["$scope","$state","$ionicLoading","LOADER","$log","WS","GATES",function(e,t,o,a,n,i,d){e.gates=d,e.select=function(d){n.debug("selected gate id",d.ItemId),o.show(a),i.changeOperatingArea(COMMON_JS.accessPointId,d.ItemId).then(function(o){200===o.Header.StatusCode?(e.selectedId=d.ItemId,e.$emit("changeOperatingArea",{id:d.ItemId,name:d.ItemName}),t.go("app.adm.tab.info")):n.debug("changeOperatingArea",o.Header)}).finally(function(){o.hide()})}}]).controller("AdmMediaCtrl",["$scope","$state","$ionicLoading","LOADER","$log","WS","MEDIA",function(e,t,o,a,n,i,d){e.media=d,e.searchTicketUsage=function(e){t.go("app.adm.tab.ticketusage",{media:e})},e.mediaProduct=function(e){t.go("app.adm.tab.mediaproduct",{media:e})},e.mediaDetail=function(e){t.go("app.adm.tab.mediadetail",{media:e})},e.portfolioMedias=function(e){t.go("app.adm.tab.portfoliomedias",{id:e})},e.portfolioTickets=function(e){t.go("app.adm.tab.portfoliotickets",{id:e})}}]).controller("AdmMediaProductCtrl",["$scope","$stateParams","$log",function(e,t,o){o.debug("stateParams",t),e.media=t.media,e.now=new Date,e.statusClass=e.media.MainTicketStatus===COMMON_JS.ticketStatusActive?"good-status":e.media.MainTicketStatus<COMMON_JS.ticketStatusGoodLimit?"warn-status":"bad-status"}]).controller("AdmMediaDetailCtrl",["$scope","$stateParams","$log",function(e,t,o){o.debug("stateParams",t),e.media=t.media,e.statusClass=e.media.MediaStatus===COMMON_JS.ticketStatusActive?"good-status":e.media.MediaStatus<COMMON_JS.ticketStatusGoodLimit?"warn-status":"bad-status"}]).controller("AdmTicketUsageCtrl",["$scope","TICKET_USAGE",function(e,t){e.usages=t}]).controller("AdmPortfolioMediasCtrl",["$scope","MEDIA",function(e,t){e.medias=t}]).controller("AdmPortfolioTicketsCtrl",["$scope","TICKETS",function(e,t){e.tickets=t}]);
angular.module("starter.adm_directives",[]).directive("attendanceStatus",["$log",function(t){return{restrict:"A",scope:"=",link:function(t,e,a){t.$watch("performance",function(){var a=new Date,o="",r=t.performance;a>=COMMON_METHODS.xmlToDate(r.AdmDateTimeFrom)&&a<=COMMON_METHODS.xmlToDate(r.AdmDateTimeTo)?o="status-open":a>=COMMON_METHODS.xmlToDate(r.DateTimeFrom)&&a<=COMMON_METHODS.xmlToDate(r.DateTimeTo)&&(o="status-busy"),e.attr("data-status",o)})}}}]);
angular.module("starter.pay",["starter.pay_controllers"]).config(["$stateProvider",function(t){t.state("app.pay",{url:"/pay",abstract:!0,controller:"PayCtrl",templateUrl:COMMON_JS.base_url+"mob_pay/templates/pay.html"}).state("app.pay.login",{url:"/login",controller:"PayLoginCtrl",templateUrl:COMMON_JS.base_url+"common/templates/login.html"}).state("app.pay.steps",{url:"/steps",templateUrl:COMMON_JS.base_url+"mob_pay/templates/steps.html",controller:"PayStepsCtrl"}).state("app.pay.info",{url:"/info",templateUrl:COMMON_JS.base_url+"common/templates/info.html",controller:"PayInfoCtrl"})}]);
angular.module("starter.pay_controllers",[]).controller("PayCtrl",["$scope","$state","$log","WS","lodash","$ionicLoading","LOADER","lodash","UTILS",function(o,e,n,t,i,r,a,i,s){o.activeStep=1,o.isActiveStep=function(e){return o.activeStep===e},o.$on("changeStep",function(e,n){o.activeStep=n.step}),o.$on("pay_login",function(c,p){r.show(a),t.login(p).then(function(t){if(n.debug(t),200===t.Header.StatusCode){o.loginError=!1,s.info.set(t.Answer.Login),s.activatePlugins(t.Answer.Login.Workstation.PluginList);var r=i.filter(t.Answer.Login.Workstation.CurrencyList,{CurrencyId:t.Answer.Login.Workstation.MainCurrencyId});o.$emit("setAppCurrency",r[0]),e.go("app.pay.steps")}else o.loginError=!0,o.loginErrorMsg=t.Header.ErrorMessage}).finally(function(){r.hide()})}),o.$on("paystepsKeyboard",function(e,n){o.manualBarcode=n.keyboardIsActive})}]).controller("PayLoginCtrl",["$scope","$log",function(o,e){o.login={username:"",password:""},o.logo=COMMON_JS.logo,o.doLogin=function(e){o.$emit("pay_login",{workstationId:COMMON_JS.workstationId,username:o.login.username,password:o.login.password,mediaCode:e,details:!0})},o.$on("brcReader",function(e,n){o.doLogin(n)}),o.userkeydown=function(o){o.keyCode===COMMON_METHODS.keyboard("KEY_ENTER")&&$timeout(function(){$("#txt-password").focus()},0)}}]).controller("PayStepsCtrl",["$scope","$rootScope","$state","$log","$ionicLoading","LOADER","WS","lodash",function(o,e,n,t,i,r,a,s){o.$on("$ionicView.beforeEnter",function(e){COMMON_JS.autoLogin&&o.$emit("pay_login",{workstationId:COMMON_JS.workstationId,details:!0})}),o.iconInfo=COMMON_JS.icons.info,o.autoLogin=COMMON_JS.autoLogin,o.toggleKeyboard=function(e){o.keyboardIsActive=void 0!=e?e:!o.keyboardIsActive,o.$emit("paystepsKeyboard",{keyboardIsActive:o.keyboardIsActive})},o.goToMenu=function(){n.go("app.menu")},o.goToInfo=function(){n.go("app.pay.info")},o.init=function(){o.step={}},o.doStep=function(e,n){var e=e||1;n&&o.init(),o.toggleKeyboard(!1),o.$emit("changeStep",{step:e})},o.$on("$ionicView.beforeEnter",function(e){o.doStep(1,!0)}),o.pay=function(){o.step.isAuthorizing=!0;var n=parseFloat(o.step.amount);a.walletPayment({mediaCode:o.step.barcode,amount:n,notes:o.step.notes,receipt:!0}).then(function(n){t.debug(n);var i=n.Answer?n.Answer.WalletPayment.WalletTransaction:{};s.isEmpty(i)?o.step.errorMsg=n.Header.ErrorMessage:(o.step.wallet=i,o.step.isApproved=!0,NativeBridge.call("Print",[i.Receipt.DriverList,i.Receipt.DocData],function(n,t){n||o.showAlert({title:e.LABELS["Common.Error"],msg:t})}))}).finally(function(){o.step.isAuthorizing=!1,o.doStep(4)})},o.$on("brcReader",function(e,n){o.step.barcode=n,o.pay()}),o.stepOneFormAction=function(e){e.$valid&&o.doStep(3)},o.submitForm=function(e,n){n?n.keyCode===COMMON_METHODS.keyboard("KEY_TAB")&&o.stepOneFormAction(e):o.stepOneFormAction(e)}}]).controller("PayInfoCtrl",["$scope",function(o){o.dataPage="pay_info"}]);
angular.module("starter.sop",["starter.sop_controllers"]).config(["$stateProvider",function(t){t.state("app.sop",{url:"/sop",abstract:!0,controller:"SopCtrl",templateUrl:COMMON_JS.base_url+"mob_sales_operator/templates/sop.html"}).state("app.sop.login",{url:"/login",controller:"SopLoginCtrl",templateUrl:COMMON_JS.base_url+"common/templates/login.html"}).state("app.sop.tab",{url:"/tab",abstract:!0,templateUrl:COMMON_JS.base_url+"mob_sales_operator/templates/sop_tabs.html",controller:"SopTabsCtrl"}).state("app.sop.tab.catalog",{url:"/catalog",views:{"tab-catalog":{templateUrl:COMMON_JS.base_url+"mob_sales_operator/templates/catalog.html",controller:"SopCatalogCtrl"}}}).state("app.sop.tab.shopcart",{url:"/shopcart",views:{"tab-shopcart":{templateUrl:COMMON_JS.base_url+"mob_sales_operator/templates/shopcart.html",controller:"SopShopcartCtrl"}}}).state("app.sop.tab.account",{url:"/account",views:{"tab-account":{templateUrl:COMMON_JS.base_url+"mob_sales_operator/templates/account.html",controller:"SopAccountCtrl"}}}).state("app.sop.tab.lookup",{url:"/lookup",views:{"tab-lookup":{templateUrl:COMMON_JS.base_url+"mob_sales_operator/templates/lookup.html",controller:"SopLookupCtrl"}}}).state("app.sop.tab.info",{url:"/info",views:{"tab-info":{templateUrl:COMMON_JS.base_url+"common/templates/info.html",controller:"SopInfoCtrl"}}})}]);
angular.module("starter.sop_controllers",[]).controller("SopCtrl",["$scope",function(o){}]).controller("SopLoginCtrl",["$scope",function(o){}]).controller("SopTabsCtrl",["$scope",function(o){}]).controller("SopCatalogCtrl",["$scope",function(o){}]).controller("SopShopcartCtrl",["$scope",function(o){}]).controller("SopAccountCtrl",["$scope",function(o){}]).controller("SopLookupCtrl",["$scope",function(o){}]).controller("SopInfoCtrl",["$scope",function(o){}]);
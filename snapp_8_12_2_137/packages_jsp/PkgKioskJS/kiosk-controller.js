/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "../script/kiosk-controller.js":
/*!*************************************!*\
  !*** ../script/kiosk-controller.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   KioskController: () => (/* binding */ KioskController)\n/* harmony export */ });\n/* harmony import */ var _common_script_snapp_api__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @common-script/snapp-api */ \"../../../common-script/snapp-api.js\");\n/* harmony import */ var _common_script_timed_task__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @common-script/timed-task */ \"../../../common-script/timed-task.js\");\n/* harmony import */ var _common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @common-script/device-manager/dm-model */ \"../../../common-script/device-manager/dm-model.js\");\n/* harmony import */ var _kiosk_model__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./kiosk-model */ \"../script/kiosk-model.js\");\n/* harmony import */ var _kiosk_face_recon__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./kiosk-face-recon */ \"../script/kiosk-face-recon.js\");\n/* harmony import */ var _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./kiosk-event-utils */ \"../script/kiosk-event-utils.js\");\n/* harmony import */ var _steps_checkout__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./steps/checkout */ \"../script/steps/checkout.js\");\n/* harmony import */ var _common_script_errors__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @common-script/errors */ \"../../../common-script/errors.js\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass KioskController {\r\n\t#inactivityTimeout;\r\n\t#fiscalDateCheckTask;\r\n\t#transactionEndTimeOutMSec;\r\n\t#transactionEndTimeOut = null;\r\n\r\n\t#status = _kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.ERROR;\r\n\t#checkoutStep = null;\r\n\t#workstationId;\r\n\t#enabledPaymentMethods = [];\r\n\t#shopCart = {};\r\n\t#currentTransaction = {};\r\n\t#currentOrder = null;\r\n\t#checkout;\r\n\t#printOptionSelection = false;\r\n\t#retryFailedPayment = false;\r\n\t#shopCartValidated = false;\r\n\t#performingCheckOut = false;\r\n\r\n\r\n\tsnappAPI;\r\n\t#workstation;\r\n\r\n\tonStatusChanged;\r\n\tonShopCartChanged;\r\n\tonMediaRead;\r\n\tkeybuffer = \"\";\r\n\ttsLast = (new Date()).getTime();\r\n\r\n\tconstructor() {\r\n\t\t$(document).on(\"device-manager-status\", (event, s) => this.onDeviceManagerStatusChanged(s));\r\n\t\t$(document).on(\"kiosk-checkout\", (event, data) => this.#onKioskCheckout(data));\r\n\t\t$(document).on(_common_script_snapp_api__WEBPACK_IMPORTED_MODULE_0__.SNAPP_API_STATUS_CHANGED, (event, status) => this.#onSnappAPIStatusChanged(status));\r\n\t\t$(document).on(\"keydown\", (event) => this.#onKeyDown(event));\r\n\r\n\t\tthis.#fiscalDateCheckTask = new _common_script_timed_task__WEBPACK_IMPORTED_MODULE_1__.TimedTask(60000, () => this.#checkFiscalDate());\r\n\t}\r\n\r\n\tget workstation() {\r\n\t\treturn this.#workstation;\r\n\t}\r\n\r\n\t/*\r\n\tparams = {\r\n\t\tapiUrl: string //url of the SnApp API\r\n\t\tworkstation: DOWorkstation // if null the WorkstationId is mandatory\r\n\t\tworkstationId: string // id of the workstation (Mandatory if the \"workstation\" parameter is null)\r\n\t\tuserId: string // id of the user (optional)\r\n\t\ttoken: string // token to be used for the login process (optional)\r\n\t\tinactivityTimeOutMSec: int // when there is ano activity for this amount of time the kiosk will return to idle\r\n\t\ttransactionEndTimeOutMSec: int // amount of time the ehd transaction screen will be visible for\r\n\t\tprintOptionSelection: bool // If true the controller will trigger the a transaction event during the checkout process with progress = \"print-option\"\r\n\t\tonStatusChanged: callback //\r\n\t\tonShopCartChanged: callback //\r\n\t\tretryFailedPayment: boolean // If true enables th e payment retry feature\r\n\t}\r\n\t*/\r\n\tinit(params) {\r\n\t\tthis.inactivityTimeOutMSec = params.inactivityTimeOutMSec || 30000;\r\n\t\tthis.#transactionEndTimeOutMSec = params.transactionEndTimeOutMSec || 3000;\r\n\t\tif (params.printOptionSelection)\r\n\t\t\tthis.#printOptionSelection = params.printOptionSelection;\r\n\t\tif (params.retryFailedPayment)\r\n\t\t\tthis.#retryFailedPayment = params.retryFailedPayment;\r\n\r\n\t\tthis.onStatusChanged = params.onStatusChanged;\r\n\t\tthis.onShopCartChanged = params.onShopCartChanged;\r\n\r\n\t\tthis.#setStatus(_kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.INIT);\r\n\r\n\t\t$(\"body\").click(() => this.#bodyTouchReceived());\r\n\r\n\t\tif (params.workstation) {\r\n\t\t\tthis.#workstation = params.workstation;\r\n\t\t\tparams.workstationId = params.workstation.WorkstationId;\r\n\t\t}\r\n\r\n\t\tthis.#workstationId = params.workstationId;\r\n\r\n\t\ttry {\r\n\t\t\tif (typeof faceapi !== 'undefined')\r\n\t\t\t\tthis.faceRecognition = new _kiosk_face_recon__WEBPACK_IMPORTED_MODULE_4__[\"default\"](params.apiUrl, document.getElementById('video'));\r\n\t\t}\r\n\t\tcatch (error) {\r\n\t\t\tthis.#setStatus(_kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.ERROR, error);\r\n\t\t}\r\n\r\n\t\t$(document).on(\"kiosk-presence-detected\", () => this.#bodyTouchReceived());\r\n\t\t$(document).on(\"kiosk-face-detected\", (event, payload) => this.#faceDetected(payload.face));\r\n\r\n\t\tthis.snappAPI = new _common_script_snapp_api__WEBPACK_IMPORTED_MODULE_0__.SnappAPI(params.apiUrl, params.workstationId, params.userId, params.token);\r\n\t\tthis.#checkout = new _steps_checkout__WEBPACK_IMPORTED_MODULE_6__.Checkout(this.snappAPI);\r\n\t\tSNP_LOGGER.setConfigurationParams(params);\r\n\t}\r\n\r\n\tasync #loadWorkstationConfigurationIfNeeded() {\r\n\t\tif (this.#workstation)\r\n\t\t\tthis.#updateSatusAccordongToDeviceManager(DEVICE_MANAGER.status);\r\n\t\telse {\r\n\t\t\tthis.#setStatus(_kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.INIT);\r\n\t\t\tawait this.#loadWorkstation(this.#workstationId);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tthis.#fiscalDateCheckTask.startWithImmediateExecution();\r\n\t\t\t\tthis.#updateEnabledPaymentMethods(this.#workstation);\r\n\t\t\t\tthis.#checkout.setEnabledPaymentMethods(this.#enabledPaymentMethods);\r\n\t\t\t\tthis.#checkout.rights = this.#workstation.Rights;\r\n\t\t\t\tthis.#checkout.mainCurrency = this.#workstation.CurrencyList.find(curr => (curr.CurrencyId === this.#workstation.MainCurrencyId));\r\n\t\t\t\tthis.#initDevices(this.#workstation);\r\n\t\t\t\tif (typeof faceapi !== 'undefined')\r\n\t\t\t\t\tthis.faceRecognition = new _kiosk_face_recon__WEBPACK_IMPORTED_MODULE_4__[\"default\"](params.apiUrl, document.getElementById('video'));\r\n\t\t\t\tSNP_LOGGER.setWorkstation(this.#workstation);\r\n\t\t\t}\r\n\t\t\tcatch (error) {\r\n\t\t\t\tthis.#setStatus(_kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.ERROR, error);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync #performMaintenance() {\r\n\t\tif (this.#status === _kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.TRANSACTION)\r\n\t\t\tlocalStorage.removeItem('fiscal-date');\r\n\t\telse {\r\n\t\t\tthis.#setStatus(_kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.ERROR, \"Maintenance\");\r\n\t\t\tawait DEVICE_MANAGER.performMaintenance();\r\n\t\t\tlocation.reload();\r\n\t\t}\r\n\t}\r\n\r\n\t#checkFiscalDate() {\r\n\t\tlet currentFiscalDate = KioskController.getFiscalDate(new Date(), this.#workstation.Rights.FiscalDateSwitchHour);\r\n\t\tlet lastFiscalDate = Date.parse(localStorage.getItem('fiscal-date'));\r\n\r\n\t\tif (!lastFiscalDate || lastFiscalDate < currentFiscalDate) {\r\n\t\t\tlocalStorage.setItem('fiscal-date', currentFiscalDate);\r\n\t\t\tthis.#performMaintenance();\r\n\t\t}\r\n\t}\r\n\r\n\t#onKioskCheckout(data) {\r\n\t\tif (data.type == \"checkout-step\") {\r\n\t\t\tthis.#checkoutStep = data.step.stepType;\r\n\t\t}\r\n\t}\r\n\r\n\tasync #loadWorkstation(workstationId) {\r\n\t\tif (!workstationId)\r\n\t\t\tthrow new Error(\"Either workstation or workstationId parameters must be evaluted\");\r\n\r\n\t\tawait this.snappAPI.cmd(\"WORKSTATION\", \"LoadEntWorkstation\", { \"WorkstationId\": workstationId })\r\n\t\t\t.then(ans => { this.#workstation = ans.Workstation; })\r\n\t\t\t.catch(error => SNP_LOGGER.error(null, null, error));\r\n\t}\r\n\r\n\t#bodyTouchReceived() {\r\n\t\tif (((this.#status === _kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.IDLE) ||\r\n\t\t\t(this.#status === _kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.TRANSACTION)) &&\r\n\t\t\t(this.#checkoutStep === null)) {\r\n\t\t\tthis.#setStatus(_kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.TRANSACTION);\r\n\t\t\tthis.#resetInactivityTimer()\r\n\t\t}\r\n\r\n\t\tif (this.#checkoutStep === null) {\r\n\t\t\tthis.#clearTransactionEndTimeOut();\r\n\t\t}\r\n\t}\r\n\r\n\tenterMaintenanceMode() {\r\n\t\tthis.#setStatus(_kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.MAINTENANCE);\r\n\t}\r\n\r\n\texitMaintenanceMode() {\r\n\t\tthis.#updateSatusAccordongToDeviceManager(DEVICE_MANAGER.status)\r\n\t}\r\n\r\n\t#faceDetected(face) {\r\n\t\tthis.snappAPI.getAccoutIdFromBiometricTemplate(face).then(response => {\r\n\t\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__.KioskEventUtils.triggerEvent(\"kiosk-account-detected\", response)\r\n\t\t})\r\n\t\t\t.catch(error => SNP_LOGGER.error(null, null, error))\r\n\t\t//.finally( () => this.faceRecognition.restartFaceDetection());\r\n\t}\r\n\r\n\tget status() {\r\n\t\treturn this.#status;\r\n\t}\r\n\r\n\tget shopCart() {\r\n\t\treturn this.#shopCart;\r\n\t}\r\n\r\n\tget currentOrder() {\r\n\t\treturn this.#currentOrder;\r\n\t}\r\n\r\n\tget enabledPaymentMethodIDs() {\r\n\t\treturn Array.from(this.#enabledPaymentMethods.map(it => it.PaymentMethodId));\r\n\t}\r\n\r\n\t#shopCartHasItemsToPrint() {\r\n\t\treturn this.#shopCart.Items.some(item => this.#isItemPrintable(item));\r\n\t}\r\n\r\n\t#isItemPrintable(item) {\r\n\t\treturn item.DocTemplateIDs && item.DocTemplateIDs.length > 0;\r\n\t}\r\n\r\n\tisShopCartEmpty() {\r\n\t\tif (!this.#shopCart)\r\n\t\t\treturn true;\r\n\r\n\t\treturn (this.#shopCart.Items || []).length <= 0;\r\n\t}\r\n\r\n\tisOrderEmpty() {\r\n\t\treturn this.#currentOrder == null;\r\n\t}\r\n\r\n\r\n\t#updateEnabledPaymentMethods() {\r\n\t\tthis.#enabledPaymentMethods = [];\r\n\r\n\t\tlet paymentIDsFromRights = this.#workstation.Rights.PaymentMethodIDs ? this.#workstation.Rights.PaymentMethodIDs.split(',') : [];\r\n\r\n\t\tthis.#workstation.PaymentMethodList.forEach(paymentMethod => {\r\n\t\t\tif (paymentMethod.PluginEnabled && paymentIDsFromRights.includes(paymentMethod.PluginId)) {\r\n\t\t\t\tthis.#enabledPaymentMethods.push(paymentMethod);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t#onKeyDown(e) {\r\n\t\tif (!$(':focus').is(\"input\")) {\r\n\t\t\tlet tsNow = (new Date()).getTime();\r\n\t\t\tif (tsNow - this.tsLast > 100)\r\n\t\t\t\tthis.keybuffer = \"\";\r\n\r\n\t\t\tif ((e.keyCode >= 48) && (e.keyCode <= 122))\r\n\t\t\t\tthis.keybuffer += String.fromCharCode(e.keyCode);\r\n\t\t\telse if ((e.keyCode == KEY_ENTER) && (this.keybuffer.length >= 6)) {\r\n\t\t\t\tlet mediaRead = {};\r\n\t\t\t\tmediaRead.MediaCode = this.keybuffer;\r\n\r\n\t\t\t\tthis.#triggerMediaRead(mediaRead);\r\n\t\t\t\tthis.keybuffer = \"\";\r\n\t\t\t}\r\n\r\n\t\t\tthis.tsLast = tsNow;\r\n\t\t}\r\n\t}\r\n\r\n\t#triggerMediaRead(read) {\r\n\t\tif (this.onMediaRead)\r\n\t\t\tthis.onMediaRead(read);\r\n\r\n\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__.KioskEventUtils.triggerEvent(\"kiosk-media-read\", read);\r\n\t}\r\n\r\n\t#triggerStatusChanged(message) {\r\n\t\tif (this.onStatusChanged)\r\n\t\t\tthis.onStatusChanged(message);\r\n\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__.KioskEventUtils.triggerEvent(\"kiosk-status-change\", message);\r\n\t}\r\n\r\n\t#triggerShopCartChanged(shopCart) {\r\n\t\tthis.#currentOrder = null;\r\n\t\tif (this.onShopCartChanged)\r\n\t\t\tthis.onShopCartChanged(shopCart);\r\n\r\n\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__.KioskEventUtils.triggerEvent(\"kiosk-shopcart-change\", { \"shopCart\": shopCart });\r\n\t}\r\n\r\n\t#triggerOrderChanged(order) {\r\n\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__.KioskEventUtils.triggerEvent(\"kiosk-order-change\", { \"order\": order });\r\n\t}\r\n\r\n\tonDeviceManagerStatusChanged(status) {\r\n\t\tif (!this.#performingCheckOut && this.status !== _kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.MAINTENANCE)\r\n\t\t\tthis.#updateSatusAccordongToDeviceManager(status);\r\n\t}\r\n\r\n\t#updateSatusAccordongToDeviceManager(status, kioskStatusOnReady) {\r\n\t\tswitch (status) {\r\n\t\t\tcase _common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_2__.CONNECTOR_STATUS.INIT:\r\n\t\t\t\tthis.#setStatus(_kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.INIT);\r\n\t\t\t\tbreak;\r\n\t\t\tcase _common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_2__.CONNECTOR_STATUS.READY:\r\n\t\t\t\tthis.#setStatus(kioskStatusOnReady || _kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.IDLE);\r\n\t\t\t\tbreak;\r\n\t\t\tcase _common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_2__.CONNECTOR_STATUS.ERROR:\r\n\t\t\t\tthis.#setStatus(_kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.ERROR);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\t#initDevices(workstation) {\r\n\t\tif (!DEVICE_MANAGER)\r\n\t\t\tthrow new Error(\"Device manager not found\");\r\n\r\n\t\tDEVICE_MANAGER.onMediaRead = r => this.#triggerMediaRead(r);\r\n\t\tDEVICE_MANAGER.init(workstation);\r\n\t}\r\n\r\n\t/*\r\n\tparams = {\r\n\t\tfillApplicablePromoList: bool \r\n\t\tlangISO: string \r\n\t}\r\n\t*/\r\n\tapiShopCart(cmd, req, params) {\r\n\t\tlet reqDO = {\r\n\t\t\tCommand: cmd\r\n\t\t}\r\n\r\n\t\tif (params) {\r\n\t\t\tif (params.fillApplicablePromoList)\r\n\t\t\t\treqDO.FillApplicablePromoList = params.fillApplicablePromoList;\r\n\t\t\tif (params.langISO)\r\n\t\t\t\treqDO.LangISO = params.langISO;\r\n\t\t}\r\n\r\n\t\tif (this.#shopCart)\r\n\t\t\treqDO.ShopCartId = this.#shopCart.ShopCartId;\r\n\t\treqDO[cmd] = req;\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.snappAPI.sendSnappRequest(\"ShopCart\", reqDO)\r\n\t\t\t\t.then(ans => {\r\n\t\t\t\t\tif (!this.#shopCart.ShopCartId) {\r\n\t\t\t\t\t\tthis.#checkoutStep = null;\r\n\t\t\t\t\t\tthis.#clearTransactionEndTimeOut();\r\n\t\t\t\t\t\tthis.#initNewTransaction();\r\n\t\t\t\t\t\tthis.#setStatus(_kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.TRANSACTION);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.#shopCart = ans.ShopCart || {};\r\n\t\t\t\t\tthis.#triggerShopCartChanged(this.#shopCart);\r\n\r\n\t\t\t\t\tif (\"ValidateShopCart\".toLocaleLowerCase() === cmd.toLocaleLowerCase() && ans[cmd] && !ans[cmd].ErrorCode)\r\n\t\t\t\t\t\tthis.#shopCartValidated = true;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tthis.#shopCartValidated = false;\r\n\r\n\t\t\t\t\tresolve(ans[cmd] || {});\r\n\t\t\t\t\treturn this.#shopCart;\r\n\t\t\t\t})\r\n\t\t\t\t.catch(error => reject(error));\r\n\t\t});\r\n\t}\r\n\r\n\tasync validateShopCart() {\r\n\t\tif (this.#shopCart && this.#shopCart.ShopCartId && !this.#shopCartValidated) {\r\n\t\t\tSNP_LOGGER.debug(null, null, \"Validating ShopCart\");\r\n\t\t\tconst ans = await this.apiShopCart(\"ValidateShopCart\", {});\r\n\t\t\tif (ans.ErrorCode)\r\n\t\t\t\tthrow new _common_script_errors__WEBPACK_IMPORTED_MODULE_7__.ESnAppError(`ShopCart validation failed because ${ans.ErrorMessage}`, ans.ErrorCode);\r\n\t\t\telse\r\n\t\t\t\tthis.#shopCartValidated = true;\r\n\t\t}\r\n\t}\r\n\r\n\tstartRead() {\r\n\t\tDEVICE_MANAGER.startRead();\r\n\t}\r\n\r\n\tstopRead() {\r\n\t\tthis.#resetInactivityTimer();\r\n\t\tDEVICE_MANAGER.stopRead();\r\n\t}\r\n\r\n\tasync startCheckout(params) {\r\n\t\tlet retry = true;\r\n\t\tthis.#performingCheckOut = true;\r\n\t\ttry {\r\n\t\t\tawait this.#beforeCheckout();\r\n\r\n\t\t\tif (!this.isShopCartEmpty())\r\n\t\t\t\tretry = await this.#doShopCartCheckout(params);\r\n\t\t\telse {\r\n\t\t\t\tawait this.#doMediaReissue(params);\r\n\t\t\t\tretry = false;\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tthis.#performingCheckOut = false;\r\n\t\t\tthis.#afterCheckout(retry);\r\n\t\t}\r\n\t}\r\n\r\n\tasync #doShopCartCheckout(params) {\r\n\t\tparams.totalDue = this.#shopCart ? this.#shopCart.TotalDue : 0;\r\n\t\tparams.shopCartId = (this.#shopCart || {}).ShopCartId;\r\n\t\tparams.trnReceiptDocTemplateId = this.#workstation.Rights.TrnReceipt_DocTemplateId;\r\n\t\tparams.printOptionSelection = this.#printOptionSelection;\r\n\t\tparams.retryFailedPayment = this.#retryFailedPayment;\r\n\t\tparams.shopCartHasItemsToPrint = this.#shopCartHasItemsToPrint();\r\n\t\tparams.transactionType = this.#shopCart ? this.#shopCart.Transaction.TransactionType : 1;\r\n\r\n\t\tlet checkoutResult = await this.#checkout.shopCartCheckout(params, this.#currentTransaction);\r\n\t\tthis.#currentTransaction = checkoutResult.data;\r\n\r\n\t\treturn checkoutResult.retry;\r\n\t}\r\n\r\n\tasync #doMediaReissue(params) {\r\n\t\tif (!this.#currentOrder)\r\n\t\t\tthrow new Error(\"An order must be loaded before calling the reissue method\");\r\n\r\n\t\tparams.order = this.#currentOrder;\r\n\t\tparams.printOptionSelection = this.#printOptionSelection;\r\n\t\tawait this.#checkout.mediaReissue(params);\r\n\t}\r\n\r\n\tloadOrder(params) {\r\n\t\tthis.#currentOrder = null;\r\n\r\n\t\tlet reqDO = {\r\n\t\t\tLocateSale: {\r\n\t\t\t\tSaleCode: params.saleCode\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn this.snappAPI.cmd(\"SALE\", \"LoadEntSale\", reqDO)\r\n\t\t\t.then((resp) => {\r\n\t\t\t\tthis.#currentOrder = resp.Sale.Sale;\r\n\t\t\t\tthis.#triggerOrderChanged(this.#currentOrder);\r\n\t\t\t\treturn this.currentOrder;\r\n\t\t\t});\r\n\t}\r\n\r\n\tasync #beforeCheckout() {\r\n\t\tif (!this.#checkoutStep) {\r\n\t\t\tthis.#checkoutStep = _kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_CHECKOUT.INIT;\r\n\t\t}\r\n\t\tthis.#clearInactivityTimer();\r\n\t\tawait this.validateShopCart();\r\n\t}\r\n\r\n\t#afterCheckout(retry) {\r\n\t\tif (retry) {\r\n\t\t\tthis.#updateSatusAccordongToDeviceManager(DEVICE_MANAGER.status, _kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.TRANSACTION);\r\n\t\t} else {\r\n\t\t\tthis.#initNewTransaction();\r\n\t\t\tthis.#transactionEndTimeOut = setTimeout(\r\n\t\t\t\t() => {\r\n\t\t\t\t\tthis.#checkoutStep = null;\r\n\t\t\t\t\tthis.#backToIdle();\r\n\t\t\t\t},\r\n\t\t\t\tthis.#transactionEndTimeOutMSec);\r\n\t\t}\r\n\t\tthis.#resetInactivityTimer();\r\n\t}\r\n\r\n\t#setInactivityTimer(timeout) {\r\n\t\tthis.#inactivityTimeout = setTimeout(() => {\r\n\t\t\tthis.#backToIdle();\r\n\t\t\tclearTimeout(this.#inactivityTimeout);\r\n\t\t}, timeout);\r\n\t}\r\n\r\n\t#resetInactivityTimer() {\r\n\t\tthis.#clearInactivityTimer();\r\n\t\tif (!this.#checkoutStep)\r\n\t\t\tthis.#setInactivityTimer(this.inactivityTimeOutMSec);\r\n\t}\r\n\r\n\t#clearInactivityTimer() {\r\n\t\tif (this.#inactivityTimeout)\r\n\t\t\tclearTimeout(this.#inactivityTimeout);\r\n\t}\r\n\r\n\t#clearTransactionEndTimeOut() {\r\n\t\tif (this.#transactionEndTimeOut) {\r\n\t\t\tclearTimeout(this.#transactionEndTimeOut);\r\n\t\t\tthis.#transactionEndTimeOut = null;\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t* Operations performed after inactivity timeout\r\n\t*/\r\n\t#backToIdle() {\r\n\t\tif ((this.#status !== _kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.ERROR) && (this.#status !== _kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.MAINTENANCE)) {\r\n\t\t\tif (this.#shopCart && this.#shopCart.ShopCartId) {\r\n\t\t\t\tthis.apiShopCart(\"EmptyShopCart\")\r\n\t\t\t\t\t.catch(error => SNP_LOGGER.error(null, null, error));\r\n\t\t\t}\r\n\t\t\tthis.#updateSatusAccordongToDeviceManager(DEVICE_MANAGER.status);\r\n\t\t}\r\n\r\n\t\tthis.#initNewTransaction();\r\n\r\n\r\n\t\tif ((this.#status !== _kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.TRANSACTION) && (this.snappAPI.status === _common_script_snapp_api__WEBPACK_IMPORTED_MODULE_0__.SNAPP_API_STATUS.ONLINE_DIFFERENT_VER))\r\n\t\t\tlocation.reload();\r\n\t}\r\n\r\n\tstartNewTransaction() {\r\n\t\tif (this.#checkoutStep && this.#checkoutStep !== _kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_CHECKOUT.COMPLETE)\r\n\t\t\tthrow new Error(\"Transaction not yet completed\");\r\n\r\n\t\tthis.#clearTransactionEndTimeOut();\r\n\t\tthis.#checkoutStep = null;\r\n\t\tthis.#backToIdle();\r\n\t}\r\n\r\n\t#initNewTransaction() {\r\n\t\tthis.#shopCart = {};\r\n\t\tthis.#shopCartValidated = false;\r\n\t\tthis.#currentTransaction = {};\r\n\t\tthis.#currentOrder = null;\r\n\t\tDEVICE_MANAGER.allLightsOff();\r\n\t}\r\n\r\n\t#setStatus(newStatus, message) {\r\n\t\tif (_kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.ERROR == newStatus) {\r\n\t\t\tthis.#resetInactivityTimer();\r\n\t\t\tSNP_LOGGER.debug(null, null, \"Kiosk status error: \" + message);\r\n\t\t}\r\n\r\n\t\tif (this.#status !== newStatus) {\r\n\t\t\tthis.#status = newStatus;\r\n\t\t\tthis.#triggerStatusChanged({\r\n\t\t\t\t\"status\": newStatus,\r\n\t\t\t\t\"message\": message\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t#destroy() {\r\n\t\tDEVICE_MANAGER.close();\r\n\t}\r\n\r\n\t#onSnappAPIStatusChanged(apiStatus) {\r\n\t\tif ((apiStatus === _common_script_snapp_api__WEBPACK_IMPORTED_MODULE_0__.SNAPP_API_STATUS.ONLINE_DIFFERENT_VER) && (this.#status !== _kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.TRANSACTION))\r\n\t\t\tlocation.reload();\r\n\t\telse if (apiStatus === _common_script_snapp_api__WEBPACK_IMPORTED_MODULE_0__.SNAPP_API_STATUS.ONLINE) {\r\n\t\t\tthis.#loadWorkstationConfigurationIfNeeded();\r\n\t\t\tSNP_LOGGER.info(null, null, \"API connection resumed\");\r\n\t\t}\r\n\t\telse if (apiStatus === _common_script_snapp_api__WEBPACK_IMPORTED_MODULE_0__.SNAPP_API_STATUS.OFFLINE) {\r\n\t\t\tthis.#setStatus(_kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_STATUS.ERROR, \"Offline\");\r\n\t\t\tSNP_LOGGER.warn(null, null, \"API connection offline\");\r\n\t\t}\r\n\t}\r\n\r\n\tstatic getFiscalDate(dateTime, switchHour) {\r\n\t\tif (!dateTime)\r\n\t\t\treturn null;\r\n\r\n\t\tlet y = dateTime.getFullYear();\r\n\t\tlet m = dateTime.getMonth();\r\n\t\tlet d = dateTime.getDate();\r\n\t\tif (dateTime.getHours() < switchHour)\r\n\t\t\td--;\r\n\t\treturn new Date(y, m, d);\r\n\t}\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L2tpb3NrLWNvbnRyb2xsZXIuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQWdHO0FBQzFDO0FBQ29CO0FBQ2I7QUFDWjtBQUNLO0FBQ1Y7QUFDUTtBQUNwRDtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsc0RBQVk7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsOEVBQXdCO0FBQ3pDO0FBQ0E7QUFDQSxrQ0FBa0MsZ0VBQVM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixzREFBWTtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IseURBQWU7QUFDOUM7QUFDQTtBQUNBLG1CQUFtQixzREFBWTtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLDhEQUFRO0FBQzlCLHVCQUF1QixxREFBUTtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixzREFBWTtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyx5REFBZTtBQUMvQztBQUNBO0FBQ0E7QUFDQSxvQkFBb0Isc0RBQVk7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixzREFBWTtBQUNuQztBQUNBO0FBQ0EsbUJBQW1CLHNEQUFZO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUVBQWlFLGdDQUFnQztBQUNqRyxrQkFBa0Isc0NBQXNDO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLHNEQUFZO0FBQ3JDLHFCQUFxQixzREFBWTtBQUNqQztBQUNBLG1CQUFtQixzREFBWTtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0Isc0RBQVk7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUcsK0RBQWU7QUFDbEIsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFLCtEQUFlO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFLCtEQUFlO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRSwrREFBZSx5Q0FBeUMsc0JBQXNCO0FBQ2hGO0FBQ0E7QUFDQTtBQUNBLEVBQUUsK0RBQWUsc0NBQXNDLGdCQUFnQjtBQUN2RTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsc0RBQVk7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsb0ZBQWdCO0FBQ3hCLG9CQUFvQixzREFBWTtBQUNoQztBQUNBLFFBQVEsb0ZBQWdCO0FBQ3hCLDBDQUEwQyxzREFBWTtBQUN0RDtBQUNBLFFBQVEsb0ZBQWdCO0FBQ3hCLG9CQUFvQixzREFBWTtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixzREFBWTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RDtBQUM1RDtBQUNBLGNBQWMsOERBQVcsdUNBQXVDLGlCQUFpQjtBQUNqRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0Isd0RBQWM7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvRUFBb0Usc0RBQVk7QUFDaEYsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixzREFBWSw2QkFBNkIsc0RBQVk7QUFDN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0Isc0RBQVksMkNBQTJDLHNFQUFnQjtBQUMvRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCx3REFBYztBQUNqRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sc0RBQVk7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsc0VBQWdCLDRDQUE0QyxzREFBWTtBQUM3RjtBQUNBLHlCQUF5QixzRUFBZ0I7QUFDekM7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLHNFQUFnQjtBQUN6QyxtQkFBbUIsc0RBQVk7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9raW9zay1jb250cm9sbGVyLy4uL3NjcmlwdC9raW9zay1jb250cm9sbGVyLmpzP2U3MjUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU25hcHBBUEksIFNOQVBQX0FQSV9TVEFUVVNfQ0hBTkdFRCwgU05BUFBfQVBJX1NUQVRVUyB9IGZyb20gXCJAY29tbW9uLXNjcmlwdC9zbmFwcC1hcGlcIjtcclxuaW1wb3J0IHsgVGltZWRUYXNrIH0gZnJvbSBcIkBjb21tb24tc2NyaXB0L3RpbWVkLXRhc2tcIjtcclxuaW1wb3J0IHsgQ09OTkVDVE9SX1NUQVRVUyB9IGZyb20gJ0Bjb21tb24tc2NyaXB0L2RldmljZS1tYW5hZ2VyL2RtLW1vZGVsJztcclxuaW1wb3J0IHsgS0lPU0tfU1RBVFVTLCBLSU9TS19DSEVDS09VVCB9IGZyb20gXCIuL2tpb3NrLW1vZGVsXCI7XHJcbmltcG9ydCBGYWNlUmVjb2duaXRpb24gZnJvbSBcIi4va2lvc2stZmFjZS1yZWNvblwiO1xyXG5pbXBvcnQgeyBLaW9za0V2ZW50VXRpbHMgfSBmcm9tICcuL2tpb3NrLWV2ZW50LXV0aWxzJztcclxuaW1wb3J0IHsgQ2hlY2tvdXQgfSBmcm9tIFwiLi9zdGVwcy9jaGVja291dFwiO1xyXG5pbXBvcnQgeyBFU25BcHBFcnJvciB9IGZyb20gXCJAY29tbW9uLXNjcmlwdC9lcnJvcnNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBLaW9za0NvbnRyb2xsZXIge1xyXG5cdCNpbmFjdGl2aXR5VGltZW91dDtcclxuXHQjZmlzY2FsRGF0ZUNoZWNrVGFzaztcclxuXHQjdHJhbnNhY3Rpb25FbmRUaW1lT3V0TVNlYztcclxuXHQjdHJhbnNhY3Rpb25FbmRUaW1lT3V0ID0gbnVsbDtcclxuXHJcblx0I3N0YXR1cyA9IEtJT1NLX1NUQVRVUy5FUlJPUjtcclxuXHQjY2hlY2tvdXRTdGVwID0gbnVsbDtcclxuXHQjd29ya3N0YXRpb25JZDtcclxuXHQjZW5hYmxlZFBheW1lbnRNZXRob2RzID0gW107XHJcblx0I3Nob3BDYXJ0ID0ge307XHJcblx0I2N1cnJlbnRUcmFuc2FjdGlvbiA9IHt9O1xyXG5cdCNjdXJyZW50T3JkZXIgPSBudWxsO1xyXG5cdCNjaGVja291dDtcclxuXHQjcHJpbnRPcHRpb25TZWxlY3Rpb24gPSBmYWxzZTtcclxuXHQjcmV0cnlGYWlsZWRQYXltZW50ID0gZmFsc2U7XHJcblx0I3Nob3BDYXJ0VmFsaWRhdGVkID0gZmFsc2U7XHJcblx0I3BlcmZvcm1pbmdDaGVja091dCA9IGZhbHNlO1xyXG5cclxuXHJcblx0c25hcHBBUEk7XHJcblx0I3dvcmtzdGF0aW9uO1xyXG5cclxuXHRvblN0YXR1c0NoYW5nZWQ7XHJcblx0b25TaG9wQ2FydENoYW5nZWQ7XHJcblx0b25NZWRpYVJlYWQ7XHJcblx0a2V5YnVmZmVyID0gXCJcIjtcclxuXHR0c0xhc3QgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpO1xyXG5cclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdCQoZG9jdW1lbnQpLm9uKFwiZGV2aWNlLW1hbmFnZXItc3RhdHVzXCIsIChldmVudCwgcykgPT4gdGhpcy5vbkRldmljZU1hbmFnZXJTdGF0dXNDaGFuZ2VkKHMpKTtcclxuXHRcdCQoZG9jdW1lbnQpLm9uKFwia2lvc2stY2hlY2tvdXRcIiwgKGV2ZW50LCBkYXRhKSA9PiB0aGlzLiNvbktpb3NrQ2hlY2tvdXQoZGF0YSkpO1xyXG5cdFx0JChkb2N1bWVudCkub24oU05BUFBfQVBJX1NUQVRVU19DSEFOR0VELCAoZXZlbnQsIHN0YXR1cykgPT4gdGhpcy4jb25TbmFwcEFQSVN0YXR1c0NoYW5nZWQoc3RhdHVzKSk7XHJcblx0XHQkKGRvY3VtZW50KS5vbihcImtleWRvd25cIiwgKGV2ZW50KSA9PiB0aGlzLiNvbktleURvd24oZXZlbnQpKTtcclxuXHJcblx0XHR0aGlzLiNmaXNjYWxEYXRlQ2hlY2tUYXNrID0gbmV3IFRpbWVkVGFzayg2MDAwMCwgKCkgPT4gdGhpcy4jY2hlY2tGaXNjYWxEYXRlKCkpO1xyXG5cdH1cclxuXHJcblx0Z2V0IHdvcmtzdGF0aW9uKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuI3dvcmtzdGF0aW9uO1xyXG5cdH1cclxuXHJcblx0LypcclxuXHRwYXJhbXMgPSB7XHJcblx0XHRhcGlVcmw6IHN0cmluZyAvL3VybCBvZiB0aGUgU25BcHAgQVBJXHJcblx0XHR3b3Jrc3RhdGlvbjogRE9Xb3Jrc3RhdGlvbiAvLyBpZiBudWxsIHRoZSBXb3Jrc3RhdGlvbklkIGlzIG1hbmRhdG9yeVxyXG5cdFx0d29ya3N0YXRpb25JZDogc3RyaW5nIC8vIGlkIG9mIHRoZSB3b3Jrc3RhdGlvbiAoTWFuZGF0b3J5IGlmIHRoZSBcIndvcmtzdGF0aW9uXCIgcGFyYW1ldGVyIGlzIG51bGwpXHJcblx0XHR1c2VySWQ6IHN0cmluZyAvLyBpZCBvZiB0aGUgdXNlciAob3B0aW9uYWwpXHJcblx0XHR0b2tlbjogc3RyaW5nIC8vIHRva2VuIHRvIGJlIHVzZWQgZm9yIHRoZSBsb2dpbiBwcm9jZXNzIChvcHRpb25hbClcclxuXHRcdGluYWN0aXZpdHlUaW1lT3V0TVNlYzogaW50IC8vIHdoZW4gdGhlcmUgaXMgYW5vIGFjdGl2aXR5IGZvciB0aGlzIGFtb3VudCBvZiB0aW1lIHRoZSBraW9zayB3aWxsIHJldHVybiB0byBpZGxlXHJcblx0XHR0cmFuc2FjdGlvbkVuZFRpbWVPdXRNU2VjOiBpbnQgLy8gYW1vdW50IG9mIHRpbWUgdGhlIGVoZCB0cmFuc2FjdGlvbiBzY3JlZW4gd2lsbCBiZSB2aXNpYmxlIGZvclxyXG5cdFx0cHJpbnRPcHRpb25TZWxlY3Rpb246IGJvb2wgLy8gSWYgdHJ1ZSB0aGUgY29udHJvbGxlciB3aWxsIHRyaWdnZXIgdGhlIGEgdHJhbnNhY3Rpb24gZXZlbnQgZHVyaW5nIHRoZSBjaGVja291dCBwcm9jZXNzIHdpdGggcHJvZ3Jlc3MgPSBcInByaW50LW9wdGlvblwiXHJcblx0XHRvblN0YXR1c0NoYW5nZWQ6IGNhbGxiYWNrIC8vXHJcblx0XHRvblNob3BDYXJ0Q2hhbmdlZDogY2FsbGJhY2sgLy9cclxuXHRcdHJldHJ5RmFpbGVkUGF5bWVudDogYm9vbGVhbiAvLyBJZiB0cnVlIGVuYWJsZXMgdGggZSBwYXltZW50IHJldHJ5IGZlYXR1cmVcclxuXHR9XHJcblx0Ki9cclxuXHRpbml0KHBhcmFtcykge1xyXG5cdFx0dGhpcy5pbmFjdGl2aXR5VGltZU91dE1TZWMgPSBwYXJhbXMuaW5hY3Rpdml0eVRpbWVPdXRNU2VjIHx8IDMwMDAwO1xyXG5cdFx0dGhpcy4jdHJhbnNhY3Rpb25FbmRUaW1lT3V0TVNlYyA9IHBhcmFtcy50cmFuc2FjdGlvbkVuZFRpbWVPdXRNU2VjIHx8IDMwMDA7XHJcblx0XHRpZiAocGFyYW1zLnByaW50T3B0aW9uU2VsZWN0aW9uKVxyXG5cdFx0XHR0aGlzLiNwcmludE9wdGlvblNlbGVjdGlvbiA9IHBhcmFtcy5wcmludE9wdGlvblNlbGVjdGlvbjtcclxuXHRcdGlmIChwYXJhbXMucmV0cnlGYWlsZWRQYXltZW50KVxyXG5cdFx0XHR0aGlzLiNyZXRyeUZhaWxlZFBheW1lbnQgPSBwYXJhbXMucmV0cnlGYWlsZWRQYXltZW50O1xyXG5cclxuXHRcdHRoaXMub25TdGF0dXNDaGFuZ2VkID0gcGFyYW1zLm9uU3RhdHVzQ2hhbmdlZDtcclxuXHRcdHRoaXMub25TaG9wQ2FydENoYW5nZWQgPSBwYXJhbXMub25TaG9wQ2FydENoYW5nZWQ7XHJcblxyXG5cdFx0dGhpcy4jc2V0U3RhdHVzKEtJT1NLX1NUQVRVUy5JTklUKTtcclxuXHJcblx0XHQkKFwiYm9keVwiKS5jbGljaygoKSA9PiB0aGlzLiNib2R5VG91Y2hSZWNlaXZlZCgpKTtcclxuXHJcblx0XHRpZiAocGFyYW1zLndvcmtzdGF0aW9uKSB7XHJcblx0XHRcdHRoaXMuI3dvcmtzdGF0aW9uID0gcGFyYW1zLndvcmtzdGF0aW9uO1xyXG5cdFx0XHRwYXJhbXMud29ya3N0YXRpb25JZCA9IHBhcmFtcy53b3Jrc3RhdGlvbi5Xb3Jrc3RhdGlvbklkO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuI3dvcmtzdGF0aW9uSWQgPSBwYXJhbXMud29ya3N0YXRpb25JZDtcclxuXHJcblx0XHR0cnkge1xyXG5cdFx0XHRpZiAodHlwZW9mIGZhY2VhcGkgIT09ICd1bmRlZmluZWQnKVxyXG5cdFx0XHRcdHRoaXMuZmFjZVJlY29nbml0aW9uID0gbmV3IEZhY2VSZWNvZ25pdGlvbihwYXJhbXMuYXBpVXJsLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmlkZW8nKSk7XHJcblx0XHR9XHJcblx0XHRjYXRjaCAoZXJyb3IpIHtcclxuXHRcdFx0dGhpcy4jc2V0U3RhdHVzKEtJT1NLX1NUQVRVUy5FUlJPUiwgZXJyb3IpO1xyXG5cdFx0fVxyXG5cclxuXHRcdCQoZG9jdW1lbnQpLm9uKFwia2lvc2stcHJlc2VuY2UtZGV0ZWN0ZWRcIiwgKCkgPT4gdGhpcy4jYm9keVRvdWNoUmVjZWl2ZWQoKSk7XHJcblx0XHQkKGRvY3VtZW50KS5vbihcImtpb3NrLWZhY2UtZGV0ZWN0ZWRcIiwgKGV2ZW50LCBwYXlsb2FkKSA9PiB0aGlzLiNmYWNlRGV0ZWN0ZWQocGF5bG9hZC5mYWNlKSk7XHJcblxyXG5cdFx0dGhpcy5zbmFwcEFQSSA9IG5ldyBTbmFwcEFQSShwYXJhbXMuYXBpVXJsLCBwYXJhbXMud29ya3N0YXRpb25JZCwgcGFyYW1zLnVzZXJJZCwgcGFyYW1zLnRva2VuKTtcclxuXHRcdHRoaXMuI2NoZWNrb3V0ID0gbmV3IENoZWNrb3V0KHRoaXMuc25hcHBBUEkpO1xyXG5cdFx0U05QX0xPR0dFUi5zZXRDb25maWd1cmF0aW9uUGFyYW1zKHBhcmFtcyk7XHJcblx0fVxyXG5cclxuXHRhc3luYyAjbG9hZFdvcmtzdGF0aW9uQ29uZmlndXJhdGlvbklmTmVlZGVkKCkge1xyXG5cdFx0aWYgKHRoaXMuI3dvcmtzdGF0aW9uKVxyXG5cdFx0XHR0aGlzLiN1cGRhdGVTYXR1c0FjY29yZG9uZ1RvRGV2aWNlTWFuYWdlcihERVZJQ0VfTUFOQUdFUi5zdGF0dXMpO1xyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMuI3NldFN0YXR1cyhLSU9TS19TVEFUVVMuSU5JVCk7XHJcblx0XHRcdGF3YWl0IHRoaXMuI2xvYWRXb3Jrc3RhdGlvbih0aGlzLiN3b3Jrc3RhdGlvbklkKTtcclxuXHJcblx0XHRcdHRyeSB7XHJcblx0XHRcdFx0dGhpcy4jZmlzY2FsRGF0ZUNoZWNrVGFzay5zdGFydFdpdGhJbW1lZGlhdGVFeGVjdXRpb24oKTtcclxuXHRcdFx0XHR0aGlzLiN1cGRhdGVFbmFibGVkUGF5bWVudE1ldGhvZHModGhpcy4jd29ya3N0YXRpb24pO1xyXG5cdFx0XHRcdHRoaXMuI2NoZWNrb3V0LnNldEVuYWJsZWRQYXltZW50TWV0aG9kcyh0aGlzLiNlbmFibGVkUGF5bWVudE1ldGhvZHMpO1xyXG5cdFx0XHRcdHRoaXMuI2NoZWNrb3V0LnJpZ2h0cyA9IHRoaXMuI3dvcmtzdGF0aW9uLlJpZ2h0cztcclxuXHRcdFx0XHR0aGlzLiNjaGVja291dC5tYWluQ3VycmVuY3kgPSB0aGlzLiN3b3Jrc3RhdGlvbi5DdXJyZW5jeUxpc3QuZmluZChjdXJyID0+IChjdXJyLkN1cnJlbmN5SWQgPT09IHRoaXMuI3dvcmtzdGF0aW9uLk1haW5DdXJyZW5jeUlkKSk7XHJcblx0XHRcdFx0dGhpcy4jaW5pdERldmljZXModGhpcy4jd29ya3N0YXRpb24pO1xyXG5cdFx0XHRcdGlmICh0eXBlb2YgZmFjZWFwaSAhPT0gJ3VuZGVmaW5lZCcpXHJcblx0XHRcdFx0XHR0aGlzLmZhY2VSZWNvZ25pdGlvbiA9IG5ldyBGYWNlUmVjb2duaXRpb24ocGFyYW1zLmFwaVVybCwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZGVvJykpO1xyXG5cdFx0XHRcdFNOUF9MT0dHRVIuc2V0V29ya3N0YXRpb24odGhpcy4jd29ya3N0YXRpb24pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGNhdGNoIChlcnJvcikge1xyXG5cdFx0XHRcdHRoaXMuI3NldFN0YXR1cyhLSU9TS19TVEFUVVMuRVJST1IsIGVycm9yKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0YXN5bmMgI3BlcmZvcm1NYWludGVuYW5jZSgpIHtcclxuXHRcdGlmICh0aGlzLiNzdGF0dXMgPT09IEtJT1NLX1NUQVRVUy5UUkFOU0FDVElPTilcclxuXHRcdFx0bG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2Zpc2NhbC1kYXRlJyk7XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy4jc2V0U3RhdHVzKEtJT1NLX1NUQVRVUy5FUlJPUiwgXCJNYWludGVuYW5jZVwiKTtcclxuXHRcdFx0YXdhaXQgREVWSUNFX01BTkFHRVIucGVyZm9ybU1haW50ZW5hbmNlKCk7XHJcblx0XHRcdGxvY2F0aW9uLnJlbG9hZCgpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0I2NoZWNrRmlzY2FsRGF0ZSgpIHtcclxuXHRcdGxldCBjdXJyZW50RmlzY2FsRGF0ZSA9IEtpb3NrQ29udHJvbGxlci5nZXRGaXNjYWxEYXRlKG5ldyBEYXRlKCksIHRoaXMuI3dvcmtzdGF0aW9uLlJpZ2h0cy5GaXNjYWxEYXRlU3dpdGNoSG91cik7XHJcblx0XHRsZXQgbGFzdEZpc2NhbERhdGUgPSBEYXRlLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdmaXNjYWwtZGF0ZScpKTtcclxuXHJcblx0XHRpZiAoIWxhc3RGaXNjYWxEYXRlIHx8IGxhc3RGaXNjYWxEYXRlIDwgY3VycmVudEZpc2NhbERhdGUpIHtcclxuXHRcdFx0bG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2Zpc2NhbC1kYXRlJywgY3VycmVudEZpc2NhbERhdGUpO1xyXG5cdFx0XHR0aGlzLiNwZXJmb3JtTWFpbnRlbmFuY2UoKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdCNvbktpb3NrQ2hlY2tvdXQoZGF0YSkge1xyXG5cdFx0aWYgKGRhdGEudHlwZSA9PSBcImNoZWNrb3V0LXN0ZXBcIikge1xyXG5cdFx0XHR0aGlzLiNjaGVja291dFN0ZXAgPSBkYXRhLnN0ZXAuc3RlcFR5cGU7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRhc3luYyAjbG9hZFdvcmtzdGF0aW9uKHdvcmtzdGF0aW9uSWQpIHtcclxuXHRcdGlmICghd29ya3N0YXRpb25JZClcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiRWl0aGVyIHdvcmtzdGF0aW9uIG9yIHdvcmtzdGF0aW9uSWQgcGFyYW1ldGVycyBtdXN0IGJlIGV2YWx1dGVkXCIpO1xyXG5cclxuXHRcdGF3YWl0IHRoaXMuc25hcHBBUEkuY21kKFwiV09SS1NUQVRJT05cIiwgXCJMb2FkRW50V29ya3N0YXRpb25cIiwgeyBcIldvcmtzdGF0aW9uSWRcIjogd29ya3N0YXRpb25JZCB9KVxyXG5cdFx0XHQudGhlbihhbnMgPT4geyB0aGlzLiN3b3Jrc3RhdGlvbiA9IGFucy5Xb3Jrc3RhdGlvbjsgfSlcclxuXHRcdFx0LmNhdGNoKGVycm9yID0+IFNOUF9MT0dHRVIuZXJyb3IobnVsbCwgbnVsbCwgZXJyb3IpKTtcclxuXHR9XHJcblxyXG5cdCNib2R5VG91Y2hSZWNlaXZlZCgpIHtcclxuXHRcdGlmICgoKHRoaXMuI3N0YXR1cyA9PT0gS0lPU0tfU1RBVFVTLklETEUpIHx8XHJcblx0XHRcdCh0aGlzLiNzdGF0dXMgPT09IEtJT1NLX1NUQVRVUy5UUkFOU0FDVElPTikpICYmXHJcblx0XHRcdCh0aGlzLiNjaGVja291dFN0ZXAgPT09IG51bGwpKSB7XHJcblx0XHRcdHRoaXMuI3NldFN0YXR1cyhLSU9TS19TVEFUVVMuVFJBTlNBQ1RJT04pO1xyXG5cdFx0XHR0aGlzLiNyZXNldEluYWN0aXZpdHlUaW1lcigpXHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMuI2NoZWNrb3V0U3RlcCA9PT0gbnVsbCkge1xyXG5cdFx0XHR0aGlzLiNjbGVhclRyYW5zYWN0aW9uRW5kVGltZU91dCgpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0ZW50ZXJNYWludGVuYW5jZU1vZGUoKSB7XHJcblx0XHR0aGlzLiNzZXRTdGF0dXMoS0lPU0tfU1RBVFVTLk1BSU5URU5BTkNFKTtcclxuXHR9XHJcblxyXG5cdGV4aXRNYWludGVuYW5jZU1vZGUoKSB7XHJcblx0XHR0aGlzLiN1cGRhdGVTYXR1c0FjY29yZG9uZ1RvRGV2aWNlTWFuYWdlcihERVZJQ0VfTUFOQUdFUi5zdGF0dXMpXHJcblx0fVxyXG5cclxuXHQjZmFjZURldGVjdGVkKGZhY2UpIHtcclxuXHRcdHRoaXMuc25hcHBBUEkuZ2V0QWNjb3V0SWRGcm9tQmlvbWV0cmljVGVtcGxhdGUoZmFjZSkudGhlbihyZXNwb25zZSA9PiB7XHJcblx0XHRcdEtpb3NrRXZlbnRVdGlscy50cmlnZ2VyRXZlbnQoXCJraW9zay1hY2NvdW50LWRldGVjdGVkXCIsIHJlc3BvbnNlKVxyXG5cdFx0fSlcclxuXHRcdFx0LmNhdGNoKGVycm9yID0+IFNOUF9MT0dHRVIuZXJyb3IobnVsbCwgbnVsbCwgZXJyb3IpKVxyXG5cdFx0Ly8uZmluYWxseSggKCkgPT4gdGhpcy5mYWNlUmVjb2duaXRpb24ucmVzdGFydEZhY2VEZXRlY3Rpb24oKSk7XHJcblx0fVxyXG5cclxuXHRnZXQgc3RhdHVzKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuI3N0YXR1cztcclxuXHR9XHJcblxyXG5cdGdldCBzaG9wQ2FydCgpIHtcclxuXHRcdHJldHVybiB0aGlzLiNzaG9wQ2FydDtcclxuXHR9XHJcblxyXG5cdGdldCBjdXJyZW50T3JkZXIoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy4jY3VycmVudE9yZGVyO1xyXG5cdH1cclxuXHJcblx0Z2V0IGVuYWJsZWRQYXltZW50TWV0aG9kSURzKCkge1xyXG5cdFx0cmV0dXJuIEFycmF5LmZyb20odGhpcy4jZW5hYmxlZFBheW1lbnRNZXRob2RzLm1hcChpdCA9PiBpdC5QYXltZW50TWV0aG9kSWQpKTtcclxuXHR9XHJcblxyXG5cdCNzaG9wQ2FydEhhc0l0ZW1zVG9QcmludCgpIHtcclxuXHRcdHJldHVybiB0aGlzLiNzaG9wQ2FydC5JdGVtcy5zb21lKGl0ZW0gPT4gdGhpcy4jaXNJdGVtUHJpbnRhYmxlKGl0ZW0pKTtcclxuXHR9XHJcblxyXG5cdCNpc0l0ZW1QcmludGFibGUoaXRlbSkge1xyXG5cdFx0cmV0dXJuIGl0ZW0uRG9jVGVtcGxhdGVJRHMgJiYgaXRlbS5Eb2NUZW1wbGF0ZUlEcy5sZW5ndGggPiAwO1xyXG5cdH1cclxuXHJcblx0aXNTaG9wQ2FydEVtcHR5KCkge1xyXG5cdFx0aWYgKCF0aGlzLiNzaG9wQ2FydClcclxuXHRcdFx0cmV0dXJuIHRydWU7XHJcblxyXG5cdFx0cmV0dXJuICh0aGlzLiNzaG9wQ2FydC5JdGVtcyB8fCBbXSkubGVuZ3RoIDw9IDA7XHJcblx0fVxyXG5cclxuXHRpc09yZGVyRW1wdHkoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy4jY3VycmVudE9yZGVyID09IG51bGw7XHJcblx0fVxyXG5cclxuXHJcblx0I3VwZGF0ZUVuYWJsZWRQYXltZW50TWV0aG9kcygpIHtcclxuXHRcdHRoaXMuI2VuYWJsZWRQYXltZW50TWV0aG9kcyA9IFtdO1xyXG5cclxuXHRcdGxldCBwYXltZW50SURzRnJvbVJpZ2h0cyA9IHRoaXMuI3dvcmtzdGF0aW9uLlJpZ2h0cy5QYXltZW50TWV0aG9kSURzID8gdGhpcy4jd29ya3N0YXRpb24uUmlnaHRzLlBheW1lbnRNZXRob2RJRHMuc3BsaXQoJywnKSA6IFtdO1xyXG5cclxuXHRcdHRoaXMuI3dvcmtzdGF0aW9uLlBheW1lbnRNZXRob2RMaXN0LmZvckVhY2gocGF5bWVudE1ldGhvZCA9PiB7XHJcblx0XHRcdGlmIChwYXltZW50TWV0aG9kLlBsdWdpbkVuYWJsZWQgJiYgcGF5bWVudElEc0Zyb21SaWdodHMuaW5jbHVkZXMocGF5bWVudE1ldGhvZC5QbHVnaW5JZCkpIHtcclxuXHRcdFx0XHR0aGlzLiNlbmFibGVkUGF5bWVudE1ldGhvZHMucHVzaChwYXltZW50TWV0aG9kKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHQjb25LZXlEb3duKGUpIHtcclxuXHRcdGlmICghJCgnOmZvY3VzJykuaXMoXCJpbnB1dFwiKSkge1xyXG5cdFx0XHRsZXQgdHNOb3cgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpO1xyXG5cdFx0XHRpZiAodHNOb3cgLSB0aGlzLnRzTGFzdCA+IDEwMClcclxuXHRcdFx0XHR0aGlzLmtleWJ1ZmZlciA9IFwiXCI7XHJcblxyXG5cdFx0XHRpZiAoKGUua2V5Q29kZSA+PSA0OCkgJiYgKGUua2V5Q29kZSA8PSAxMjIpKVxyXG5cdFx0XHRcdHRoaXMua2V5YnVmZmVyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoZS5rZXlDb2RlKTtcclxuXHRcdFx0ZWxzZSBpZiAoKGUua2V5Q29kZSA9PSBLRVlfRU5URVIpICYmICh0aGlzLmtleWJ1ZmZlci5sZW5ndGggPj0gNikpIHtcclxuXHRcdFx0XHRsZXQgbWVkaWFSZWFkID0ge307XHJcblx0XHRcdFx0bWVkaWFSZWFkLk1lZGlhQ29kZSA9IHRoaXMua2V5YnVmZmVyO1xyXG5cclxuXHRcdFx0XHR0aGlzLiN0cmlnZ2VyTWVkaWFSZWFkKG1lZGlhUmVhZCk7XHJcblx0XHRcdFx0dGhpcy5rZXlidWZmZXIgPSBcIlwiO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzLnRzTGFzdCA9IHRzTm93O1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0I3RyaWdnZXJNZWRpYVJlYWQocmVhZCkge1xyXG5cdFx0aWYgKHRoaXMub25NZWRpYVJlYWQpXHJcblx0XHRcdHRoaXMub25NZWRpYVJlYWQocmVhZCk7XHJcblxyXG5cdFx0S2lvc2tFdmVudFV0aWxzLnRyaWdnZXJFdmVudChcImtpb3NrLW1lZGlhLXJlYWRcIiwgcmVhZCk7XHJcblx0fVxyXG5cclxuXHQjdHJpZ2dlclN0YXR1c0NoYW5nZWQobWVzc2FnZSkge1xyXG5cdFx0aWYgKHRoaXMub25TdGF0dXNDaGFuZ2VkKVxyXG5cdFx0XHR0aGlzLm9uU3RhdHVzQ2hhbmdlZChtZXNzYWdlKTtcclxuXHRcdEtpb3NrRXZlbnRVdGlscy50cmlnZ2VyRXZlbnQoXCJraW9zay1zdGF0dXMtY2hhbmdlXCIsIG1lc3NhZ2UpO1xyXG5cdH1cclxuXHJcblx0I3RyaWdnZXJTaG9wQ2FydENoYW5nZWQoc2hvcENhcnQpIHtcclxuXHRcdHRoaXMuI2N1cnJlbnRPcmRlciA9IG51bGw7XHJcblx0XHRpZiAodGhpcy5vblNob3BDYXJ0Q2hhbmdlZClcclxuXHRcdFx0dGhpcy5vblNob3BDYXJ0Q2hhbmdlZChzaG9wQ2FydCk7XHJcblxyXG5cdFx0S2lvc2tFdmVudFV0aWxzLnRyaWdnZXJFdmVudChcImtpb3NrLXNob3BjYXJ0LWNoYW5nZVwiLCB7IFwic2hvcENhcnRcIjogc2hvcENhcnQgfSk7XHJcblx0fVxyXG5cclxuXHQjdHJpZ2dlck9yZGVyQ2hhbmdlZChvcmRlcikge1xyXG5cdFx0S2lvc2tFdmVudFV0aWxzLnRyaWdnZXJFdmVudChcImtpb3NrLW9yZGVyLWNoYW5nZVwiLCB7IFwib3JkZXJcIjogb3JkZXIgfSk7XHJcblx0fVxyXG5cclxuXHRvbkRldmljZU1hbmFnZXJTdGF0dXNDaGFuZ2VkKHN0YXR1cykge1xyXG5cdFx0aWYgKCF0aGlzLiNwZXJmb3JtaW5nQ2hlY2tPdXQgJiYgdGhpcy5zdGF0dXMgIT09IEtJT1NLX1NUQVRVUy5NQUlOVEVOQU5DRSlcclxuXHRcdFx0dGhpcy4jdXBkYXRlU2F0dXNBY2NvcmRvbmdUb0RldmljZU1hbmFnZXIoc3RhdHVzKTtcclxuXHR9XHJcblxyXG5cdCN1cGRhdGVTYXR1c0FjY29yZG9uZ1RvRGV2aWNlTWFuYWdlcihzdGF0dXMsIGtpb3NrU3RhdHVzT25SZWFkeSkge1xyXG5cdFx0c3dpdGNoIChzdGF0dXMpIHtcclxuXHRcdFx0Y2FzZSBDT05ORUNUT1JfU1RBVFVTLklOSVQ6XHJcblx0XHRcdFx0dGhpcy4jc2V0U3RhdHVzKEtJT1NLX1NUQVRVUy5JTklUKTtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdFx0Y2FzZSBDT05ORUNUT1JfU1RBVFVTLlJFQURZOlxyXG5cdFx0XHRcdHRoaXMuI3NldFN0YXR1cyhraW9za1N0YXR1c09uUmVhZHkgfHwgS0lPU0tfU1RBVFVTLklETEUpO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRjYXNlIENPTk5FQ1RPUl9TVEFUVVMuRVJST1I6XHJcblx0XHRcdFx0dGhpcy4jc2V0U3RhdHVzKEtJT1NLX1NUQVRVUy5FUlJPUik7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdGRlZmF1bHQ6XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQjaW5pdERldmljZXMod29ya3N0YXRpb24pIHtcclxuXHRcdGlmICghREVWSUNFX01BTkFHRVIpXHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIkRldmljZSBtYW5hZ2VyIG5vdCBmb3VuZFwiKTtcclxuXHJcblx0XHRERVZJQ0VfTUFOQUdFUi5vbk1lZGlhUmVhZCA9IHIgPT4gdGhpcy4jdHJpZ2dlck1lZGlhUmVhZChyKTtcclxuXHRcdERFVklDRV9NQU5BR0VSLmluaXQod29ya3N0YXRpb24pO1xyXG5cdH1cclxuXHJcblx0LypcclxuXHRwYXJhbXMgPSB7XHJcblx0XHRmaWxsQXBwbGljYWJsZVByb21vTGlzdDogYm9vbCBcclxuXHRcdGxhbmdJU086IHN0cmluZyBcclxuXHR9XHJcblx0Ki9cclxuXHRhcGlTaG9wQ2FydChjbWQsIHJlcSwgcGFyYW1zKSB7XHJcblx0XHRsZXQgcmVxRE8gPSB7XHJcblx0XHRcdENvbW1hbmQ6IGNtZFxyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChwYXJhbXMpIHtcclxuXHRcdFx0aWYgKHBhcmFtcy5maWxsQXBwbGljYWJsZVByb21vTGlzdClcclxuXHRcdFx0XHRyZXFETy5GaWxsQXBwbGljYWJsZVByb21vTGlzdCA9IHBhcmFtcy5maWxsQXBwbGljYWJsZVByb21vTGlzdDtcclxuXHRcdFx0aWYgKHBhcmFtcy5sYW5nSVNPKVxyXG5cdFx0XHRcdHJlcURPLkxhbmdJU08gPSBwYXJhbXMubGFuZ0lTTztcclxuXHRcdH1cclxuXHJcblx0XHRpZiAodGhpcy4jc2hvcENhcnQpXHJcblx0XHRcdHJlcURPLlNob3BDYXJ0SWQgPSB0aGlzLiNzaG9wQ2FydC5TaG9wQ2FydElkO1xyXG5cdFx0cmVxRE9bY21kXSA9IHJlcTtcclxuXHJcblx0XHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cdFx0XHR0aGlzLnNuYXBwQVBJLnNlbmRTbmFwcFJlcXVlc3QoXCJTaG9wQ2FydFwiLCByZXFETylcclxuXHRcdFx0XHQudGhlbihhbnMgPT4ge1xyXG5cdFx0XHRcdFx0aWYgKCF0aGlzLiNzaG9wQ2FydC5TaG9wQ2FydElkKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuI2NoZWNrb3V0U3RlcCA9IG51bGw7XHJcblx0XHRcdFx0XHRcdHRoaXMuI2NsZWFyVHJhbnNhY3Rpb25FbmRUaW1lT3V0KCk7XHJcblx0XHRcdFx0XHRcdHRoaXMuI2luaXROZXdUcmFuc2FjdGlvbigpO1xyXG5cdFx0XHRcdFx0XHR0aGlzLiNzZXRTdGF0dXMoS0lPU0tfU1RBVFVTLlRSQU5TQUNUSU9OKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHRoaXMuI3Nob3BDYXJ0ID0gYW5zLlNob3BDYXJ0IHx8IHt9O1xyXG5cdFx0XHRcdFx0dGhpcy4jdHJpZ2dlclNob3BDYXJ0Q2hhbmdlZCh0aGlzLiNzaG9wQ2FydCk7XHJcblxyXG5cdFx0XHRcdFx0aWYgKFwiVmFsaWRhdGVTaG9wQ2FydFwiLnRvTG9jYWxlTG93ZXJDYXNlKCkgPT09IGNtZC50b0xvY2FsZUxvd2VyQ2FzZSgpICYmIGFuc1tjbWRdICYmICFhbnNbY21kXS5FcnJvckNvZGUpXHJcblx0XHRcdFx0XHRcdHRoaXMuI3Nob3BDYXJ0VmFsaWRhdGVkID0gdHJ1ZTtcclxuXHRcdFx0XHRcdGVsc2VcclxuXHRcdFx0XHRcdFx0dGhpcy4jc2hvcENhcnRWYWxpZGF0ZWQgPSBmYWxzZTtcclxuXHJcblx0XHRcdFx0XHRyZXNvbHZlKGFuc1tjbWRdIHx8IHt9KTtcclxuXHRcdFx0XHRcdHJldHVybiB0aGlzLiNzaG9wQ2FydDtcclxuXHRcdFx0XHR9KVxyXG5cdFx0XHRcdC5jYXRjaChlcnJvciA9PiByZWplY3QoZXJyb3IpKTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0YXN5bmMgdmFsaWRhdGVTaG9wQ2FydCgpIHtcclxuXHRcdGlmICh0aGlzLiNzaG9wQ2FydCAmJiB0aGlzLiNzaG9wQ2FydC5TaG9wQ2FydElkICYmICF0aGlzLiNzaG9wQ2FydFZhbGlkYXRlZCkge1xyXG5cdFx0XHRTTlBfTE9HR0VSLmRlYnVnKG51bGwsIG51bGwsIFwiVmFsaWRhdGluZyBTaG9wQ2FydFwiKTtcclxuXHRcdFx0Y29uc3QgYW5zID0gYXdhaXQgdGhpcy5hcGlTaG9wQ2FydChcIlZhbGlkYXRlU2hvcENhcnRcIiwge30pO1xyXG5cdFx0XHRpZiAoYW5zLkVycm9yQ29kZSlcclxuXHRcdFx0XHR0aHJvdyBuZXcgRVNuQXBwRXJyb3IoYFNob3BDYXJ0IHZhbGlkYXRpb24gZmFpbGVkIGJlY2F1c2UgJHthbnMuRXJyb3JNZXNzYWdlfWAsIGFucy5FcnJvckNvZGUpO1xyXG5cdFx0XHRlbHNlXHJcblx0XHRcdFx0dGhpcy4jc2hvcENhcnRWYWxpZGF0ZWQgPSB0cnVlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0c3RhcnRSZWFkKCkge1xyXG5cdFx0REVWSUNFX01BTkFHRVIuc3RhcnRSZWFkKCk7XHJcblx0fVxyXG5cclxuXHRzdG9wUmVhZCgpIHtcclxuXHRcdHRoaXMuI3Jlc2V0SW5hY3Rpdml0eVRpbWVyKCk7XHJcblx0XHRERVZJQ0VfTUFOQUdFUi5zdG9wUmVhZCgpO1xyXG5cdH1cclxuXHJcblx0YXN5bmMgc3RhcnRDaGVja291dChwYXJhbXMpIHtcclxuXHRcdGxldCByZXRyeSA9IHRydWU7XHJcblx0XHR0aGlzLiNwZXJmb3JtaW5nQ2hlY2tPdXQgPSB0cnVlO1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0YXdhaXQgdGhpcy4jYmVmb3JlQ2hlY2tvdXQoKTtcclxuXHJcblx0XHRcdGlmICghdGhpcy5pc1Nob3BDYXJ0RW1wdHkoKSlcclxuXHRcdFx0XHRyZXRyeSA9IGF3YWl0IHRoaXMuI2RvU2hvcENhcnRDaGVja291dChwYXJhbXMpO1xyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRhd2FpdCB0aGlzLiNkb01lZGlhUmVpc3N1ZShwYXJhbXMpO1xyXG5cdFx0XHRcdHJldHJ5ID0gZmFsc2U7XHJcblx0XHRcdH1cclxuXHRcdH0gZmluYWxseSB7XHJcblx0XHRcdHRoaXMuI3BlcmZvcm1pbmdDaGVja091dCA9IGZhbHNlO1xyXG5cdFx0XHR0aGlzLiNhZnRlckNoZWNrb3V0KHJldHJ5KTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGFzeW5jICNkb1Nob3BDYXJ0Q2hlY2tvdXQocGFyYW1zKSB7XHJcblx0XHRwYXJhbXMudG90YWxEdWUgPSB0aGlzLiNzaG9wQ2FydCA/IHRoaXMuI3Nob3BDYXJ0LlRvdGFsRHVlIDogMDtcclxuXHRcdHBhcmFtcy5zaG9wQ2FydElkID0gKHRoaXMuI3Nob3BDYXJ0IHx8IHt9KS5TaG9wQ2FydElkO1xyXG5cdFx0cGFyYW1zLnRyblJlY2VpcHREb2NUZW1wbGF0ZUlkID0gdGhpcy4jd29ya3N0YXRpb24uUmlnaHRzLlRyblJlY2VpcHRfRG9jVGVtcGxhdGVJZDtcclxuXHRcdHBhcmFtcy5wcmludE9wdGlvblNlbGVjdGlvbiA9IHRoaXMuI3ByaW50T3B0aW9uU2VsZWN0aW9uO1xyXG5cdFx0cGFyYW1zLnJldHJ5RmFpbGVkUGF5bWVudCA9IHRoaXMuI3JldHJ5RmFpbGVkUGF5bWVudDtcclxuXHRcdHBhcmFtcy5zaG9wQ2FydEhhc0l0ZW1zVG9QcmludCA9IHRoaXMuI3Nob3BDYXJ0SGFzSXRlbXNUb1ByaW50KCk7XHJcblx0XHRwYXJhbXMudHJhbnNhY3Rpb25UeXBlID0gdGhpcy4jc2hvcENhcnQgPyB0aGlzLiNzaG9wQ2FydC5UcmFuc2FjdGlvbi5UcmFuc2FjdGlvblR5cGUgOiAxO1xyXG5cclxuXHRcdGxldCBjaGVja291dFJlc3VsdCA9IGF3YWl0IHRoaXMuI2NoZWNrb3V0LnNob3BDYXJ0Q2hlY2tvdXQocGFyYW1zLCB0aGlzLiNjdXJyZW50VHJhbnNhY3Rpb24pO1xyXG5cdFx0dGhpcy4jY3VycmVudFRyYW5zYWN0aW9uID0gY2hlY2tvdXRSZXN1bHQuZGF0YTtcclxuXHJcblx0XHRyZXR1cm4gY2hlY2tvdXRSZXN1bHQucmV0cnk7XHJcblx0fVxyXG5cclxuXHRhc3luYyAjZG9NZWRpYVJlaXNzdWUocGFyYW1zKSB7XHJcblx0XHRpZiAoIXRoaXMuI2N1cnJlbnRPcmRlcilcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiQW4gb3JkZXIgbXVzdCBiZSBsb2FkZWQgYmVmb3JlIGNhbGxpbmcgdGhlIHJlaXNzdWUgbWV0aG9kXCIpO1xyXG5cclxuXHRcdHBhcmFtcy5vcmRlciA9IHRoaXMuI2N1cnJlbnRPcmRlcjtcclxuXHRcdHBhcmFtcy5wcmludE9wdGlvblNlbGVjdGlvbiA9IHRoaXMuI3ByaW50T3B0aW9uU2VsZWN0aW9uO1xyXG5cdFx0YXdhaXQgdGhpcy4jY2hlY2tvdXQubWVkaWFSZWlzc3VlKHBhcmFtcyk7XHJcblx0fVxyXG5cclxuXHRsb2FkT3JkZXIocGFyYW1zKSB7XHJcblx0XHR0aGlzLiNjdXJyZW50T3JkZXIgPSBudWxsO1xyXG5cclxuXHRcdGxldCByZXFETyA9IHtcclxuXHRcdFx0TG9jYXRlU2FsZToge1xyXG5cdFx0XHRcdFNhbGVDb2RlOiBwYXJhbXMuc2FsZUNvZGVcclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHJcblx0XHRyZXR1cm4gdGhpcy5zbmFwcEFQSS5jbWQoXCJTQUxFXCIsIFwiTG9hZEVudFNhbGVcIiwgcmVxRE8pXHJcblx0XHRcdC50aGVuKChyZXNwKSA9PiB7XHJcblx0XHRcdFx0dGhpcy4jY3VycmVudE9yZGVyID0gcmVzcC5TYWxlLlNhbGU7XHJcblx0XHRcdFx0dGhpcy4jdHJpZ2dlck9yZGVyQ2hhbmdlZCh0aGlzLiNjdXJyZW50T3JkZXIpO1xyXG5cdFx0XHRcdHJldHVybiB0aGlzLmN1cnJlbnRPcmRlcjtcclxuXHRcdFx0fSk7XHJcblx0fVxyXG5cclxuXHRhc3luYyAjYmVmb3JlQ2hlY2tvdXQoKSB7XHJcblx0XHRpZiAoIXRoaXMuI2NoZWNrb3V0U3RlcCkge1xyXG5cdFx0XHR0aGlzLiNjaGVja291dFN0ZXAgPSBLSU9TS19DSEVDS09VVC5JTklUO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy4jY2xlYXJJbmFjdGl2aXR5VGltZXIoKTtcclxuXHRcdGF3YWl0IHRoaXMudmFsaWRhdGVTaG9wQ2FydCgpO1xyXG5cdH1cclxuXHJcblx0I2FmdGVyQ2hlY2tvdXQocmV0cnkpIHtcclxuXHRcdGlmIChyZXRyeSkge1xyXG5cdFx0XHR0aGlzLiN1cGRhdGVTYXR1c0FjY29yZG9uZ1RvRGV2aWNlTWFuYWdlcihERVZJQ0VfTUFOQUdFUi5zdGF0dXMsIEtJT1NLX1NUQVRVUy5UUkFOU0FDVElPTik7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLiNpbml0TmV3VHJhbnNhY3Rpb24oKTtcclxuXHRcdFx0dGhpcy4jdHJhbnNhY3Rpb25FbmRUaW1lT3V0ID0gc2V0VGltZW91dChcclxuXHRcdFx0XHQoKSA9PiB7XHJcblx0XHRcdFx0XHR0aGlzLiNjaGVja291dFN0ZXAgPSBudWxsO1xyXG5cdFx0XHRcdFx0dGhpcy4jYmFja1RvSWRsZSgpO1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0dGhpcy4jdHJhbnNhY3Rpb25FbmRUaW1lT3V0TVNlYyk7XHJcblx0XHR9XHJcblx0XHR0aGlzLiNyZXNldEluYWN0aXZpdHlUaW1lcigpO1xyXG5cdH1cclxuXHJcblx0I3NldEluYWN0aXZpdHlUaW1lcih0aW1lb3V0KSB7XHJcblx0XHR0aGlzLiNpbmFjdGl2aXR5VGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG5cdFx0XHR0aGlzLiNiYWNrVG9JZGxlKCk7XHJcblx0XHRcdGNsZWFyVGltZW91dCh0aGlzLiNpbmFjdGl2aXR5VGltZW91dCk7XHJcblx0XHR9LCB0aW1lb3V0KTtcclxuXHR9XHJcblxyXG5cdCNyZXNldEluYWN0aXZpdHlUaW1lcigpIHtcclxuXHRcdHRoaXMuI2NsZWFySW5hY3Rpdml0eVRpbWVyKCk7XHJcblx0XHRpZiAoIXRoaXMuI2NoZWNrb3V0U3RlcClcclxuXHRcdFx0dGhpcy4jc2V0SW5hY3Rpdml0eVRpbWVyKHRoaXMuaW5hY3Rpdml0eVRpbWVPdXRNU2VjKTtcclxuXHR9XHJcblxyXG5cdCNjbGVhckluYWN0aXZpdHlUaW1lcigpIHtcclxuXHRcdGlmICh0aGlzLiNpbmFjdGl2aXR5VGltZW91dClcclxuXHRcdFx0Y2xlYXJUaW1lb3V0KHRoaXMuI2luYWN0aXZpdHlUaW1lb3V0KTtcclxuXHR9XHJcblxyXG5cdCNjbGVhclRyYW5zYWN0aW9uRW5kVGltZU91dCgpIHtcclxuXHRcdGlmICh0aGlzLiN0cmFuc2FjdGlvbkVuZFRpbWVPdXQpIHtcclxuXHRcdFx0Y2xlYXJUaW1lb3V0KHRoaXMuI3RyYW5zYWN0aW9uRW5kVGltZU91dCk7XHJcblx0XHRcdHRoaXMuI3RyYW5zYWN0aW9uRW5kVGltZU91dCA9IG51bGw7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKlxyXG5cdCogT3BlcmF0aW9ucyBwZXJmb3JtZWQgYWZ0ZXIgaW5hY3Rpdml0eSB0aW1lb3V0XHJcblx0Ki9cclxuXHQjYmFja1RvSWRsZSgpIHtcclxuXHRcdGlmICgodGhpcy4jc3RhdHVzICE9PSBLSU9TS19TVEFUVVMuRVJST1IpICYmICh0aGlzLiNzdGF0dXMgIT09IEtJT1NLX1NUQVRVUy5NQUlOVEVOQU5DRSkpIHtcclxuXHRcdFx0aWYgKHRoaXMuI3Nob3BDYXJ0ICYmIHRoaXMuI3Nob3BDYXJ0LlNob3BDYXJ0SWQpIHtcclxuXHRcdFx0XHR0aGlzLmFwaVNob3BDYXJ0KFwiRW1wdHlTaG9wQ2FydFwiKVxyXG5cdFx0XHRcdFx0LmNhdGNoKGVycm9yID0+IFNOUF9MT0dHRVIuZXJyb3IobnVsbCwgbnVsbCwgZXJyb3IpKTtcclxuXHRcdFx0fVxyXG5cdFx0XHR0aGlzLiN1cGRhdGVTYXR1c0FjY29yZG9uZ1RvRGV2aWNlTWFuYWdlcihERVZJQ0VfTUFOQUdFUi5zdGF0dXMpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuI2luaXROZXdUcmFuc2FjdGlvbigpO1xyXG5cclxuXHJcblx0XHRpZiAoKHRoaXMuI3N0YXR1cyAhPT0gS0lPU0tfU1RBVFVTLlRSQU5TQUNUSU9OKSAmJiAodGhpcy5zbmFwcEFQSS5zdGF0dXMgPT09IFNOQVBQX0FQSV9TVEFUVVMuT05MSU5FX0RJRkZFUkVOVF9WRVIpKVxyXG5cdFx0XHRsb2NhdGlvbi5yZWxvYWQoKTtcclxuXHR9XHJcblxyXG5cdHN0YXJ0TmV3VHJhbnNhY3Rpb24oKSB7XHJcblx0XHRpZiAodGhpcy4jY2hlY2tvdXRTdGVwICYmIHRoaXMuI2NoZWNrb3V0U3RlcCAhPT0gS0lPU0tfQ0hFQ0tPVVQuQ09NUExFVEUpXHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIlRyYW5zYWN0aW9uIG5vdCB5ZXQgY29tcGxldGVkXCIpO1xyXG5cclxuXHRcdHRoaXMuI2NsZWFyVHJhbnNhY3Rpb25FbmRUaW1lT3V0KCk7XHJcblx0XHR0aGlzLiNjaGVja291dFN0ZXAgPSBudWxsO1xyXG5cdFx0dGhpcy4jYmFja1RvSWRsZSgpO1xyXG5cdH1cclxuXHJcblx0I2luaXROZXdUcmFuc2FjdGlvbigpIHtcclxuXHRcdHRoaXMuI3Nob3BDYXJ0ID0ge307XHJcblx0XHR0aGlzLiNzaG9wQ2FydFZhbGlkYXRlZCA9IGZhbHNlO1xyXG5cdFx0dGhpcy4jY3VycmVudFRyYW5zYWN0aW9uID0ge307XHJcblx0XHR0aGlzLiNjdXJyZW50T3JkZXIgPSBudWxsO1xyXG5cdFx0REVWSUNFX01BTkFHRVIuYWxsTGlnaHRzT2ZmKCk7XHJcblx0fVxyXG5cclxuXHQjc2V0U3RhdHVzKG5ld1N0YXR1cywgbWVzc2FnZSkge1xyXG5cdFx0aWYgKEtJT1NLX1NUQVRVUy5FUlJPUiA9PSBuZXdTdGF0dXMpIHtcclxuXHRcdFx0dGhpcy4jcmVzZXRJbmFjdGl2aXR5VGltZXIoKTtcclxuXHRcdFx0U05QX0xPR0dFUi5kZWJ1ZyhudWxsLCBudWxsLCBcIktpb3NrIHN0YXR1cyBlcnJvcjogXCIgKyBtZXNzYWdlKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAodGhpcy4jc3RhdHVzICE9PSBuZXdTdGF0dXMpIHtcclxuXHRcdFx0dGhpcy4jc3RhdHVzID0gbmV3U3RhdHVzO1xyXG5cdFx0XHR0aGlzLiN0cmlnZ2VyU3RhdHVzQ2hhbmdlZCh7XHJcblx0XHRcdFx0XCJzdGF0dXNcIjogbmV3U3RhdHVzLFxyXG5cdFx0XHRcdFwibWVzc2FnZVwiOiBtZXNzYWdlXHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0I2Rlc3Ryb3koKSB7XHJcblx0XHRERVZJQ0VfTUFOQUdFUi5jbG9zZSgpO1xyXG5cdH1cclxuXHJcblx0I29uU25hcHBBUElTdGF0dXNDaGFuZ2VkKGFwaVN0YXR1cykge1xyXG5cdFx0aWYgKChhcGlTdGF0dXMgPT09IFNOQVBQX0FQSV9TVEFUVVMuT05MSU5FX0RJRkZFUkVOVF9WRVIpICYmICh0aGlzLiNzdGF0dXMgIT09IEtJT1NLX1NUQVRVUy5UUkFOU0FDVElPTikpXHJcblx0XHRcdGxvY2F0aW9uLnJlbG9hZCgpO1xyXG5cdFx0ZWxzZSBpZiAoYXBpU3RhdHVzID09PSBTTkFQUF9BUElfU1RBVFVTLk9OTElORSkge1xyXG5cdFx0XHR0aGlzLiNsb2FkV29ya3N0YXRpb25Db25maWd1cmF0aW9uSWZOZWVkZWQoKTtcclxuXHRcdFx0U05QX0xPR0dFUi5pbmZvKG51bGwsIG51bGwsIFwiQVBJIGNvbm5lY3Rpb24gcmVzdW1lZFwiKTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKGFwaVN0YXR1cyA9PT0gU05BUFBfQVBJX1NUQVRVUy5PRkZMSU5FKSB7XHJcblx0XHRcdHRoaXMuI3NldFN0YXR1cyhLSU9TS19TVEFUVVMuRVJST1IsIFwiT2ZmbGluZVwiKTtcclxuXHRcdFx0U05QX0xPR0dFUi53YXJuKG51bGwsIG51bGwsIFwiQVBJIGNvbm5lY3Rpb24gb2ZmbGluZVwiKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHN0YXRpYyBnZXRGaXNjYWxEYXRlKGRhdGVUaW1lLCBzd2l0Y2hIb3VyKSB7XHJcblx0XHRpZiAoIWRhdGVUaW1lKVxyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHJcblx0XHRsZXQgeSA9IGRhdGVUaW1lLmdldEZ1bGxZZWFyKCk7XHJcblx0XHRsZXQgbSA9IGRhdGVUaW1lLmdldE1vbnRoKCk7XHJcblx0XHRsZXQgZCA9IGRhdGVUaW1lLmdldERhdGUoKTtcclxuXHRcdGlmIChkYXRlVGltZS5nZXRIb3VycygpIDwgc3dpdGNoSG91cilcclxuXHRcdFx0ZC0tO1xyXG5cdFx0cmV0dXJuIG5ldyBEYXRlKHksIG0sIGQpO1xyXG5cdH1cclxufSJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../script/kiosk-controller.js\n");

/***/ }),

/***/ "../script/kiosk-event-utils.js":
/*!**************************************!*\
  !*** ../script/kiosk-event-utils.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   KioskEventUtils: () => (/* binding */ KioskEventUtils)\n/* harmony export */ });\nclass KioskEventUtils {\r\n\t\r\n\tstatic triggerCheckoutStepEvent(stepType) {\r\n    let coEvent = {\r\n      type: \"checkout-step\",\r\n      step: {\r\n        stepType: stepType\r\n      }\r\n    };\r\n\r\n    this.triggerCheckoutEvent(coEvent);    \r\n  }\r\n  \r\n\tstatic triggerPaymentEvent(paymentType, paymentStatus, message, due, tendered, balance, remainingTime, extraProperties) {\r\n    let coEvent = {\r\n      type: \"payment\",\r\n      payment: {\r\n        paymentType: paymentType,\r\n        paymentStatus: paymentStatus,\r\n        message: message,\r\n        due: due,\r\n        tendered: tendered,\r\n        balance: balance,\r\n        remainingTime: remainingTime\r\n      }\r\n    };\r\n\r\n    if (extraProperties)\r\n      coEvent.transaction = Object.assign(coEvent.payment, extraProperties);\r\n\r\n    this.triggerCheckoutEvent(coEvent);    \r\n  }\r\n  \r\n  /*\r\n  params = {\r\n    status: string // transaction Status\r\n    progress: string // transaction progress\r\n    message: String // message\r\n    transactionRef: transactionRef // transactionReference\r\n    extraProperties: object // \r\n  }\r\n   */\r\n  static triggerTransactionEvent(status, progress, message, transactionRef, extraProperties) {\r\n    let coEvent = {\r\n      type: \"transaction\",\r\n      transaction: {\r\n        transactionStatus: status,\r\n        progress: progress,\r\n        message: message,\r\n        transactionRef: transactionRef\r\n      }\r\n    };\r\n\r\n    if (extraProperties)\r\n      coEvent.transaction = Object.assign(coEvent.transaction, extraProperties)\r\n\r\n    this.triggerCheckoutEvent(coEvent);    \r\n  }\r\n  \r\n\r\n  static triggerCheckoutEvent(payload) {\r\n    this.triggerEvent(\"kiosk-checkout\", payload);\r\n  }\r\n\r\n  static triggerEvent(eventCode, payload) {\r\n    $(document).trigger(eventCode, payload);\r\n  }\r\n\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L2tpb3NrLWV2ZW50LXV0aWxzLmpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9raW9zay1jb250cm9sbGVyLy4uL3NjcmlwdC9raW9zay1ldmVudC11dGlscy5qcz80YzA4Il0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBLaW9za0V2ZW50VXRpbHMge1xyXG5cdFxyXG5cdHN0YXRpYyB0cmlnZ2VyQ2hlY2tvdXRTdGVwRXZlbnQoc3RlcFR5cGUpIHtcclxuICAgIGxldCBjb0V2ZW50ID0ge1xyXG4gICAgICB0eXBlOiBcImNoZWNrb3V0LXN0ZXBcIixcclxuICAgICAgc3RlcDoge1xyXG4gICAgICAgIHN0ZXBUeXBlOiBzdGVwVHlwZVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMudHJpZ2dlckNoZWNrb3V0RXZlbnQoY29FdmVudCk7ICAgIFxyXG4gIH1cclxuICBcclxuXHRzdGF0aWMgdHJpZ2dlclBheW1lbnRFdmVudChwYXltZW50VHlwZSwgcGF5bWVudFN0YXR1cywgbWVzc2FnZSwgZHVlLCB0ZW5kZXJlZCwgYmFsYW5jZSwgcmVtYWluaW5nVGltZSwgZXh0cmFQcm9wZXJ0aWVzKSB7XHJcbiAgICBsZXQgY29FdmVudCA9IHtcclxuICAgICAgdHlwZTogXCJwYXltZW50XCIsXHJcbiAgICAgIHBheW1lbnQ6IHtcclxuICAgICAgICBwYXltZW50VHlwZTogcGF5bWVudFR5cGUsXHJcbiAgICAgICAgcGF5bWVudFN0YXR1czogcGF5bWVudFN0YXR1cyxcclxuICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLFxyXG4gICAgICAgIGR1ZTogZHVlLFxyXG4gICAgICAgIHRlbmRlcmVkOiB0ZW5kZXJlZCxcclxuICAgICAgICBiYWxhbmNlOiBiYWxhbmNlLFxyXG4gICAgICAgIHJlbWFpbmluZ1RpbWU6IHJlbWFpbmluZ1RpbWVcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoZXh0cmFQcm9wZXJ0aWVzKVxyXG4gICAgICBjb0V2ZW50LnRyYW5zYWN0aW9uID0gT2JqZWN0LmFzc2lnbihjb0V2ZW50LnBheW1lbnQsIGV4dHJhUHJvcGVydGllcyk7XHJcblxyXG4gICAgdGhpcy50cmlnZ2VyQ2hlY2tvdXRFdmVudChjb0V2ZW50KTsgICAgXHJcbiAgfVxyXG4gIFxyXG4gIC8qXHJcbiAgcGFyYW1zID0ge1xyXG4gICAgc3RhdHVzOiBzdHJpbmcgLy8gdHJhbnNhY3Rpb24gU3RhdHVzXHJcbiAgICBwcm9ncmVzczogc3RyaW5nIC8vIHRyYW5zYWN0aW9uIHByb2dyZXNzXHJcbiAgICBtZXNzYWdlOiBTdHJpbmcgLy8gbWVzc2FnZVxyXG4gICAgdHJhbnNhY3Rpb25SZWY6IHRyYW5zYWN0aW9uUmVmIC8vIHRyYW5zYWN0aW9uUmVmZXJlbmNlXHJcbiAgICBleHRyYVByb3BlcnRpZXM6IG9iamVjdCAvLyBcclxuICB9XHJcbiAgICovXHJcbiAgc3RhdGljIHRyaWdnZXJUcmFuc2FjdGlvbkV2ZW50KHN0YXR1cywgcHJvZ3Jlc3MsIG1lc3NhZ2UsIHRyYW5zYWN0aW9uUmVmLCBleHRyYVByb3BlcnRpZXMpIHtcclxuICAgIGxldCBjb0V2ZW50ID0ge1xyXG4gICAgICB0eXBlOiBcInRyYW5zYWN0aW9uXCIsXHJcbiAgICAgIHRyYW5zYWN0aW9uOiB7XHJcbiAgICAgICAgdHJhbnNhY3Rpb25TdGF0dXM6IHN0YXR1cyxcclxuICAgICAgICBwcm9ncmVzczogcHJvZ3Jlc3MsXHJcbiAgICAgICAgbWVzc2FnZTogbWVzc2FnZSxcclxuICAgICAgICB0cmFuc2FjdGlvblJlZjogdHJhbnNhY3Rpb25SZWZcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoZXh0cmFQcm9wZXJ0aWVzKVxyXG4gICAgICBjb0V2ZW50LnRyYW5zYWN0aW9uID0gT2JqZWN0LmFzc2lnbihjb0V2ZW50LnRyYW5zYWN0aW9uLCBleHRyYVByb3BlcnRpZXMpXHJcblxyXG4gICAgdGhpcy50cmlnZ2VyQ2hlY2tvdXRFdmVudChjb0V2ZW50KTsgICAgXHJcbiAgfVxyXG4gIFxyXG5cclxuICBzdGF0aWMgdHJpZ2dlckNoZWNrb3V0RXZlbnQocGF5bG9hZCkge1xyXG4gICAgdGhpcy50cmlnZ2VyRXZlbnQoXCJraW9zay1jaGVja291dFwiLCBwYXlsb2FkKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyB0cmlnZ2VyRXZlbnQoZXZlbnRDb2RlLCBwYXlsb2FkKSB7XHJcbiAgICAkKGRvY3VtZW50KS50cmlnZ2VyKGV2ZW50Q29kZSwgcGF5bG9hZCk7XHJcbiAgfVxyXG5cclxufSJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../script/kiosk-event-utils.js\n");

/***/ }),

/***/ "../script/kiosk-face-recon.js":
/*!*************************************!*\
  !*** ../script/kiosk-face-recon.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ FaceRecognition)\n/* harmony export */ });\nconst STATUS = {FACE: \"face\", NO_FACE: \"no_face\"}\r\nconst videoSize = { width: 720, height: 576 };\r\n\r\nclass FaceRecognition {\r\n  #video;\r\n  \r\n  constructor(siteURL, video) {\r\n    this.#video = video;\r\n    if (video)\r\n      video.addEventListener('play', this.#videoEventListener);\r\n      \r\n    if (typeof faceapi !== 'undefined') {\r\n      Promise.all([    \r\n          faceapi.nets.tinyFaceDetector.loadFromUri(siteURL + '/libraries/face-api/models'),\r\n          //faceapi.nets.faceLandmark68Net.loadFromUri('/models'),\r\n          //faceapi.nets.faceRecognitionNet.loadFromUri('/models'),\r\n          //faceapi.nets.ssdMobilenetv1.loadFromUri('/models'),\r\n          //faceapi.nets.faceExpressionNet.loadFromUri('/models'),\r\n      ]).then(() => {\r\n          this.#prepareFaceDetector();\r\n      }).catch((err) => {\r\n          SNP_LOGGER.error(null, null, err)\r\n      });\r\n    }\r\n  }\r\n  \r\n  #videoEventListener() {\r\n    /**\r\n     * Bounds modufy this values to change beahviour\r\n     * */\r\n\r\n    let outerLeftRightMargin = 50;\r\n    let outerPaddingTop = 50;\r\n    let innerPaddingInner = 200;\r\n    let drawBBox = false;\r\n\r\n    let outerRect = new Rect(outerLeftRightMargin, outerPaddingTop, videoSize.width - outerLeftRightMargin, outerPaddingTop + videoSize.width - ( 2 * outerLeftRightMargin ) );\r\n    let innerRect = new Rect(outerRect.left + innerPaddingInner ,outerRect.top + innerPaddingInner, outerRect.right - innerPaddingInner ,outerRect.bottom - innerPaddingInner);\r\n\r\n    let tlRect = new Rect(outerRect.left, outerRect.top, innerRect.left, innerRect.top);\r\n    let trRect = new Rect(innerRect.right, outerRect.top, outerRect.right, innerRect.top);\r\n    let blRect = new Rect(outerRect.left, innerRect.bottom, innerRect.left, outerRect.bottom);\r\n    let brRect = new Rect(innerRect.right, innerRect.bottom, outerRect.right, outerRect.bottom);\r\n\r\n    const canvas = faceapi.createCanvasFromMedia(this)\r\n    document.body.append(canvas)\r\n    const ctx = canvas.getContext('2d');\r\n    const displaySize = { width: this.width, height: this.height }\r\n    faceapi.matchDimensions(canvas, displaySize)\r\n    let eventFilter = new EventFilter();\r\n\r\n    setInterval(async () => {\r\n      const detections = await faceapi.detectSingleFace(this, new faceapi.TinyFaceDetectorOptions())\r\n      ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n\r\n      if (detections) {\r\n        const resizedDetections = faceapi.resizeResults(detections, displaySize)\r\n        //console.log(resizedDetections)\r\n        if (resizedDetections) {\r\n          const box = resizedDetections.box;\r\n          if (drawBBox) {\r\n            const drawBox = new faceapi.draw.DrawBox(box);\r\n            drawBox.draw(canvas); \r\n          }\r\n\r\n          if (isFaceIsCloseEnough(box)) {\r\n            if (isFaceOnBounds(box)) {\r\n              eventFilter.setValue(STATUS.FACE);\r\n              extractFaceFromBox(this, box);\r\n            }\r\n            else \r\n              _triggerEvent(\"kiosk-presence-detected\", {});\r\n          }\r\n          else\r\n            eventFilter.setValue(STATUS.NO_FACE);\r\n        }                         \r\n      }\r\n     if (drawBBox)\r\n      drawBoungingBoxes(ctx);   \r\n    }, 200);\r\n\r\n\r\n    function drawBoungingBoxes(ctx) {\r\n      innerRect.draw(ctx, \"#FF0000\", 2);\r\n      outerRect.draw(ctx, \"#FF0000\", 2);\r\n    }\r\n    \r\n    function isFaceIsCloseEnough(faceBBox) {\r\n      let faceArea = faceBBox.width * faceBBox.height;\r\n      let ratio = faceArea / videoSize.width ^ 2;\r\n      //console.log(\"RATIO:\" + ratio);\r\n      return ratio > 40;\r\n    }\r\n\r\n    function isFaceOnBounds(faceBBox) {\r\n      return  tlRect.contains(faceBBox.left,faceBBox.top) &&\r\n              trRect.contains(faceBBox.right, faceBBox.top) &&\r\n              blRect.contains(faceBBox.left, faceBBox.bottom) &&\r\n              brRect.contains(faceBBox.right, faceBBox.bottom);\r\n    }                    \r\n\r\n    async function extractFaceFromBox(video, box) { \r\n      const regionsToExtract = [\r\n          new faceapi.Rect( box.x - 40, box.y - 70 , box.width + 40, box.height + 70)\r\n      ]\r\n                          \r\n      let faceImages = await faceapi.extractFaces(video, regionsToExtract)\r\n      \r\n      if(faceImages.length == 0) {\r\n        SNP_LOGGER.debug(null, null, 'Face not found')\r\n      }\r\n      else {\r\n        //video.pause();\r\n        faceImages.forEach(cnv => {     \r\n          let base64Image = cnv.toDataURL('image/jpeg', 1.0);\r\n          //downloadFaceWhenDetected(base64Image)\r\n          base64Image = base64Image.replace('data:image/jpeg;base64,','')\r\n          _triggerEvent(\"kiosk-face-detected\", {\"face\": base64Image});\r\n        })\r\n      }   \r\n    } \r\n    \r\n    function downloadFaceWhenDetected(base64Image) {\r\n      const link = document.createElement('a');\r\n      link.download = 'download.jpg';\r\n      link.href = base64Image;\r\n      link.click();\r\n      link.delete;\r\n    }\r\n      \r\n    function _triggerEvent(eventCode, payload) {\r\n      $(document).trigger(eventCode, payload);\r\n    }\r\n  }\r\n\r\n  \r\n  #prepareFaceDetector() {\r\n    let fakeImage = new Image();\r\n    fakeImage.src = \"libraries/face-api/img/fr-idle_pos.png\";\r\n    fakeImage.onload = () => {\r\n      const useTinyModel = true;\r\n      faceapi\r\n          .detectSingleFace(fakeImage, new faceapi.TinyFaceDetectorOptions())\r\n          .withFaceLandmarks(useTinyModel)\r\n          .withFaceDescriptor()\r\n          .run()\r\n          .then(() => {\r\n              SNP_LOGGER.info(null, null, \"Face dection ready\");\r\n              this.#startVideo();\r\n          });\r\n    };\r\n  }\r\n\r\n  #startVideo() {\r\n    const constraints = {\r\n        audio: false,\r\n        video: videoSize\r\n    };\r\n    \r\n    navigator.mediaDevices.getUserMedia(constraints)\r\n        .then((mediaStream) => {\r\n            this.#video.srcObject = mediaStream;\r\n            this.#video.onloadedmetadata = () => {\r\n                this.#video.play();\r\n            };\r\n        })\r\n        .catch((err) => {\r\n            // always check for errors at the end.\r\n            SNP_LOGGER.error(null, null, `${err.name}: ${err.message}`);\r\n        });            \r\n  }\r\n  \r\n  \r\n  stopFaceDetection() {\r\n    if (this.#video)\r\n    this.#video.pause();\r\n  }\r\n  \r\n  restartFaceDetection() {\r\n    if (this.#video)\r\n      this.#video.play();\r\n  }\r\n\r\n}\r\n\r\nclass Rect {             \r\n  constructor(left, top, right, bottom) {\r\n    this.left = left;\r\n    this.top = top;\r\n    this.right = right;\r\n    this.bottom = bottom;\r\n  }\r\n  \r\n  contains(x, y) {\r\n    return this.left < this.right && this.top < this.bottom  // check for empty first\r\n        && x >= this.left && x < this.right && y >= this.top && y < this.bottom;\r\n  }\r\n  \r\n  draw(ctx, color, lineWidth, alpha, fill) {\r\n    ctx.lineWidth = lineWidth;\r\n    ctx.strokeStyle = color\r\n    if (fill)\r\n      ctx.fillRect(this.top, this.left, this.right - this.left, this.bottom - this.top);\r\n    else\r\n      ctx.strokeRect(this.top, this.left, this.right - this.left, this.bottom - this.top);\r\n  }\r\n}\r\n\r\nclass EventFilter {\r\n  constructor() {\r\n    this.value = null;\r\n    this.lastFaceEvent = Date.now();\r\n    this.MIN_REFRESH_RATE = 2000; //ms\r\n  }\r\n  \r\n  setValue(newValue){\r\n    let isChanged = false;\r\n    let diffInMillies = Date.now() - this.lastFaceEvent;\r\n\r\n    if (STATUS.FACE == newValue)\r\n        this.lastFaceEvent = Date.now();\r\n\r\n    if ((this.value == null) ||\r\n          (STATUS.FACE == this.value) && (STATUS.NO_FACE == newValue  &&  diffInMillies > this.MIN_REFRESH_RATE) ||\r\n          (STATUS.NO_FACE == this.value && STATUS.FACE == newValue)){\r\n      isChanged = true;\r\n      this.value = newValue;\r\n    }\r\n    \r\n    return isChanged;\r\n  }\r\n  \r\n  getValue(){\r\n//      console.log(this.value);\r\n      return this.value;\r\n  }\r\n}            \r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L2tpb3NrLWZhY2UtcmVjb24uanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBLGdCQUFnQjtBQUNoQixvQkFBb0I7QUFDcEI7QUFDZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseURBQXlEO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RDtBQUM3RCxnREFBZ0Qsb0JBQW9CO0FBQ3BFLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSw0Q0FBNEMsU0FBUyxJQUFJLFlBQVk7QUFDckUsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9raW9zay1jb250cm9sbGVyLy4uL3NjcmlwdC9raW9zay1mYWNlLXJlY29uLmpzPzA4NjEiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU1RBVFVTID0ge0ZBQ0U6IFwiZmFjZVwiLCBOT19GQUNFOiBcIm5vX2ZhY2VcIn1cclxuY29uc3QgdmlkZW9TaXplID0geyB3aWR0aDogNzIwLCBoZWlnaHQ6IDU3NiB9O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRmFjZVJlY29nbml0aW9uIHtcclxuICAjdmlkZW87XHJcbiAgXHJcbiAgY29uc3RydWN0b3Ioc2l0ZVVSTCwgdmlkZW8pIHtcclxuICAgIHRoaXMuI3ZpZGVvID0gdmlkZW87XHJcbiAgICBpZiAodmlkZW8pXHJcbiAgICAgIHZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ3BsYXknLCB0aGlzLiN2aWRlb0V2ZW50TGlzdGVuZXIpO1xyXG4gICAgICBcclxuICAgIGlmICh0eXBlb2YgZmFjZWFwaSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgUHJvbWlzZS5hbGwoWyAgICBcclxuICAgICAgICAgIGZhY2VhcGkubmV0cy50aW55RmFjZURldGVjdG9yLmxvYWRGcm9tVXJpKHNpdGVVUkwgKyAnL2xpYnJhcmllcy9mYWNlLWFwaS9tb2RlbHMnKSxcclxuICAgICAgICAgIC8vZmFjZWFwaS5uZXRzLmZhY2VMYW5kbWFyazY4TmV0LmxvYWRGcm9tVXJpKCcvbW9kZWxzJyksXHJcbiAgICAgICAgICAvL2ZhY2VhcGkubmV0cy5mYWNlUmVjb2duaXRpb25OZXQubG9hZEZyb21VcmkoJy9tb2RlbHMnKSxcclxuICAgICAgICAgIC8vZmFjZWFwaS5uZXRzLnNzZE1vYmlsZW5ldHYxLmxvYWRGcm9tVXJpKCcvbW9kZWxzJyksXHJcbiAgICAgICAgICAvL2ZhY2VhcGkubmV0cy5mYWNlRXhwcmVzc2lvbk5ldC5sb2FkRnJvbVVyaSgnL21vZGVscycpLFxyXG4gICAgICBdKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgIHRoaXMuI3ByZXBhcmVGYWNlRGV0ZWN0b3IoKTtcclxuICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgU05QX0xPR0dFUi5lcnJvcihudWxsLCBudWxsLCBlcnIpXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICAjdmlkZW9FdmVudExpc3RlbmVyKCkge1xyXG4gICAgLyoqXHJcbiAgICAgKiBCb3VuZHMgbW9kdWZ5IHRoaXMgdmFsdWVzIHRvIGNoYW5nZSBiZWFodmlvdXJcclxuICAgICAqICovXHJcblxyXG4gICAgbGV0IG91dGVyTGVmdFJpZ2h0TWFyZ2luID0gNTA7XHJcbiAgICBsZXQgb3V0ZXJQYWRkaW5nVG9wID0gNTA7XHJcbiAgICBsZXQgaW5uZXJQYWRkaW5nSW5uZXIgPSAyMDA7XHJcbiAgICBsZXQgZHJhd0JCb3ggPSBmYWxzZTtcclxuXHJcbiAgICBsZXQgb3V0ZXJSZWN0ID0gbmV3IFJlY3Qob3V0ZXJMZWZ0UmlnaHRNYXJnaW4sIG91dGVyUGFkZGluZ1RvcCwgdmlkZW9TaXplLndpZHRoIC0gb3V0ZXJMZWZ0UmlnaHRNYXJnaW4sIG91dGVyUGFkZGluZ1RvcCArIHZpZGVvU2l6ZS53aWR0aCAtICggMiAqIG91dGVyTGVmdFJpZ2h0TWFyZ2luICkgKTtcclxuICAgIGxldCBpbm5lclJlY3QgPSBuZXcgUmVjdChvdXRlclJlY3QubGVmdCArIGlubmVyUGFkZGluZ0lubmVyICxvdXRlclJlY3QudG9wICsgaW5uZXJQYWRkaW5nSW5uZXIsIG91dGVyUmVjdC5yaWdodCAtIGlubmVyUGFkZGluZ0lubmVyICxvdXRlclJlY3QuYm90dG9tIC0gaW5uZXJQYWRkaW5nSW5uZXIpO1xyXG5cclxuICAgIGxldCB0bFJlY3QgPSBuZXcgUmVjdChvdXRlclJlY3QubGVmdCwgb3V0ZXJSZWN0LnRvcCwgaW5uZXJSZWN0LmxlZnQsIGlubmVyUmVjdC50b3ApO1xyXG4gICAgbGV0IHRyUmVjdCA9IG5ldyBSZWN0KGlubmVyUmVjdC5yaWdodCwgb3V0ZXJSZWN0LnRvcCwgb3V0ZXJSZWN0LnJpZ2h0LCBpbm5lclJlY3QudG9wKTtcclxuICAgIGxldCBibFJlY3QgPSBuZXcgUmVjdChvdXRlclJlY3QubGVmdCwgaW5uZXJSZWN0LmJvdHRvbSwgaW5uZXJSZWN0LmxlZnQsIG91dGVyUmVjdC5ib3R0b20pO1xyXG4gICAgbGV0IGJyUmVjdCA9IG5ldyBSZWN0KGlubmVyUmVjdC5yaWdodCwgaW5uZXJSZWN0LmJvdHRvbSwgb3V0ZXJSZWN0LnJpZ2h0LCBvdXRlclJlY3QuYm90dG9tKTtcclxuXHJcbiAgICBjb25zdCBjYW52YXMgPSBmYWNlYXBpLmNyZWF0ZUNhbnZhc0Zyb21NZWRpYSh0aGlzKVxyXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmQoY2FudmFzKVxyXG4gICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICBjb25zdCBkaXNwbGF5U2l6ZSA9IHsgd2lkdGg6IHRoaXMud2lkdGgsIGhlaWdodDogdGhpcy5oZWlnaHQgfVxyXG4gICAgZmFjZWFwaS5tYXRjaERpbWVuc2lvbnMoY2FudmFzLCBkaXNwbGF5U2l6ZSlcclxuICAgIGxldCBldmVudEZpbHRlciA9IG5ldyBFdmVudEZpbHRlcigpO1xyXG5cclxuICAgIHNldEludGVydmFsKGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZGV0ZWN0aW9ucyA9IGF3YWl0IGZhY2VhcGkuZGV0ZWN0U2luZ2xlRmFjZSh0aGlzLCBuZXcgZmFjZWFwaS5UaW55RmFjZURldGVjdG9yT3B0aW9ucygpKVxyXG4gICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodClcclxuXHJcbiAgICAgIGlmIChkZXRlY3Rpb25zKSB7XHJcbiAgICAgICAgY29uc3QgcmVzaXplZERldGVjdGlvbnMgPSBmYWNlYXBpLnJlc2l6ZVJlc3VsdHMoZGV0ZWN0aW9ucywgZGlzcGxheVNpemUpXHJcbiAgICAgICAgLy9jb25zb2xlLmxvZyhyZXNpemVkRGV0ZWN0aW9ucylcclxuICAgICAgICBpZiAocmVzaXplZERldGVjdGlvbnMpIHtcclxuICAgICAgICAgIGNvbnN0IGJveCA9IHJlc2l6ZWREZXRlY3Rpb25zLmJveDtcclxuICAgICAgICAgIGlmIChkcmF3QkJveCkge1xyXG4gICAgICAgICAgICBjb25zdCBkcmF3Qm94ID0gbmV3IGZhY2VhcGkuZHJhdy5EcmF3Qm94KGJveCk7XHJcbiAgICAgICAgICAgIGRyYXdCb3guZHJhdyhjYW52YXMpOyBcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBpZiAoaXNGYWNlSXNDbG9zZUVub3VnaChib3gpKSB7XHJcbiAgICAgICAgICAgIGlmIChpc0ZhY2VPbkJvdW5kcyhib3gpKSB7XHJcbiAgICAgICAgICAgICAgZXZlbnRGaWx0ZXIuc2V0VmFsdWUoU1RBVFVTLkZBQ0UpO1xyXG4gICAgICAgICAgICAgIGV4dHJhY3RGYWNlRnJvbUJveCh0aGlzLCBib3gpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgXHJcbiAgICAgICAgICAgICAgX3RyaWdnZXJFdmVudChcImtpb3NrLXByZXNlbmNlLWRldGVjdGVkXCIsIHt9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgZXZlbnRGaWx0ZXIuc2V0VmFsdWUoU1RBVFVTLk5PX0ZBQ0UpO1xyXG4gICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgIH1cclxuICAgICBpZiAoZHJhd0JCb3gpXHJcbiAgICAgIGRyYXdCb3VuZ2luZ0JveGVzKGN0eCk7ICAgXHJcbiAgICB9LCAyMDApO1xyXG5cclxuXHJcbiAgICBmdW5jdGlvbiBkcmF3Qm91bmdpbmdCb3hlcyhjdHgpIHtcclxuICAgICAgaW5uZXJSZWN0LmRyYXcoY3R4LCBcIiNGRjAwMDBcIiwgMik7XHJcbiAgICAgIG91dGVyUmVjdC5kcmF3KGN0eCwgXCIjRkYwMDAwXCIsIDIpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBpc0ZhY2VJc0Nsb3NlRW5vdWdoKGZhY2VCQm94KSB7XHJcbiAgICAgIGxldCBmYWNlQXJlYSA9IGZhY2VCQm94LndpZHRoICogZmFjZUJCb3guaGVpZ2h0O1xyXG4gICAgICBsZXQgcmF0aW8gPSBmYWNlQXJlYSAvIHZpZGVvU2l6ZS53aWR0aCBeIDI7XHJcbiAgICAgIC8vY29uc29sZS5sb2coXCJSQVRJTzpcIiArIHJhdGlvKTtcclxuICAgICAgcmV0dXJuIHJhdGlvID4gNDA7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gaXNGYWNlT25Cb3VuZHMoZmFjZUJCb3gpIHtcclxuICAgICAgcmV0dXJuICB0bFJlY3QuY29udGFpbnMoZmFjZUJCb3gubGVmdCxmYWNlQkJveC50b3ApICYmXHJcbiAgICAgICAgICAgICAgdHJSZWN0LmNvbnRhaW5zKGZhY2VCQm94LnJpZ2h0LCBmYWNlQkJveC50b3ApICYmXHJcbiAgICAgICAgICAgICAgYmxSZWN0LmNvbnRhaW5zKGZhY2VCQm94LmxlZnQsIGZhY2VCQm94LmJvdHRvbSkgJiZcclxuICAgICAgICAgICAgICBiclJlY3QuY29udGFpbnMoZmFjZUJCb3gucmlnaHQsIGZhY2VCQm94LmJvdHRvbSk7XHJcbiAgICB9ICAgICAgICAgICAgICAgICAgICBcclxuXHJcbiAgICBhc3luYyBmdW5jdGlvbiBleHRyYWN0RmFjZUZyb21Cb3godmlkZW8sIGJveCkgeyBcclxuICAgICAgY29uc3QgcmVnaW9uc1RvRXh0cmFjdCA9IFtcclxuICAgICAgICAgIG5ldyBmYWNlYXBpLlJlY3QoIGJveC54IC0gNDAsIGJveC55IC0gNzAgLCBib3gud2lkdGggKyA0MCwgYm94LmhlaWdodCArIDcwKVxyXG4gICAgICBdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgIGxldCBmYWNlSW1hZ2VzID0gYXdhaXQgZmFjZWFwaS5leHRyYWN0RmFjZXModmlkZW8sIHJlZ2lvbnNUb0V4dHJhY3QpXHJcbiAgICAgIFxyXG4gICAgICBpZihmYWNlSW1hZ2VzLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgU05QX0xPR0dFUi5kZWJ1ZyhudWxsLCBudWxsLCAnRmFjZSBub3QgZm91bmQnKVxyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIC8vdmlkZW8ucGF1c2UoKTtcclxuICAgICAgICBmYWNlSW1hZ2VzLmZvckVhY2goY252ID0+IHsgICAgIFxyXG4gICAgICAgICAgbGV0IGJhc2U2NEltYWdlID0gY252LnRvRGF0YVVSTCgnaW1hZ2UvanBlZycsIDEuMCk7XHJcbiAgICAgICAgICAvL2Rvd25sb2FkRmFjZVdoZW5EZXRlY3RlZChiYXNlNjRJbWFnZSlcclxuICAgICAgICAgIGJhc2U2NEltYWdlID0gYmFzZTY0SW1hZ2UucmVwbGFjZSgnZGF0YTppbWFnZS9qcGVnO2Jhc2U2NCwnLCcnKVxyXG4gICAgICAgICAgX3RyaWdnZXJFdmVudChcImtpb3NrLWZhY2UtZGV0ZWN0ZWRcIiwge1wiZmFjZVwiOiBiYXNlNjRJbWFnZX0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgIH0gICBcclxuICAgIH0gXHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIGRvd25sb2FkRmFjZVdoZW5EZXRlY3RlZChiYXNlNjRJbWFnZSkge1xyXG4gICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gICAgICBsaW5rLmRvd25sb2FkID0gJ2Rvd25sb2FkLmpwZyc7XHJcbiAgICAgIGxpbmsuaHJlZiA9IGJhc2U2NEltYWdlO1xyXG4gICAgICBsaW5rLmNsaWNrKCk7XHJcbiAgICAgIGxpbmsuZGVsZXRlO1xyXG4gICAgfVxyXG4gICAgICBcclxuICAgIGZ1bmN0aW9uIF90cmlnZ2VyRXZlbnQoZXZlbnRDb2RlLCBwYXlsb2FkKSB7XHJcbiAgICAgICQoZG9jdW1lbnQpLnRyaWdnZXIoZXZlbnRDb2RlLCBwYXlsb2FkKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIFxyXG4gICNwcmVwYXJlRmFjZURldGVjdG9yKCkge1xyXG4gICAgbGV0IGZha2VJbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgZmFrZUltYWdlLnNyYyA9IFwibGlicmFyaWVzL2ZhY2UtYXBpL2ltZy9mci1pZGxlX3Bvcy5wbmdcIjtcclxuICAgIGZha2VJbWFnZS5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVzZVRpbnlNb2RlbCA9IHRydWU7XHJcbiAgICAgIGZhY2VhcGlcclxuICAgICAgICAgIC5kZXRlY3RTaW5nbGVGYWNlKGZha2VJbWFnZSwgbmV3IGZhY2VhcGkuVGlueUZhY2VEZXRlY3Rvck9wdGlvbnMoKSlcclxuICAgICAgICAgIC53aXRoRmFjZUxhbmRtYXJrcyh1c2VUaW55TW9kZWwpXHJcbiAgICAgICAgICAud2l0aEZhY2VEZXNjcmlwdG9yKClcclxuICAgICAgICAgIC5ydW4oKVxyXG4gICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgIFNOUF9MT0dHRVIuaW5mbyhudWxsLCBudWxsLCBcIkZhY2UgZGVjdGlvbiByZWFkeVwiKTtcclxuICAgICAgICAgICAgICB0aGlzLiNzdGFydFZpZGVvKCk7XHJcbiAgICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAjc3RhcnRWaWRlbygpIHtcclxuICAgIGNvbnN0IGNvbnN0cmFpbnRzID0ge1xyXG4gICAgICAgIGF1ZGlvOiBmYWxzZSxcclxuICAgICAgICB2aWRlbzogdmlkZW9TaXplXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYShjb25zdHJhaW50cylcclxuICAgICAgICAudGhlbigobWVkaWFTdHJlYW0pID0+IHtcclxuICAgICAgICAgICAgdGhpcy4jdmlkZW8uc3JjT2JqZWN0ID0gbWVkaWFTdHJlYW07XHJcbiAgICAgICAgICAgIHRoaXMuI3ZpZGVvLm9ubG9hZGVkbWV0YWRhdGEgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiN2aWRlby5wbGF5KCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgICAvLyBhbHdheXMgY2hlY2sgZm9yIGVycm9ycyBhdCB0aGUgZW5kLlxyXG4gICAgICAgICAgICBTTlBfTE9HR0VSLmVycm9yKG51bGwsIG51bGwsIGAke2Vyci5uYW1lfTogJHtlcnIubWVzc2FnZX1gKTtcclxuICAgICAgICB9KTsgICAgICAgICAgICBcclxuICB9XHJcbiAgXHJcbiAgXHJcbiAgc3RvcEZhY2VEZXRlY3Rpb24oKSB7XHJcbiAgICBpZiAodGhpcy4jdmlkZW8pXHJcbiAgICB0aGlzLiN2aWRlby5wYXVzZSgpO1xyXG4gIH1cclxuICBcclxuICByZXN0YXJ0RmFjZURldGVjdGlvbigpIHtcclxuICAgIGlmICh0aGlzLiN2aWRlbylcclxuICAgICAgdGhpcy4jdmlkZW8ucGxheSgpO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmNsYXNzIFJlY3QgeyAgICAgICAgICAgICBcclxuICBjb25zdHJ1Y3RvcihsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20pIHtcclxuICAgIHRoaXMubGVmdCA9IGxlZnQ7XHJcbiAgICB0aGlzLnRvcCA9IHRvcDtcclxuICAgIHRoaXMucmlnaHQgPSByaWdodDtcclxuICAgIHRoaXMuYm90dG9tID0gYm90dG9tO1xyXG4gIH1cclxuICBcclxuICBjb250YWlucyh4LCB5KSB7XHJcbiAgICByZXR1cm4gdGhpcy5sZWZ0IDwgdGhpcy5yaWdodCAmJiB0aGlzLnRvcCA8IHRoaXMuYm90dG9tICAvLyBjaGVjayBmb3IgZW1wdHkgZmlyc3RcclxuICAgICAgICAmJiB4ID49IHRoaXMubGVmdCAmJiB4IDwgdGhpcy5yaWdodCAmJiB5ID49IHRoaXMudG9wICYmIHkgPCB0aGlzLmJvdHRvbTtcclxuICB9XHJcbiAgXHJcbiAgZHJhdyhjdHgsIGNvbG9yLCBsaW5lV2lkdGgsIGFscGhhLCBmaWxsKSB7XHJcbiAgICBjdHgubGluZVdpZHRoID0gbGluZVdpZHRoO1xyXG4gICAgY3R4LnN0cm9rZVN0eWxlID0gY29sb3JcclxuICAgIGlmIChmaWxsKVxyXG4gICAgICBjdHguZmlsbFJlY3QodGhpcy50b3AsIHRoaXMubGVmdCwgdGhpcy5yaWdodCAtIHRoaXMubGVmdCwgdGhpcy5ib3R0b20gLSB0aGlzLnRvcCk7XHJcbiAgICBlbHNlXHJcbiAgICAgIGN0eC5zdHJva2VSZWN0KHRoaXMudG9wLCB0aGlzLmxlZnQsIHRoaXMucmlnaHQgLSB0aGlzLmxlZnQsIHRoaXMuYm90dG9tIC0gdGhpcy50b3ApO1xyXG4gIH1cclxufVxyXG5cclxuY2xhc3MgRXZlbnRGaWx0ZXIge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy52YWx1ZSA9IG51bGw7XHJcbiAgICB0aGlzLmxhc3RGYWNlRXZlbnQgPSBEYXRlLm5vdygpO1xyXG4gICAgdGhpcy5NSU5fUkVGUkVTSF9SQVRFID0gMjAwMDsgLy9tc1xyXG4gIH1cclxuICBcclxuICBzZXRWYWx1ZShuZXdWYWx1ZSl7XHJcbiAgICBsZXQgaXNDaGFuZ2VkID0gZmFsc2U7XHJcbiAgICBsZXQgZGlmZkluTWlsbGllcyA9IERhdGUubm93KCkgLSB0aGlzLmxhc3RGYWNlRXZlbnQ7XHJcblxyXG4gICAgaWYgKFNUQVRVUy5GQUNFID09IG5ld1ZhbHVlKVxyXG4gICAgICAgIHRoaXMubGFzdEZhY2VFdmVudCA9IERhdGUubm93KCk7XHJcblxyXG4gICAgaWYgKCh0aGlzLnZhbHVlID09IG51bGwpIHx8XHJcbiAgICAgICAgICAoU1RBVFVTLkZBQ0UgPT0gdGhpcy52YWx1ZSkgJiYgKFNUQVRVUy5OT19GQUNFID09IG5ld1ZhbHVlICAmJiAgZGlmZkluTWlsbGllcyA+IHRoaXMuTUlOX1JFRlJFU0hfUkFURSkgfHxcclxuICAgICAgICAgIChTVEFUVVMuTk9fRkFDRSA9PSB0aGlzLnZhbHVlICYmIFNUQVRVUy5GQUNFID09IG5ld1ZhbHVlKSl7XHJcbiAgICAgIGlzQ2hhbmdlZCA9IHRydWU7XHJcbiAgICAgIHRoaXMudmFsdWUgPSBuZXdWYWx1ZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGlzQ2hhbmdlZDtcclxuICB9XHJcbiAgXHJcbiAgZ2V0VmFsdWUoKXtcclxuLy8gICAgICBjb25zb2xlLmxvZyh0aGlzLnZhbHVlKTtcclxuICAgICAgcmV0dXJuIHRoaXMudmFsdWU7XHJcbiAgfVxyXG59ICAgICAgICAgICAgXHJcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../script/kiosk-face-recon.js\n");

/***/ }),

/***/ "../script/kiosk-model.js":
/*!********************************!*\
  !*** ../script/kiosk-model.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   KIOSK_CHECKOUT: () => (/* binding */ KIOSK_CHECKOUT),\n/* harmony export */   KIOSK_STATUS: () => (/* binding */ KIOSK_STATUS)\n/* harmony export */ });\nconst KIOSK_STATUS = { INIT : \"INIT\", ERROR : \"ERROR\", IDLE: \"IDLE\", TRANSACTION: \"TRANSACTION\", MAINTENANCE: \"MAINTENANCE\" };\r\nconst KIOSK_CHECKOUT = { INIT : \"INIT\", PAYMENT: \"PAYMENT\", PRINT_PAYMENT_RECEIPT: \"PRINT_PAYMENT_RECEIPT\", PRINT_TICKET: \"PRINT_TICKET\", CHANGE_HAND_OVER: \"CHANGE_HAND_OVER\", PRINT_RECEIPT: \"PRINT_RECEIPT\", COMPLETE: \"COMPLETE\" };\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L2tpb3NrLW1vZGVsLmpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQU8sdUJBQXVCO0FBQ3ZCLHlCQUF5QiIsInNvdXJjZXMiOlsid2VicGFjazovL2tpb3NrLWNvbnRyb2xsZXIvLi4vc2NyaXB0L2tpb3NrLW1vZGVsLmpzP2VjZGUiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IEtJT1NLX1NUQVRVUyA9IHsgSU5JVCA6IFwiSU5JVFwiLCBFUlJPUiA6IFwiRVJST1JcIiwgSURMRTogXCJJRExFXCIsIFRSQU5TQUNUSU9OOiBcIlRSQU5TQUNUSU9OXCIsIE1BSU5URU5BTkNFOiBcIk1BSU5URU5BTkNFXCIgfTtcclxuZXhwb3J0IGNvbnN0IEtJT1NLX0NIRUNLT1VUID0geyBJTklUIDogXCJJTklUXCIsIFBBWU1FTlQ6IFwiUEFZTUVOVFwiLCBQUklOVF9QQVlNRU5UX1JFQ0VJUFQ6IFwiUFJJTlRfUEFZTUVOVF9SRUNFSVBUXCIsIFBSSU5UX1RJQ0tFVDogXCJQUklOVF9USUNLRVRcIiwgQ0hBTkdFX0hBTkRfT1ZFUjogXCJDSEFOR0VfSEFORF9PVkVSXCIsIFBSSU5UX1JFQ0VJUFQ6IFwiUFJJTlRfUkVDRUlQVFwiLCBDT01QTEVURTogXCJDT01QTEVURVwiIH07XHJcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../script/kiosk-model.js\n");

/***/ }),

/***/ "../script/kiosk-utils.js":
/*!********************************!*\
  !*** ../script/kiosk-utils.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   KioskUtils: () => (/* binding */ KioskUtils)\n/* harmony export */ });\nclass KioskUtils {\r\n  \r\n  static createRandomBase32String(stringLength) {\r\n\t\tconst BASE32 = '0123456789ABCDEFGHJKMPQRSTUVWXYZ';\r\n\t\t\r\n\t\tlet result = '';\r\n\t\t\r\n\t\tfor (let counter = 0; counter < stringLength; counter++)\r\n\t\t  result += BASE32.charAt(Math.floor(Math.random() * 32));\r\n\t\t\r\n    return result;\r\n  }\r\n\r\n\tstatic newStrUUID() {\r\n\t  function s4() {\r\n\t    return Math.floor((1 + Math.random()) * 0x10000)\r\n\t      .toString(16)\r\n\t      .substring(1);\r\n\t  }\r\n\t  return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\r\n\t}\r\n\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L2tpb3NrLXV0aWxzLmpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix3QkFBd0I7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8va2lvc2stY29udHJvbGxlci8uLi9zY3JpcHQva2lvc2stdXRpbHMuanM/YTU0NCJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgS2lvc2tVdGlscyB7XHJcbiAgXHJcbiAgc3RhdGljIGNyZWF0ZVJhbmRvbUJhc2UzMlN0cmluZyhzdHJpbmdMZW5ndGgpIHtcclxuXHRcdGNvbnN0IEJBU0UzMiA9ICcwMTIzNDU2Nzg5QUJDREVGR0hKS01QUVJTVFVWV1hZWic7XHJcblx0XHRcclxuXHRcdGxldCByZXN1bHQgPSAnJztcclxuXHRcdFxyXG5cdFx0Zm9yIChsZXQgY291bnRlciA9IDA7IGNvdW50ZXIgPCBzdHJpbmdMZW5ndGg7IGNvdW50ZXIrKylcclxuXHRcdCAgcmVzdWx0ICs9IEJBU0UzMi5jaGFyQXQoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMzIpKTtcclxuXHRcdFxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG5cdHN0YXRpYyBuZXdTdHJVVUlEKCkge1xyXG5cdCAgZnVuY3Rpb24gczQoKSB7XHJcblx0ICAgIHJldHVybiBNYXRoLmZsb29yKCgxICsgTWF0aC5yYW5kb20oKSkgKiAweDEwMDAwKVxyXG5cdCAgICAgIC50b1N0cmluZygxNilcclxuXHQgICAgICAuc3Vic3RyaW5nKDEpO1xyXG5cdCAgfVxyXG5cdCAgcmV0dXJuIHM0KCkgKyBzNCgpICsgJy0nICsgczQoKSArICctJyArIHM0KCkgKyAnLScgKyBzNCgpICsgJy0nICsgczQoKSArIHM0KCkgKyBzNCgpO1xyXG5cdH1cclxuXHJcbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///../script/kiosk-utils.js\n");

/***/ }),

/***/ "../script/kiosk.js":
/*!**************************!*\
  !*** ../script/kiosk.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _kiosk_controller_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./kiosk-controller.js */ \"../script/kiosk-controller.js\");\n/* harmony import */ var _kiosk_model_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./kiosk-model.js */ \"../script/kiosk-model.js\");\n/* harmony import */ var _common_script_snapp_logger__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @common-script/snapp-logger */ \"../../../common-script/snapp-logger.js\");\n/* harmony import */ var _common_script_snapp_api_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @common-script/snapp-api.js */ \"../../../common-script/snapp-api.js\");\n/* harmony import */ var _common_script_errors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @common-script/errors */ \"../../../common-script/errors.js\");\n\r\n\r\n\r\n\r\n\r\n\r\nwindow.KIOSK_CONTROLLER = new _kiosk_controller_js__WEBPACK_IMPORTED_MODULE_0__.KioskController();\r\nwindow.KIOSK_STATUS = _kiosk_model_js__WEBPACK_IMPORTED_MODULE_1__.KIOSK_STATUS;\r\nwindow.SNP_LOGGER = new _common_script_snapp_logger__WEBPACK_IMPORTED_MODULE_2__.SnappLogger();\r\nwindow.ServiceError = _common_script_snapp_api_js__WEBPACK_IMPORTED_MODULE_3__.ServiceError;\r\nwindow.ESnAppError = _common_script_errors__WEBPACK_IMPORTED_MODULE_4__.ESnAppError;\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L2tpb3NrLmpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUF1RDtBQUNHO0FBQ0E7QUFDQztBQUNQO0FBQ3BEO0FBQ0EsOEJBQThCLGlFQUFlO0FBQzdDLHNCQUFzQix5REFBTTtBQUM1Qix3QkFBd0Isb0VBQVc7QUFDbkMsc0JBQXNCLHFFQUFZO0FBQ2xDLHFCQUFxQiw4REFBVyIsInNvdXJjZXMiOlsid2VicGFjazovL2tpb3NrLWNvbnRyb2xsZXIvLi4vc2NyaXB0L2tpb3NrLmpzPzg5YWEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgS2lvc2tDb250cm9sbGVyfSBmcm9tICcuL2tpb3NrLWNvbnRyb2xsZXIuanMnO1xyXG5pbXBvcnQgeyBLSU9TS19TVEFUVVMgYXMgc3RhdHVzIH0gZnJvbSAnLi9raW9zay1tb2RlbC5qcyc7XHJcbmltcG9ydCB7IFNuYXBwTG9nZ2VyIH0gZnJvbSAnQGNvbW1vbi1zY3JpcHQvc25hcHAtbG9nZ2VyJztcclxuaW1wb3J0IHsgU2VydmljZUVycm9yIH0gZnJvbSAnQGNvbW1vbi1zY3JpcHQvc25hcHAtYXBpLmpzJztcclxuaW1wb3J0IHsgRVNuQXBwRXJyb3IgfSBmcm9tIFwiQGNvbW1vbi1zY3JpcHQvZXJyb3JzXCI7XHJcblxyXG53aW5kb3cuS0lPU0tfQ09OVFJPTExFUiA9IG5ldyBLaW9za0NvbnRyb2xsZXIoKTtcclxud2luZG93LktJT1NLX1NUQVRVUyA9IHN0YXR1cztcclxud2luZG93LlNOUF9MT0dHRVIgPSBuZXcgU25hcHBMb2dnZXIoKTtcclxud2luZG93LlNlcnZpY2VFcnJvciA9IFNlcnZpY2VFcnJvcjtcclxud2luZG93LkVTbkFwcEVycm9yID0gRVNuQXBwRXJyb3I7XHJcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../script/kiosk.js\n");

/***/ }),

/***/ "../script/payment/pay-proc-ext-device.js":
/*!************************************************!*\
  !*** ../script/payment/pay-proc-ext-device.js ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PayProcExtDevice: () => (/* binding */ PayProcExtDevice)\n/* harmony export */ });\n/* harmony import */ var _common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @common-script/device-manager/dm-model */ \"../../../common-script/device-manager/dm-model.js\");\n/* harmony import */ var _payment_processor_factory__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./payment-processor-factory */ \"../script/payment/payment-processor-factory.js\");\n/* harmony import */ var _pay_processor_base__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./pay-processor-base */ \"../script/payment/pay-processor-base.js\");\n/* harmony import */ var _common_script_errors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @common-script/errors */ \"../../../common-script/errors.js\");\n/* harmony import */ var _kiosk_utils__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../kiosk-utils */ \"../script/kiosk-utils.js\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass PayProcExtDevice extends _pay_processor_base__WEBPACK_IMPORTED_MODULE_2__.PaymentProcessor {\r\n\t#transactionTimeoutTimer;\r\n\t#deivceManager;\r\n\t\r\n\tconstructor (paymentMethod, devManager) {\r\n\t\tsuper(paymentMethod);\r\n\t  this.#deivceManager = devManager;\r\n\t  this._description = \"Credit card\";\r\n\t}\r\n\t\r\n\tget receiptDocTemplateId () {\r\n\t\tif (!this._paymentMethod.PluginSettings) {\r\n\t\t\tSNP_LOGGER.debug(`Plugin settings not present for payment method ${this._paymentMethod.PluginName}`)\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet pluginSettings = JSON.parse(this._paymentMethod.PluginSettings);\r\n\t\t\treturn pluginSettings ? pluginSettings.ReceiptTemplateId : null;\r\n\t\t}\r\n\t}\r\n\r\n\tpay(params, listener) {\r\n\t\ttry {\r\n\t\t\tlet paymentDevice = this.#getPaymentDevice();\r\n\t\t\tthis._onChange = listener;\r\n\t\t\tthis.#startTransactionTimeoutTimer(paymentDevice.paymentTransactionTimeout, params.totalDue);\r\n\t\t\t\r\n\t    return paymentDevice.pay(params.mainCurrency, params.totalDue, this.#createTransactionRef(), this.paymentDeviceAlias)\r\n\t        .then(processorResult => {\r\n\t\t\t\t\t\t\treturn this.#createResultFromProcessorResult(params.totalDue, processorResult);\r\n\t\t\t\t\t\t})\r\n\t        .catch((error) => {\r\n\t\t\t\t\t\t\tif (error.processorResult)\r\n\t\t\t\t\t\t\t\tthrow new _common_script_errors__WEBPACK_IMPORTED_MODULE_3__.EPaymentError(error.message, error.errorCode, this.#createResultFromProcessorResult(params.totalDue, error.processorResult));\r\n\r\n\t\t\t\t\t\t\tthrow new _common_script_errors__WEBPACK_IMPORTED_MODULE_3__.EPaymentError(error.message, error.errorCode);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.finally(()=> this.#commandCompleted());\r\n\t\t}\r\n\t\tcatch (error) {\r\n\t\t\treturn Promise.reject(error);\r\n\t\t}\r\n\t}\r\n\t\r\n\tvoid(currency, salePayment, listener) {\r\n\t\ttry {\r\n\t\t\tlet paymentDevice = this.#getPaymentDevice();\r\n\t\t\tthis._onChange = listener;\r\n\t\t  this.#startTransactionTimeoutTimer(paymentDevice.paymentTransactionTimeout, salePayment.PaymentAmount);\r\n\r\n\t\t\treturn paymentDevice.void(currency, salePayment, this.#createTransactionRef(), this.paymentDeviceAlias)\r\n\t\t\t\t.then(paymentResult => {\r\n\t\t\t\t\treturn this.#createResultFromProcessorResult(-salePayment.PaymentAmount, paymentResult);\r\n\t\t\t\t})\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tif (error.processorResult)\r\n\t\t\t\t\t\tthrow new _common_script_errors__WEBPACK_IMPORTED_MODULE_3__.EPaymentError(error.message, error.errorCode, this.#createResultFromProcessorResult(-salePayment.PaymentAmount, error.processorResult));\r\n\r\n\t\t\t\t\tthrow new _common_script_errors__WEBPACK_IMPORTED_MODULE_3__.EPaymentError(error.message, error.errorCode);\r\n\t\t\t\t})\r\n\t\t\t\t.finally(() => this.#commandCompleted());\r\n\t\t}\r\n\t\tcatch (error) {\r\n\t\t\treturn Promise.reject(error)\r\n\t\t}\r\n\t}\r\n\t\r\n\trefund(currency, amount, listener) {\r\n\t\ttry {\r\n\t\t\tlet paymentDevice = this.#getPaymentDevice();\r\n\t\t\tthis._onChange = listener;\r\n\t\t  this.#startTransactionTimeoutTimer(paymentDevice.paymentTransactionTimeout, amount);\r\n\r\n\t\t\treturn paymentDevice.refund(currency, amount, this.#createTransactionRef(), this.paymentDeviceAlias)\r\n\t\t\t\t.then(paymentResult => {\r\n\t\t\t\t\treturn this.#createResultFromProcessorResult(amount, paymentResult);\r\n\t\t\t\t})\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tif (error.processorResult)\r\n\t\t\t\t\t\tthrow new _common_script_errors__WEBPACK_IMPORTED_MODULE_3__.EPaymentError(error.message, error.errorCode, this.#createResultFromProcessorResult(amount, error.processorResult));\r\n\r\n\t\t\t\t\tthrow new _common_script_errors__WEBPACK_IMPORTED_MODULE_3__.EPaymentError(error.message, error.errorCode);\r\n\t\t\t\t})\r\n\t\t\t\t.finally(() => this.#commandCompleted());\r\n\t\t}\r\n\t\tcatch (error) {\r\n\t\t\treturn Promise.reject(error)\r\n\t\t}\r\n\t}\r\n\t\r\n\t#getPaymentDevice() {\r\n\t\tlet result = null; \r\n\t  let paymentDevices = this.#deivceManager.findDeviceByDeviceType(_common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_0__.DEVICE_TYPE.EXT_PAY_DEVICE);\r\n\t  \r\n\t\tfor (let pm of paymentDevices) {\r\n\t\t\tif (pm.paymentMethodIDs.includes(this.paymentMethodId)) {\r\n\t\t\t\tresult = pm;\r\n\t\t\t\tif (result.deviceStatus === _common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_0__.DEVICE_STATUS.READY)\r\n\t\t\t\t\tbreak;\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif (!result)\r\n\t\t\tthrow new Error(\"Payment device not found\");\r\n\r\n\t\tif (result.deviceStatus !== _common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_0__.DEVICE_STATUS.READY)\r\n\t\t  throw new Error(\"Payment device not ready\");\r\n\r\n\t  return result;\r\n\t}\r\n\r\n\t#commandCompleted() {\r\n\t\tthis._onChange = null;\r\n\t\tclearInterval(this.#transactionTimeoutTimer);\r\n\t}\r\n\t\r\n\t#createResultFromProcessorResult(totalDue, paymentResult) {\r\n\t\treturn {\r\n\t\t\tsalePayment: this.#createSalePayment(totalDue, paymentResult),\r\n\t\t\tdeviceReceipts: paymentResult.DeviceReceipts\r\n\t\t}\r\n\t}\r\n\t\r\n\t#startTransactionTimeoutTimer(timeoutTime, totalDue) {\r\n\t\tlet timeLeft = timeoutTime;\r\n\t\tthis.#transactionTimeoutTimer = setInterval(()=> {\r\n\t\t  if (timeLeft <= 0)\r\n\t\t    clearInterval(this.#transactionTimeoutTimer);\r\n\r\n      let remainingSec = timeLeft / 1000;\r\n      this._dispatchChangedEvent(totalDue, 0, remainingSec);\r\n\t\t  timeLeft -= 1000;\r\n\t\t}, 1000);\r\n\t}\r\n\t\t\r\n\t#createSalePayment(amount, paymentResult) {\r\n\t\tlet cardData = paymentResult.CardData;\r\n\t\tlet salePayment = {};\r\n\t\tsalePayment.CreditCard = {};\r\n\t\tsalePayment.PaymentType = _payment_processor_factory__WEBPACK_IMPORTED_MODULE_1__.PAYMENT_TYPE.CREDIT_CARD;\r\n\t\tsalePayment.PaymentMethodId = this.paymentMethodId;\r\n\t\tsalePayment.PaymentAmount = paymentResult.AcceptedAmount || amount;\r\n\t\tsalePayment.PaymentStatus = paymentResult.PaymentStatus;\r\n\t\t\r\n\t\tif (cardData) {\r\n\t\t\tif (cardData.Status)\r\n\t\t\t\tsalePayment.PaymentStatus = cardData.Status;\r\n\t\t\t\r\n\t\t\tsalePayment.CreditCard.AuthorizationCode = cardData.ManualAuthCode;\r\n\t\t\tsalePayment.CreditCard.CardNumber =\tcardData.CardNumber;\r\n\t\t\tsalePayment.CreditCard.CardHolderName = cardData.CardHolderName;\r\n\t\t\tsalePayment.CreditCard.CardType = cardData.CardType;\r\n\t\t\tsalePayment.CreditCard.MaskedCardNumber = cardData.MaskedCardNumber;\r\n\t\t\tsalePayment.CreditCard.EndValidity = cardData.EndValidity;\r\n\t\t\tsalePayment.CreditCard.ManualAuthCode =\tcardData.ManualAuthCode;\r\n\t\t\tif (cardData.Token)\r\n\t\t\t\tsalePayment.CreditCard.Token = {PaymentTokenCode: cardData.Token.PaymentTokenCode};\r\n\t\t}\r\n\t\t\r\n\t\tsalePayment.PaymentDataList = paymentResult.PaymentDataList;\r\n\t\t\r\n\t\treturn salePayment;\r\n\t}\r\n\t\r\n\t#createTransactionRef() {\r\n\t\treturn _kiosk_utils__WEBPACK_IMPORTED_MODULE_4__.KioskUtils.createRandomBase32String(10);\r\n\t}\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L3BheW1lbnQvcGF5LXByb2MtZXh0LWRldmljZS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBb0Y7QUFDekI7QUFDSDtBQUNGO0FBQ1Y7QUFDNUM7QUFDQTtBQUNPLCtCQUErQixpRUFBZ0I7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNFQUFzRSwrQkFBK0I7QUFDckc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0Esa0JBQWtCLGdFQUFhO0FBQy9CO0FBQ0EsaUJBQWlCLGdFQUFhO0FBQzlCLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsZ0JBQWdCLGdFQUFhO0FBQzdCO0FBQ0EsZUFBZSxnRUFBYTtBQUM1QixLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLGdCQUFnQixnRUFBYTtBQUM3QjtBQUNBLGVBQWUsZ0VBQWE7QUFDNUIsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1FQUFtRSwrRUFBVztBQUM5RTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxpRkFBYTtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixpRkFBYTtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixvRUFBWTtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQztBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUyxvREFBVTtBQUNuQjtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8va2lvc2stY29udHJvbGxlci8uLi9zY3JpcHQvcGF5bWVudC9wYXktcHJvYy1leHQtZGV2aWNlLmpzPzY0N2EiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgREVWSUNFX1RZUEUsIERFVklDRV9TVEFUVVMgfSBmcm9tICdAY29tbW9uLXNjcmlwdC9kZXZpY2UtbWFuYWdlci9kbS1tb2RlbCc7XHJcbmltcG9ydCB7IFBBWU1FTlRfVFlQRSB9IGZyb20gXCIuL3BheW1lbnQtcHJvY2Vzc29yLWZhY3RvcnlcIjtcclxuaW1wb3J0IHsgUGF5bWVudFByb2Nlc3NvciB9IGZyb20gXCIuL3BheS1wcm9jZXNzb3ItYmFzZVwiO1xyXG5pbXBvcnQgeyBFUGF5bWVudEVycm9yIH0gZnJvbSAnQGNvbW1vbi1zY3JpcHQvZXJyb3JzJztcclxuaW1wb3J0IHsgS2lvc2tVdGlscyB9IGZyb20gJy4uL2tpb3NrLXV0aWxzJztcclxuXHJcblxyXG5leHBvcnQgY2xhc3MgUGF5UHJvY0V4dERldmljZSBleHRlbmRzIFBheW1lbnRQcm9jZXNzb3Ige1xyXG5cdCN0cmFuc2FjdGlvblRpbWVvdXRUaW1lcjtcclxuXHQjZGVpdmNlTWFuYWdlcjtcclxuXHRcclxuXHRjb25zdHJ1Y3RvciAocGF5bWVudE1ldGhvZCwgZGV2TWFuYWdlcikge1xyXG5cdFx0c3VwZXIocGF5bWVudE1ldGhvZCk7XHJcblx0ICB0aGlzLiNkZWl2Y2VNYW5hZ2VyID0gZGV2TWFuYWdlcjtcclxuXHQgIHRoaXMuX2Rlc2NyaXB0aW9uID0gXCJDcmVkaXQgY2FyZFwiO1xyXG5cdH1cclxuXHRcclxuXHRnZXQgcmVjZWlwdERvY1RlbXBsYXRlSWQgKCkge1xyXG5cdFx0aWYgKCF0aGlzLl9wYXltZW50TWV0aG9kLlBsdWdpblNldHRpbmdzKSB7XHJcblx0XHRcdFNOUF9MT0dHRVIuZGVidWcoYFBsdWdpbiBzZXR0aW5ncyBub3QgcHJlc2VudCBmb3IgcGF5bWVudCBtZXRob2QgJHt0aGlzLl9wYXltZW50TWV0aG9kLlBsdWdpbk5hbWV9YClcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0bGV0IHBsdWdpblNldHRpbmdzID0gSlNPTi5wYXJzZSh0aGlzLl9wYXltZW50TWV0aG9kLlBsdWdpblNldHRpbmdzKTtcclxuXHRcdFx0cmV0dXJuIHBsdWdpblNldHRpbmdzID8gcGx1Z2luU2V0dGluZ3MuUmVjZWlwdFRlbXBsYXRlSWQgOiBudWxsO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0cGF5KHBhcmFtcywgbGlzdGVuZXIpIHtcclxuXHRcdHRyeSB7XHJcblx0XHRcdGxldCBwYXltZW50RGV2aWNlID0gdGhpcy4jZ2V0UGF5bWVudERldmljZSgpO1xyXG5cdFx0XHR0aGlzLl9vbkNoYW5nZSA9IGxpc3RlbmVyO1xyXG5cdFx0XHR0aGlzLiNzdGFydFRyYW5zYWN0aW9uVGltZW91dFRpbWVyKHBheW1lbnREZXZpY2UucGF5bWVudFRyYW5zYWN0aW9uVGltZW91dCwgcGFyYW1zLnRvdGFsRHVlKTtcclxuXHRcdFx0XHJcblx0ICAgIHJldHVybiBwYXltZW50RGV2aWNlLnBheShwYXJhbXMubWFpbkN1cnJlbmN5LCBwYXJhbXMudG90YWxEdWUsIHRoaXMuI2NyZWF0ZVRyYW5zYWN0aW9uUmVmKCksIHRoaXMucGF5bWVudERldmljZUFsaWFzKVxyXG5cdCAgICAgICAgLnRoZW4ocHJvY2Vzc29yUmVzdWx0ID0+IHtcclxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdGhpcy4jY3JlYXRlUmVzdWx0RnJvbVByb2Nlc3NvclJlc3VsdChwYXJhbXMudG90YWxEdWUsIHByb2Nlc3NvclJlc3VsdCk7XHJcblx0XHRcdFx0XHRcdH0pXHJcblx0ICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XHJcblx0XHRcdFx0XHRcdFx0aWYgKGVycm9yLnByb2Nlc3NvclJlc3VsdClcclxuXHRcdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFUGF5bWVudEVycm9yKGVycm9yLm1lc3NhZ2UsIGVycm9yLmVycm9yQ29kZSwgdGhpcy4jY3JlYXRlUmVzdWx0RnJvbVByb2Nlc3NvclJlc3VsdChwYXJhbXMudG90YWxEdWUsIGVycm9yLnByb2Nlc3NvclJlc3VsdCkpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRVBheW1lbnRFcnJvcihlcnJvci5tZXNzYWdlLCBlcnJvci5lcnJvckNvZGUpO1xyXG5cdFx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdFx0LmZpbmFsbHkoKCk9PiB0aGlzLiNjb21tYW5kQ29tcGxldGVkKCkpO1xyXG5cdFx0fVxyXG5cdFx0Y2F0Y2ggKGVycm9yKSB7XHJcblx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdHZvaWQoY3VycmVuY3ksIHNhbGVQYXltZW50LCBsaXN0ZW5lcikge1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0bGV0IHBheW1lbnREZXZpY2UgPSB0aGlzLiNnZXRQYXltZW50RGV2aWNlKCk7XHJcblx0XHRcdHRoaXMuX29uQ2hhbmdlID0gbGlzdGVuZXI7XHJcblx0XHQgIHRoaXMuI3N0YXJ0VHJhbnNhY3Rpb25UaW1lb3V0VGltZXIocGF5bWVudERldmljZS5wYXltZW50VHJhbnNhY3Rpb25UaW1lb3V0LCBzYWxlUGF5bWVudC5QYXltZW50QW1vdW50KTtcclxuXHJcblx0XHRcdHJldHVybiBwYXltZW50RGV2aWNlLnZvaWQoY3VycmVuY3ksIHNhbGVQYXltZW50LCB0aGlzLiNjcmVhdGVUcmFuc2FjdGlvblJlZigpLCB0aGlzLnBheW1lbnREZXZpY2VBbGlhcylcclxuXHRcdFx0XHQudGhlbihwYXltZW50UmVzdWx0ID0+IHtcclxuXHRcdFx0XHRcdHJldHVybiB0aGlzLiNjcmVhdGVSZXN1bHRGcm9tUHJvY2Vzc29yUmVzdWx0KC1zYWxlUGF5bWVudC5QYXltZW50QW1vdW50LCBwYXltZW50UmVzdWx0KTtcclxuXHRcdFx0XHR9KVxyXG5cdFx0XHRcdC5jYXRjaCgoZXJyb3IpID0+IHtcclxuXHRcdFx0XHRcdGlmIChlcnJvci5wcm9jZXNzb3JSZXN1bHQpXHJcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFUGF5bWVudEVycm9yKGVycm9yLm1lc3NhZ2UsIGVycm9yLmVycm9yQ29kZSwgdGhpcy4jY3JlYXRlUmVzdWx0RnJvbVByb2Nlc3NvclJlc3VsdCgtc2FsZVBheW1lbnQuUGF5bWVudEFtb3VudCwgZXJyb3IucHJvY2Vzc29yUmVzdWx0KSk7XHJcblxyXG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVQYXltZW50RXJyb3IoZXJyb3IubWVzc2FnZSwgZXJyb3IuZXJyb3JDb2RlKTtcclxuXHRcdFx0XHR9KVxyXG5cdFx0XHRcdC5maW5hbGx5KCgpID0+IHRoaXMuI2NvbW1hbmRDb21wbGV0ZWQoKSk7XHJcblx0XHR9XHJcblx0XHRjYXRjaCAoZXJyb3IpIHtcclxuXHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKVxyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHRyZWZ1bmQoY3VycmVuY3ksIGFtb3VudCwgbGlzdGVuZXIpIHtcclxuXHRcdHRyeSB7XHJcblx0XHRcdGxldCBwYXltZW50RGV2aWNlID0gdGhpcy4jZ2V0UGF5bWVudERldmljZSgpO1xyXG5cdFx0XHR0aGlzLl9vbkNoYW5nZSA9IGxpc3RlbmVyO1xyXG5cdFx0ICB0aGlzLiNzdGFydFRyYW5zYWN0aW9uVGltZW91dFRpbWVyKHBheW1lbnREZXZpY2UucGF5bWVudFRyYW5zYWN0aW9uVGltZW91dCwgYW1vdW50KTtcclxuXHJcblx0XHRcdHJldHVybiBwYXltZW50RGV2aWNlLnJlZnVuZChjdXJyZW5jeSwgYW1vdW50LCB0aGlzLiNjcmVhdGVUcmFuc2FjdGlvblJlZigpLCB0aGlzLnBheW1lbnREZXZpY2VBbGlhcylcclxuXHRcdFx0XHQudGhlbihwYXltZW50UmVzdWx0ID0+IHtcclxuXHRcdFx0XHRcdHJldHVybiB0aGlzLiNjcmVhdGVSZXN1bHRGcm9tUHJvY2Vzc29yUmVzdWx0KGFtb3VudCwgcGF5bWVudFJlc3VsdCk7XHJcblx0XHRcdFx0fSlcclxuXHRcdFx0XHQuY2F0Y2goKGVycm9yKSA9PiB7XHJcblx0XHRcdFx0XHRpZiAoZXJyb3IucHJvY2Vzc29yUmVzdWx0KVxyXG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRVBheW1lbnRFcnJvcihlcnJvci5tZXNzYWdlLCBlcnJvci5lcnJvckNvZGUsIHRoaXMuI2NyZWF0ZVJlc3VsdEZyb21Qcm9jZXNzb3JSZXN1bHQoYW1vdW50LCBlcnJvci5wcm9jZXNzb3JSZXN1bHQpKTtcclxuXHJcblx0XHRcdFx0XHR0aHJvdyBuZXcgRVBheW1lbnRFcnJvcihlcnJvci5tZXNzYWdlLCBlcnJvci5lcnJvckNvZGUpO1xyXG5cdFx0XHRcdH0pXHJcblx0XHRcdFx0LmZpbmFsbHkoKCkgPT4gdGhpcy4jY29tbWFuZENvbXBsZXRlZCgpKTtcclxuXHRcdH1cclxuXHRcdGNhdGNoIChlcnJvcikge1xyXG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpXHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdCNnZXRQYXltZW50RGV2aWNlKCkge1xyXG5cdFx0bGV0IHJlc3VsdCA9IG51bGw7IFxyXG5cdCAgbGV0IHBheW1lbnREZXZpY2VzID0gdGhpcy4jZGVpdmNlTWFuYWdlci5maW5kRGV2aWNlQnlEZXZpY2VUeXBlKERFVklDRV9UWVBFLkVYVF9QQVlfREVWSUNFKTtcclxuXHQgIFxyXG5cdFx0Zm9yIChsZXQgcG0gb2YgcGF5bWVudERldmljZXMpIHtcclxuXHRcdFx0aWYgKHBtLnBheW1lbnRNZXRob2RJRHMuaW5jbHVkZXModGhpcy5wYXltZW50TWV0aG9kSWQpKSB7XHJcblx0XHRcdFx0cmVzdWx0ID0gcG07XHJcblx0XHRcdFx0aWYgKHJlc3VsdC5kZXZpY2VTdGF0dXMgPT09IERFVklDRV9TVEFUVVMuUkVBRFkpXHJcblx0XHRcdFx0XHRicmVhaztcdFx0XHRcdFxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGlmICghcmVzdWx0KVxyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJQYXltZW50IGRldmljZSBub3QgZm91bmRcIik7XHJcblxyXG5cdFx0aWYgKHJlc3VsdC5kZXZpY2VTdGF0dXMgIT09IERFVklDRV9TVEFUVVMuUkVBRFkpXHJcblx0XHQgIHRocm93IG5ldyBFcnJvcihcIlBheW1lbnQgZGV2aWNlIG5vdCByZWFkeVwiKTtcclxuXHJcblx0ICByZXR1cm4gcmVzdWx0O1xyXG5cdH1cclxuXHJcblx0I2NvbW1hbmRDb21wbGV0ZWQoKSB7XHJcblx0XHR0aGlzLl9vbkNoYW5nZSA9IG51bGw7XHJcblx0XHRjbGVhckludGVydmFsKHRoaXMuI3RyYW5zYWN0aW9uVGltZW91dFRpbWVyKTtcclxuXHR9XHJcblx0XHJcblx0I2NyZWF0ZVJlc3VsdEZyb21Qcm9jZXNzb3JSZXN1bHQodG90YWxEdWUsIHBheW1lbnRSZXN1bHQpIHtcclxuXHRcdHJldHVybiB7XHJcblx0XHRcdHNhbGVQYXltZW50OiB0aGlzLiNjcmVhdGVTYWxlUGF5bWVudCh0b3RhbER1ZSwgcGF5bWVudFJlc3VsdCksXHJcblx0XHRcdGRldmljZVJlY2VpcHRzOiBwYXltZW50UmVzdWx0LkRldmljZVJlY2VpcHRzXHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdCNzdGFydFRyYW5zYWN0aW9uVGltZW91dFRpbWVyKHRpbWVvdXRUaW1lLCB0b3RhbER1ZSkge1xyXG5cdFx0bGV0IHRpbWVMZWZ0ID0gdGltZW91dFRpbWU7XHJcblx0XHR0aGlzLiN0cmFuc2FjdGlvblRpbWVvdXRUaW1lciA9IHNldEludGVydmFsKCgpPT4ge1xyXG5cdFx0ICBpZiAodGltZUxlZnQgPD0gMClcclxuXHRcdCAgICBjbGVhckludGVydmFsKHRoaXMuI3RyYW5zYWN0aW9uVGltZW91dFRpbWVyKTtcclxuXHJcbiAgICAgIGxldCByZW1haW5pbmdTZWMgPSB0aW1lTGVmdCAvIDEwMDA7XHJcbiAgICAgIHRoaXMuX2Rpc3BhdGNoQ2hhbmdlZEV2ZW50KHRvdGFsRHVlLCAwLCByZW1haW5pbmdTZWMpO1xyXG5cdFx0ICB0aW1lTGVmdCAtPSAxMDAwO1xyXG5cdFx0fSwgMTAwMCk7XHJcblx0fVxyXG5cdFx0XHJcblx0I2NyZWF0ZVNhbGVQYXltZW50KGFtb3VudCwgcGF5bWVudFJlc3VsdCkge1xyXG5cdFx0bGV0IGNhcmREYXRhID0gcGF5bWVudFJlc3VsdC5DYXJkRGF0YTtcclxuXHRcdGxldCBzYWxlUGF5bWVudCA9IHt9O1xyXG5cdFx0c2FsZVBheW1lbnQuQ3JlZGl0Q2FyZCA9IHt9O1xyXG5cdFx0c2FsZVBheW1lbnQuUGF5bWVudFR5cGUgPSBQQVlNRU5UX1RZUEUuQ1JFRElUX0NBUkQ7XHJcblx0XHRzYWxlUGF5bWVudC5QYXltZW50TWV0aG9kSWQgPSB0aGlzLnBheW1lbnRNZXRob2RJZDtcclxuXHRcdHNhbGVQYXltZW50LlBheW1lbnRBbW91bnQgPSBwYXltZW50UmVzdWx0LkFjY2VwdGVkQW1vdW50IHx8IGFtb3VudDtcclxuXHRcdHNhbGVQYXltZW50LlBheW1lbnRTdGF0dXMgPSBwYXltZW50UmVzdWx0LlBheW1lbnRTdGF0dXM7XHJcblx0XHRcclxuXHRcdGlmIChjYXJkRGF0YSkge1xyXG5cdFx0XHRpZiAoY2FyZERhdGEuU3RhdHVzKVxyXG5cdFx0XHRcdHNhbGVQYXltZW50LlBheW1lbnRTdGF0dXMgPSBjYXJkRGF0YS5TdGF0dXM7XHJcblx0XHRcdFxyXG5cdFx0XHRzYWxlUGF5bWVudC5DcmVkaXRDYXJkLkF1dGhvcml6YXRpb25Db2RlID0gY2FyZERhdGEuTWFudWFsQXV0aENvZGU7XHJcblx0XHRcdHNhbGVQYXltZW50LkNyZWRpdENhcmQuQ2FyZE51bWJlciA9XHRjYXJkRGF0YS5DYXJkTnVtYmVyO1xyXG5cdFx0XHRzYWxlUGF5bWVudC5DcmVkaXRDYXJkLkNhcmRIb2xkZXJOYW1lID0gY2FyZERhdGEuQ2FyZEhvbGRlck5hbWU7XHJcblx0XHRcdHNhbGVQYXltZW50LkNyZWRpdENhcmQuQ2FyZFR5cGUgPSBjYXJkRGF0YS5DYXJkVHlwZTtcclxuXHRcdFx0c2FsZVBheW1lbnQuQ3JlZGl0Q2FyZC5NYXNrZWRDYXJkTnVtYmVyID0gY2FyZERhdGEuTWFza2VkQ2FyZE51bWJlcjtcclxuXHRcdFx0c2FsZVBheW1lbnQuQ3JlZGl0Q2FyZC5FbmRWYWxpZGl0eSA9IGNhcmREYXRhLkVuZFZhbGlkaXR5O1xyXG5cdFx0XHRzYWxlUGF5bWVudC5DcmVkaXRDYXJkLk1hbnVhbEF1dGhDb2RlID1cdGNhcmREYXRhLk1hbnVhbEF1dGhDb2RlO1xyXG5cdFx0XHRpZiAoY2FyZERhdGEuVG9rZW4pXHJcblx0XHRcdFx0c2FsZVBheW1lbnQuQ3JlZGl0Q2FyZC5Ub2tlbiA9IHtQYXltZW50VG9rZW5Db2RlOiBjYXJkRGF0YS5Ub2tlbi5QYXltZW50VG9rZW5Db2RlfTtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0c2FsZVBheW1lbnQuUGF5bWVudERhdGFMaXN0ID0gcGF5bWVudFJlc3VsdC5QYXltZW50RGF0YUxpc3Q7XHJcblx0XHRcclxuXHRcdHJldHVybiBzYWxlUGF5bWVudDtcclxuXHR9XHJcblx0XHJcblx0I2NyZWF0ZVRyYW5zYWN0aW9uUmVmKCkge1xyXG5cdFx0cmV0dXJuIEtpb3NrVXRpbHMuY3JlYXRlUmFuZG9tQmFzZTMyU3RyaW5nKDEwKTtcclxuXHR9XHJcbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///../script/payment/pay-proc-ext-device.js\n");

/***/ }),

/***/ "../script/payment/pay-proc-wallet.js":
/*!********************************************!*\
  !*** ../script/payment/pay-proc-wallet.js ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PayProcWallet: () => (/* binding */ PayProcWallet)\n/* harmony export */ });\n/* harmony import */ var _payment_processor_factory__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./payment-processor-factory */ \"../script/payment/payment-processor-factory.js\");\n/* harmony import */ var _pay_processor_base__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./pay-processor-base */ \"../script/payment/pay-processor-base.js\");\n\r\n\r\n\r\nclass PayProcWallet extends _pay_processor_base__WEBPACK_IMPORTED_MODULE_1__.PaymentProcessor {\r\n\r\n\tconstructor (paymentMethod) {\r\n\t\tsuper(paymentMethod);\r\n\t  this._description = \"Wallet\";\r\n\t}\r\n\t\r\n\tpay(params) {\r\n\t\tif (!params.mediaRead || !params.mediaRead.MediaCode)\r\n\t\t\tPromise.reject(new Error(\"'mediaRead' attribute is required for wallet payments\"));\r\n\r\n\t\tlet mediaCode = params.mediaRead.MediaCode;\r\n\t\tlet amount = params.totalDue;\r\n\r\n\t\treturn KIOSK_CONTROLLER.snappAPI.cmd(\"PORTFOLIO\", \"HoldWalletPayment\", { \"MediaCode\": mediaCode, \"Amount\": amount })\r\n\t\t\t.then(ansDO => {\r\n\t\t\t\treturn { salePayment: this.#createSalePayment(mediaCode, amount, ansDO) }\r\n\t\t\t})\r\n\t}\r\n\t\r\n\tvoid(salePayment) {\r\n    return Promise.reject(new Error(\"TO DO\"));\r\n\t}\r\n\t\r\n\t#createSalePayment(mediaCode, amount, ansDO) {\r\n\t\tlet salePayment = {};\r\n\t\tsalePayment = {};\r\n\t\tsalePayment.PaymentType = _payment_processor_factory__WEBPACK_IMPORTED_MODULE_0__.PAYMENT_TYPE.WALLET;\r\n\t\tsalePayment.PaymentMethodId = this.paymentMethodId;\r\n\t\tsalePayment.PaymentAmount = amount;\r\n\t\tsalePayment.PaymentStatus = 2;\r\n\t\t\r\n\t\tsalePayment.Wallet = {};\t\r\n\t\tsalePayment.Wallet.MediaCode = mediaCode;\r\n\t\tsalePayment.Wallet.PortfolioSlotHoldId =\tansDO.PortfolioSlotHoldId;\r\n\t\t\r\n\t\treturn salePayment;\r\n\t}\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L3BheW1lbnQvcGF5LXByb2Mtd2FsbGV0LmpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUEyRDtBQUNIO0FBQ3hEO0FBQ08sNEJBQTRCLGlFQUFnQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJFQUEyRSwwQ0FBMEM7QUFDckg7QUFDQSxhQUFhO0FBQ2IsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixvRUFBWTtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8va2lvc2stY29udHJvbGxlci8uLi9zY3JpcHQvcGF5bWVudC9wYXktcHJvYy13YWxsZXQuanM/YjMyNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQQVlNRU5UX1RZUEUgfSBmcm9tIFwiLi9wYXltZW50LXByb2Nlc3Nvci1mYWN0b3J5XCI7XHJcbmltcG9ydCB7IFBheW1lbnRQcm9jZXNzb3IgfSBmcm9tIFwiLi9wYXktcHJvY2Vzc29yLWJhc2VcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBQYXlQcm9jV2FsbGV0IGV4dGVuZHMgUGF5bWVudFByb2Nlc3NvciB7XHJcblxyXG5cdGNvbnN0cnVjdG9yIChwYXltZW50TWV0aG9kKSB7XHJcblx0XHRzdXBlcihwYXltZW50TWV0aG9kKTtcclxuXHQgIHRoaXMuX2Rlc2NyaXB0aW9uID0gXCJXYWxsZXRcIjtcclxuXHR9XHJcblx0XHJcblx0cGF5KHBhcmFtcykge1xyXG5cdFx0aWYgKCFwYXJhbXMubWVkaWFSZWFkIHx8ICFwYXJhbXMubWVkaWFSZWFkLk1lZGlhQ29kZSlcclxuXHRcdFx0UHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiJ21lZGlhUmVhZCcgYXR0cmlidXRlIGlzIHJlcXVpcmVkIGZvciB3YWxsZXQgcGF5bWVudHNcIikpO1xyXG5cclxuXHRcdGxldCBtZWRpYUNvZGUgPSBwYXJhbXMubWVkaWFSZWFkLk1lZGlhQ29kZTtcclxuXHRcdGxldCBhbW91bnQgPSBwYXJhbXMudG90YWxEdWU7XHJcblxyXG5cdFx0cmV0dXJuIEtJT1NLX0NPTlRST0xMRVIuc25hcHBBUEkuY21kKFwiUE9SVEZPTElPXCIsIFwiSG9sZFdhbGxldFBheW1lbnRcIiwgeyBcIk1lZGlhQ29kZVwiOiBtZWRpYUNvZGUsIFwiQW1vdW50XCI6IGFtb3VudCB9KVxyXG5cdFx0XHQudGhlbihhbnNETyA9PiB7XHJcblx0XHRcdFx0cmV0dXJuIHsgc2FsZVBheW1lbnQ6IHRoaXMuI2NyZWF0ZVNhbGVQYXltZW50KG1lZGlhQ29kZSwgYW1vdW50LCBhbnNETykgfVxyXG5cdFx0XHR9KVxyXG5cdH1cclxuXHRcclxuXHR2b2lkKHNhbGVQYXltZW50KSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiVE8gRE9cIikpO1xyXG5cdH1cclxuXHRcclxuXHQjY3JlYXRlU2FsZVBheW1lbnQobWVkaWFDb2RlLCBhbW91bnQsIGFuc0RPKSB7XHJcblx0XHRsZXQgc2FsZVBheW1lbnQgPSB7fTtcclxuXHRcdHNhbGVQYXltZW50ID0ge307XHJcblx0XHRzYWxlUGF5bWVudC5QYXltZW50VHlwZSA9IFBBWU1FTlRfVFlQRS5XQUxMRVQ7XHJcblx0XHRzYWxlUGF5bWVudC5QYXltZW50TWV0aG9kSWQgPSB0aGlzLnBheW1lbnRNZXRob2RJZDtcclxuXHRcdHNhbGVQYXltZW50LlBheW1lbnRBbW91bnQgPSBhbW91bnQ7XHJcblx0XHRzYWxlUGF5bWVudC5QYXltZW50U3RhdHVzID0gMjtcclxuXHRcdFxyXG5cdFx0c2FsZVBheW1lbnQuV2FsbGV0ID0ge307XHRcclxuXHRcdHNhbGVQYXltZW50LldhbGxldC5NZWRpYUNvZGUgPSBtZWRpYUNvZGU7XHJcblx0XHRzYWxlUGF5bWVudC5XYWxsZXQuUG9ydGZvbGlvU2xvdEhvbGRJZCA9XHRhbnNETy5Qb3J0Zm9saW9TbG90SG9sZElkO1xyXG5cdFx0XHJcblx0XHRyZXR1cm4gc2FsZVBheW1lbnQ7XHJcblx0fVxyXG59Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///../script/payment/pay-proc-wallet.js\n");

/***/ }),

/***/ "../script/payment/pay-processor-base.js":
/*!***********************************************!*\
  !*** ../script/payment/pay-processor-base.js ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PaymentProcessor: () => (/* binding */ PaymentProcessor)\n/* harmony export */ });\n\r\nclass PaymentProcessor {\r\n\t_description = \"\";\t\r\n\t_paymentMethod;\r\n\t_onChange;\r\n\t\r\n\tconstructor (paymentMethod) {\r\n\t  this._paymentMethod = paymentMethod;\r\n\t}\r\n\r\n\tget description() {\r\n\t\treturn this._description;\r\n\t}\r\n\t\r\n\tget receiptDocTemplateId () {\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tget paymentMethodId () {\r\n\t\treturn this._paymentMethod.PluginId;\r\n\t}\r\n\t\r\n\tget paymentDeviceAlias () {\r\n\t\treturn this._paymentMethod.DeviceAlias;\r\n\t}\r\n\t\r\n\tget paymentType() {\r\n\t\treturn this._paymentMethod.PaymentMethodDetails.PaymentType;\r\n\t}\r\n\t\r\n\tpay(params) {\r\n\t\tthrow new Error(\"Pay method must be implemented in extending class\");\r\n\t}\r\n\t\r\n\tvoid(currency, salePayment) {\r\n\t\tthrow new Error(\"doVoid method must be implemented in extending class\");\r\n\t}\r\n\t\r\n\t_dispatchChangedEvent(due, tendered, remainingTime) {\r\n\t\tif (this._onChange) {\r\n\t\t\tlet event = {\r\n\t\t\t\tprocessor: this,\r\n\t\t\t\tdue: due, \r\n\t\t\t\ttendered: tendered,\r\n\t\t\t\tremainingTime: remainingTime\r\n\t\t\t};\r\n\t\t\tthis._onChange(event);\r\n\t\t}\r\n\t}\r\n\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L3BheW1lbnQvcGF5LXByb2Nlc3Nvci1iYXNlLmpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9raW9zay1jb250cm9sbGVyLy4uL3NjcmlwdC9wYXltZW50L3BheS1wcm9jZXNzb3ItYmFzZS5qcz9lNGRlIl0sInNvdXJjZXNDb250ZW50IjpbIlxyXG5leHBvcnQgY2xhc3MgUGF5bWVudFByb2Nlc3NvciB7XHJcblx0X2Rlc2NyaXB0aW9uID0gXCJcIjtcdFxyXG5cdF9wYXltZW50TWV0aG9kO1xyXG5cdF9vbkNoYW5nZTtcclxuXHRcclxuXHRjb25zdHJ1Y3RvciAocGF5bWVudE1ldGhvZCkge1xyXG5cdCAgdGhpcy5fcGF5bWVudE1ldGhvZCA9IHBheW1lbnRNZXRob2Q7XHJcblx0fVxyXG5cclxuXHRnZXQgZGVzY3JpcHRpb24oKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fZGVzY3JpcHRpb247XHJcblx0fVxyXG5cdFxyXG5cdGdldCByZWNlaXB0RG9jVGVtcGxhdGVJZCAoKSB7XHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcblx0XHJcblx0Z2V0IHBheW1lbnRNZXRob2RJZCAoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fcGF5bWVudE1ldGhvZC5QbHVnaW5JZDtcclxuXHR9XHJcblx0XHJcblx0Z2V0IHBheW1lbnREZXZpY2VBbGlhcyAoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fcGF5bWVudE1ldGhvZC5EZXZpY2VBbGlhcztcclxuXHR9XHJcblx0XHJcblx0Z2V0IHBheW1lbnRUeXBlKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX3BheW1lbnRNZXRob2QuUGF5bWVudE1ldGhvZERldGFpbHMuUGF5bWVudFR5cGU7XHJcblx0fVxyXG5cdFxyXG5cdHBheShwYXJhbXMpIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcihcIlBheSBtZXRob2QgbXVzdCBiZSBpbXBsZW1lbnRlZCBpbiBleHRlbmRpbmcgY2xhc3NcIik7XHJcblx0fVxyXG5cdFxyXG5cdHZvaWQoY3VycmVuY3ksIHNhbGVQYXltZW50KSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJkb1ZvaWQgbWV0aG9kIG11c3QgYmUgaW1wbGVtZW50ZWQgaW4gZXh0ZW5kaW5nIGNsYXNzXCIpO1xyXG5cdH1cclxuXHRcclxuXHRfZGlzcGF0Y2hDaGFuZ2VkRXZlbnQoZHVlLCB0ZW5kZXJlZCwgcmVtYWluaW5nVGltZSkge1xyXG5cdFx0aWYgKHRoaXMuX29uQ2hhbmdlKSB7XHJcblx0XHRcdGxldCBldmVudCA9IHtcclxuXHRcdFx0XHRwcm9jZXNzb3I6IHRoaXMsXHJcblx0XHRcdFx0ZHVlOiBkdWUsIFxyXG5cdFx0XHRcdHRlbmRlcmVkOiB0ZW5kZXJlZCxcclxuXHRcdFx0XHRyZW1haW5pbmdUaW1lOiByZW1haW5pbmdUaW1lXHJcblx0XHRcdH07XHJcblx0XHRcdHRoaXMuX29uQ2hhbmdlKGV2ZW50KTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG59Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///../script/payment/pay-processor-base.js\n");

/***/ }),

/***/ "../script/payment/payment-processor-factory.js":
/*!******************************************************!*\
  !*** ../script/payment/payment-processor-factory.js ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PAYMENT_TYPE: () => (/* binding */ PAYMENT_TYPE),\n/* harmony export */   PaymentProcessorFactory: () => (/* binding */ PaymentProcessorFactory)\n/* harmony export */ });\n/* harmony import */ var _pay_proc_ext_device__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./pay-proc-ext-device */ \"../script/payment/pay-proc-ext-device.js\");\n/* harmony import */ var _pay_proc_wallet__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./pay-proc-wallet */ \"../script/payment/pay-proc-wallet.js\");\n\r\n\r\n\r\nconst PAYMENT_TYPE = {CASH: 1, CREDIT_CARD: 2, WALLET: 15};\r\n\r\nclass PaymentProcessorFactory {\r\n\t#paymentProcessorMap = new Map();\r\n\r\n  getPaymentProcessor(paymentMethod) {\r\n\t  let paymentProcessor = this.#paymentProcessorMap.get(paymentMethod.PluginId);\r\n\t  \r\n\t  if (!paymentProcessor) {\r\n\t  \tpaymentProcessor = this.#createPaymentProcessor(paymentMethod);\r\n\t  \tthis.#paymentProcessorMap.set(paymentMethod.PluginId, paymentProcessor);\r\n\t  }\r\n\t  \r\n\t  return paymentProcessor;\r\n  }\r\n  \r\n  findPaymentProcessorByPluginId(pluginId) {\r\n\t  return this.#paymentProcessorMap.get(pluginId);\r\n  }\r\n\r\n  #createPaymentProcessor(paymentMethod) {\r\n\t  switch (paymentMethod.PaymentMethodDetails.PaymentType) {\r\n      case PAYMENT_TYPE.WALLET:\r\n        return new _pay_proc_wallet__WEBPACK_IMPORTED_MODULE_1__.PayProcWallet(paymentMethod);\r\n      case PAYMENT_TYPE.CASH:\r\n      case PAYMENT_TYPE.CREDIT_CARD:\r\n        return new _pay_proc_ext_device__WEBPACK_IMPORTED_MODULE_0__.PayProcExtDevice(paymentMethod, DEVICE_MANAGER);\r\n    }\r\n    \r\n    throw new Error(\"Payment type not supported: \" + paymentMethod.PaymentMethodDetails.PaymentType);\r\n  }\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L3BheW1lbnQvcGF5bWVudC1wcm9jZXNzb3ItZmFjdG9yeS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQXlEO0FBQ1A7QUFDbEQ7QUFDTyxzQkFBc0I7QUFDN0I7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsMkRBQWE7QUFDaEM7QUFDQTtBQUNBLG1CQUFtQixrRUFBZ0I7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2tpb3NrLWNvbnRyb2xsZXIvLi4vc2NyaXB0L3BheW1lbnQvcGF5bWVudC1wcm9jZXNzb3ItZmFjdG9yeS5qcz8yYTllIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBheVByb2NFeHREZXZpY2UgfSBmcm9tICcuL3BheS1wcm9jLWV4dC1kZXZpY2UnO1xyXG5pbXBvcnQgeyBQYXlQcm9jV2FsbGV0IH0gZnJvbSAnLi9wYXktcHJvYy13YWxsZXQnO1xyXG5cclxuZXhwb3J0IGNvbnN0IFBBWU1FTlRfVFlQRSA9IHtDQVNIOiAxLCBDUkVESVRfQ0FSRDogMiwgV0FMTEVUOiAxNX07XHJcblxyXG5leHBvcnQgY2xhc3MgUGF5bWVudFByb2Nlc3NvckZhY3Rvcnkge1xyXG5cdCNwYXltZW50UHJvY2Vzc29yTWFwID0gbmV3IE1hcCgpO1xyXG5cclxuICBnZXRQYXltZW50UHJvY2Vzc29yKHBheW1lbnRNZXRob2QpIHtcclxuXHQgIGxldCBwYXltZW50UHJvY2Vzc29yID0gdGhpcy4jcGF5bWVudFByb2Nlc3Nvck1hcC5nZXQocGF5bWVudE1ldGhvZC5QbHVnaW5JZCk7XHJcblx0ICBcclxuXHQgIGlmICghcGF5bWVudFByb2Nlc3Nvcikge1xyXG5cdCAgXHRwYXltZW50UHJvY2Vzc29yID0gdGhpcy4jY3JlYXRlUGF5bWVudFByb2Nlc3NvcihwYXltZW50TWV0aG9kKTtcclxuXHQgIFx0dGhpcy4jcGF5bWVudFByb2Nlc3Nvck1hcC5zZXQocGF5bWVudE1ldGhvZC5QbHVnaW5JZCwgcGF5bWVudFByb2Nlc3Nvcik7XHJcblx0ICB9XHJcblx0ICBcclxuXHQgIHJldHVybiBwYXltZW50UHJvY2Vzc29yO1xyXG4gIH1cclxuICBcclxuICBmaW5kUGF5bWVudFByb2Nlc3NvckJ5UGx1Z2luSWQocGx1Z2luSWQpIHtcclxuXHQgIHJldHVybiB0aGlzLiNwYXltZW50UHJvY2Vzc29yTWFwLmdldChwbHVnaW5JZCk7XHJcbiAgfVxyXG5cclxuICAjY3JlYXRlUGF5bWVudFByb2Nlc3NvcihwYXltZW50TWV0aG9kKSB7XHJcblx0ICBzd2l0Y2ggKHBheW1lbnRNZXRob2QuUGF5bWVudE1ldGhvZERldGFpbHMuUGF5bWVudFR5cGUpIHtcclxuICAgICAgY2FzZSBQQVlNRU5UX1RZUEUuV0FMTEVUOlxyXG4gICAgICAgIHJldHVybiBuZXcgUGF5UHJvY1dhbGxldChwYXltZW50TWV0aG9kKTtcclxuICAgICAgY2FzZSBQQVlNRU5UX1RZUEUuQ0FTSDpcclxuICAgICAgY2FzZSBQQVlNRU5UX1RZUEUuQ1JFRElUX0NBUkQ6XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQYXlQcm9jRXh0RGV2aWNlKHBheW1lbnRNZXRob2QsIERFVklDRV9NQU5BR0VSKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiUGF5bWVudCB0eXBlIG5vdCBzdXBwb3J0ZWQ6IFwiICsgcGF5bWVudE1ldGhvZC5QYXltZW50TWV0aG9kRGV0YWlscy5QYXltZW50VHlwZSk7XHJcbiAgfVxyXG59Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///../script/payment/payment-processor-factory.js\n");

/***/ }),

/***/ "../script/steps/checkout.js":
/*!***********************************!*\
  !*** ../script/steps/checkout.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Checkout: () => (/* binding */ Checkout)\n/* harmony export */ });\n/* harmony import */ var _step_payment__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./step-payment */ \"../script/steps/step-payment.js\");\n/* harmony import */ var _step_print_ticket__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./step-print-ticket */ \"../script/steps/step-print-ticket.js\");\n/* harmony import */ var _step_print_receipt__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./step-print-receipt */ \"../script/steps/step-print-receipt.js\");\n/* harmony import */ var _step_print_payment_receipt__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./step-print-payment-receipt */ \"../script/steps/step-print-payment-receipt.js\");\n/* harmony import */ var _step_change_handover__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./step-change-handover */ \"../script/steps/step-change-handover.js\");\n/* harmony import */ var _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../kiosk-event-utils */ \"../script/kiosk-event-utils.js\");\n/* harmony import */ var _payment_payment_processor_factory__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../payment/payment-processor-factory */ \"../script/payment/payment-processor-factory.js\");\n/* harmony import */ var _kiosk_model__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../kiosk-model */ \"../script/kiosk-model.js\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass Checkout {\r\n    #params;\r\n    #rights;\r\n    #snappAPI;\r\n    #stepPayment;\r\n    #stepPrintPaymentReceipt;\r\n    #stepPrintTicket;\r\n    #stepChangeHandOver;\r\n    #stepPrintReceipt;\r\n    #paymentFactory = new _payment_payment_processor_factory__WEBPACK_IMPORTED_MODULE_6__.PaymentProcessorFactory();\r\n    #mainCurrency;\r\n\r\n    constructor(snappAPI) {\r\n        this.#snappAPI = snappAPI;\r\n        this.#stepPayment = new _step_payment__WEBPACK_IMPORTED_MODULE_0__.StepPayment(snappAPI, this.#paymentFactory);\r\n        this.#stepPrintTicket = new _step_print_ticket__WEBPACK_IMPORTED_MODULE_1__.StepPrintTicket(snappAPI);\r\n        this.#stepPrintPaymentReceipt = new _step_print_payment_receipt__WEBPACK_IMPORTED_MODULE_3__.StepPrintTicketReceipt(snappAPI);\r\n        this.#stepChangeHandOver = new _step_change_handover__WEBPACK_IMPORTED_MODULE_4__.StepChangeHandOver(snappAPI, this.#paymentFactory);\r\n        this.#stepPrintReceipt = new _step_print_receipt__WEBPACK_IMPORTED_MODULE_2__.StepPrintReceipt(snappAPI);\r\n    }\r\n\r\n    get printAtHomeIsEnabled() {\r\n        return !!this.#rights.KSK_OrderConfirmationDocTemplateId;\r\n    }\r\n\r\n    /**\r\n     * @param {any} rights\r\n     */\r\n    set rights(rights) {\r\n        this.#rights = rights;\r\n    }\r\n\r\n    /**\r\n     * @param {string} mainCurrency\r\n     */\r\n    set mainCurrency(mainCurrency) {\r\n        this.#mainCurrency = mainCurrency;\r\n    }\r\n\r\n    setEnabledPaymentMethods(enabledPaymentMethods) {\r\n        this.#stepPayment.setEnabledPaymentMethods(enabledPaymentMethods);\r\n    }\r\n\r\n    async shopCartCheckout(params, currentTransaction) {\r\n        const result = {\r\n            retry: false,\r\n            stepWarnMessage: \"\",\r\n            data: {\r\n                paymentList: [],\r\n                totalTendered: 0,\r\n                transactionRef: null,\r\n                itemsToPrint: [],\r\n                printedMedia: [],\r\n            },\r\n            paymentInfoList: [\r\n                // {\r\n                //  paymentResult: {},\r\n                //  receiptDocTemplateId: null\r\n                // },\r\n            ],\r\n        };\r\n        Object.assign(result.data, currentTransaction);\r\n\r\n\t\tthis.#params = JSON.parse(JSON.stringify(params));\r\n\t\tthis.#params.mainCurrency = this.#mainCurrency;\r\n\t\tthis.#params.rights = JSON.parse(JSON.stringify(this.#rights));\r\n\t\ttry {\r\n\t\t\tawait this.#executePaymentStep(result);\r\n\t\t\tawait this.#executePostTransaction(result);\r\n\t\t\tawait this.#executePrintTicketStep(result);\r\n\t\t\tawait this.#activateMediaAndValidateOrder(result);\r\n\t\t\tawait this.#executeHandOverChangeStep(result);\r\n\t\t} catch (e) {\r\n\t\t\tthis.#logError(\"Checkout failed with error: \", e)\r\n\t\t\tresult.stepWarnMessage = e.stepFailure;\r\n\t\t\t// KioskEventUtils.triggerTransactionEvent(\"failed\", \"transaction\", e.stepFailure || \"\", result.data.transactionRef);\r\n\t\t} finally {\r\n\t\t\tawait this.#executePrintPaymentReceiptStep(result);\r\n\t\t\tif (!result.retry) {\r\n\t\t\t\tawait this.#executePrintTransactionReceiptStep(result);\r\n\r\n\t\t\t\tif (result.stepWarnMessage)\r\n\t\t\t\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__.KioskEventUtils.triggerTransactionEvent(\"failed\", \"transaction\", result.stepWarnMessage, result.data.transactionRef);\r\n\t\t\t\telse \r\n\t\t\t\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__.KioskEventUtils.triggerTransactionEvent(\"successful\", \"transaction\", \"Successful check-out\", result.data.transactionRef);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__.KioskEventUtils.triggerCheckoutStepEvent(_kiosk_model__WEBPACK_IMPORTED_MODULE_7__.KIOSK_CHECKOUT.COMPLETE);\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n    async mediaReissue(params) {\r\n        const result = {\r\n            retry: false,\r\n            data: {\r\n                paymentList: [],\r\n                totalTendered: 0,\r\n                transactionRef: null,\r\n                itemsToPrint: [],\r\n                printedMedia: [],\r\n                paymentInfoList: [{\r\n                    paymentResult: {},\r\n                    receiptDocTemplateId: null\r\n                }],\r\n            }\r\n        };\r\n        this.#params = JSON.parse(JSON.stringify(params));\r\n        this.#params.mainCurrency = this.#mainCurrency;\r\n        this.#params.rights = JSON.parse(JSON.stringify(this.#rights));\r\n        try {\r\n            await this.#callMediaReissue(result);\r\n            await this.#executePrintTicketStep(result);\r\n            await this.#activateMediaAndValidateOrder(result);\r\n        } catch (e) {\r\n            this.#logError(\"Media reissue failed with error: \", e)\r\n        } finally {\r\n            this.#notifyTransactionEnd();\r\n        }\r\n        return result;\r\n    }\r\n\r\n    #logError(errorMessage, error) {\r\n        SNP_LOGGER.error(null, null, error.stack);\r\n        SNP_LOGGER.error(null, null, errorMessage + error.message)\r\n    }\r\n\r\n    #callMediaReissue(result) {\r\n        _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__.KioskEventUtils.triggerTransactionEvent(\"working\", \"post-transaction\", \"Processing transaction\");\r\n\r\n        SNP_LOGGER.debug(null, null, \"Calling media reissue\");\r\n\r\n        let req = {\r\n            Sale: { \"SaleId\": this.#params.order.SaleId },\r\n            TransactionReason: 2,\r\n            ReturnPrintItems: true\r\n        }\r\n\r\n        return this.#snappAPI.cmd(\"TRANSACTION\", \"MediaReissue\", req)\r\n            .then(ans => {\r\n                result.data.transactionRef = this.#transactionRefFromAnswer(ans.TransactionRecap, ans.PrintItemList);\r\n                result.data.itemsToPrint = ans.itemsToPrint;\r\n            })\r\n            .catch(e => this.#failedAPICall(e))\r\n    }\r\n\r\n    #failedAPICall(error) {\r\n        error.stepFailure = \"Failed to process order\";\r\n        throw error;\r\n    }\r\n\r\n    async #executePaymentStep(result) {\r\n        let paymentResult = {};\r\n        let exception = {};\r\n        let paymentSuccess = false;\r\n        try {\r\n            paymentResult = await this.#stepPayment.execute(this.#params);\r\n\r\n            result.paymentInfoList.push({\r\n                paymentResult: paymentResult.paymentResult,\r\n                receiptDocTemplateId: paymentResult.receiptDocTemplateId\r\n            });\r\n            // result.paymentInfoList.paymentResult = paymentResult.paymentResult;\r\n            // result.paymentInfoList.receiptDocTemplateId = paymentResult.receiptDocTemplateId;\r\n            result.data.paymentList.push(...paymentResult.paymentList)\r\n            result.data.totalTendered = paymentResult.totalTendered;\r\n            result.retry = paymentResult.retry;\r\n\r\n            exception = paymentResult.exception;\r\n            paymentSuccess = paymentResult.success;\r\n        } catch (e) {\r\n            result.data.retry = false;\r\n            paymentSuccess = false;\r\n            exception = e;\r\n            SNP_LOGGER.error(null, null, \"Step payment failed with error: \" + e.message);\r\n            await this.#failedPaymentStep(e, result.data, result.retry);\r\n        }\r\n\r\n        if (!paymentSuccess) \r\n            await this.#failedPaymentStep(exception, result.data, result.retry);\r\n\r\n    }\r\n\r\n    async #failedPaymentStep(error, transactionData, retryPayment) {\r\n        if (transactionData.paymentList && (transactionData.paymentList.length > 0) && !retryPayment)\r\n            transactionData.transactionRef = await this.#postOrderAbort(transactionData);\r\n\r\n        if (!retryPayment)\r\n            error.stepFailure = \"Payment failed\";\r\n\r\n        SNP_LOGGER.error(null, null, \"Step payment failed with error: \" + error.message);\r\n\r\n        throw error;\r\n    }\r\n\r\n    async #printPaymentReceipt(receiptParams) {\r\n        SNP_LOGGER.debug(null, null, \"Printing payment receipt\");\r\n        const stepParams = {\r\n            ...this.#params,\r\n            ...receiptParams,\r\n        };\r\n        try {\r\n            await this.#stepPrintPaymentReceipt.execute(stepParams)\r\n        } catch (error) {\r\n            console.error(error); //A failure during the print of the receipt should not make the transaction to fail\r\n        }\r\n    }\r\n/*\r\n    async #executePrintTicketStep(result) {\r\n        let printedMedia = [];\r\n        \r\n        if (result.data.itemsToPrint && result.data.itemsToPrint.NotPrintableItemsCount)\r\n            await this.#failedPrintTicketStep(new Error(\"There are products not printable at this station\"), result.data, result.paymentInfoList);\r\n        \r\n        if (result.data.itemsToPrint && result.data.itemsToPrint.PrintItemList && (result.data.itemsToPrint.PrintItemList.length > 0)) {\r\n            try {\r\n                const printParams = {\r\n                    ...this.#params,\r\n                    itemsToPrint: {...result.data.itemsToPrint},\r\n                    transactionRef: {...result.data.transactionRef},\r\n                }\r\n\r\n                let printCompleted = false;\r\n                while (!printCompleted) {\r\n                    printParams.deliveryOption = await this.#executePrintOptionSelection();\r\n                    ({ printCompleted, printedMedia } = await this.#stepPrintTicket.execute(printParams));\r\n                }\r\n                result.printedMedia = printedMedia;\r\n            } catch (error) {\r\n                await this.#failedPrintTicketStep(error, result.data, result.paymentInfoList);\r\n            }\r\n        }\r\n        else {\r\n            SNP_LOGGER.debug(null, null, \"Print ticket not required\");\r\n        }\r\n    }\r\n*/\r\n    async #executePrintTicketStep(result) {\r\n        let printedMedia = [];\r\n        \r\n        if (this.#params.shopCartHasItemsToPrint) {\r\n            try {\r\n                const printParams = {\r\n                    ...this.#params,\r\n                    itemsToPrint: {...result.data.itemsToPrint},\r\n                    transactionRef: {...result.data.transactionRef},\r\n                    saleCompleted: this.#params.transactionType === 51,\r\n                }\r\n\r\n                let printCompleted = false;\r\n                let saleCompleted = false;\r\n                while (!printCompleted) {\r\n                    printParams.deliveryOption = await this.#executePrintOptionSelection();\r\n                    ({ printCompleted, printedMedia, saleCompleted } = await this.#stepPrintTicket.execute(printParams));\r\n                    printParams.saleCompleted = saleCompleted;\r\n                }\r\n                result.printedMedia = printedMedia;\r\n            } catch (error) {\r\n                await this.#failedPrintTicketStep(error, result.data, result.paymentInfoList);\r\n            }\r\n        }\r\n        else {\r\n            SNP_LOGGER.debug(null, null, \"Print ticket not required\");\r\n        }\r\n    }\r\n\r\n    async #failedPrintTicketStep(error, transactionData, paymentInfoList) {\r\n        error.stepFailure = \"Ticket print failed\";\r\n        SNP_LOGGER.error(null, null, \"Step print ticket failed with error: \" + error.message);\r\n\r\n        if (transactionData.paymentList && (transactionData.paymentList.length > 0)) {\r\n            await this.#voidLastPayment(transactionData, paymentInfoList);\r\n        }\r\n\r\n        throw error;\r\n    }\r\n\r\n    async #executeHandOverChangeStep(result) {\r\n        if (!this.#rights.RefundOverPayment) {\r\n            SNP_LOGGER.error(null, null, \"RefundOverPayment not allowed, please check rights\");\r\n            return Promise.resolve();\r\n        }\r\n\r\n        SNP_LOGGER.debug(null, null, \"Change hand over\");\r\n\r\n        const stepParams = {\r\n            ...this.#params,\r\n            totalTendered: result.data.totalTendered,\r\n            transactionRef: {...result.data.transactionRef}\r\n        };\r\n        return this.#stepChangeHandOver.execute(stepParams)\r\n            .catch(error => console.error(error)) //A failure during the change hand over should not make the transaction to fail\r\n    }\r\n\r\n    async #executePrintPaymentReceiptStep(result) {\r\n        for (let i = 0; i < result.paymentInfoList.length; i++) {\r\n            const paymentInfo = result.paymentInfoList[i];\r\n\r\n            SNP_LOGGER.debug(null, null, `Printing payment receipt ${i+1} of ${result.paymentInfoList.length}`);\r\n            \r\n            const receiptParams = {\r\n                receiptDocTemplateId: paymentInfo.receiptDocTemplateId,\r\n                deviceReceipts: paymentInfo.paymentResult.deviceReceipts,\r\n                salePayment: paymentInfo.paymentResult.salePayment,\r\n                transactionRef: {...result.data.transactionRef},\r\n            };\r\n            await this.#printPaymentReceipt(receiptParams);\r\n        }\r\n    }\r\n\r\n    async #executePrintTransactionReceiptStep(result) {\r\n        SNP_LOGGER.debug(null, null, \"Printing transaction receipt\");\r\n        const stepParams = {\r\n            ...this.#params,\r\n            transactionRef: {...result.data.transactionRef}\r\n        };\r\n        return this.#stepPrintReceipt.execute(stepParams)\r\n            .catch(error => console.error(error)) //A failure during the print of the receipt should not make the transaction to fail\r\n    }\r\n\r\n    async #voidLastPayment(transactionData, paymentInfoList) {\r\n        const voidParams = {\r\n            ...this.#params,\r\n            paymentList: [...transactionData.paymentList],\r\n        };\r\n        const voidResult = await this.#stepPayment.voidLastPayment(voidParams);\r\n        transactionData.paymentList.push(...voidResult.paymentList);\r\n        \r\n        paymentInfoList.push({\r\n            paymentResult: voidResult.paymentResult,\r\n            receiptDocTemplateId: voidResult.receiptDocTemplateId\r\n        });\r\n\r\n        if (transactionData.transactionRef) {\r\n            let lastPayment = transactionData.paymentList[transactionData.paymentList.length - 1];\r\n            const ans = await this.#voidTheOrder(lastPayment, transactionData);\r\n            if (ans) {\r\n                transactionData.transactionRef.transactionId = ans.transactionId;\r\n                transactionData.transactionRef.ticketCount = ans.ticketCount;\r\n            }\r\n        }\r\n    }\r\n\r\n    async #voidTheOrder(salePayment, transactionData) {\r\n        try {\r\n            return await this.#postOrderVoid(salePayment, transactionData);\r\n        } catch (e) {\r\n            return this.#failedToVoidTheOrder(e);\r\n        }\r\n    }\r\n\r\n    #failedToVoidTheOrder(error) {\r\n        error.stepFailure = \"Order void failed\";\r\n        SNP_LOGGER.error(null, null, \"Order void failed with error: \" + error.message);\r\n        throw error;\r\n    }\r\n\r\n    async #postOrderVoid(salePayment, transactionData) {\r\n        _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__.KioskEventUtils.triggerTransactionEvent(\"working\", \"post-transaction\", \"Voiding transaction\");\r\n        SNP_LOGGER.debug(null, null, \"Posting order void\");\r\n\r\n        let req = {\r\n            Approved: true,\r\n            Paid: true,\r\n            Printed: false,\r\n            TransactionType: 2,//systemSaleVoid\r\n            TransactionReason: 26, //SaleVoid_RefundAll_FullRefund\r\n            SaleId: transactionData.transactionRef.saleId,\r\n            PaymentList: []\r\n        }\r\n\r\n        if (salePayment)\r\n            req.PaymentList.push(salePayment);\r\n\r\n        const ans = await this.#snappAPI.postTransaction(req);\r\n        \r\n        return {transactionId: ans.TransactionId, ticketCount: 0}\r\n    }\r\n\r\n    #activateMediaAndValidateOrder(result) {\r\n        if (!result.data.transactionRef || (result.data.totalTendered < this.#params.totalDue) || !result.printedMedia || (result.printedMedia.length === 0)) {\r\n            SNP_LOGGER.debug(null, null, \"Media activation not required\");\r\n            return Promise.resolve();\r\n        }\r\n        else {\r\n            SNP_LOGGER.debug(null, null, \"Activating medias\");\r\n            _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__.KioskEventUtils.triggerTransactionEvent(\"working\", \"activating-media\", \"Activating media\", result.data.transactionRef);\r\n\r\n            let req = {\r\n                MediaPrintSuccessList: result.printedMedia,\r\n                Sale: {\r\n                    SaleId: result.data.transactionRef.saleId\r\n                }\r\n            }\r\n\r\n            return this.#snappAPI.cmd(\"TRANSACTION\", \"MediaPrintComplete\", req)\r\n                .then(rsp => {\r\n                    if (rsp.MediaReissued)\r\n                        result.stepWarnMessage = \"All printed tickets has been reissued\";\r\n                })\r\n                .catch(e => this.#failedAPICall(e));\r\n        }\r\n    }\r\n\r\n    async #executePostTransaction(result) {\r\n        try {\r\n            const { transactionRef, itemsToPrint } = await this.#postTransaction(result.data);\r\n            result.data.transactionRef = transactionRef;\r\n            result.data.itemsToPrint = itemsToPrint;\r\n        } catch (e) {\r\n            await this.#failedPostTransaction(e, result.data, result.paymentInfoList);\r\n        }\r\n    }\r\n\r\n    async #failedPostTransaction(error, transactionData, paymentInfoList) {\r\n        if (transactionData.paymentList && (transactionData.paymentList.length > 0))\r\n            await this.#voidLastPayment(transactionData, paymentInfoList);\r\n\r\n        error.stepFailure = \"Failed to process the order\";\r\n        SNP_LOGGER.error(null, null, \"PostTransaction failed with error: \" + error.message);\r\n        throw error;\r\n    }\r\n\r\n    async #postTransaction(transactionData) {\r\n        _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__.KioskEventUtils.triggerTransactionEvent(\"working\", \"post-transaction\", \"Processing transaction\");\r\n\r\n        SNP_LOGGER.debug(null, null, \"Processing transaction\");\r\n\r\n        let req = {\r\n            Approved: true,\r\n            ReturnPrintItems: !this.printAtHomeIsEnabled,\r\n            ShopCartId: this.#params.shopCartId\r\n        }\r\n        \r\n        if (transactionData.totalTendered >= this.#params.totalDue) \r\n            req.Paid = true;\r\n\r\n        if (!this.printAtHomeIsEnabled) {\r\n            SNP_LOGGER.debug(null, null, \"Tendered amount is enough\");\r\n            req.Printed = true;\r\n            req.GenerateMedia = true;\r\n            req.Validated = true;\r\n            req.ReturnPrintItemsPrintData = this.#params.printOptionSelection;\r\n        }\r\n\r\n        if (transactionData.paymentList)\r\n            req.PaymentList = transactionData.paymentList;\r\n\r\n        return new Promise((resolve, reject) => {\r\n            this.#snappAPI.cmd(\"TRANSACTION\", \"PostTransaction\", req)\r\n                .then(ans => {\r\n                    let transactionRef = this.#transactionRefFromAnswer(ans.PostTransactionRecap, ans.ItemsToPrint ? ans.ItemsToPrint.PrintItemList : null);\r\n                    let itemsToPrint = ans.ItemsToPrint;\r\n                    resolve({ transactionRef, itemsToPrint });\r\n                })\r\n                .catch(error => {\r\n                    reject(error);\r\n                });\r\n        });\r\n    }\r\n\r\n    #postOrderAbort(transactionData) {\r\n        _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__.KioskEventUtils.triggerTransactionEvent(\"working\", \"post-transaction\", \"Processing transaction\");\r\n\r\n        SNP_LOGGER.debug(null, null, \"Processing interrupted transaction\");\r\n\r\n        let req = {\r\n            ShopCartId: this.#params.shopCartId,\r\n            PaymentList: transactionData.paymentList\r\n        }\r\n\r\n        return new Promise((resolve, reject) => {\r\n            this.#snappAPI.cmd(\"SHOPCART\", \"AbortOrder\", req)\r\n                .then(ans => {\r\n                    const transactionRef = this.#transactionRefFromAnswer(ans.PostTransactionRecap, null);\r\n                    resolve(transactionRef);\r\n                })\r\n                .catch(error => {\r\n                    reject(error);\r\n                });\r\n        });\r\n    }\r\n\r\n    async #executePrintOptionSelection() {\r\n        if (!this.#params.printOptionSelection)\r\n            return Promise.resolve(_step_print_ticket__WEBPACK_IMPORTED_MODULE_1__.DELIVERY_OPTIONS.PRINT.code);\r\n        else {\r\n            return new Promise(resolve => {              \r\n                const enabledOptions = this.#params.rights.KSK_PrintMediaMethod.split(\",\");\r\n                let deliveryOptions = Object.values(_step_print_ticket__WEBPACK_IMPORTED_MODULE_1__.DELIVERY_OPTIONS)\r\n                    .filter(opt => enabledOptions.includes(opt.value.toString()))\r\n                    .map(opt => opt.code);\r\n\r\n                if (!this.printAtHomeIsEnabled) {\r\n                    deliveryOptions = deliveryOptions.filter(opt => opt !== _step_print_ticket__WEBPACK_IMPORTED_MODULE_1__.DELIVERY_OPTIONS.PRINT_AT_HOME.code);\r\n                    SNP_LOGGER.warn(null, null, `${_step_print_ticket__WEBPACK_IMPORTED_MODULE_1__.DELIVERY_OPTIONS.PRINT_AT_HOME.code} not enabled because Order Confirmation TemplateId is missing`);\r\n                }\r\n                let extraProperties = {\r\n                    deliveryOptions: deliveryOptions,\r\n                    deliveryOptionCallback: deliveryOption => resolve(deliveryOption),\r\n                    /* 03/10/2024 - @deprecated */ printOptionCallback: printPluginFilter => { printPluginFilter ? resolve(_step_print_ticket__WEBPACK_IMPORTED_MODULE_1__.DELIVERY_OPTIONS.GO_GREEN.code) : resolve(_step_print_ticket__WEBPACK_IMPORTED_MODULE_1__.DELIVERY_OPTIONS.PRINT.code) }\r\n                };\r\n\r\n                _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__.KioskEventUtils.triggerTransactionEvent(\"working\", \"print-option\", \"Waiting print option\", null, extraProperties);\r\n            });\r\n        }\r\n    }\r\n\r\n    #transactionRefFromAnswer(transactionRecap, printItemList) {\r\n        return {\r\n            saleId: transactionRecap.SaleId,\r\n            saleCode: transactionRecap.SaleCode,\r\n            transactionId: transactionRecap.TransactionId,\r\n            ticketCount: printItemList ? printItemList.length : 0\r\n        };\r\n    }\r\n\r\n    #notifyTransactionEnd() {\r\n        if (this.#params.stepFailure)\r\n            _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__.KioskEventUtils.triggerTransactionEvent(\"failed\", \"transaction\", this.#params.stepFailure, this.#params.transactionRef);\r\n        else\r\n            _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_5__.KioskEventUtils.triggerTransactionEvent(\"successful\", \"transaction\", \"Successful check-out\", this.#params.transactionRef);\r\n    }\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L3N0ZXBzL2NoZWNrb3V0LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUE2QztBQUMyQjtBQUNoQjtBQUNjO0FBQ1Y7QUFDTDtBQUN3QjtBQUMvQjtBQUNoRDtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQix1RkFBdUI7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0Msc0RBQVc7QUFDM0Msb0NBQW9DLCtEQUFlO0FBQ25ELDRDQUE0QywrRUFBc0I7QUFDbEUsdUNBQXVDLHFFQUFrQjtBQUN6RCxxQ0FBcUMsaUVBQWdCO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxLQUFLO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSywrREFBZTtBQUNwQjtBQUNBLEtBQUssK0RBQWU7QUFDcEI7QUFDQTtBQUNBLEdBQUcsK0RBQWUsMEJBQTBCLHdEQUFjO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLCtEQUFlO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHFDQUFxQztBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Ysa0NBQWtDO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLDRCQUE0QjtBQUMvRCxxQ0FBcUMsOEJBQThCO0FBQ25FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsK0JBQStCO0FBQ3REO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLDRCQUE0QjtBQUMvRCxxQ0FBcUMsOEJBQThCO0FBQ25FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLDhDQUE4QztBQUNyRTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixtQ0FBbUM7QUFDM0Q7QUFDQTtBQUNBLHFFQUFxRSxLQUFLLEtBQUssOEJBQThCO0FBQzdHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsOEJBQThCO0FBQy9EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLCtEQUFlO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSwrREFBZTtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLCtCQUErQjtBQUNuRDtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLCtEQUFlO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLDhCQUE4QjtBQUM1RCxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSwrREFBZTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxnRUFBZ0I7QUFDbkQ7QUFDQTtBQUNBO0FBQ0Esb0RBQW9ELGdFQUFnQjtBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRFQUE0RSxnRUFBZ0I7QUFDNUYsbURBQW1ELGdFQUFnQixxQkFBcUI7QUFDeEY7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrRkFBK0YsNEJBQTRCLGdFQUFnQiwwQkFBMEIsZ0VBQWdCO0FBQ3JMO0FBQ0E7QUFDQSxnQkFBZ0IsK0RBQWU7QUFDL0IsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLCtEQUFlO0FBQzNCO0FBQ0EsWUFBWSwrREFBZTtBQUMzQjtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8va2lvc2stY29udHJvbGxlci8uLi9zY3JpcHQvc3RlcHMvY2hlY2tvdXQuanM/Y2U3MyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTdGVwUGF5bWVudCB9IGZyb20gJy4vc3RlcC1wYXltZW50JztcclxuaW1wb3J0IHsgU3RlcFByaW50VGlja2V0LCBERUxJVkVSWV9PUFRJT05TIH0gZnJvbSAnLi9zdGVwLXByaW50LXRpY2tldCc7XHJcbmltcG9ydCB7IFN0ZXBQcmludFJlY2VpcHQgfSBmcm9tICcuL3N0ZXAtcHJpbnQtcmVjZWlwdCc7XHJcbmltcG9ydCB7IFN0ZXBQcmludFRpY2tldFJlY2VpcHQgfSBmcm9tICcuL3N0ZXAtcHJpbnQtcGF5bWVudC1yZWNlaXB0JztcclxuaW1wb3J0IHsgU3RlcENoYW5nZUhhbmRPdmVyIH0gZnJvbSAnLi9zdGVwLWNoYW5nZS1oYW5kb3Zlcic7XHJcbmltcG9ydCB7IEtpb3NrRXZlbnRVdGlscyB9IGZyb20gJy4uL2tpb3NrLWV2ZW50LXV0aWxzJztcclxuaW1wb3J0IHsgUGF5bWVudFByb2Nlc3NvckZhY3RvcnkgfSBmcm9tIFwiLi4vcGF5bWVudC9wYXltZW50LXByb2Nlc3Nvci1mYWN0b3J5XCI7XHJcbmltcG9ydCB7IEtJT1NLX0NIRUNLT1VUIH0gZnJvbSBcIi4uL2tpb3NrLW1vZGVsXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgQ2hlY2tvdXQge1xyXG4gICAgI3BhcmFtcztcclxuICAgICNyaWdodHM7XHJcbiAgICAjc25hcHBBUEk7XHJcbiAgICAjc3RlcFBheW1lbnQ7XHJcbiAgICAjc3RlcFByaW50UGF5bWVudFJlY2VpcHQ7XHJcbiAgICAjc3RlcFByaW50VGlja2V0O1xyXG4gICAgI3N0ZXBDaGFuZ2VIYW5kT3ZlcjtcclxuICAgICNzdGVwUHJpbnRSZWNlaXB0O1xyXG4gICAgI3BheW1lbnRGYWN0b3J5ID0gbmV3IFBheW1lbnRQcm9jZXNzb3JGYWN0b3J5KCk7XHJcbiAgICAjbWFpbkN1cnJlbmN5O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHNuYXBwQVBJKSB7XHJcbiAgICAgICAgdGhpcy4jc25hcHBBUEkgPSBzbmFwcEFQSTtcclxuICAgICAgICB0aGlzLiNzdGVwUGF5bWVudCA9IG5ldyBTdGVwUGF5bWVudChzbmFwcEFQSSwgdGhpcy4jcGF5bWVudEZhY3RvcnkpO1xyXG4gICAgICAgIHRoaXMuI3N0ZXBQcmludFRpY2tldCA9IG5ldyBTdGVwUHJpbnRUaWNrZXQoc25hcHBBUEkpO1xyXG4gICAgICAgIHRoaXMuI3N0ZXBQcmludFBheW1lbnRSZWNlaXB0ID0gbmV3IFN0ZXBQcmludFRpY2tldFJlY2VpcHQoc25hcHBBUEkpO1xyXG4gICAgICAgIHRoaXMuI3N0ZXBDaGFuZ2VIYW5kT3ZlciA9IG5ldyBTdGVwQ2hhbmdlSGFuZE92ZXIoc25hcHBBUEksIHRoaXMuI3BheW1lbnRGYWN0b3J5KTtcclxuICAgICAgICB0aGlzLiNzdGVwUHJpbnRSZWNlaXB0ID0gbmV3IFN0ZXBQcmludFJlY2VpcHQoc25hcHBBUEkpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBwcmludEF0SG9tZUlzRW5hYmxlZCgpIHtcclxuICAgICAgICByZXR1cm4gISF0aGlzLiNyaWdodHMuS1NLX09yZGVyQ29uZmlybWF0aW9uRG9jVGVtcGxhdGVJZDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSB7YW55fSByaWdodHNcclxuICAgICAqL1xyXG4gICAgc2V0IHJpZ2h0cyhyaWdodHMpIHtcclxuICAgICAgICB0aGlzLiNyaWdodHMgPSByaWdodHM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbWFpbkN1cnJlbmN5XHJcbiAgICAgKi9cclxuICAgIHNldCBtYWluQ3VycmVuY3kobWFpbkN1cnJlbmN5KSB7XHJcbiAgICAgICAgdGhpcy4jbWFpbkN1cnJlbmN5ID0gbWFpbkN1cnJlbmN5O1xyXG4gICAgfVxyXG5cclxuICAgIHNldEVuYWJsZWRQYXltZW50TWV0aG9kcyhlbmFibGVkUGF5bWVudE1ldGhvZHMpIHtcclxuICAgICAgICB0aGlzLiNzdGVwUGF5bWVudC5zZXRFbmFibGVkUGF5bWVudE1ldGhvZHMoZW5hYmxlZFBheW1lbnRNZXRob2RzKTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBzaG9wQ2FydENoZWNrb3V0KHBhcmFtcywgY3VycmVudFRyYW5zYWN0aW9uKSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0ge1xyXG4gICAgICAgICAgICByZXRyeTogZmFsc2UsXHJcbiAgICAgICAgICAgIHN0ZXBXYXJuTWVzc2FnZTogXCJcIixcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgcGF5bWVudExpc3Q6IFtdLFxyXG4gICAgICAgICAgICAgICAgdG90YWxUZW5kZXJlZDogMCxcclxuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uUmVmOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgaXRlbXNUb1ByaW50OiBbXSxcclxuICAgICAgICAgICAgICAgIHByaW50ZWRNZWRpYTogW10sXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHBheW1lbnRJbmZvTGlzdDogW1xyXG4gICAgICAgICAgICAgICAgLy8ge1xyXG4gICAgICAgICAgICAgICAgLy8gIHBheW1lbnRSZXN1bHQ6IHt9LFxyXG4gICAgICAgICAgICAgICAgLy8gIHJlY2VpcHREb2NUZW1wbGF0ZUlkOiBudWxsXHJcbiAgICAgICAgICAgICAgICAvLyB9LFxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbihyZXN1bHQuZGF0YSwgY3VycmVudFRyYW5zYWN0aW9uKTtcclxuXHJcblx0XHR0aGlzLiNwYXJhbXMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHBhcmFtcykpO1xyXG5cdFx0dGhpcy4jcGFyYW1zLm1haW5DdXJyZW5jeSA9IHRoaXMuI21haW5DdXJyZW5jeTtcclxuXHRcdHRoaXMuI3BhcmFtcy5yaWdodHMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuI3JpZ2h0cykpO1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0YXdhaXQgdGhpcy4jZXhlY3V0ZVBheW1lbnRTdGVwKHJlc3VsdCk7XHJcblx0XHRcdGF3YWl0IHRoaXMuI2V4ZWN1dGVQb3N0VHJhbnNhY3Rpb24ocmVzdWx0KTtcclxuXHRcdFx0YXdhaXQgdGhpcy4jZXhlY3V0ZVByaW50VGlja2V0U3RlcChyZXN1bHQpO1xyXG5cdFx0XHRhd2FpdCB0aGlzLiNhY3RpdmF0ZU1lZGlhQW5kVmFsaWRhdGVPcmRlcihyZXN1bHQpO1xyXG5cdFx0XHRhd2FpdCB0aGlzLiNleGVjdXRlSGFuZE92ZXJDaGFuZ2VTdGVwKHJlc3VsdCk7XHJcblx0XHR9IGNhdGNoIChlKSB7XHJcblx0XHRcdHRoaXMuI2xvZ0Vycm9yKFwiQ2hlY2tvdXQgZmFpbGVkIHdpdGggZXJyb3I6IFwiLCBlKVxyXG5cdFx0XHRyZXN1bHQuc3RlcFdhcm5NZXNzYWdlID0gZS5zdGVwRmFpbHVyZTtcclxuXHRcdFx0Ly8gS2lvc2tFdmVudFV0aWxzLnRyaWdnZXJUcmFuc2FjdGlvbkV2ZW50KFwiZmFpbGVkXCIsIFwidHJhbnNhY3Rpb25cIiwgZS5zdGVwRmFpbHVyZSB8fCBcIlwiLCByZXN1bHQuZGF0YS50cmFuc2FjdGlvblJlZik7XHJcblx0XHR9IGZpbmFsbHkge1xyXG5cdFx0XHRhd2FpdCB0aGlzLiNleGVjdXRlUHJpbnRQYXltZW50UmVjZWlwdFN0ZXAocmVzdWx0KTtcclxuXHRcdFx0aWYgKCFyZXN1bHQucmV0cnkpIHtcclxuXHRcdFx0XHRhd2FpdCB0aGlzLiNleGVjdXRlUHJpbnRUcmFuc2FjdGlvblJlY2VpcHRTdGVwKHJlc3VsdCk7XHJcblxyXG5cdFx0XHRcdGlmIChyZXN1bHQuc3RlcFdhcm5NZXNzYWdlKVxyXG5cdFx0XHRcdFx0S2lvc2tFdmVudFV0aWxzLnRyaWdnZXJUcmFuc2FjdGlvbkV2ZW50KFwiZmFpbGVkXCIsIFwidHJhbnNhY3Rpb25cIiwgcmVzdWx0LnN0ZXBXYXJuTWVzc2FnZSwgcmVzdWx0LmRhdGEudHJhbnNhY3Rpb25SZWYpO1xyXG5cdFx0XHRcdGVsc2UgXHJcblx0XHRcdFx0XHRLaW9za0V2ZW50VXRpbHMudHJpZ2dlclRyYW5zYWN0aW9uRXZlbnQoXCJzdWNjZXNzZnVsXCIsIFwidHJhbnNhY3Rpb25cIiwgXCJTdWNjZXNzZnVsIGNoZWNrLW91dFwiLCByZXN1bHQuZGF0YS50cmFuc2FjdGlvblJlZik7XHJcblx0XHRcdH1cclxuXHRcdFx0XHJcblx0XHRcdEtpb3NrRXZlbnRVdGlscy50cmlnZ2VyQ2hlY2tvdXRTdGVwRXZlbnQoS0lPU0tfQ0hFQ0tPVVQuQ09NUExFVEUpO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHJlc3VsdDtcclxuXHR9XHJcblxyXG4gICAgYXN5bmMgbWVkaWFSZWlzc3VlKHBhcmFtcykge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHtcclxuICAgICAgICAgICAgcmV0cnk6IGZhbHNlLFxyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBwYXltZW50TGlzdDogW10sXHJcbiAgICAgICAgICAgICAgICB0b3RhbFRlbmRlcmVkOiAwLFxyXG4gICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25SZWY6IG51bGwsXHJcbiAgICAgICAgICAgICAgICBpdGVtc1RvUHJpbnQ6IFtdLFxyXG4gICAgICAgICAgICAgICAgcHJpbnRlZE1lZGlhOiBbXSxcclxuICAgICAgICAgICAgICAgIHBheW1lbnRJbmZvTGlzdDogW3tcclxuICAgICAgICAgICAgICAgICAgICBwYXltZW50UmVzdWx0OiB7fSxcclxuICAgICAgICAgICAgICAgICAgICByZWNlaXB0RG9jVGVtcGxhdGVJZDogbnVsbFxyXG4gICAgICAgICAgICAgICAgfV0sXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuI3BhcmFtcyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocGFyYW1zKSk7XHJcbiAgICAgICAgdGhpcy4jcGFyYW1zLm1haW5DdXJyZW5jeSA9IHRoaXMuI21haW5DdXJyZW5jeTtcclxuICAgICAgICB0aGlzLiNwYXJhbXMucmlnaHRzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLiNyaWdodHMpKTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLiNjYWxsTWVkaWFSZWlzc3VlKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuI2V4ZWN1dGVQcmludFRpY2tldFN0ZXAocmVzdWx0KTtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy4jYWN0aXZhdGVNZWRpYUFuZFZhbGlkYXRlT3JkZXIocmVzdWx0KTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuI2xvZ0Vycm9yKFwiTWVkaWEgcmVpc3N1ZSBmYWlsZWQgd2l0aCBlcnJvcjogXCIsIGUpXHJcbiAgICAgICAgfSBmaW5hbGx5IHtcclxuICAgICAgICAgICAgdGhpcy4jbm90aWZ5VHJhbnNhY3Rpb25FbmQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICAjbG9nRXJyb3IoZXJyb3JNZXNzYWdlLCBlcnJvcikge1xyXG4gICAgICAgIFNOUF9MT0dHRVIuZXJyb3IobnVsbCwgbnVsbCwgZXJyb3Iuc3RhY2spO1xyXG4gICAgICAgIFNOUF9MT0dHRVIuZXJyb3IobnVsbCwgbnVsbCwgZXJyb3JNZXNzYWdlICsgZXJyb3IubWVzc2FnZSlcclxuICAgIH1cclxuXHJcbiAgICAjY2FsbE1lZGlhUmVpc3N1ZShyZXN1bHQpIHtcclxuICAgICAgICBLaW9za0V2ZW50VXRpbHMudHJpZ2dlclRyYW5zYWN0aW9uRXZlbnQoXCJ3b3JraW5nXCIsIFwicG9zdC10cmFuc2FjdGlvblwiLCBcIlByb2Nlc3NpbmcgdHJhbnNhY3Rpb25cIik7XHJcblxyXG4gICAgICAgIFNOUF9MT0dHRVIuZGVidWcobnVsbCwgbnVsbCwgXCJDYWxsaW5nIG1lZGlhIHJlaXNzdWVcIik7XHJcblxyXG4gICAgICAgIGxldCByZXEgPSB7XHJcbiAgICAgICAgICAgIFNhbGU6IHsgXCJTYWxlSWRcIjogdGhpcy4jcGFyYW1zLm9yZGVyLlNhbGVJZCB9LFxyXG4gICAgICAgICAgICBUcmFuc2FjdGlvblJlYXNvbjogMixcclxuICAgICAgICAgICAgUmV0dXJuUHJpbnRJdGVtczogdHJ1ZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuI3NuYXBwQVBJLmNtZChcIlRSQU5TQUNUSU9OXCIsIFwiTWVkaWFSZWlzc3VlXCIsIHJlcSlcclxuICAgICAgICAgICAgLnRoZW4oYW5zID0+IHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5kYXRhLnRyYW5zYWN0aW9uUmVmID0gdGhpcy4jdHJhbnNhY3Rpb25SZWZGcm9tQW5zd2VyKGFucy5UcmFuc2FjdGlvblJlY2FwLCBhbnMuUHJpbnRJdGVtTGlzdCk7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuZGF0YS5pdGVtc1RvUHJpbnQgPSBhbnMuaXRlbXNUb1ByaW50O1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goZSA9PiB0aGlzLiNmYWlsZWRBUElDYWxsKGUpKVxyXG4gICAgfVxyXG5cclxuICAgICNmYWlsZWRBUElDYWxsKGVycm9yKSB7XHJcbiAgICAgICAgZXJyb3Iuc3RlcEZhaWx1cmUgPSBcIkZhaWxlZCB0byBwcm9jZXNzIG9yZGVyXCI7XHJcbiAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgI2V4ZWN1dGVQYXltZW50U3RlcChyZXN1bHQpIHtcclxuICAgICAgICBsZXQgcGF5bWVudFJlc3VsdCA9IHt9O1xyXG4gICAgICAgIGxldCBleGNlcHRpb24gPSB7fTtcclxuICAgICAgICBsZXQgcGF5bWVudFN1Y2Nlc3MgPSBmYWxzZTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBwYXltZW50UmVzdWx0ID0gYXdhaXQgdGhpcy4jc3RlcFBheW1lbnQuZXhlY3V0ZSh0aGlzLiNwYXJhbXMpO1xyXG5cclxuICAgICAgICAgICAgcmVzdWx0LnBheW1lbnRJbmZvTGlzdC5wdXNoKHtcclxuICAgICAgICAgICAgICAgIHBheW1lbnRSZXN1bHQ6IHBheW1lbnRSZXN1bHQucGF5bWVudFJlc3VsdCxcclxuICAgICAgICAgICAgICAgIHJlY2VpcHREb2NUZW1wbGF0ZUlkOiBwYXltZW50UmVzdWx0LnJlY2VpcHREb2NUZW1wbGF0ZUlkXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvLyByZXN1bHQucGF5bWVudEluZm9MaXN0LnBheW1lbnRSZXN1bHQgPSBwYXltZW50UmVzdWx0LnBheW1lbnRSZXN1bHQ7XHJcbiAgICAgICAgICAgIC8vIHJlc3VsdC5wYXltZW50SW5mb0xpc3QucmVjZWlwdERvY1RlbXBsYXRlSWQgPSBwYXltZW50UmVzdWx0LnJlY2VpcHREb2NUZW1wbGF0ZUlkO1xyXG4gICAgICAgICAgICByZXN1bHQuZGF0YS5wYXltZW50TGlzdC5wdXNoKC4uLnBheW1lbnRSZXN1bHQucGF5bWVudExpc3QpXHJcbiAgICAgICAgICAgIHJlc3VsdC5kYXRhLnRvdGFsVGVuZGVyZWQgPSBwYXltZW50UmVzdWx0LnRvdGFsVGVuZGVyZWQ7XHJcbiAgICAgICAgICAgIHJlc3VsdC5yZXRyeSA9IHBheW1lbnRSZXN1bHQucmV0cnk7XHJcblxyXG4gICAgICAgICAgICBleGNlcHRpb24gPSBwYXltZW50UmVzdWx0LmV4Y2VwdGlvbjtcclxuICAgICAgICAgICAgcGF5bWVudFN1Y2Nlc3MgPSBwYXltZW50UmVzdWx0LnN1Y2Nlc3M7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICByZXN1bHQuZGF0YS5yZXRyeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBwYXltZW50U3VjY2VzcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBleGNlcHRpb24gPSBlO1xyXG4gICAgICAgICAgICBTTlBfTE9HR0VSLmVycm9yKG51bGwsIG51bGwsIFwiU3RlcCBwYXltZW50IGZhaWxlZCB3aXRoIGVycm9yOiBcIiArIGUubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuI2ZhaWxlZFBheW1lbnRTdGVwKGUsIHJlc3VsdC5kYXRhLCByZXN1bHQucmV0cnkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFwYXltZW50U3VjY2VzcykgXHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuI2ZhaWxlZFBheW1lbnRTdGVwKGV4Y2VwdGlvbiwgcmVzdWx0LmRhdGEsIHJlc3VsdC5yZXRyeSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jICNmYWlsZWRQYXltZW50U3RlcChlcnJvciwgdHJhbnNhY3Rpb25EYXRhLCByZXRyeVBheW1lbnQpIHtcclxuICAgICAgICBpZiAodHJhbnNhY3Rpb25EYXRhLnBheW1lbnRMaXN0ICYmICh0cmFuc2FjdGlvbkRhdGEucGF5bWVudExpc3QubGVuZ3RoID4gMCkgJiYgIXJldHJ5UGF5bWVudClcclxuICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRhLnRyYW5zYWN0aW9uUmVmID0gYXdhaXQgdGhpcy4jcG9zdE9yZGVyQWJvcnQodHJhbnNhY3Rpb25EYXRhKTtcclxuXHJcbiAgICAgICAgaWYgKCFyZXRyeVBheW1lbnQpXHJcbiAgICAgICAgICAgIGVycm9yLnN0ZXBGYWlsdXJlID0gXCJQYXltZW50IGZhaWxlZFwiO1xyXG5cclxuICAgICAgICBTTlBfTE9HR0VSLmVycm9yKG51bGwsIG51bGwsIFwiU3RlcCBwYXltZW50IGZhaWxlZCB3aXRoIGVycm9yOiBcIiArIGVycm9yLm1lc3NhZ2UpO1xyXG5cclxuICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyAjcHJpbnRQYXltZW50UmVjZWlwdChyZWNlaXB0UGFyYW1zKSB7XHJcbiAgICAgICAgU05QX0xPR0dFUi5kZWJ1ZyhudWxsLCBudWxsLCBcIlByaW50aW5nIHBheW1lbnQgcmVjZWlwdFwiKTtcclxuICAgICAgICBjb25zdCBzdGVwUGFyYW1zID0ge1xyXG4gICAgICAgICAgICAuLi50aGlzLiNwYXJhbXMsXHJcbiAgICAgICAgICAgIC4uLnJlY2VpcHRQYXJhbXMsXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLiNzdGVwUHJpbnRQYXltZW50UmVjZWlwdC5leGVjdXRlKHN0ZXBQYXJhbXMpXHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7IC8vQSBmYWlsdXJlIGR1cmluZyB0aGUgcHJpbnQgb2YgdGhlIHJlY2VpcHQgc2hvdWxkIG5vdCBtYWtlIHRoZSB0cmFuc2FjdGlvbiB0byBmYWlsXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4vKlxyXG4gICAgYXN5bmMgI2V4ZWN1dGVQcmludFRpY2tldFN0ZXAocmVzdWx0KSB7XHJcbiAgICAgICAgbGV0IHByaW50ZWRNZWRpYSA9IFtdO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChyZXN1bHQuZGF0YS5pdGVtc1RvUHJpbnQgJiYgcmVzdWx0LmRhdGEuaXRlbXNUb1ByaW50Lk5vdFByaW50YWJsZUl0ZW1zQ291bnQpXHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuI2ZhaWxlZFByaW50VGlja2V0U3RlcChuZXcgRXJyb3IoXCJUaGVyZSBhcmUgcHJvZHVjdHMgbm90IHByaW50YWJsZSBhdCB0aGlzIHN0YXRpb25cIiksIHJlc3VsdC5kYXRhLCByZXN1bHQucGF5bWVudEluZm9MaXN0KTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAocmVzdWx0LmRhdGEuaXRlbXNUb1ByaW50ICYmIHJlc3VsdC5kYXRhLml0ZW1zVG9QcmludC5QcmludEl0ZW1MaXN0ICYmIChyZXN1bHQuZGF0YS5pdGVtc1RvUHJpbnQuUHJpbnRJdGVtTGlzdC5sZW5ndGggPiAwKSkge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcHJpbnRQYXJhbXMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLi4udGhpcy4jcGFyYW1zLFxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zVG9QcmludDogey4uLnJlc3VsdC5kYXRhLml0ZW1zVG9QcmludH0sXHJcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25SZWY6IHsuLi5yZXN1bHQuZGF0YS50cmFuc2FjdGlvblJlZn0sXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHByaW50Q29tcGxldGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoIXByaW50Q29tcGxldGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJpbnRQYXJhbXMuZGVsaXZlcnlPcHRpb24gPSBhd2FpdCB0aGlzLiNleGVjdXRlUHJpbnRPcHRpb25TZWxlY3Rpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICAoeyBwcmludENvbXBsZXRlZCwgcHJpbnRlZE1lZGlhIH0gPSBhd2FpdCB0aGlzLiNzdGVwUHJpbnRUaWNrZXQuZXhlY3V0ZShwcmludFBhcmFtcykpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnByaW50ZWRNZWRpYSA9IHByaW50ZWRNZWRpYTtcclxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuI2ZhaWxlZFByaW50VGlja2V0U3RlcChlcnJvciwgcmVzdWx0LmRhdGEsIHJlc3VsdC5wYXltZW50SW5mb0xpc3QpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBTTlBfTE9HR0VSLmRlYnVnKG51bGwsIG51bGwsIFwiUHJpbnQgdGlja2V0IG5vdCByZXF1aXJlZFwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiovXHJcbiAgICBhc3luYyAjZXhlY3V0ZVByaW50VGlja2V0U3RlcChyZXN1bHQpIHtcclxuICAgICAgICBsZXQgcHJpbnRlZE1lZGlhID0gW107XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKHRoaXMuI3BhcmFtcy5zaG9wQ2FydEhhc0l0ZW1zVG9QcmludCkge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcHJpbnRQYXJhbXMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLi4udGhpcy4jcGFyYW1zLFxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zVG9QcmludDogey4uLnJlc3VsdC5kYXRhLml0ZW1zVG9QcmludH0sXHJcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25SZWY6IHsuLi5yZXN1bHQuZGF0YS50cmFuc2FjdGlvblJlZn0sXHJcbiAgICAgICAgICAgICAgICAgICAgc2FsZUNvbXBsZXRlZDogdGhpcy4jcGFyYW1zLnRyYW5zYWN0aW9uVHlwZSA9PT0gNTEsXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHByaW50Q29tcGxldGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBsZXQgc2FsZUNvbXBsZXRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKCFwcmludENvbXBsZXRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHByaW50UGFyYW1zLmRlbGl2ZXJ5T3B0aW9uID0gYXdhaXQgdGhpcy4jZXhlY3V0ZVByaW50T3B0aW9uU2VsZWN0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgKHsgcHJpbnRDb21wbGV0ZWQsIHByaW50ZWRNZWRpYSwgc2FsZUNvbXBsZXRlZCB9ID0gYXdhaXQgdGhpcy4jc3RlcFByaW50VGlja2V0LmV4ZWN1dGUocHJpbnRQYXJhbXMpKTtcclxuICAgICAgICAgICAgICAgICAgICBwcmludFBhcmFtcy5zYWxlQ29tcGxldGVkID0gc2FsZUNvbXBsZXRlZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wcmludGVkTWVkaWEgPSBwcmludGVkTWVkaWE7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLiNmYWlsZWRQcmludFRpY2tldFN0ZXAoZXJyb3IsIHJlc3VsdC5kYXRhLCByZXN1bHQucGF5bWVudEluZm9MaXN0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgU05QX0xPR0dFUi5kZWJ1ZyhudWxsLCBudWxsLCBcIlByaW50IHRpY2tldCBub3QgcmVxdWlyZWRcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jICNmYWlsZWRQcmludFRpY2tldFN0ZXAoZXJyb3IsIHRyYW5zYWN0aW9uRGF0YSwgcGF5bWVudEluZm9MaXN0KSB7XHJcbiAgICAgICAgZXJyb3Iuc3RlcEZhaWx1cmUgPSBcIlRpY2tldCBwcmludCBmYWlsZWRcIjtcclxuICAgICAgICBTTlBfTE9HR0VSLmVycm9yKG51bGwsIG51bGwsIFwiU3RlcCBwcmludCB0aWNrZXQgZmFpbGVkIHdpdGggZXJyb3I6IFwiICsgZXJyb3IubWVzc2FnZSk7XHJcblxyXG4gICAgICAgIGlmICh0cmFuc2FjdGlvbkRhdGEucGF5bWVudExpc3QgJiYgKHRyYW5zYWN0aW9uRGF0YS5wYXltZW50TGlzdC5sZW5ndGggPiAwKSkge1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLiN2b2lkTGFzdFBheW1lbnQodHJhbnNhY3Rpb25EYXRhLCBwYXltZW50SW5mb0xpc3QpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgI2V4ZWN1dGVIYW5kT3ZlckNoYW5nZVN0ZXAocmVzdWx0KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLiNyaWdodHMuUmVmdW5kT3ZlclBheW1lbnQpIHtcclxuICAgICAgICAgICAgU05QX0xPR0dFUi5lcnJvcihudWxsLCBudWxsLCBcIlJlZnVuZE92ZXJQYXltZW50IG5vdCBhbGxvd2VkLCBwbGVhc2UgY2hlY2sgcmlnaHRzXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBTTlBfTE9HR0VSLmRlYnVnKG51bGwsIG51bGwsIFwiQ2hhbmdlIGhhbmQgb3ZlclwiKTtcclxuXHJcbiAgICAgICAgY29uc3Qgc3RlcFBhcmFtcyA9IHtcclxuICAgICAgICAgICAgLi4udGhpcy4jcGFyYW1zLFxyXG4gICAgICAgICAgICB0b3RhbFRlbmRlcmVkOiByZXN1bHQuZGF0YS50b3RhbFRlbmRlcmVkLFxyXG4gICAgICAgICAgICB0cmFuc2FjdGlvblJlZjogey4uLnJlc3VsdC5kYXRhLnRyYW5zYWN0aW9uUmVmfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuI3N0ZXBDaGFuZ2VIYW5kT3Zlci5leGVjdXRlKHN0ZXBQYXJhbXMpXHJcbiAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmVycm9yKGVycm9yKSkgLy9BIGZhaWx1cmUgZHVyaW5nIHRoZSBjaGFuZ2UgaGFuZCBvdmVyIHNob3VsZCBub3QgbWFrZSB0aGUgdHJhbnNhY3Rpb24gdG8gZmFpbFxyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jICNleGVjdXRlUHJpbnRQYXltZW50UmVjZWlwdFN0ZXAocmVzdWx0KSB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXN1bHQucGF5bWVudEluZm9MaXN0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBheW1lbnRJbmZvID0gcmVzdWx0LnBheW1lbnRJbmZvTGlzdFtpXTtcclxuXHJcbiAgICAgICAgICAgIFNOUF9MT0dHRVIuZGVidWcobnVsbCwgbnVsbCwgYFByaW50aW5nIHBheW1lbnQgcmVjZWlwdCAke2krMX0gb2YgJHtyZXN1bHQucGF5bWVudEluZm9MaXN0Lmxlbmd0aH1gKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlY2VpcHRQYXJhbXMgPSB7XHJcbiAgICAgICAgICAgICAgICByZWNlaXB0RG9jVGVtcGxhdGVJZDogcGF5bWVudEluZm8ucmVjZWlwdERvY1RlbXBsYXRlSWQsXHJcbiAgICAgICAgICAgICAgICBkZXZpY2VSZWNlaXB0czogcGF5bWVudEluZm8ucGF5bWVudFJlc3VsdC5kZXZpY2VSZWNlaXB0cyxcclxuICAgICAgICAgICAgICAgIHNhbGVQYXltZW50OiBwYXltZW50SW5mby5wYXltZW50UmVzdWx0LnNhbGVQYXltZW50LFxyXG4gICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25SZWY6IHsuLi5yZXN1bHQuZGF0YS50cmFuc2FjdGlvblJlZn0sXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuI3ByaW50UGF5bWVudFJlY2VpcHQocmVjZWlwdFBhcmFtcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jICNleGVjdXRlUHJpbnRUcmFuc2FjdGlvblJlY2VpcHRTdGVwKHJlc3VsdCkge1xyXG4gICAgICAgIFNOUF9MT0dHRVIuZGVidWcobnVsbCwgbnVsbCwgXCJQcmludGluZyB0cmFuc2FjdGlvbiByZWNlaXB0XCIpO1xyXG4gICAgICAgIGNvbnN0IHN0ZXBQYXJhbXMgPSB7XHJcbiAgICAgICAgICAgIC4uLnRoaXMuI3BhcmFtcyxcclxuICAgICAgICAgICAgdHJhbnNhY3Rpb25SZWY6IHsuLi5yZXN1bHQuZGF0YS50cmFuc2FjdGlvblJlZn1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiB0aGlzLiNzdGVwUHJpbnRSZWNlaXB0LmV4ZWN1dGUoc3RlcFBhcmFtcylcclxuICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUuZXJyb3IoZXJyb3IpKSAvL0EgZmFpbHVyZSBkdXJpbmcgdGhlIHByaW50IG9mIHRoZSByZWNlaXB0IHNob3VsZCBub3QgbWFrZSB0aGUgdHJhbnNhY3Rpb24gdG8gZmFpbFxyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jICN2b2lkTGFzdFBheW1lbnQodHJhbnNhY3Rpb25EYXRhLCBwYXltZW50SW5mb0xpc3QpIHtcclxuICAgICAgICBjb25zdCB2b2lkUGFyYW1zID0ge1xyXG4gICAgICAgICAgICAuLi50aGlzLiNwYXJhbXMsXHJcbiAgICAgICAgICAgIHBheW1lbnRMaXN0OiBbLi4udHJhbnNhY3Rpb25EYXRhLnBheW1lbnRMaXN0XSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IHZvaWRSZXN1bHQgPSBhd2FpdCB0aGlzLiNzdGVwUGF5bWVudC52b2lkTGFzdFBheW1lbnQodm9pZFBhcmFtcyk7XHJcbiAgICAgICAgdHJhbnNhY3Rpb25EYXRhLnBheW1lbnRMaXN0LnB1c2goLi4udm9pZFJlc3VsdC5wYXltZW50TGlzdCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgcGF5bWVudEluZm9MaXN0LnB1c2goe1xyXG4gICAgICAgICAgICBwYXltZW50UmVzdWx0OiB2b2lkUmVzdWx0LnBheW1lbnRSZXN1bHQsXHJcbiAgICAgICAgICAgIHJlY2VpcHREb2NUZW1wbGF0ZUlkOiB2b2lkUmVzdWx0LnJlY2VpcHREb2NUZW1wbGF0ZUlkXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICh0cmFuc2FjdGlvbkRhdGEudHJhbnNhY3Rpb25SZWYpIHtcclxuICAgICAgICAgICAgbGV0IGxhc3RQYXltZW50ID0gdHJhbnNhY3Rpb25EYXRhLnBheW1lbnRMaXN0W3RyYW5zYWN0aW9uRGF0YS5wYXltZW50TGlzdC5sZW5ndGggLSAxXTtcclxuICAgICAgICAgICAgY29uc3QgYW5zID0gYXdhaXQgdGhpcy4jdm9pZFRoZU9yZGVyKGxhc3RQYXltZW50LCB0cmFuc2FjdGlvbkRhdGEpO1xyXG4gICAgICAgICAgICBpZiAoYW5zKSB7XHJcbiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbkRhdGEudHJhbnNhY3Rpb25SZWYudHJhbnNhY3Rpb25JZCA9IGFucy50cmFuc2FjdGlvbklkO1xyXG4gICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25EYXRhLnRyYW5zYWN0aW9uUmVmLnRpY2tldENvdW50ID0gYW5zLnRpY2tldENvdW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jICN2b2lkVGhlT3JkZXIoc2FsZVBheW1lbnQsIHRyYW5zYWN0aW9uRGF0YSkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLiNwb3N0T3JkZXJWb2lkKHNhbGVQYXltZW50LCB0cmFuc2FjdGlvbkRhdGEpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuI2ZhaWxlZFRvVm9pZFRoZU9yZGVyKGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAjZmFpbGVkVG9Wb2lkVGhlT3JkZXIoZXJyb3IpIHtcclxuICAgICAgICBlcnJvci5zdGVwRmFpbHVyZSA9IFwiT3JkZXIgdm9pZCBmYWlsZWRcIjtcclxuICAgICAgICBTTlBfTE9HR0VSLmVycm9yKG51bGwsIG51bGwsIFwiT3JkZXIgdm9pZCBmYWlsZWQgd2l0aCBlcnJvcjogXCIgKyBlcnJvci5tZXNzYWdlKTtcclxuICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyAjcG9zdE9yZGVyVm9pZChzYWxlUGF5bWVudCwgdHJhbnNhY3Rpb25EYXRhKSB7XHJcbiAgICAgICAgS2lvc2tFdmVudFV0aWxzLnRyaWdnZXJUcmFuc2FjdGlvbkV2ZW50KFwid29ya2luZ1wiLCBcInBvc3QtdHJhbnNhY3Rpb25cIiwgXCJWb2lkaW5nIHRyYW5zYWN0aW9uXCIpO1xyXG4gICAgICAgIFNOUF9MT0dHRVIuZGVidWcobnVsbCwgbnVsbCwgXCJQb3N0aW5nIG9yZGVyIHZvaWRcIik7XHJcblxyXG4gICAgICAgIGxldCByZXEgPSB7XHJcbiAgICAgICAgICAgIEFwcHJvdmVkOiB0cnVlLFxyXG4gICAgICAgICAgICBQYWlkOiB0cnVlLFxyXG4gICAgICAgICAgICBQcmludGVkOiBmYWxzZSxcclxuICAgICAgICAgICAgVHJhbnNhY3Rpb25UeXBlOiAyLC8vc3lzdGVtU2FsZVZvaWRcclxuICAgICAgICAgICAgVHJhbnNhY3Rpb25SZWFzb246IDI2LCAvL1NhbGVWb2lkX1JlZnVuZEFsbF9GdWxsUmVmdW5kXHJcbiAgICAgICAgICAgIFNhbGVJZDogdHJhbnNhY3Rpb25EYXRhLnRyYW5zYWN0aW9uUmVmLnNhbGVJZCxcclxuICAgICAgICAgICAgUGF5bWVudExpc3Q6IFtdXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoc2FsZVBheW1lbnQpXHJcbiAgICAgICAgICAgIHJlcS5QYXltZW50TGlzdC5wdXNoKHNhbGVQYXltZW50KTtcclxuXHJcbiAgICAgICAgY29uc3QgYW5zID0gYXdhaXQgdGhpcy4jc25hcHBBUEkucG9zdFRyYW5zYWN0aW9uKHJlcSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHt0cmFuc2FjdGlvbklkOiBhbnMuVHJhbnNhY3Rpb25JZCwgdGlja2V0Q291bnQ6IDB9XHJcbiAgICB9XHJcblxyXG4gICAgI2FjdGl2YXRlTWVkaWFBbmRWYWxpZGF0ZU9yZGVyKHJlc3VsdCkge1xyXG4gICAgICAgIGlmICghcmVzdWx0LmRhdGEudHJhbnNhY3Rpb25SZWYgfHwgKHJlc3VsdC5kYXRhLnRvdGFsVGVuZGVyZWQgPCB0aGlzLiNwYXJhbXMudG90YWxEdWUpIHx8ICFyZXN1bHQucHJpbnRlZE1lZGlhIHx8IChyZXN1bHQucHJpbnRlZE1lZGlhLmxlbmd0aCA9PT0gMCkpIHtcclxuICAgICAgICAgICAgU05QX0xPR0dFUi5kZWJ1ZyhudWxsLCBudWxsLCBcIk1lZGlhIGFjdGl2YXRpb24gbm90IHJlcXVpcmVkXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBTTlBfTE9HR0VSLmRlYnVnKG51bGwsIG51bGwsIFwiQWN0aXZhdGluZyBtZWRpYXNcIik7XHJcbiAgICAgICAgICAgIEtpb3NrRXZlbnRVdGlscy50cmlnZ2VyVHJhbnNhY3Rpb25FdmVudChcIndvcmtpbmdcIiwgXCJhY3RpdmF0aW5nLW1lZGlhXCIsIFwiQWN0aXZhdGluZyBtZWRpYVwiLCByZXN1bHQuZGF0YS50cmFuc2FjdGlvblJlZik7XHJcblxyXG4gICAgICAgICAgICBsZXQgcmVxID0ge1xyXG4gICAgICAgICAgICAgICAgTWVkaWFQcmludFN1Y2Nlc3NMaXN0OiByZXN1bHQucHJpbnRlZE1lZGlhLFxyXG4gICAgICAgICAgICAgICAgU2FsZToge1xyXG4gICAgICAgICAgICAgICAgICAgIFNhbGVJZDogcmVzdWx0LmRhdGEudHJhbnNhY3Rpb25SZWYuc2FsZUlkXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiNzbmFwcEFQSS5jbWQoXCJUUkFOU0FDVElPTlwiLCBcIk1lZGlhUHJpbnRDb21wbGV0ZVwiLCByZXEpXHJcbiAgICAgICAgICAgICAgICAudGhlbihyc3AgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyc3AuTWVkaWFSZWlzc3VlZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnN0ZXBXYXJuTWVzc2FnZSA9IFwiQWxsIHByaW50ZWQgdGlja2V0cyBoYXMgYmVlbiByZWlzc3VlZFwiO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChlID0+IHRoaXMuI2ZhaWxlZEFQSUNhbGwoZSkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhc3luYyAjZXhlY3V0ZVBvc3RUcmFuc2FjdGlvbihyZXN1bHQpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCB7IHRyYW5zYWN0aW9uUmVmLCBpdGVtc1RvUHJpbnQgfSA9IGF3YWl0IHRoaXMuI3Bvc3RUcmFuc2FjdGlvbihyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgIHJlc3VsdC5kYXRhLnRyYW5zYWN0aW9uUmVmID0gdHJhbnNhY3Rpb25SZWY7XHJcbiAgICAgICAgICAgIHJlc3VsdC5kYXRhLml0ZW1zVG9QcmludCA9IGl0ZW1zVG9QcmludDtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuI2ZhaWxlZFBvc3RUcmFuc2FjdGlvbihlLCByZXN1bHQuZGF0YSwgcmVzdWx0LnBheW1lbnRJbmZvTGlzdCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jICNmYWlsZWRQb3N0VHJhbnNhY3Rpb24oZXJyb3IsIHRyYW5zYWN0aW9uRGF0YSwgcGF5bWVudEluZm9MaXN0KSB7XHJcbiAgICAgICAgaWYgKHRyYW5zYWN0aW9uRGF0YS5wYXltZW50TGlzdCAmJiAodHJhbnNhY3Rpb25EYXRhLnBheW1lbnRMaXN0Lmxlbmd0aCA+IDApKVxyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLiN2b2lkTGFzdFBheW1lbnQodHJhbnNhY3Rpb25EYXRhLCBwYXltZW50SW5mb0xpc3QpO1xyXG5cclxuICAgICAgICBlcnJvci5zdGVwRmFpbHVyZSA9IFwiRmFpbGVkIHRvIHByb2Nlc3MgdGhlIG9yZGVyXCI7XHJcbiAgICAgICAgU05QX0xPR0dFUi5lcnJvcihudWxsLCBudWxsLCBcIlBvc3RUcmFuc2FjdGlvbiBmYWlsZWQgd2l0aCBlcnJvcjogXCIgKyBlcnJvci5tZXNzYWdlKTtcclxuICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyAjcG9zdFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uRGF0YSkge1xyXG4gICAgICAgIEtpb3NrRXZlbnRVdGlscy50cmlnZ2VyVHJhbnNhY3Rpb25FdmVudChcIndvcmtpbmdcIiwgXCJwb3N0LXRyYW5zYWN0aW9uXCIsIFwiUHJvY2Vzc2luZyB0cmFuc2FjdGlvblwiKTtcclxuXHJcbiAgICAgICAgU05QX0xPR0dFUi5kZWJ1ZyhudWxsLCBudWxsLCBcIlByb2Nlc3NpbmcgdHJhbnNhY3Rpb25cIik7XHJcblxyXG4gICAgICAgIGxldCByZXEgPSB7XHJcbiAgICAgICAgICAgIEFwcHJvdmVkOiB0cnVlLFxyXG4gICAgICAgICAgICBSZXR1cm5QcmludEl0ZW1zOiAhdGhpcy5wcmludEF0SG9tZUlzRW5hYmxlZCxcclxuICAgICAgICAgICAgU2hvcENhcnRJZDogdGhpcy4jcGFyYW1zLnNob3BDYXJ0SWRcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKHRyYW5zYWN0aW9uRGF0YS50b3RhbFRlbmRlcmVkID49IHRoaXMuI3BhcmFtcy50b3RhbER1ZSkgXHJcbiAgICAgICAgICAgIHJlcS5QYWlkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLnByaW50QXRIb21lSXNFbmFibGVkKSB7XHJcbiAgICAgICAgICAgIFNOUF9MT0dHRVIuZGVidWcobnVsbCwgbnVsbCwgXCJUZW5kZXJlZCBhbW91bnQgaXMgZW5vdWdoXCIpO1xyXG4gICAgICAgICAgICByZXEuUHJpbnRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHJlcS5HZW5lcmF0ZU1lZGlhID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmVxLlZhbGlkYXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHJlcS5SZXR1cm5QcmludEl0ZW1zUHJpbnREYXRhID0gdGhpcy4jcGFyYW1zLnByaW50T3B0aW9uU2VsZWN0aW9uO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRyYW5zYWN0aW9uRGF0YS5wYXltZW50TGlzdClcclxuICAgICAgICAgICAgcmVxLlBheW1lbnRMaXN0ID0gdHJhbnNhY3Rpb25EYXRhLnBheW1lbnRMaXN0O1xyXG5cclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLiNzbmFwcEFQSS5jbWQoXCJUUkFOU0FDVElPTlwiLCBcIlBvc3RUcmFuc2FjdGlvblwiLCByZXEpXHJcbiAgICAgICAgICAgICAgICAudGhlbihhbnMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB0cmFuc2FjdGlvblJlZiA9IHRoaXMuI3RyYW5zYWN0aW9uUmVmRnJvbUFuc3dlcihhbnMuUG9zdFRyYW5zYWN0aW9uUmVjYXAsIGFucy5JdGVtc1RvUHJpbnQgPyBhbnMuSXRlbXNUb1ByaW50LlByaW50SXRlbUxpc3QgOiBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgaXRlbXNUb1ByaW50ID0gYW5zLkl0ZW1zVG9QcmludDtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHsgdHJhbnNhY3Rpb25SZWYsIGl0ZW1zVG9QcmludCB9KTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAjcG9zdE9yZGVyQWJvcnQodHJhbnNhY3Rpb25EYXRhKSB7XHJcbiAgICAgICAgS2lvc2tFdmVudFV0aWxzLnRyaWdnZXJUcmFuc2FjdGlvbkV2ZW50KFwid29ya2luZ1wiLCBcInBvc3QtdHJhbnNhY3Rpb25cIiwgXCJQcm9jZXNzaW5nIHRyYW5zYWN0aW9uXCIpO1xyXG5cclxuICAgICAgICBTTlBfTE9HR0VSLmRlYnVnKG51bGwsIG51bGwsIFwiUHJvY2Vzc2luZyBpbnRlcnJ1cHRlZCB0cmFuc2FjdGlvblwiKTtcclxuXHJcbiAgICAgICAgbGV0IHJlcSA9IHtcclxuICAgICAgICAgICAgU2hvcENhcnRJZDogdGhpcy4jcGFyYW1zLnNob3BDYXJ0SWQsXHJcbiAgICAgICAgICAgIFBheW1lbnRMaXN0OiB0cmFuc2FjdGlvbkRhdGEucGF5bWVudExpc3RcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuI3NuYXBwQVBJLmNtZChcIlNIT1BDQVJUXCIsIFwiQWJvcnRPcmRlclwiLCByZXEpXHJcbiAgICAgICAgICAgICAgICAudGhlbihhbnMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uUmVmID0gdGhpcy4jdHJhbnNhY3Rpb25SZWZGcm9tQW5zd2VyKGFucy5Qb3N0VHJhbnNhY3Rpb25SZWNhcCwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0cmFuc2FjdGlvblJlZik7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgI2V4ZWN1dGVQcmludE9wdGlvblNlbGVjdGlvbigpIHtcclxuICAgICAgICBpZiAoIXRoaXMuI3BhcmFtcy5wcmludE9wdGlvblNlbGVjdGlvbilcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShERUxJVkVSWV9PUFRJT05TLlBSSU5ULmNvZGUpO1xyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7ICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGNvbnN0IGVuYWJsZWRPcHRpb25zID0gdGhpcy4jcGFyYW1zLnJpZ2h0cy5LU0tfUHJpbnRNZWRpYU1ldGhvZC5zcGxpdChcIixcIik7XHJcbiAgICAgICAgICAgICAgICBsZXQgZGVsaXZlcnlPcHRpb25zID0gT2JqZWN0LnZhbHVlcyhERUxJVkVSWV9PUFRJT05TKVxyXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIob3B0ID0+IGVuYWJsZWRPcHRpb25zLmluY2x1ZGVzKG9wdC52YWx1ZS50b1N0cmluZygpKSlcclxuICAgICAgICAgICAgICAgICAgICAubWFwKG9wdCA9PiBvcHQuY29kZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnByaW50QXRIb21lSXNFbmFibGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVsaXZlcnlPcHRpb25zID0gZGVsaXZlcnlPcHRpb25zLmZpbHRlcihvcHQgPT4gb3B0ICE9PSBERUxJVkVSWV9PUFRJT05TLlBSSU5UX0FUX0hPTUUuY29kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgU05QX0xPR0dFUi53YXJuKG51bGwsIG51bGwsIGAke0RFTElWRVJZX09QVElPTlMuUFJJTlRfQVRfSE9NRS5jb2RlfSBub3QgZW5hYmxlZCBiZWNhdXNlIE9yZGVyIENvbmZpcm1hdGlvbiBUZW1wbGF0ZUlkIGlzIG1pc3NpbmdgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGxldCBleHRyYVByb3BlcnRpZXMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVsaXZlcnlPcHRpb25zOiBkZWxpdmVyeU9wdGlvbnMsXHJcbiAgICAgICAgICAgICAgICAgICAgZGVsaXZlcnlPcHRpb25DYWxsYmFjazogZGVsaXZlcnlPcHRpb24gPT4gcmVzb2x2ZShkZWxpdmVyeU9wdGlvbiksXHJcbiAgICAgICAgICAgICAgICAgICAgLyogMDMvMTAvMjAyNCAtIEBkZXByZWNhdGVkICovIHByaW50T3B0aW9uQ2FsbGJhY2s6IHByaW50UGx1Z2luRmlsdGVyID0+IHsgcHJpbnRQbHVnaW5GaWx0ZXIgPyByZXNvbHZlKERFTElWRVJZX09QVElPTlMuR09fR1JFRU4uY29kZSkgOiByZXNvbHZlKERFTElWRVJZX09QVElPTlMuUFJJTlQuY29kZSkgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBLaW9za0V2ZW50VXRpbHMudHJpZ2dlclRyYW5zYWN0aW9uRXZlbnQoXCJ3b3JraW5nXCIsIFwicHJpbnQtb3B0aW9uXCIsIFwiV2FpdGluZyBwcmludCBvcHRpb25cIiwgbnVsbCwgZXh0cmFQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgICN0cmFuc2FjdGlvblJlZkZyb21BbnN3ZXIodHJhbnNhY3Rpb25SZWNhcCwgcHJpbnRJdGVtTGlzdCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNhbGVJZDogdHJhbnNhY3Rpb25SZWNhcC5TYWxlSWQsXHJcbiAgICAgICAgICAgIHNhbGVDb2RlOiB0cmFuc2FjdGlvblJlY2FwLlNhbGVDb2RlLFxyXG4gICAgICAgICAgICB0cmFuc2FjdGlvbklkOiB0cmFuc2FjdGlvblJlY2FwLlRyYW5zYWN0aW9uSWQsXHJcbiAgICAgICAgICAgIHRpY2tldENvdW50OiBwcmludEl0ZW1MaXN0ID8gcHJpbnRJdGVtTGlzdC5sZW5ndGggOiAwXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAjbm90aWZ5VHJhbnNhY3Rpb25FbmQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuI3BhcmFtcy5zdGVwRmFpbHVyZSlcclxuICAgICAgICAgICAgS2lvc2tFdmVudFV0aWxzLnRyaWdnZXJUcmFuc2FjdGlvbkV2ZW50KFwiZmFpbGVkXCIsIFwidHJhbnNhY3Rpb25cIiwgdGhpcy4jcGFyYW1zLnN0ZXBGYWlsdXJlLCB0aGlzLiNwYXJhbXMudHJhbnNhY3Rpb25SZWYpO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgS2lvc2tFdmVudFV0aWxzLnRyaWdnZXJUcmFuc2FjdGlvbkV2ZW50KFwic3VjY2Vzc2Z1bFwiLCBcInRyYW5zYWN0aW9uXCIsIFwiU3VjY2Vzc2Z1bCBjaGVjay1vdXRcIiwgdGhpcy4jcGFyYW1zLnRyYW5zYWN0aW9uUmVmKTtcclxuICAgIH1cclxufSJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../script/steps/checkout.js\n");

/***/ }),

/***/ "../script/steps/print-media-processor.js":
/*!************************************************!*\
  !*** ../script/steps/print-media-processor.js ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PrintMediaProcessor: () => (/* binding */ PrintMediaProcessor)\n/* harmony export */ });\n/* harmony import */ var _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../kiosk-event-utils */ \"../script/kiosk-event-utils.js\");\n/* harmony import */ var _common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @common-script/device-manager/dm-model */ \"../../../common-script/device-manager/dm-model.js\");\n/* harmony import */ var _common_script_errors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @common-script/errors */ \"../../../common-script/errors.js\");\n\r\n\r\n\r\n\r\nconst TRANSACTION_PROGRESS = \"print-ticket\";\r\n\r\nclass PrintMediaProcessor {\r\n  #deivceManager;\r\n\t#toBePrinted;\r\n\t#printedMedias;\r\n  \r\n\tconstructor (devManager) {\r\n\t  this.#deivceManager = devManager;\r\n\t}\r\n\t\r\n\tprint(printItemList, transactionRef) {\r\n\t\tthis.#toBePrinted = printItemList || [];\r\n\t\tthis.#printedMedias = [];\r\n\r\n\t\tif (this.#toBePrinted.length > 0)\r\n\t\t\treturn this.#printNextItem(transactionRef);\r\n\t\telse\r\n\t\t\treturn Promise.resolve(this.#printedMedias);\r\n\t}\r\n\t\r\n\t#printNextItem(transactionRef) {\r\n\t\tif (this.#toBePrinted.length <= 0)\r\n\t\t\treturn Promise.resolve(this.#printedMedias);\r\n\t\telse {\r\n\t\t\tlet item = this.#toBePrinted.shift();\r\n\t\t\tlet currentTicketNo = this.#printedMedias.length + 1;\r\n\t\t\tlet totalTickets = this.#printedMedias.length + this.#toBePrinted.length + 1;\r\n\t\t\tSNP_LOGGER.debug(null, null, \"Printing \" + currentTicketNo + \" of \" + totalTickets);\r\n\r\n\t\t\tlet extraProperties = {\r\n\t\t\t\tticketPrint: {\r\n\t\t\t\t\tcurrentTicketNo: currentTicketNo\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_0__.KioskEventUtils.triggerTransactionEvent(\"working\", TRANSACTION_PROGRESS, \"Printing ticket\", transactionRef, extraProperties);\r\n\t\t\treturn this.#printItem(item, transactionRef);\r\n\t\t}\r\n\t}  \r\n\r\n\t#printItem(item, transactionRef) {\r\n\t\tlet device = this.#deivceManager.findDeviceById(item.PluginId);\r\n\t\tif (device == null)\r\n\t\t\treturn this.#rejectWithError(\"Device:\" + item.PluginId + \" not found\", transactionRef);\r\n\r\n\t\tif (device.deviceStatus !== _common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_1__.DEVICE_STATUS.READY)\r\n\t\t\treturn this.#rejectWithError(\"Device \" + device.pluginName + \" not ready\", transactionRef);\r\n\r\n\t\treturn device.processDoc(item.DocData, item.DocEditorType)\r\n\t\t\t\t.then(() => this.#mediaPrinted(item, transactionRef))\r\n\t\t\t\t.catch(error => this.#printFailure(error, transactionRef));\r\n\t}\r\n\r\n\t#rejectWithError(errorMessage, transactionRef) {\r\n\t\tlet error = new Error(errorMessage);\r\n\t\treturn this.#printFailure(error, transactionRef);\r\n\t}\r\n\t\r\n\t#mediaPrinted(item, transactionRef) {\r\n\t  \tlet printedMedia = this.createPrintedMediaObject(item);\r\n\t  \tthis.#printedMedias.push(printedMedia);\r\n\t  \treturn this.#printNextItem(transactionRef);\r\n\t}        \r\n\t\r\n\t#printFailure(error, transactionRef) {\r\n\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_0__.KioskEventUtils.triggerTransactionEvent(\"failed\", TRANSACTION_PROGRESS, error, transactionRef);\r\n\t\tSNP_LOGGER.error(null, null, \"Print failed with error: \" + error);\r\n\t\t\r\n\t\tthrow new _common_script_errors__WEBPACK_IMPORTED_MODULE_2__.EPrintError(error.message, this.#printedMedias);\r\n\t}\r\n\r\n\tcreatePrintedMediaObject(media) {\r\n\t\treturn ({MediaId: media.MediaId})\r\n\t}\r\n\t\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L3N0ZXBzL3ByaW50LW1lZGlhLXByb2Nlc3Nvci5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQXVEO0FBQ2dCO0FBQ25CO0FBQ3BEO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRywrREFBZTtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsaUZBQWE7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFLCtEQUFlO0FBQ2pCO0FBQ0E7QUFDQSxZQUFZLDhEQUFXO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBLFdBQVcsdUJBQXVCO0FBQ2xDO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2tpb3NrLWNvbnRyb2xsZXIvLi4vc2NyaXB0L3N0ZXBzL3ByaW50LW1lZGlhLXByb2Nlc3Nvci5qcz81MTcwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEtpb3NrRXZlbnRVdGlscyB9IGZyb20gJy4uL2tpb3NrLWV2ZW50LXV0aWxzJztcclxuaW1wb3J0IHsgREVWSUNFX1NUQVRVUyB9IGZyb20gJ0Bjb21tb24tc2NyaXB0L2RldmljZS1tYW5hZ2VyL2RtLW1vZGVsJztcclxuaW1wb3J0IHsgRVByaW50RXJyb3IgfSBmcm9tICdAY29tbW9uLXNjcmlwdC9lcnJvcnMnO1xyXG5cclxuY29uc3QgVFJBTlNBQ1RJT05fUFJPR1JFU1MgPSBcInByaW50LXRpY2tldFwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFByaW50TWVkaWFQcm9jZXNzb3Ige1xyXG4gICNkZWl2Y2VNYW5hZ2VyO1xyXG5cdCN0b0JlUHJpbnRlZDtcclxuXHQjcHJpbnRlZE1lZGlhcztcclxuICBcclxuXHRjb25zdHJ1Y3RvciAoZGV2TWFuYWdlcikge1xyXG5cdCAgdGhpcy4jZGVpdmNlTWFuYWdlciA9IGRldk1hbmFnZXI7XHJcblx0fVxyXG5cdFxyXG5cdHByaW50KHByaW50SXRlbUxpc3QsIHRyYW5zYWN0aW9uUmVmKSB7XHJcblx0XHR0aGlzLiN0b0JlUHJpbnRlZCA9IHByaW50SXRlbUxpc3QgfHwgW107XHJcblx0XHR0aGlzLiNwcmludGVkTWVkaWFzID0gW107XHJcblxyXG5cdFx0aWYgKHRoaXMuI3RvQmVQcmludGVkLmxlbmd0aCA+IDApXHJcblx0XHRcdHJldHVybiB0aGlzLiNwcmludE5leHRJdGVtKHRyYW5zYWN0aW9uUmVmKTtcclxuXHRcdGVsc2VcclxuXHRcdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLiNwcmludGVkTWVkaWFzKTtcclxuXHR9XHJcblx0XHJcblx0I3ByaW50TmV4dEl0ZW0odHJhbnNhY3Rpb25SZWYpIHtcclxuXHRcdGlmICh0aGlzLiN0b0JlUHJpbnRlZC5sZW5ndGggPD0gMClcclxuXHRcdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLiNwcmludGVkTWVkaWFzKTtcclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRsZXQgaXRlbSA9IHRoaXMuI3RvQmVQcmludGVkLnNoaWZ0KCk7XHJcblx0XHRcdGxldCBjdXJyZW50VGlja2V0Tm8gPSB0aGlzLiNwcmludGVkTWVkaWFzLmxlbmd0aCArIDE7XHJcblx0XHRcdGxldCB0b3RhbFRpY2tldHMgPSB0aGlzLiNwcmludGVkTWVkaWFzLmxlbmd0aCArIHRoaXMuI3RvQmVQcmludGVkLmxlbmd0aCArIDE7XHJcblx0XHRcdFNOUF9MT0dHRVIuZGVidWcobnVsbCwgbnVsbCwgXCJQcmludGluZyBcIiArIGN1cnJlbnRUaWNrZXRObyArIFwiIG9mIFwiICsgdG90YWxUaWNrZXRzKTtcclxuXHJcblx0XHRcdGxldCBleHRyYVByb3BlcnRpZXMgPSB7XHJcblx0XHRcdFx0dGlja2V0UHJpbnQ6IHtcclxuXHRcdFx0XHRcdGN1cnJlbnRUaWNrZXRObzogY3VycmVudFRpY2tldE5vXHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0S2lvc2tFdmVudFV0aWxzLnRyaWdnZXJUcmFuc2FjdGlvbkV2ZW50KFwid29ya2luZ1wiLCBUUkFOU0FDVElPTl9QUk9HUkVTUywgXCJQcmludGluZyB0aWNrZXRcIiwgdHJhbnNhY3Rpb25SZWYsIGV4dHJhUHJvcGVydGllcyk7XHJcblx0XHRcdHJldHVybiB0aGlzLiNwcmludEl0ZW0oaXRlbSwgdHJhbnNhY3Rpb25SZWYpO1xyXG5cdFx0fVxyXG5cdH0gIFxyXG5cclxuXHQjcHJpbnRJdGVtKGl0ZW0sIHRyYW5zYWN0aW9uUmVmKSB7XHJcblx0XHRsZXQgZGV2aWNlID0gdGhpcy4jZGVpdmNlTWFuYWdlci5maW5kRGV2aWNlQnlJZChpdGVtLlBsdWdpbklkKTtcclxuXHRcdGlmIChkZXZpY2UgPT0gbnVsbClcclxuXHRcdFx0cmV0dXJuIHRoaXMuI3JlamVjdFdpdGhFcnJvcihcIkRldmljZTpcIiArIGl0ZW0uUGx1Z2luSWQgKyBcIiBub3QgZm91bmRcIiwgdHJhbnNhY3Rpb25SZWYpO1xyXG5cclxuXHRcdGlmIChkZXZpY2UuZGV2aWNlU3RhdHVzICE9PSBERVZJQ0VfU1RBVFVTLlJFQURZKVxyXG5cdFx0XHRyZXR1cm4gdGhpcy4jcmVqZWN0V2l0aEVycm9yKFwiRGV2aWNlIFwiICsgZGV2aWNlLnBsdWdpbk5hbWUgKyBcIiBub3QgcmVhZHlcIiwgdHJhbnNhY3Rpb25SZWYpO1xyXG5cclxuXHRcdHJldHVybiBkZXZpY2UucHJvY2Vzc0RvYyhpdGVtLkRvY0RhdGEsIGl0ZW0uRG9jRWRpdG9yVHlwZSlcclxuXHRcdFx0XHQudGhlbigoKSA9PiB0aGlzLiNtZWRpYVByaW50ZWQoaXRlbSwgdHJhbnNhY3Rpb25SZWYpKVxyXG5cdFx0XHRcdC5jYXRjaChlcnJvciA9PiB0aGlzLiNwcmludEZhaWx1cmUoZXJyb3IsIHRyYW5zYWN0aW9uUmVmKSk7XHJcblx0fVxyXG5cclxuXHQjcmVqZWN0V2l0aEVycm9yKGVycm9yTWVzc2FnZSwgdHJhbnNhY3Rpb25SZWYpIHtcclxuXHRcdGxldCBlcnJvciA9IG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpO1xyXG5cdFx0cmV0dXJuIHRoaXMuI3ByaW50RmFpbHVyZShlcnJvciwgdHJhbnNhY3Rpb25SZWYpO1xyXG5cdH1cclxuXHRcclxuXHQjbWVkaWFQcmludGVkKGl0ZW0sIHRyYW5zYWN0aW9uUmVmKSB7XHJcblx0ICBcdGxldCBwcmludGVkTWVkaWEgPSB0aGlzLmNyZWF0ZVByaW50ZWRNZWRpYU9iamVjdChpdGVtKTtcclxuXHQgIFx0dGhpcy4jcHJpbnRlZE1lZGlhcy5wdXNoKHByaW50ZWRNZWRpYSk7XHJcblx0ICBcdHJldHVybiB0aGlzLiNwcmludE5leHRJdGVtKHRyYW5zYWN0aW9uUmVmKTtcclxuXHR9ICAgICAgICBcclxuXHRcclxuXHQjcHJpbnRGYWlsdXJlKGVycm9yLCB0cmFuc2FjdGlvblJlZikge1xyXG5cdFx0S2lvc2tFdmVudFV0aWxzLnRyaWdnZXJUcmFuc2FjdGlvbkV2ZW50KFwiZmFpbGVkXCIsIFRSQU5TQUNUSU9OX1BST0dSRVNTLCBlcnJvciwgdHJhbnNhY3Rpb25SZWYpO1xyXG5cdFx0U05QX0xPR0dFUi5lcnJvcihudWxsLCBudWxsLCBcIlByaW50IGZhaWxlZCB3aXRoIGVycm9yOiBcIiArIGVycm9yKTtcclxuXHRcdFxyXG5cdFx0dGhyb3cgbmV3IEVQcmludEVycm9yKGVycm9yLm1lc3NhZ2UsIHRoaXMuI3ByaW50ZWRNZWRpYXMpO1xyXG5cdH1cclxuXHJcblx0Y3JlYXRlUHJpbnRlZE1lZGlhT2JqZWN0KG1lZGlhKSB7XHJcblx0XHRyZXR1cm4gKHtNZWRpYUlkOiBtZWRpYS5NZWRpYUlkfSlcclxuXHR9XHJcblx0XHJcbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///../script/steps/print-media-processor.js\n");

/***/ }),

/***/ "../script/steps/print-receipt-processor.js":
/*!**************************************************!*\
  !*** ../script/steps/print-receipt-processor.js ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PrintReceiptProcessor: () => (/* binding */ PrintReceiptProcessor)\n/* harmony export */ });\n/* harmony import */ var _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../kiosk-event-utils */ \"../script/kiosk-event-utils.js\");\n/* harmony import */ var _common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @common-script/device-manager/dm-model */ \"../../../common-script/device-manager/dm-model.js\");\n\r\n\r\n\r\nconst TRANSACTION_PROGRESS = \"print-receipt\";\r\n\r\nclass PrintReceiptProcessor {\r\n  #deivceManager;\r\n  \r\n\tconstructor (devManager) {\r\n\t  this.#deivceManager = devManager;\r\n\t}\r\n\t\r\n\tprint(receiptPrintTemplate, driverList, transactionRef) {\r\n\r\n\t\tlet device = null;\r\n\t\tif (driverList) {\r\n\t\t\tfor (let driver of driverList) {\r\n\t\t\t\tdevice = this.#deivceManager.findDeviceByClassAndDeviceAlias(driver.ClassAlias, driver.DeviceAlias);\r\n\t\t\t\tif (device)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (device == null)\r\n\t\t\treturn this.#rejectWithError(\"Device not found\", transactionRef);\r\n\r\n\t\tif (device.deviceStatus !== _common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_1__.DEVICE_STATUS.READY)\r\n\t\t\treturn this.#rejectWithError(\"Device \" + device.pluginName + \" not ready\", transactionRef);\r\n\r\n\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_0__.KioskEventUtils.triggerTransactionEvent(\"working\", TRANSACTION_PROGRESS, \"Printing receipt\", transactionRef);\r\n\r\n\t\treturn device.processReceipt(receiptPrintTemplate)\r\n\t\t\t.catch(error => this.#printFailure(error, transactionRef));\r\n\t}\r\n\r\n\t#rejectWithError(errorMessage, transactionRef) {\r\n\t\tlet error = new Error(errorMessage);\r\n\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_0__.KioskEventUtils.triggerTransactionEvent(\"failed\", TRANSACTION_PROGRESS, error, transactionRef);\t\r\n\t\treturn Promise.reject(error);\r\n\t}\r\n\r\n\t#printFailure(error, transactionRef) {\r\n\t  _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_0__.KioskEventUtils.triggerTransactionEvent(\"failed\", TRANSACTION_PROGRESS, error, transactionRef);\r\n\t  SNP_LOGGER.error(null, null, \"Print failed with error: \" + error);\r\n\t  throw error;\r\n\t}\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L3N0ZXBzL3ByaW50LXJlY2VpcHQtcHJvY2Vzc29yLmpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUF1RDtBQUNnQjtBQUN2RTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsaUZBQWE7QUFDM0M7QUFDQTtBQUNBLEVBQUUsK0RBQWU7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFLCtEQUFlO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRywrREFBZTtBQUNsQjtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2tpb3NrLWNvbnRyb2xsZXIvLi4vc2NyaXB0L3N0ZXBzL3ByaW50LXJlY2VpcHQtcHJvY2Vzc29yLmpzPzcwYzgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgS2lvc2tFdmVudFV0aWxzIH0gZnJvbSAnLi4va2lvc2stZXZlbnQtdXRpbHMnO1xyXG5pbXBvcnQgeyBERVZJQ0VfU1RBVFVTIH0gZnJvbSAnQGNvbW1vbi1zY3JpcHQvZGV2aWNlLW1hbmFnZXIvZG0tbW9kZWwnO1xyXG5cclxuY29uc3QgVFJBTlNBQ1RJT05fUFJPR1JFU1MgPSBcInByaW50LXJlY2VpcHRcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBQcmludFJlY2VpcHRQcm9jZXNzb3Ige1xyXG4gICNkZWl2Y2VNYW5hZ2VyO1xyXG4gIFxyXG5cdGNvbnN0cnVjdG9yIChkZXZNYW5hZ2VyKSB7XHJcblx0ICB0aGlzLiNkZWl2Y2VNYW5hZ2VyID0gZGV2TWFuYWdlcjtcclxuXHR9XHJcblx0XHJcblx0cHJpbnQocmVjZWlwdFByaW50VGVtcGxhdGUsIGRyaXZlckxpc3QsIHRyYW5zYWN0aW9uUmVmKSB7XHJcblxyXG5cdFx0bGV0IGRldmljZSA9IG51bGw7XHJcblx0XHRpZiAoZHJpdmVyTGlzdCkge1xyXG5cdFx0XHRmb3IgKGxldCBkcml2ZXIgb2YgZHJpdmVyTGlzdCkge1xyXG5cdFx0XHRcdGRldmljZSA9IHRoaXMuI2RlaXZjZU1hbmFnZXIuZmluZERldmljZUJ5Q2xhc3NBbmREZXZpY2VBbGlhcyhkcml2ZXIuQ2xhc3NBbGlhcywgZHJpdmVyLkRldmljZUFsaWFzKTtcclxuXHRcdFx0XHRpZiAoZGV2aWNlKVxyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRpZiAoZGV2aWNlID09IG51bGwpXHJcblx0XHRcdHJldHVybiB0aGlzLiNyZWplY3RXaXRoRXJyb3IoXCJEZXZpY2Ugbm90IGZvdW5kXCIsIHRyYW5zYWN0aW9uUmVmKTtcclxuXHJcblx0XHRpZiAoZGV2aWNlLmRldmljZVN0YXR1cyAhPT0gREVWSUNFX1NUQVRVUy5SRUFEWSlcclxuXHRcdFx0cmV0dXJuIHRoaXMuI3JlamVjdFdpdGhFcnJvcihcIkRldmljZSBcIiArIGRldmljZS5wbHVnaW5OYW1lICsgXCIgbm90IHJlYWR5XCIsIHRyYW5zYWN0aW9uUmVmKTtcclxuXHJcblx0XHRLaW9za0V2ZW50VXRpbHMudHJpZ2dlclRyYW5zYWN0aW9uRXZlbnQoXCJ3b3JraW5nXCIsIFRSQU5TQUNUSU9OX1BST0dSRVNTLCBcIlByaW50aW5nIHJlY2VpcHRcIiwgdHJhbnNhY3Rpb25SZWYpO1xyXG5cclxuXHRcdHJldHVybiBkZXZpY2UucHJvY2Vzc1JlY2VpcHQocmVjZWlwdFByaW50VGVtcGxhdGUpXHJcblx0XHRcdC5jYXRjaChlcnJvciA9PiB0aGlzLiNwcmludEZhaWx1cmUoZXJyb3IsIHRyYW5zYWN0aW9uUmVmKSk7XHJcblx0fVxyXG5cclxuXHQjcmVqZWN0V2l0aEVycm9yKGVycm9yTWVzc2FnZSwgdHJhbnNhY3Rpb25SZWYpIHtcclxuXHRcdGxldCBlcnJvciA9IG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpO1xyXG5cdFx0S2lvc2tFdmVudFV0aWxzLnRyaWdnZXJUcmFuc2FjdGlvbkV2ZW50KFwiZmFpbGVkXCIsIFRSQU5TQUNUSU9OX1BST0dSRVNTLCBlcnJvciwgdHJhbnNhY3Rpb25SZWYpO1x0XHJcblx0XHRyZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG5cdH1cclxuXHJcblx0I3ByaW50RmFpbHVyZShlcnJvciwgdHJhbnNhY3Rpb25SZWYpIHtcclxuXHQgIEtpb3NrRXZlbnRVdGlscy50cmlnZ2VyVHJhbnNhY3Rpb25FdmVudChcImZhaWxlZFwiLCBUUkFOU0FDVElPTl9QUk9HUkVTUywgZXJyb3IsIHRyYW5zYWN0aW9uUmVmKTtcclxuXHQgIFNOUF9MT0dHRVIuZXJyb3IobnVsbCwgbnVsbCwgXCJQcmludCBmYWlsZWQgd2l0aCBlcnJvcjogXCIgKyBlcnJvcik7XHJcblx0ICB0aHJvdyBlcnJvcjtcclxuXHR9XHJcbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///../script/steps/print-receipt-processor.js\n");

/***/ }),

/***/ "../script/steps/step-base.js":
/*!************************************!*\
  !*** ../script/steps/step-base.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Step: () => (/* binding */ Step)\n/* harmony export */ });\n/* harmony import */ var _common_script_errors__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @common-script/errors */ \"../../../common-script/errors.js\");\n/* harmony import */ var _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../kiosk-event-utils */ \"../script/kiosk-event-utils.js\");\n\r\n\r\n\r\nclass Step {\r\n\t_stepType;\r\n\t_params;\r\n    _snappAPI;\r\n\r\n\tconstructor(snappAPI) {\r\n\t\tthis._snappAPI = snappAPI;\r\n\t}\r\n\t\t\r\n\tget stepType() {\r\n\t\treturn this._stepType;\r\n\t}\r\n\t\r\n\texecute(params) {\r\n\t\tthis._params = params;\r\n\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_1__.KioskEventUtils.triggerCheckoutStepEvent(this.stepType);\r\n\t\tSNP_LOGGER.debug(null, null, \"Executing step: \" + this.stepType);\r\n\t\treturn this._doExecute(); \r\n\t}\r\n\t\r\n\t_doExecute() {\r\n\t\tthrow Error(\"Missing _doExecute impelemtation for step \" + this.constructor.name);\r\n\t}\r\n\r\n\t_getRights() {\r\n\t\treturn this._params.rights;\r\n\t}\r\n\t\r\n\t_handleError(error) {\r\n\t\tif (!error)\r\n\t\t\tSNP_LOGGER.error(null, null, \"Undefined step error\")\r\n\t\telse if (error.errorCode && (error.errorCode === _common_script_errors__WEBPACK_IMPORTED_MODULE_0__.PAYMENT_ERROR.ABORT))\r\n\t\t\tSNP_LOGGER.error(null, null, \"Payment abort\")\r\n\t\telse\r\n\t\t\tSNP_LOGGER.error(null, null, \"Step failed with error: \" + error.message)\r\n\t}\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L3N0ZXBzL3N0ZXAtYmFzZS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBc0Q7QUFDQztBQUN2RDtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUUsK0RBQWU7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1ELGdFQUFhO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9raW9zay1jb250cm9sbGVyLy4uL3NjcmlwdC9zdGVwcy9zdGVwLWJhc2UuanM/NjYxNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQQVlNRU5UX0VSUk9SIH0gZnJvbSAnQGNvbW1vbi1zY3JpcHQvZXJyb3JzJztcclxuaW1wb3J0IHsgS2lvc2tFdmVudFV0aWxzIH0gZnJvbSAnLi4va2lvc2stZXZlbnQtdXRpbHMnO1xyXG5cclxuZXhwb3J0IGNsYXNzIFN0ZXAge1xyXG5cdF9zdGVwVHlwZTtcclxuXHRfcGFyYW1zO1xyXG4gICAgX3NuYXBwQVBJO1xyXG5cclxuXHRjb25zdHJ1Y3RvcihzbmFwcEFQSSkge1xyXG5cdFx0dGhpcy5fc25hcHBBUEkgPSBzbmFwcEFQSTtcclxuXHR9XHJcblx0XHRcclxuXHRnZXQgc3RlcFR5cGUoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fc3RlcFR5cGU7XHJcblx0fVxyXG5cdFxyXG5cdGV4ZWN1dGUocGFyYW1zKSB7XHJcblx0XHR0aGlzLl9wYXJhbXMgPSBwYXJhbXM7XHJcblx0XHRLaW9za0V2ZW50VXRpbHMudHJpZ2dlckNoZWNrb3V0U3RlcEV2ZW50KHRoaXMuc3RlcFR5cGUpO1xyXG5cdFx0U05QX0xPR0dFUi5kZWJ1ZyhudWxsLCBudWxsLCBcIkV4ZWN1dGluZyBzdGVwOiBcIiArIHRoaXMuc3RlcFR5cGUpO1xyXG5cdFx0cmV0dXJuIHRoaXMuX2RvRXhlY3V0ZSgpOyBcclxuXHR9XHJcblx0XHJcblx0X2RvRXhlY3V0ZSgpIHtcclxuXHRcdHRocm93IEVycm9yKFwiTWlzc2luZyBfZG9FeGVjdXRlIGltcGVsZW10YXRpb24gZm9yIHN0ZXAgXCIgKyB0aGlzLmNvbnN0cnVjdG9yLm5hbWUpO1xyXG5cdH1cclxuXHJcblx0X2dldFJpZ2h0cygpIHtcclxuXHRcdHJldHVybiB0aGlzLl9wYXJhbXMucmlnaHRzO1xyXG5cdH1cclxuXHRcclxuXHRfaGFuZGxlRXJyb3IoZXJyb3IpIHtcclxuXHRcdGlmICghZXJyb3IpXHJcblx0XHRcdFNOUF9MT0dHRVIuZXJyb3IobnVsbCwgbnVsbCwgXCJVbmRlZmluZWQgc3RlcCBlcnJvclwiKVxyXG5cdFx0ZWxzZSBpZiAoZXJyb3IuZXJyb3JDb2RlICYmIChlcnJvci5lcnJvckNvZGUgPT09IFBBWU1FTlRfRVJST1IuQUJPUlQpKVxyXG5cdFx0XHRTTlBfTE9HR0VSLmVycm9yKG51bGwsIG51bGwsIFwiUGF5bWVudCBhYm9ydFwiKVxyXG5cdFx0ZWxzZVxyXG5cdFx0XHRTTlBfTE9HR0VSLmVycm9yKG51bGwsIG51bGwsIFwiU3RlcCBmYWlsZWQgd2l0aCBlcnJvcjogXCIgKyBlcnJvci5tZXNzYWdlKVxyXG5cdH1cclxufSJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../script/steps/step-base.js\n");

/***/ }),

/***/ "../script/steps/step-change-handover.js":
/*!***********************************************!*\
  !*** ../script/steps/step-change-handover.js ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   StepChangeHandOver: () => (/* binding */ StepChangeHandOver)\n/* harmony export */ });\n/* harmony import */ var _step_base__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./step-base */ \"../script/steps/step-base.js\");\n/* harmony import */ var _kiosk_model__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../kiosk-model */ \"../script/kiosk-model.js\");\n/* harmony import */ var _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../kiosk-event-utils */ \"../script/kiosk-event-utils.js\");\n\r\n\r\n\r\n\r\nconst TRANSACTION_PROGRESS = \"dispensing-change\";\r\n\r\nclass StepChangeHandOver extends _step_base__WEBPACK_IMPORTED_MODULE_0__.Step {\r\n  #paymentFactory;\r\n\t\r\n\tconstructor(snappAPI, paymentFactory) {\r\n\t\tsuper(snappAPI);\r\n\t\tthis.#paymentFactory = paymentFactory;\r\n\t\tthis._stepType = _kiosk_model__WEBPACK_IMPORTED_MODULE_1__.KIOSK_CHECKOUT.CHANGE_HAND_OVER;\r\n\t}\r\n\t\r\n\t_doExecute() {\r\n\t\tif (typeof this._params.totalDue === 'undefined' || this._params.totalDue === null)\r\n      throw new Error(\"'totalDue' attribute is required for change hand over\");\r\n\t\tif (typeof this._params.totalTendered === 'undefined' || this._params.totalTendered === null)\r\n      throw new Error(\"'totalTendered' attribute is required for change hand over\");\r\n\r\n\t\tlet changeAmount = this.#calcAmountToReturn();\r\n\t\t\r\n\t\tif (changeAmount === 0) {\r\n\t\t\tSNP_LOGGER.debug(null, null, \"Change hand over not required\");\r\n\t\t\treturn Promise.resolve();\r\n\t\t}\r\n\t\t\r\n\t\treturn this.#changeHandOver(changeAmount)\r\n\t\t\t.then((payment) => this.#updateOrder(payment))\r\n\t}\r\n\t\r\n\t#calcAmountToReturn() {\r\n\t\tif (this._params.totalTendered >= this._params.totalDue)\r\n      return this._params.totalTendered - this._params.totalDue;\r\n    \r\n\t\treturn this._params.totalTendered;\r\n\t}\r\n\t\r\n\t#changeHandOver(changeAmount) {\r\n    SNP_LOGGER.debug(null, null, \"Change hand over\");\r\n\r\n \t\tlet paymentProcessor = this.#paymentFactory.findPaymentProcessorByPluginId(this._params.paymentMethodId);\r\n\t\t\r\n\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_2__.KioskEventUtils.triggerTransactionEvent(\"working\", TRANSACTION_PROGRESS, \"Dispensing change...\", this._params.transactionRef);\r\n\t\t\r\n\t\treturn paymentProcessor.refund(this._params.mainCurrency, changeAmount, () => this.#onPaymentPrcessorUpdate)\r\n\t\t\t\t.then((paymentResult) => {\r\n\t\t\t\t\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_2__.KioskEventUtils.triggerTransactionEvent(\"success\", TRANSACTION_PROGRESS, \"Dispensing change complete\", this._params.transactionRef);\r\n\t\t\t\t\t\treturn Promise.resolve(paymentResult.salePayment);\r\n\t\t\t\t\t})\r\n\t\t\t\t.catch(async (error) => {\r\n\t\t\t\t\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_2__.KioskEventUtils.triggerTransactionEvent(\"failed\", TRANSACTION_PROGRESS, error, this._params.transactionRef);\t\r\n\t\t\t\t\t\tthrow error;\r\n\t\t\t\t\t});\r\n\t}\r\n\t\r\n\t#onPaymentPrcessorUpdate(event){\r\n\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_2__.KioskEventUtils.triggerTransactionEvent(\"working\", TRANSACTION_PROGRESS, \"Dispensing change...\", this._params.transactionRef);\r\n\t}\r\n\r\n\t#updateOrder(salePayment) {\r\n    SNP_LOGGER.debug(null, null, \"Update Order: RefundOverPayment\");    \r\n\r\n    let reqDO = {\r\n      Sale: {\r\n\t\t  \t\tSaleId: this._params.transactionRef.saleId\r\n\t\t  \t}, \r\n      Transaction: {\t\t  \r\n\t\t\t\t\tPaymentList: []\r\n\t\t  \t}\r\n    };\r\n    \r\n\t\tif (salePayment)\r\n\t\t\treqDO.Transaction.PaymentList.push(salePayment);\r\n    \r\n    return this._snappAPI.cmd(\"TRANSACTION\", \"RefundOverPayment\", reqDO);\r\n\t}\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L3N0ZXBzL3N0ZXAtY2hhbmdlLWhhbmRvdmVyLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBbUM7QUFDYTtBQUNPO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNPLGlDQUFpQyw0Q0FBSTtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLHdEQUFjO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRSwrREFBZTtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxNQUFNLCtEQUFlO0FBQ3JCO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTSwrREFBZTtBQUNyQjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxFQUFFLCtEQUFlO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2tpb3NrLWNvbnRyb2xsZXIvLi4vc2NyaXB0L3N0ZXBzL3N0ZXAtY2hhbmdlLWhhbmRvdmVyLmpzP2I5NjIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3RlcCB9IGZyb20gJy4vc3RlcC1iYXNlJztcclxuaW1wb3J0IHsgS0lPU0tfQ0hFQ0tPVVQgfSBmcm9tIFwiLi4va2lvc2stbW9kZWxcIjtcclxuaW1wb3J0IHsgS2lvc2tFdmVudFV0aWxzIH0gZnJvbSAnLi4va2lvc2stZXZlbnQtdXRpbHMnO1xyXG5cclxuY29uc3QgVFJBTlNBQ1RJT05fUFJPR1JFU1MgPSBcImRpc3BlbnNpbmctY2hhbmdlXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgU3RlcENoYW5nZUhhbmRPdmVyIGV4dGVuZHMgU3RlcCB7XHJcbiAgI3BheW1lbnRGYWN0b3J5O1xyXG5cdFxyXG5cdGNvbnN0cnVjdG9yKHNuYXBwQVBJLCBwYXltZW50RmFjdG9yeSkge1xyXG5cdFx0c3VwZXIoc25hcHBBUEkpO1xyXG5cdFx0dGhpcy4jcGF5bWVudEZhY3RvcnkgPSBwYXltZW50RmFjdG9yeTtcclxuXHRcdHRoaXMuX3N0ZXBUeXBlID0gS0lPU0tfQ0hFQ0tPVVQuQ0hBTkdFX0hBTkRfT1ZFUjtcclxuXHR9XHJcblx0XHJcblx0X2RvRXhlY3V0ZSgpIHtcclxuXHRcdGlmICh0eXBlb2YgdGhpcy5fcGFyYW1zLnRvdGFsRHVlID09PSAndW5kZWZpbmVkJyB8fCB0aGlzLl9wYXJhbXMudG90YWxEdWUgPT09IG51bGwpXHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIid0b3RhbER1ZScgYXR0cmlidXRlIGlzIHJlcXVpcmVkIGZvciBjaGFuZ2UgaGFuZCBvdmVyXCIpO1xyXG5cdFx0aWYgKHR5cGVvZiB0aGlzLl9wYXJhbXMudG90YWxUZW5kZXJlZCA9PT0gJ3VuZGVmaW5lZCcgfHwgdGhpcy5fcGFyYW1zLnRvdGFsVGVuZGVyZWQgPT09IG51bGwpXHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIid0b3RhbFRlbmRlcmVkJyBhdHRyaWJ1dGUgaXMgcmVxdWlyZWQgZm9yIGNoYW5nZSBoYW5kIG92ZXJcIik7XHJcblxyXG5cdFx0bGV0IGNoYW5nZUFtb3VudCA9IHRoaXMuI2NhbGNBbW91bnRUb1JldHVybigpO1xyXG5cdFx0XHJcblx0XHRpZiAoY2hhbmdlQW1vdW50ID09PSAwKSB7XHJcblx0XHRcdFNOUF9MT0dHRVIuZGVidWcobnVsbCwgbnVsbCwgXCJDaGFuZ2UgaGFuZCBvdmVyIG5vdCByZXF1aXJlZFwiKTtcclxuXHRcdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRyZXR1cm4gdGhpcy4jY2hhbmdlSGFuZE92ZXIoY2hhbmdlQW1vdW50KVxyXG5cdFx0XHQudGhlbigocGF5bWVudCkgPT4gdGhpcy4jdXBkYXRlT3JkZXIocGF5bWVudCkpXHJcblx0fVxyXG5cdFxyXG5cdCNjYWxjQW1vdW50VG9SZXR1cm4oKSB7XHJcblx0XHRpZiAodGhpcy5fcGFyYW1zLnRvdGFsVGVuZGVyZWQgPj0gdGhpcy5fcGFyYW1zLnRvdGFsRHVlKVxyXG4gICAgICByZXR1cm4gdGhpcy5fcGFyYW1zLnRvdGFsVGVuZGVyZWQgLSB0aGlzLl9wYXJhbXMudG90YWxEdWU7XHJcbiAgICBcclxuXHRcdHJldHVybiB0aGlzLl9wYXJhbXMudG90YWxUZW5kZXJlZDtcclxuXHR9XHJcblx0XHJcblx0I2NoYW5nZUhhbmRPdmVyKGNoYW5nZUFtb3VudCkge1xyXG4gICAgU05QX0xPR0dFUi5kZWJ1ZyhudWxsLCBudWxsLCBcIkNoYW5nZSBoYW5kIG92ZXJcIik7XHJcblxyXG4gXHRcdGxldCBwYXltZW50UHJvY2Vzc29yID0gdGhpcy4jcGF5bWVudEZhY3RvcnkuZmluZFBheW1lbnRQcm9jZXNzb3JCeVBsdWdpbklkKHRoaXMuX3BhcmFtcy5wYXltZW50TWV0aG9kSWQpO1xyXG5cdFx0XHJcblx0XHRLaW9za0V2ZW50VXRpbHMudHJpZ2dlclRyYW5zYWN0aW9uRXZlbnQoXCJ3b3JraW5nXCIsIFRSQU5TQUNUSU9OX1BST0dSRVNTLCBcIkRpc3BlbnNpbmcgY2hhbmdlLi4uXCIsIHRoaXMuX3BhcmFtcy50cmFuc2FjdGlvblJlZik7XHJcblx0XHRcclxuXHRcdHJldHVybiBwYXltZW50UHJvY2Vzc29yLnJlZnVuZCh0aGlzLl9wYXJhbXMubWFpbkN1cnJlbmN5LCBjaGFuZ2VBbW91bnQsICgpID0+IHRoaXMuI29uUGF5bWVudFByY2Vzc29yVXBkYXRlKVxyXG5cdFx0XHRcdC50aGVuKChwYXltZW50UmVzdWx0KSA9PiB7XHJcblx0XHRcdFx0XHRcdEtpb3NrRXZlbnRVdGlscy50cmlnZ2VyVHJhbnNhY3Rpb25FdmVudChcInN1Y2Nlc3NcIiwgVFJBTlNBQ1RJT05fUFJPR1JFU1MsIFwiRGlzcGVuc2luZyBjaGFuZ2UgY29tcGxldGVcIiwgdGhpcy5fcGFyYW1zLnRyYW5zYWN0aW9uUmVmKTtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZShwYXltZW50UmVzdWx0LnNhbGVQYXltZW50KTtcclxuXHRcdFx0XHRcdH0pXHJcblx0XHRcdFx0LmNhdGNoKGFzeW5jIChlcnJvcikgPT4ge1xyXG5cdFx0XHRcdFx0XHRLaW9za0V2ZW50VXRpbHMudHJpZ2dlclRyYW5zYWN0aW9uRXZlbnQoXCJmYWlsZWRcIiwgVFJBTlNBQ1RJT05fUFJPR1JFU1MsIGVycm9yLCB0aGlzLl9wYXJhbXMudHJhbnNhY3Rpb25SZWYpO1x0XHJcblx0XHRcdFx0XHRcdHRocm93IGVycm9yO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0fVxyXG5cdFxyXG5cdCNvblBheW1lbnRQcmNlc3NvclVwZGF0ZShldmVudCl7XHJcblx0XHRLaW9za0V2ZW50VXRpbHMudHJpZ2dlclRyYW5zYWN0aW9uRXZlbnQoXCJ3b3JraW5nXCIsIFRSQU5TQUNUSU9OX1BST0dSRVNTLCBcIkRpc3BlbnNpbmcgY2hhbmdlLi4uXCIsIHRoaXMuX3BhcmFtcy50cmFuc2FjdGlvblJlZik7XHJcblx0fVxyXG5cclxuXHQjdXBkYXRlT3JkZXIoc2FsZVBheW1lbnQpIHtcclxuICAgIFNOUF9MT0dHRVIuZGVidWcobnVsbCwgbnVsbCwgXCJVcGRhdGUgT3JkZXI6IFJlZnVuZE92ZXJQYXltZW50XCIpOyAgICBcclxuXHJcbiAgICBsZXQgcmVxRE8gPSB7XHJcbiAgICAgIFNhbGU6IHtcclxuXHRcdCAgXHRcdFNhbGVJZDogdGhpcy5fcGFyYW1zLnRyYW5zYWN0aW9uUmVmLnNhbGVJZFxyXG5cdFx0ICBcdH0sIFxyXG4gICAgICBUcmFuc2FjdGlvbjoge1x0XHQgIFxyXG5cdFx0XHRcdFx0UGF5bWVudExpc3Q6IFtdXHJcblx0XHQgIFx0fVxyXG4gICAgfTtcclxuICAgIFxyXG5cdFx0aWYgKHNhbGVQYXltZW50KVxyXG5cdFx0XHRyZXFETy5UcmFuc2FjdGlvbi5QYXltZW50TGlzdC5wdXNoKHNhbGVQYXltZW50KTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHRoaXMuX3NuYXBwQVBJLmNtZChcIlRSQU5TQUNUSU9OXCIsIFwiUmVmdW5kT3ZlclBheW1lbnRcIiwgcmVxRE8pO1xyXG5cdH1cclxufSJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../script/steps/step-change-handover.js\n");

/***/ }),

/***/ "../script/steps/step-payment.js":
/*!***************************************!*\
  !*** ../script/steps/step-payment.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   StepPayment: () => (/* binding */ StepPayment)\n/* harmony export */ });\n/* harmony import */ var _step_base__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./step-base */ \"../script/steps/step-base.js\");\n/* harmony import */ var _print_receipt_processor__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./print-receipt-processor */ \"../script/steps/print-receipt-processor.js\");\n/* harmony import */ var _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../kiosk-event-utils */ \"../script/kiosk-event-utils.js\");\n/* harmony import */ var _common_script_errors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @common-script/errors */ \"../../../common-script/errors.js\");\n/* harmony import */ var _kiosk_model__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../kiosk-model */ \"../script/kiosk-model.js\");\n\r\n\r\n\r\n\r\n\r\n\r\nclass StepPayment extends _step_base__WEBPACK_IMPORTED_MODULE_0__.Step {\r\n\t#paymentFactory;\r\n\t#paymentMethodList = [];\r\n\r\n\tconstructor(snappAPI, paymentFactory) {\r\n\t\tsuper(snappAPI);\r\n\t\tthis._stepType = _kiosk_model__WEBPACK_IMPORTED_MODULE_4__.KIOSK_CHECKOUT.PAYMENT;\r\n\t\tthis.#paymentFactory = paymentFactory;\r\n\t}\r\n\r\n\tsetEnabledPaymentMethods(paymentMethodList) {\r\n\t\tthis.#paymentMethodList = paymentMethodList;\r\n\t}\r\n\r\n\t_doExecute() {\r\n\t\tif (typeof this._params.totalDue === 'undefined' || this._params.totalDue === null)\r\n\t\t\tthrow new Error(\"'totalDue' attribute is required for payment\");\r\n\t\treturn this.#processPayment();\r\n\t}\r\n\r\n\tasync #processPayment() {\r\n\t\tconst result = {\r\n\t\t\tsuccess: false,\r\n\t\t\texception: undefined,\r\n\t\t\tretry: false,\r\n\t\t\ttotalTendered: 0,\r\n\t\t\tpaymentList: [],\r\n\t\t\tpaymentResult: {},\r\n\t\t\treceiptDocTemplateId: null\r\n\t\t};\r\n\r\n\t\tif (this._params.totalDue == 0) {\r\n\t\t\tresult.totalTendered = 0;\r\n\t\t\tresult.success = true;\r\n\t\t\tSNP_LOGGER.debug(null, null, \"Payment not required\");\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tSNP_LOGGER.debug(null, null, \"Processing payment\");\r\n\r\n\t\tlet amount = this._params.totalDue;\r\n\r\n\t\tlet paymentProcessor = this.#getPaymentProcessorByPaymentMethodId(this._params.paymentMethodId);\r\n\r\n\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_2__.KioskEventUtils.triggerPaymentEvent(paymentProcessor.paymentType, \"working\", \"Processing: \" + paymentProcessor.description, amount, 0, amount);\r\n\r\n\t\tresult.receiptDocTemplateId = paymentProcessor.receiptDocTemplateId;\r\n\r\n\t\ttry {\r\n\t\t\tconst paymentResult = await this.#pay(paymentProcessor, amount);\r\n\r\n\t\t\tresult.paymentResult = paymentResult;\r\n\t\t\tresult.paymentList.push(paymentResult.salePayment);\r\n\t\t\tresult.totalTendered = paymentResult.salePayment.PaymentAmount;\r\n\t\t\tresult.success = true;\r\n\r\n\t\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_2__.KioskEventUtils.triggerPaymentEvent(paymentProcessor.paymentType, \"success\", \"Payment complete: \" + paymentProcessor.description, amount, this._params.tendered, this._params.balance);\r\n\t\t} catch (error) {\r\n\t\t\tthis._handleError(error);\r\n\t\t\tresult.success = false;\r\n\t\t\tresult.exception = error;\r\n\r\n\t\t\tif (error.paymentResult) {\r\n\t\t\t\tconst paymentResult = error.paymentResult\r\n\t\t\t\tresult.paymentResult = paymentResult;\r\n\t\t\t\tresult.paymentList.push(paymentResult.salePayment);\r\n\t\t\t}\r\n\r\n\t\t\tif (this._params.retryFailedPayment)\r\n\t\t\t\tresult.retry = await this.#dispatchPaymentFailed(error, paymentProcessor, amount);\r\n\t\t\telse \r\n\t\t\t\tresult.retry = false;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t#getPaymentProcessorByPaymentMethodId(paymentMethodId) {\r\n\t\tlet paymentMethod = this.#paymentMethodList.find(pm => pm.PluginId === paymentMethodId);\r\n\t\treturn this.#paymentFactory.getPaymentProcessor(paymentMethod);\r\n\t}\r\n\r\n\t#dispatchPaymentFailed(error, paymentProcessor, amount) {\r\n\t\treturn new Promise(resolve => {\r\n\t\t\tlet extraProperties = {\r\n\t\t\t\tdismiss: () => resolve(false),\r\n\t\t\t\tretry: () => resolve(true)\r\n\t\t\t};\r\n\r\n\t\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_2__.KioskEventUtils.triggerPaymentEvent(paymentProcessor.paymentType, \"failed\", error.message, amount, 0, amount, 0, extraProperties);\r\n\t\t});\r\n\t}\r\n\r\n\tasync voidLastPayment(voidParams) {\r\n\t\tconst result = {\r\n\t\t\tpaymentList: [],\r\n\t\t\tpaymentResult: {},\r\n\t\t\treceiptDocTemplateId: null\r\n\t\t};\r\n\r\n\t\tif (!voidParams.paymentList)\r\n\t\t\tthrow new Error(\"There are no payments to void in this transaction\");\r\n\r\n\t\tlet lastPayment = voidParams.paymentList[voidParams.paymentList.length - 1];\r\n\t\tlet paymentProcessor = this.#getPaymentProcessorByPaymentMethodId(lastPayment.PaymentMethodId);\r\n\r\n\t\tconst paymentResult = await paymentProcessor.void(this._params.mainCurrency, lastPayment, event => this.#onPaymentPrcessorUpdate(event));\r\n\r\n\t\tresult.paymentResult = paymentResult;\r\n\t\tresult.paymentList.push(paymentResult.salePayment);\r\n\t\tresult.receiptDocTemplateId = paymentProcessor.receiptDocTemplateId;\r\n\r\n\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_2__.KioskEventUtils.triggerPaymentEvent(paymentProcessor.paymentType, \"success\", \"Payment complete: \" + paymentProcessor.description, lastPayment.PaymentAmount, lastPayment.PaymentAmount, 0);\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t#onPaymentPrcessorUpdate(event) {\r\n\t\t_kiosk_event_utils__WEBPACK_IMPORTED_MODULE_2__.KioskEventUtils.triggerPaymentEvent(\r\n\t\t\tevent.processor.paymentType,\r\n\t\t\t\"working\",\r\n\t\t\t\"Processing: \" + event.processor.description,\r\n\t\t\tevent.due,\r\n\t\t\tevent.tendered,\r\n\t\t\tevent.due - event.tendered,\r\n\t\t\tevent.remainingTime);\r\n\t}\r\n\r\n\tasync #pay(paymentProcessor, amount) {\r\n\t\tlet paymentResult = await paymentProcessor.pay(this._params, event => this.#onPaymentPrcessorUpdate(event));\r\n\t\treturn paymentResult;\r\n\t}\r\n\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L3N0ZXBzL3N0ZXAtcGF5bWVudC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBbUM7QUFDK0I7QUFDWDtBQUNjO0FBQ3JCO0FBQ2hEO0FBQ08sMEJBQTBCLDRDQUFJO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsd0RBQWM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUUsK0RBQWU7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUcsK0RBQWU7QUFDbEIsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRywrREFBZTtBQUNsQixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFLCtEQUFlO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFLCtEQUFlO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2tpb3NrLWNvbnRyb2xsZXIvLi4vc2NyaXB0L3N0ZXBzL3N0ZXAtcGF5bWVudC5qcz85OTdmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN0ZXAgfSBmcm9tICcuL3N0ZXAtYmFzZSc7XHJcbmltcG9ydCB7IFByaW50UmVjZWlwdFByb2Nlc3NvciB9IGZyb20gJy4vcHJpbnQtcmVjZWlwdC1wcm9jZXNzb3InO1xyXG5pbXBvcnQgeyBLaW9za0V2ZW50VXRpbHMgfSBmcm9tICcuLi9raW9zay1ldmVudC11dGlscyc7XHJcbmltcG9ydCB7IEVQYXltZW50RXJyb3IsIFBBWU1FTlRfRVJST1IgfSBmcm9tICdAY29tbW9uLXNjcmlwdC9lcnJvcnMnO1xyXG5pbXBvcnQgeyBLSU9TS19DSEVDS09VVCB9IGZyb20gXCIuLi9raW9zay1tb2RlbFwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFN0ZXBQYXltZW50IGV4dGVuZHMgU3RlcCB7XHJcblx0I3BheW1lbnRGYWN0b3J5O1xyXG5cdCNwYXltZW50TWV0aG9kTGlzdCA9IFtdO1xyXG5cclxuXHRjb25zdHJ1Y3RvcihzbmFwcEFQSSwgcGF5bWVudEZhY3RvcnkpIHtcclxuXHRcdHN1cGVyKHNuYXBwQVBJKTtcclxuXHRcdHRoaXMuX3N0ZXBUeXBlID0gS0lPU0tfQ0hFQ0tPVVQuUEFZTUVOVDtcclxuXHRcdHRoaXMuI3BheW1lbnRGYWN0b3J5ID0gcGF5bWVudEZhY3Rvcnk7XHJcblx0fVxyXG5cclxuXHRzZXRFbmFibGVkUGF5bWVudE1ldGhvZHMocGF5bWVudE1ldGhvZExpc3QpIHtcclxuXHRcdHRoaXMuI3BheW1lbnRNZXRob2RMaXN0ID0gcGF5bWVudE1ldGhvZExpc3Q7XHJcblx0fVxyXG5cclxuXHRfZG9FeGVjdXRlKCkge1xyXG5cdFx0aWYgKHR5cGVvZiB0aGlzLl9wYXJhbXMudG90YWxEdWUgPT09ICd1bmRlZmluZWQnIHx8IHRoaXMuX3BhcmFtcy50b3RhbER1ZSA9PT0gbnVsbClcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiJ3RvdGFsRHVlJyBhdHRyaWJ1dGUgaXMgcmVxdWlyZWQgZm9yIHBheW1lbnRcIik7XHJcblx0XHRyZXR1cm4gdGhpcy4jcHJvY2Vzc1BheW1lbnQoKTtcclxuXHR9XHJcblxyXG5cdGFzeW5jICNwcm9jZXNzUGF5bWVudCgpIHtcclxuXHRcdGNvbnN0IHJlc3VsdCA9IHtcclxuXHRcdFx0c3VjY2VzczogZmFsc2UsXHJcblx0XHRcdGV4Y2VwdGlvbjogdW5kZWZpbmVkLFxyXG5cdFx0XHRyZXRyeTogZmFsc2UsXHJcblx0XHRcdHRvdGFsVGVuZGVyZWQ6IDAsXHJcblx0XHRcdHBheW1lbnRMaXN0OiBbXSxcclxuXHRcdFx0cGF5bWVudFJlc3VsdDoge30sXHJcblx0XHRcdHJlY2VpcHREb2NUZW1wbGF0ZUlkOiBudWxsXHJcblx0XHR9O1xyXG5cclxuXHRcdGlmICh0aGlzLl9wYXJhbXMudG90YWxEdWUgPT0gMCkge1xyXG5cdFx0XHRyZXN1bHQudG90YWxUZW5kZXJlZCA9IDA7XHJcblx0XHRcdHJlc3VsdC5zdWNjZXNzID0gdHJ1ZTtcclxuXHRcdFx0U05QX0xPR0dFUi5kZWJ1ZyhudWxsLCBudWxsLCBcIlBheW1lbnQgbm90IHJlcXVpcmVkXCIpO1xyXG5cdFx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdFx0fVxyXG5cclxuXHRcdFNOUF9MT0dHRVIuZGVidWcobnVsbCwgbnVsbCwgXCJQcm9jZXNzaW5nIHBheW1lbnRcIik7XHJcblxyXG5cdFx0bGV0IGFtb3VudCA9IHRoaXMuX3BhcmFtcy50b3RhbER1ZTtcclxuXHJcblx0XHRsZXQgcGF5bWVudFByb2Nlc3NvciA9IHRoaXMuI2dldFBheW1lbnRQcm9jZXNzb3JCeVBheW1lbnRNZXRob2RJZCh0aGlzLl9wYXJhbXMucGF5bWVudE1ldGhvZElkKTtcclxuXHJcblx0XHRLaW9za0V2ZW50VXRpbHMudHJpZ2dlclBheW1lbnRFdmVudChwYXltZW50UHJvY2Vzc29yLnBheW1lbnRUeXBlLCBcIndvcmtpbmdcIiwgXCJQcm9jZXNzaW5nOiBcIiArIHBheW1lbnRQcm9jZXNzb3IuZGVzY3JpcHRpb24sIGFtb3VudCwgMCwgYW1vdW50KTtcclxuXHJcblx0XHRyZXN1bHQucmVjZWlwdERvY1RlbXBsYXRlSWQgPSBwYXltZW50UHJvY2Vzc29yLnJlY2VpcHREb2NUZW1wbGF0ZUlkO1xyXG5cclxuXHRcdHRyeSB7XHJcblx0XHRcdGNvbnN0IHBheW1lbnRSZXN1bHQgPSBhd2FpdCB0aGlzLiNwYXkocGF5bWVudFByb2Nlc3NvciwgYW1vdW50KTtcclxuXHJcblx0XHRcdHJlc3VsdC5wYXltZW50UmVzdWx0ID0gcGF5bWVudFJlc3VsdDtcclxuXHRcdFx0cmVzdWx0LnBheW1lbnRMaXN0LnB1c2gocGF5bWVudFJlc3VsdC5zYWxlUGF5bWVudCk7XHJcblx0XHRcdHJlc3VsdC50b3RhbFRlbmRlcmVkID0gcGF5bWVudFJlc3VsdC5zYWxlUGF5bWVudC5QYXltZW50QW1vdW50O1xyXG5cdFx0XHRyZXN1bHQuc3VjY2VzcyA9IHRydWU7XHJcblxyXG5cdFx0XHRLaW9za0V2ZW50VXRpbHMudHJpZ2dlclBheW1lbnRFdmVudChwYXltZW50UHJvY2Vzc29yLnBheW1lbnRUeXBlLCBcInN1Y2Nlc3NcIiwgXCJQYXltZW50IGNvbXBsZXRlOiBcIiArIHBheW1lbnRQcm9jZXNzb3IuZGVzY3JpcHRpb24sIGFtb3VudCwgdGhpcy5fcGFyYW1zLnRlbmRlcmVkLCB0aGlzLl9wYXJhbXMuYmFsYW5jZSk7XHJcblx0XHR9IGNhdGNoIChlcnJvcikge1xyXG5cdFx0XHR0aGlzLl9oYW5kbGVFcnJvcihlcnJvcik7XHJcblx0XHRcdHJlc3VsdC5zdWNjZXNzID0gZmFsc2U7XHJcblx0XHRcdHJlc3VsdC5leGNlcHRpb24gPSBlcnJvcjtcclxuXHJcblx0XHRcdGlmIChlcnJvci5wYXltZW50UmVzdWx0KSB7XHJcblx0XHRcdFx0Y29uc3QgcGF5bWVudFJlc3VsdCA9IGVycm9yLnBheW1lbnRSZXN1bHRcclxuXHRcdFx0XHRyZXN1bHQucGF5bWVudFJlc3VsdCA9IHBheW1lbnRSZXN1bHQ7XHJcblx0XHRcdFx0cmVzdWx0LnBheW1lbnRMaXN0LnB1c2gocGF5bWVudFJlc3VsdC5zYWxlUGF5bWVudCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICh0aGlzLl9wYXJhbXMucmV0cnlGYWlsZWRQYXltZW50KVxyXG5cdFx0XHRcdHJlc3VsdC5yZXRyeSA9IGF3YWl0IHRoaXMuI2Rpc3BhdGNoUGF5bWVudEZhaWxlZChlcnJvciwgcGF5bWVudFByb2Nlc3NvciwgYW1vdW50KTtcclxuXHRcdFx0ZWxzZSBcclxuXHRcdFx0XHRyZXN1bHQucmV0cnkgPSBmYWxzZTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdH1cclxuXHJcblx0I2dldFBheW1lbnRQcm9jZXNzb3JCeVBheW1lbnRNZXRob2RJZChwYXltZW50TWV0aG9kSWQpIHtcclxuXHRcdGxldCBwYXltZW50TWV0aG9kID0gdGhpcy4jcGF5bWVudE1ldGhvZExpc3QuZmluZChwbSA9PiBwbS5QbHVnaW5JZCA9PT0gcGF5bWVudE1ldGhvZElkKTtcclxuXHRcdHJldHVybiB0aGlzLiNwYXltZW50RmFjdG9yeS5nZXRQYXltZW50UHJvY2Vzc29yKHBheW1lbnRNZXRob2QpO1xyXG5cdH1cclxuXHJcblx0I2Rpc3BhdGNoUGF5bWVudEZhaWxlZChlcnJvciwgcGF5bWVudFByb2Nlc3NvciwgYW1vdW50KSB7XHJcblx0XHRyZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcblx0XHRcdGxldCBleHRyYVByb3BlcnRpZXMgPSB7XHJcblx0XHRcdFx0ZGlzbWlzczogKCkgPT4gcmVzb2x2ZShmYWxzZSksXHJcblx0XHRcdFx0cmV0cnk6ICgpID0+IHJlc29sdmUodHJ1ZSlcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdEtpb3NrRXZlbnRVdGlscy50cmlnZ2VyUGF5bWVudEV2ZW50KHBheW1lbnRQcm9jZXNzb3IucGF5bWVudFR5cGUsIFwiZmFpbGVkXCIsIGVycm9yLm1lc3NhZ2UsIGFtb3VudCwgMCwgYW1vdW50LCAwLCBleHRyYVByb3BlcnRpZXMpO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHRhc3luYyB2b2lkTGFzdFBheW1lbnQodm9pZFBhcmFtcykge1xyXG5cdFx0Y29uc3QgcmVzdWx0ID0ge1xyXG5cdFx0XHRwYXltZW50TGlzdDogW10sXHJcblx0XHRcdHBheW1lbnRSZXN1bHQ6IHt9LFxyXG5cdFx0XHRyZWNlaXB0RG9jVGVtcGxhdGVJZDogbnVsbFxyXG5cdFx0fTtcclxuXHJcblx0XHRpZiAoIXZvaWRQYXJhbXMucGF5bWVudExpc3QpXHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIlRoZXJlIGFyZSBubyBwYXltZW50cyB0byB2b2lkIGluIHRoaXMgdHJhbnNhY3Rpb25cIik7XHJcblxyXG5cdFx0bGV0IGxhc3RQYXltZW50ID0gdm9pZFBhcmFtcy5wYXltZW50TGlzdFt2b2lkUGFyYW1zLnBheW1lbnRMaXN0Lmxlbmd0aCAtIDFdO1xyXG5cdFx0bGV0IHBheW1lbnRQcm9jZXNzb3IgPSB0aGlzLiNnZXRQYXltZW50UHJvY2Vzc29yQnlQYXltZW50TWV0aG9kSWQobGFzdFBheW1lbnQuUGF5bWVudE1ldGhvZElkKTtcclxuXHJcblx0XHRjb25zdCBwYXltZW50UmVzdWx0ID0gYXdhaXQgcGF5bWVudFByb2Nlc3Nvci52b2lkKHRoaXMuX3BhcmFtcy5tYWluQ3VycmVuY3ksIGxhc3RQYXltZW50LCBldmVudCA9PiB0aGlzLiNvblBheW1lbnRQcmNlc3NvclVwZGF0ZShldmVudCkpO1xyXG5cclxuXHRcdHJlc3VsdC5wYXltZW50UmVzdWx0ID0gcGF5bWVudFJlc3VsdDtcclxuXHRcdHJlc3VsdC5wYXltZW50TGlzdC5wdXNoKHBheW1lbnRSZXN1bHQuc2FsZVBheW1lbnQpO1xyXG5cdFx0cmVzdWx0LnJlY2VpcHREb2NUZW1wbGF0ZUlkID0gcGF5bWVudFByb2Nlc3Nvci5yZWNlaXB0RG9jVGVtcGxhdGVJZDtcclxuXHJcblx0XHRLaW9za0V2ZW50VXRpbHMudHJpZ2dlclBheW1lbnRFdmVudChwYXltZW50UHJvY2Vzc29yLnBheW1lbnRUeXBlLCBcInN1Y2Nlc3NcIiwgXCJQYXltZW50IGNvbXBsZXRlOiBcIiArIHBheW1lbnRQcm9jZXNzb3IuZGVzY3JpcHRpb24sIGxhc3RQYXltZW50LlBheW1lbnRBbW91bnQsIGxhc3RQYXltZW50LlBheW1lbnRBbW91bnQsIDApO1xyXG5cclxuXHRcdHJldHVybiByZXN1bHQ7XHJcblx0fVxyXG5cclxuXHQjb25QYXltZW50UHJjZXNzb3JVcGRhdGUoZXZlbnQpIHtcclxuXHRcdEtpb3NrRXZlbnRVdGlscy50cmlnZ2VyUGF5bWVudEV2ZW50KFxyXG5cdFx0XHRldmVudC5wcm9jZXNzb3IucGF5bWVudFR5cGUsXHJcblx0XHRcdFwid29ya2luZ1wiLFxyXG5cdFx0XHRcIlByb2Nlc3Npbmc6IFwiICsgZXZlbnQucHJvY2Vzc29yLmRlc2NyaXB0aW9uLFxyXG5cdFx0XHRldmVudC5kdWUsXHJcblx0XHRcdGV2ZW50LnRlbmRlcmVkLFxyXG5cdFx0XHRldmVudC5kdWUgLSBldmVudC50ZW5kZXJlZCxcclxuXHRcdFx0ZXZlbnQucmVtYWluaW5nVGltZSk7XHJcblx0fVxyXG5cclxuXHRhc3luYyAjcGF5KHBheW1lbnRQcm9jZXNzb3IsIGFtb3VudCkge1xyXG5cdFx0bGV0IHBheW1lbnRSZXN1bHQgPSBhd2FpdCBwYXltZW50UHJvY2Vzc29yLnBheSh0aGlzLl9wYXJhbXMsIGV2ZW50ID0+IHRoaXMuI29uUGF5bWVudFByY2Vzc29yVXBkYXRlKGV2ZW50KSk7XHJcblx0XHRyZXR1cm4gcGF5bWVudFJlc3VsdDtcclxuXHR9XHJcblxyXG59Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///../script/steps/step-payment.js\n");

/***/ }),

/***/ "../script/steps/step-print-payment-receipt.js":
/*!*****************************************************!*\
  !*** ../script/steps/step-print-payment-receipt.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   StepPrintTicketReceipt: () => (/* binding */ StepPrintTicketReceipt)\n/* harmony export */ });\n/* harmony import */ var _step_base__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./step-base */ \"../script/steps/step-base.js\");\n/* harmony import */ var _print_receipt_processor__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./print-receipt-processor */ \"../script/steps/print-receipt-processor.js\");\n/* harmony import */ var _kiosk_model__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../kiosk-model */ \"../script/kiosk-model.js\");\n\r\n\r\n\r\n\r\nconst CUT_COMMAND = {\"Type\":\"macro\",\"Macro\":{\"MacroName\":\"CUT\"}};\r\n\r\nclass StepPrintTicketReceipt extends _step_base__WEBPACK_IMPORTED_MODULE_0__.Step {\r\n\t#printReceiptProcessor;\r\n\t\r\n\tconstructor(snappAPI) {\r\n\t\tsuper(snappAPI);\r\n\t\tthis.#printReceiptProcessor = new _print_receipt_processor__WEBPACK_IMPORTED_MODULE_1__.PrintReceiptProcessor(DEVICE_MANAGER);\r\n\t\tthis._stepType = _kiosk_model__WEBPACK_IMPORTED_MODULE_2__.KIOSK_CHECKOUT.PRINT_PAYMENT_RECEIPT;\r\n\t}\r\n\t\r\n\t_doExecute() {\r\n\t\tif (!this._params.receiptDocTemplateId) {\r\n\t\t\tSNP_LOGGER.debug(null, null, \"Payment receipt not required, receipt template not configured\");\r\n\t\t\treturn Promise.resolve();\r\n\t\t}\r\n\t\t\r\n\t\treturn this.#printPaymentReceipt(this._params.deviceReceipts, this._params.receiptDocTemplateId, this._params.salePayment);\r\n\t}\r\n\r\n\tasync #printPaymentReceipt(deviceReceipts, docTemplateId, salePayment) {\r\n\t\ttry {\r\n\t\t\tif (this.#canPrintReceipt(deviceReceipts, docTemplateId, salePayment)) {\r\n\t\t\t\tSNP_LOGGER.debug(null, null, \"Printing payment receipt\");\r\n\t\t\t\tconst receipt = await this.#getParsedPaymentReceipt(deviceReceipts, docTemplateId, salePayment);\r\n\t\t\t\tawait this.#printReceipt(receipt.Template.DriverList, receipt.ReceiptPrintTemplate)\r\n\t\t\t} else {\r\n\t\t\t\tSNP_LOGGER.debug(null, null, \"Payment receipt not printed due to printing criteria not satisfied\");\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tSNP_LOGGER.error(null, null, error); //A failure during the print of the receipt should not make the transaction to fail\r\n\t\t}\r\n\t}\r\n\t\r\n\t#canPrintReceipt(deviceReceipts, docTemplateId, salePayment) {\r\n\t\treturn docTemplateId && (this.#hasDeviceReceipt(deviceReceipts) || this.#hasPaymentData(salePayment));\r\n\t}\r\n\r\n\t#hasDeviceReceipt(deviceReceipts) {\r\n\t\treturn deviceReceipts && (deviceReceipts.CustomerReceipt || deviceReceipts.MerchantReceipt);\r\n\t}\r\n\r\n\t#hasPaymentData(salePayment) {\r\n\t\treturn salePayment && salePayment.PaymentDataList && salePayment.PaymentDataList.length;\r\n\t}\r\n\r\n\tasync #getParsedPaymentReceipt(deviceReceipts, docTemplateId, salePayment) {\r\n\t\tSNP_LOGGER.debug(null, null, \"Get payment receipt\");\r\n\r\n\t\tlet req = {\r\n\t\t\tShopCartId: this._params.shopCartId,\r\n\t\t\tTransactionId: this._params.transactionRef ? this._params.transactionRef.transactionId : null,\r\n\t\t\tDeviceReceipts: deviceReceipts,\r\n\t\t\tDocTemplateId: docTemplateId,\r\n\t\t\tPayment: salePayment\r\n\t\t}\r\n\r\n\t\treturn await this._snappAPI.cmd(\"TRANSACTION\", \"GetParsedPaymentReceipt\", req);\r\n\t}\r\n\r\n\tasync #printReceipt(driverList, receiptPrintTemplate) {\r\n\t\tSNP_LOGGER.debug(null, null, \"Printing payment receipt\");\r\n\r\n\t\treturn await this.#printReceiptProcessor.print(receiptPrintTemplate, driverList, this._params.transactionRef);\r\n\t}\r\n\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L3N0ZXBzL3N0ZXAtcHJpbnQtcGF5bWVudC1yZWNlaXB0LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBbUM7QUFDK0I7QUFDbEI7QUFDaEQ7QUFDQSxxQkFBcUIsd0JBQXdCO0FBQzdDO0FBQ08scUNBQXFDLDRDQUFJO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLDJFQUFxQjtBQUN6RCxtQkFBbUIsd0RBQWM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsSUFBSTtBQUNKLHdDQUF3QztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9raW9zay1jb250cm9sbGVyLy4uL3NjcmlwdC9zdGVwcy9zdGVwLXByaW50LXBheW1lbnQtcmVjZWlwdC5qcz8yZDI2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN0ZXAgfSBmcm9tICcuL3N0ZXAtYmFzZSc7XHJcbmltcG9ydCB7IFByaW50UmVjZWlwdFByb2Nlc3NvciB9IGZyb20gJy4vcHJpbnQtcmVjZWlwdC1wcm9jZXNzb3InO1xyXG5pbXBvcnQgeyBLSU9TS19DSEVDS09VVCB9IGZyb20gXCIuLi9raW9zay1tb2RlbFwiO1xyXG5cclxuY29uc3QgQ1VUX0NPTU1BTkQgPSB7XCJUeXBlXCI6XCJtYWNyb1wiLFwiTWFjcm9cIjp7XCJNYWNyb05hbWVcIjpcIkNVVFwifX07XHJcblxyXG5leHBvcnQgY2xhc3MgU3RlcFByaW50VGlja2V0UmVjZWlwdCBleHRlbmRzIFN0ZXAge1xyXG5cdCNwcmludFJlY2VpcHRQcm9jZXNzb3I7XHJcblx0XHJcblx0Y29uc3RydWN0b3Ioc25hcHBBUEkpIHtcclxuXHRcdHN1cGVyKHNuYXBwQVBJKTtcclxuXHRcdHRoaXMuI3ByaW50UmVjZWlwdFByb2Nlc3NvciA9IG5ldyBQcmludFJlY2VpcHRQcm9jZXNzb3IoREVWSUNFX01BTkFHRVIpO1xyXG5cdFx0dGhpcy5fc3RlcFR5cGUgPSBLSU9TS19DSEVDS09VVC5QUklOVF9QQVlNRU5UX1JFQ0VJUFQ7XHJcblx0fVxyXG5cdFxyXG5cdF9kb0V4ZWN1dGUoKSB7XHJcblx0XHRpZiAoIXRoaXMuX3BhcmFtcy5yZWNlaXB0RG9jVGVtcGxhdGVJZCkge1xyXG5cdFx0XHRTTlBfTE9HR0VSLmRlYnVnKG51bGwsIG51bGwsIFwiUGF5bWVudCByZWNlaXB0IG5vdCByZXF1aXJlZCwgcmVjZWlwdCB0ZW1wbGF0ZSBub3QgY29uZmlndXJlZFwiKTtcclxuXHRcdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRyZXR1cm4gdGhpcy4jcHJpbnRQYXltZW50UmVjZWlwdCh0aGlzLl9wYXJhbXMuZGV2aWNlUmVjZWlwdHMsIHRoaXMuX3BhcmFtcy5yZWNlaXB0RG9jVGVtcGxhdGVJZCwgdGhpcy5fcGFyYW1zLnNhbGVQYXltZW50KTtcclxuXHR9XHJcblxyXG5cdGFzeW5jICNwcmludFBheW1lbnRSZWNlaXB0KGRldmljZVJlY2VpcHRzLCBkb2NUZW1wbGF0ZUlkLCBzYWxlUGF5bWVudCkge1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0aWYgKHRoaXMuI2NhblByaW50UmVjZWlwdChkZXZpY2VSZWNlaXB0cywgZG9jVGVtcGxhdGVJZCwgc2FsZVBheW1lbnQpKSB7XHJcblx0XHRcdFx0U05QX0xPR0dFUi5kZWJ1ZyhudWxsLCBudWxsLCBcIlByaW50aW5nIHBheW1lbnQgcmVjZWlwdFwiKTtcclxuXHRcdFx0XHRjb25zdCByZWNlaXB0ID0gYXdhaXQgdGhpcy4jZ2V0UGFyc2VkUGF5bWVudFJlY2VpcHQoZGV2aWNlUmVjZWlwdHMsIGRvY1RlbXBsYXRlSWQsIHNhbGVQYXltZW50KTtcclxuXHRcdFx0XHRhd2FpdCB0aGlzLiNwcmludFJlY2VpcHQocmVjZWlwdC5UZW1wbGF0ZS5Ecml2ZXJMaXN0LCByZWNlaXB0LlJlY2VpcHRQcmludFRlbXBsYXRlKVxyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFNOUF9MT0dHRVIuZGVidWcobnVsbCwgbnVsbCwgXCJQYXltZW50IHJlY2VpcHQgbm90IHByaW50ZWQgZHVlIHRvIHByaW50aW5nIGNyaXRlcmlhIG5vdCBzYXRpc2ZpZWRcIik7XHJcblx0XHRcdH1cclxuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XHJcblx0XHRcdFNOUF9MT0dHRVIuZXJyb3IobnVsbCwgbnVsbCwgZXJyb3IpOyAvL0EgZmFpbHVyZSBkdXJpbmcgdGhlIHByaW50IG9mIHRoZSByZWNlaXB0IHNob3VsZCBub3QgbWFrZSB0aGUgdHJhbnNhY3Rpb24gdG8gZmFpbFxyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHQjY2FuUHJpbnRSZWNlaXB0KGRldmljZVJlY2VpcHRzLCBkb2NUZW1wbGF0ZUlkLCBzYWxlUGF5bWVudCkge1xyXG5cdFx0cmV0dXJuIGRvY1RlbXBsYXRlSWQgJiYgKHRoaXMuI2hhc0RldmljZVJlY2VpcHQoZGV2aWNlUmVjZWlwdHMpIHx8IHRoaXMuI2hhc1BheW1lbnREYXRhKHNhbGVQYXltZW50KSk7XHJcblx0fVxyXG5cclxuXHQjaGFzRGV2aWNlUmVjZWlwdChkZXZpY2VSZWNlaXB0cykge1xyXG5cdFx0cmV0dXJuIGRldmljZVJlY2VpcHRzICYmIChkZXZpY2VSZWNlaXB0cy5DdXN0b21lclJlY2VpcHQgfHwgZGV2aWNlUmVjZWlwdHMuTWVyY2hhbnRSZWNlaXB0KTtcclxuXHR9XHJcblxyXG5cdCNoYXNQYXltZW50RGF0YShzYWxlUGF5bWVudCkge1xyXG5cdFx0cmV0dXJuIHNhbGVQYXltZW50ICYmIHNhbGVQYXltZW50LlBheW1lbnREYXRhTGlzdCAmJiBzYWxlUGF5bWVudC5QYXltZW50RGF0YUxpc3QubGVuZ3RoO1xyXG5cdH1cclxuXHJcblx0YXN5bmMgI2dldFBhcnNlZFBheW1lbnRSZWNlaXB0KGRldmljZVJlY2VpcHRzLCBkb2NUZW1wbGF0ZUlkLCBzYWxlUGF5bWVudCkge1xyXG5cdFx0U05QX0xPR0dFUi5kZWJ1ZyhudWxsLCBudWxsLCBcIkdldCBwYXltZW50IHJlY2VpcHRcIik7XHJcblxyXG5cdFx0bGV0IHJlcSA9IHtcclxuXHRcdFx0U2hvcENhcnRJZDogdGhpcy5fcGFyYW1zLnNob3BDYXJ0SWQsXHJcblx0XHRcdFRyYW5zYWN0aW9uSWQ6IHRoaXMuX3BhcmFtcy50cmFuc2FjdGlvblJlZiA/IHRoaXMuX3BhcmFtcy50cmFuc2FjdGlvblJlZi50cmFuc2FjdGlvbklkIDogbnVsbCxcclxuXHRcdFx0RGV2aWNlUmVjZWlwdHM6IGRldmljZVJlY2VpcHRzLFxyXG5cdFx0XHREb2NUZW1wbGF0ZUlkOiBkb2NUZW1wbGF0ZUlkLFxyXG5cdFx0XHRQYXltZW50OiBzYWxlUGF5bWVudFxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBhd2FpdCB0aGlzLl9zbmFwcEFQSS5jbWQoXCJUUkFOU0FDVElPTlwiLCBcIkdldFBhcnNlZFBheW1lbnRSZWNlaXB0XCIsIHJlcSk7XHJcblx0fVxyXG5cclxuXHRhc3luYyAjcHJpbnRSZWNlaXB0KGRyaXZlckxpc3QsIHJlY2VpcHRQcmludFRlbXBsYXRlKSB7XHJcblx0XHRTTlBfTE9HR0VSLmRlYnVnKG51bGwsIG51bGwsIFwiUHJpbnRpbmcgcGF5bWVudCByZWNlaXB0XCIpO1xyXG5cclxuXHRcdHJldHVybiBhd2FpdCB0aGlzLiNwcmludFJlY2VpcHRQcm9jZXNzb3IucHJpbnQocmVjZWlwdFByaW50VGVtcGxhdGUsIGRyaXZlckxpc3QsIHRoaXMuX3BhcmFtcy50cmFuc2FjdGlvblJlZik7XHJcblx0fVxyXG5cclxufSJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../script/steps/step-print-payment-receipt.js\n");

/***/ }),

/***/ "../script/steps/step-print-receipt.js":
/*!*********************************************!*\
  !*** ../script/steps/step-print-receipt.js ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   StepPrintReceipt: () => (/* binding */ StepPrintReceipt)\n/* harmony export */ });\n/* harmony import */ var _step_base__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./step-base */ \"../script/steps/step-base.js\");\n/* harmony import */ var _print_receipt_processor__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./print-receipt-processor */ \"../script/steps/print-receipt-processor.js\");\n/* harmony import */ var _kiosk_model__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../kiosk-model */ \"../script/kiosk-model.js\");\n\r\n\r\n\r\n\r\nconst CUT_COMMAND = {\"Type\":\"macro\",\"Macro\":{\"MacroName\":\"CUT\"}};\r\n\r\nclass StepPrintReceipt extends _step_base__WEBPACK_IMPORTED_MODULE_0__.Step {\r\n\t#printReceiptProcessor;\r\n\t\r\n\tconstructor(snappAPI) {\r\n\t\tsuper(snappAPI);\r\n\t\tthis.#printReceiptProcessor = new _print_receipt_processor__WEBPACK_IMPORTED_MODULE_1__.PrintReceiptProcessor(DEVICE_MANAGER);\r\n\t\tthis._stepType = _kiosk_model__WEBPACK_IMPORTED_MODULE_2__.KIOSK_CHECKOUT.PRINT_RECEIPT;\r\n\t}\r\n\t\r\n\t_doExecute() {\r\n\t\tif (!this._params.transactionRef || !this._params.transactionRef.transactionId || !this._params.trnReceiptDocTemplateId) {\r\n\t\t\tSNP_LOGGER.debug(null, null, \"Transaction receipt not required\");\r\n\t\t\treturn Promise.resolve();\r\n\t\t}\r\n\t\t\r\n\t\treturn this.#getParsedTransactionReceipt()\r\n\t\t\t.then(ans => this.#printReceipt(ans.Template.DriverList, ans.ReceiptPrintTemplate))\r\n\t}\r\n\t\r\n\t#getParsedTransactionReceipt() {\r\n    SNP_LOGGER.debug(null, null, \"Get transaction receipt\");\r\n\r\n    if (!this._params.trnReceiptDocTemplateId) \r\n      throw new Error(\"Unable to print receipt, transaction receipt template not set for this workstation\");\r\n\r\n    let reqDO = {\r\n      \"TransactionId\": this._params.transactionRef.transactionId, \r\n      \"DocTemplateId\": this._params.trnReceiptDocTemplateId\r\n    };\r\n    \r\n    return this._snappAPI.cmd(\"TRANSACTION\", \"GetParsedTransactionReceipt\", reqDO)\r\n\t}\r\n\t\r\n\t#appendCutCommand(receiptPrintTemplate) {\r\n\t\treceiptPrintTemplate.ControlsList.push(CUT_COMMAND);\r\n\t}\r\n\t\r\n\t#printReceipt(driverList, receiptPrintTemplate) {\r\n\t\tif (this._params.rights.AutomaticReceiptCut)\r\n\t\t\tthis.#appendCutCommand(receiptPrintTemplate);\r\n\t\t\t\r\n    SNP_LOGGER.debug(null, null, \"Printing transaction receipt\");\r\n    return this.#printReceiptProcessor.print(receiptPrintTemplate, driverList, this._params.transactionRef);\r\n  }\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L3N0ZXBzL3N0ZXAtcHJpbnQtcmVjZWlwdC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQW1DO0FBQytCO0FBQ2xCO0FBQ2hEO0FBQ0EscUJBQXFCLHdCQUF3QjtBQUM3QztBQUNPLCtCQUErQiw0Q0FBSTtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQywyRUFBcUI7QUFDekQsbUJBQW1CLHdEQUFjO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9raW9zay1jb250cm9sbGVyLy4uL3NjcmlwdC9zdGVwcy9zdGVwLXByaW50LXJlY2VpcHQuanM/M2NjNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTdGVwIH0gZnJvbSAnLi9zdGVwLWJhc2UnO1xyXG5pbXBvcnQgeyBQcmludFJlY2VpcHRQcm9jZXNzb3IgfSBmcm9tICcuL3ByaW50LXJlY2VpcHQtcHJvY2Vzc29yJztcclxuaW1wb3J0IHsgS0lPU0tfQ0hFQ0tPVVQgfSBmcm9tIFwiLi4va2lvc2stbW9kZWxcIjtcclxuXHJcbmNvbnN0IENVVF9DT01NQU5EID0ge1wiVHlwZVwiOlwibWFjcm9cIixcIk1hY3JvXCI6e1wiTWFjcm9OYW1lXCI6XCJDVVRcIn19O1xyXG5cclxuZXhwb3J0IGNsYXNzIFN0ZXBQcmludFJlY2VpcHQgZXh0ZW5kcyBTdGVwIHtcclxuXHQjcHJpbnRSZWNlaXB0UHJvY2Vzc29yO1xyXG5cdFxyXG5cdGNvbnN0cnVjdG9yKHNuYXBwQVBJKSB7XHJcblx0XHRzdXBlcihzbmFwcEFQSSk7XHJcblx0XHR0aGlzLiNwcmludFJlY2VpcHRQcm9jZXNzb3IgPSBuZXcgUHJpbnRSZWNlaXB0UHJvY2Vzc29yKERFVklDRV9NQU5BR0VSKTtcclxuXHRcdHRoaXMuX3N0ZXBUeXBlID0gS0lPU0tfQ0hFQ0tPVVQuUFJJTlRfUkVDRUlQVDtcclxuXHR9XHJcblx0XHJcblx0X2RvRXhlY3V0ZSgpIHtcclxuXHRcdGlmICghdGhpcy5fcGFyYW1zLnRyYW5zYWN0aW9uUmVmIHx8ICF0aGlzLl9wYXJhbXMudHJhbnNhY3Rpb25SZWYudHJhbnNhY3Rpb25JZCB8fCAhdGhpcy5fcGFyYW1zLnRyblJlY2VpcHREb2NUZW1wbGF0ZUlkKSB7XHJcblx0XHRcdFNOUF9MT0dHRVIuZGVidWcobnVsbCwgbnVsbCwgXCJUcmFuc2FjdGlvbiByZWNlaXB0IG5vdCByZXF1aXJlZFwiKTtcclxuXHRcdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRyZXR1cm4gdGhpcy4jZ2V0UGFyc2VkVHJhbnNhY3Rpb25SZWNlaXB0KClcclxuXHRcdFx0LnRoZW4oYW5zID0+IHRoaXMuI3ByaW50UmVjZWlwdChhbnMuVGVtcGxhdGUuRHJpdmVyTGlzdCwgYW5zLlJlY2VpcHRQcmludFRlbXBsYXRlKSlcclxuXHR9XHJcblx0XHJcblx0I2dldFBhcnNlZFRyYW5zYWN0aW9uUmVjZWlwdCgpIHtcclxuICAgIFNOUF9MT0dHRVIuZGVidWcobnVsbCwgbnVsbCwgXCJHZXQgdHJhbnNhY3Rpb24gcmVjZWlwdFwiKTtcclxuXHJcbiAgICBpZiAoIXRoaXMuX3BhcmFtcy50cm5SZWNlaXB0RG9jVGVtcGxhdGVJZCkgXHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuYWJsZSB0byBwcmludCByZWNlaXB0LCB0cmFuc2FjdGlvbiByZWNlaXB0IHRlbXBsYXRlIG5vdCBzZXQgZm9yIHRoaXMgd29ya3N0YXRpb25cIik7XHJcblxyXG4gICAgbGV0IHJlcURPID0ge1xyXG4gICAgICBcIlRyYW5zYWN0aW9uSWRcIjogdGhpcy5fcGFyYW1zLnRyYW5zYWN0aW9uUmVmLnRyYW5zYWN0aW9uSWQsIFxyXG4gICAgICBcIkRvY1RlbXBsYXRlSWRcIjogdGhpcy5fcGFyYW1zLnRyblJlY2VpcHREb2NUZW1wbGF0ZUlkXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICByZXR1cm4gdGhpcy5fc25hcHBBUEkuY21kKFwiVFJBTlNBQ1RJT05cIiwgXCJHZXRQYXJzZWRUcmFuc2FjdGlvblJlY2VpcHRcIiwgcmVxRE8pXHJcblx0fVxyXG5cdFxyXG5cdCNhcHBlbmRDdXRDb21tYW5kKHJlY2VpcHRQcmludFRlbXBsYXRlKSB7XHJcblx0XHRyZWNlaXB0UHJpbnRUZW1wbGF0ZS5Db250cm9sc0xpc3QucHVzaChDVVRfQ09NTUFORCk7XHJcblx0fVxyXG5cdFxyXG5cdCNwcmludFJlY2VpcHQoZHJpdmVyTGlzdCwgcmVjZWlwdFByaW50VGVtcGxhdGUpIHtcclxuXHRcdGlmICh0aGlzLl9wYXJhbXMucmlnaHRzLkF1dG9tYXRpY1JlY2VpcHRDdXQpXHJcblx0XHRcdHRoaXMuI2FwcGVuZEN1dENvbW1hbmQocmVjZWlwdFByaW50VGVtcGxhdGUpO1xyXG5cdFx0XHRcclxuICAgIFNOUF9MT0dHRVIuZGVidWcobnVsbCwgbnVsbCwgXCJQcmludGluZyB0cmFuc2FjdGlvbiByZWNlaXB0XCIpO1xyXG4gICAgcmV0dXJuIHRoaXMuI3ByaW50UmVjZWlwdFByb2Nlc3Nvci5wcmludChyZWNlaXB0UHJpbnRUZW1wbGF0ZSwgZHJpdmVyTGlzdCwgdGhpcy5fcGFyYW1zLnRyYW5zYWN0aW9uUmVmKTtcclxuICB9XHJcbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///../script/steps/step-print-receipt.js\n");

/***/ }),

/***/ "../script/steps/step-print-ticket.js":
/*!********************************************!*\
  !*** ../script/steps/step-print-ticket.js ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DELIVERY_OPTIONS: () => (/* binding */ DELIVERY_OPTIONS),\n/* harmony export */   StepPrintTicket: () => (/* binding */ StepPrintTicket)\n/* harmony export */ });\n/* harmony import */ var _step_base__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./step-base */ \"../script/steps/step-base.js\");\n/* harmony import */ var _print_media_processor__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./print-media-processor */ \"../script/steps/print-media-processor.js\");\n/* harmony import */ var _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../kiosk-event-utils */ \"../script/kiosk-event-utils.js\");\n/* harmony import */ var _kiosk_model__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../kiosk-model */ \"../script/kiosk-model.js\");\n/* harmony import */ var _common_script_errors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @common-script/errors */ \"../../../common-script/errors.js\");\n\r\n\r\n\r\n\r\n\r\n\r\nconst DELIVERY_OPTIONS = Object.freeze({ \r\n    PRINT: {\r\n        code: \"PRINT\", \r\n        value: 1\r\n    },\r\n    GO_GREEN: {\r\n        code: \"GO-GREEN\",\r\n        value: 2\r\n    },\r\n    PRINT_AT_HOME: {\r\n        code: \"PRINT-AT-HOME\",\r\n        value: 3\r\n    } \r\n});\r\n\r\nclass StepPrintTicket extends _step_base__WEBPACK_IMPORTED_MODULE_0__.Step {\r\n    #printMediaProcessor;\r\n    #orderConfirmationTemplateId;\r\n\r\n    constructor(snappAPI) {\r\n        super(snappAPI);\r\n        this.#printMediaProcessor = new _print_media_processor__WEBPACK_IMPORTED_MODULE_1__.PrintMediaProcessor(DEVICE_MANAGER);\r\n        this._stepType = _kiosk_model__WEBPACK_IMPORTED_MODULE_3__.KIOSK_CHECKOUT.PRINT_TICKET;\r\n    }\r\n\r\n    /**\r\n     * @param {string} orderConfirmationTemplateId\r\n     */\r\n    set orderConfirmationTemplateId(orderConfirmationTemplateId) {\r\n        this.#orderConfirmationTemplateId = orderConfirmationTemplateId;\r\n    }\r\n\r\n    _doExecute() {\r\n        return this.#printItems();\r\n    }\r\n\r\n    get transactionRef() {\r\n        return this._params.transactionRef;\r\n    }\r\n\r\n    async #printItems() {\r\n        let result = {printedMedia: [], printCompleted: false, saleCompleted: false};\r\n \r\n        const deliveryOptionFunction = this.deliveryOptionsMap[this._params.deliveryOption];\r\n        if (!deliveryOptionFunction) \r\n            throw new _common_script_errors__WEBPACK_IMPORTED_MODULE_4__.EPrintError(`Selected print option ${this._params.deliveryOption} not recognized`, null);\r\n            \r\n        result = await deliveryOptionFunction.call(this);\r\n        \r\n        return result;\r\n    }\r\n\r\n    get printAtHomeIsEnabled() {\r\n        return !!this._params.rights.KSK_OrderConfirmationDocTemplateId;\r\n    }\r\n\r\n    #printTicketRequired() {\r\n        return this._params.itemsToPrint && this._params.itemsToPrint.PrintItemList && (this._params.itemsToPrint.PrintItemList.length > 0);\r\n    }\r\n\r\n    async #printPhysicalTickets() {\r\n        let saleCompleted = this._params.saleCompleted;\r\n        if (this.printAtHomeIsEnabled && !this._params.itemsToPrint.PrintItemList) {\r\n            let result;\r\n            if (saleCompleted)\r\n                result = await this.#callSaleGenerateMediaAPI(this.#prepareGenerateMediaReqForPrintTickets());\r\n            else\r\n                result = await this.#callSaleCompleteAPI(this.#prepareRequestForPrintTickets());\r\n            saleCompleted = true;\r\n            this._params.itemsToPrint = result.itemsToPrint;\r\n            this.transactionRef.ticketCount =  result.itemsToPrint.PrintItemList ? result.itemsToPrint.PrintItemList.length : 0;\r\n        }        \r\n\r\n        const result = {printedMedia: [], printCompleted: true, saleCompleted: saleCompleted};\r\n\r\n        if (this._params.itemsToPrint && this._params.itemsToPrint.NotPrintableItemsCount > 0)\r\n            throw new _common_script_errors__WEBPACK_IMPORTED_MODULE_4__.EPrintError(\"There are products not printable at this station\", null);\r\n\r\n        if (!this.#printTicketRequired()) {\r\n            SNP_LOGGER.debug(null, null, \"Print ticket not required\");\r\n            return result;\r\n        } \r\n \r\n        let extraProperties = {\r\n            ticketPrint: {\r\n                currentTicketNo: 0\r\n            }\r\n        };\r\n\r\n        _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_2__.KioskEventUtils.triggerTransactionEvent(\"working\", \"print-ticket\", \"Printing ticket\", this.transactionRef, extraProperties);\r\n\r\n        SNP_LOGGER.debug(null, null, \"Printing tickets\");\r\n        result.printedMedia = await this.#printMediaProcessor.print(this._params.itemsToPrint.PrintItemList, this.transactionRef);\r\n\r\n        return result;\r\n    }\r\n\r\n    async #dispatchEventForVirtualTickets() {\r\n        let printCompleted = true;\r\n        let saleCompleted = this._params.saleCompleted;\r\n        if (!saleCompleted && this.printAtHomeIsEnabled && !this._params.itemsToPrint.PrintItemList) {\r\n            await this.#callSaleCompleteAPI(this.#prepareRequestForVirtualTickets());\r\n            saleCompleted = true;\r\n        }        \r\n\r\n        printCompleted = await this.#triggerVirtualPrintEvent();\r\n\r\n        return {printedMedia: [], printCompleted: printCompleted, saleCompleted: saleCompleted};\r\n    }\r\n\r\n    async #printAtHome() {\r\n        let printCompleted = false;\r\n        let saleCompleted = this._params.saleCompleted;\r\n \r\n        let result = await this.#triggerEmailImputEvent(this.transactionRef);\r\n        if (result.completed) {\r\n            if (!result.email)\r\n                throw new _common_script_errors__WEBPACK_IMPORTED_MODULE_4__.EPrintError(\"Email not valid\", []);\r\n            else {\r\n                SNP_LOGGER.debug(null, null, \"Sending order confirmation\");\r\n                if (saleCompleted)\r\n                   await this.#callSaleGenerateMediaAPI(this.#prepareGenerateMediaReqForPrintAtHome(result.email ? result.email : \"\"));\r\n                else\r\n                   await this.#callSaleCompleteAPI(this.#prepareRequestForPrintAtHome(result.email ? result.email : \"\"));\r\n                saleCompleted = true;\r\n                printCompleted = true;\r\n            }\r\n        }\r\n        return {printedMedia: [], printCompleted: printCompleted, saleCompleted: saleCompleted};\r\n    }\r\n\r\n    #triggerVirtualPrintEvent() {\r\n        return new Promise(resolve => {\r\n            let extraProperties = {\r\n                virtualTicketList: this._params.itemsToPrint.PrintItemList,\r\n                virtualPrintCallback: () => resolve(true),\r\n                virtualGoBackCallback: () => resolve(false)\r\n            };\r\n\r\n            if (!this._getRights().MobileWalletSaleTemplateId || !this._getRights().BackofficeURL)\r\n                SNP_LOGGER.warn(null, null, \"MobileWalletSaleTemplateId or BackofficeURL configuration right not set\");\r\n            else {\r\n                const addToWalletUrl = `${this._getRights().BackofficeURL}/b2c?page=mwlt&saleid=${this.transactionRef.saleId}`;\r\n                extraProperties.addToWalletUrl = addToWalletUrl;\r\n            }\r\n            \r\n            _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_2__.KioskEventUtils.triggerTransactionEvent(\"working\", \"virtual-print\", \"Waiting virtual print\", this.transactionRef, extraProperties);\r\n        });\r\n    }\r\n\r\n   #triggerEmailImputEvent(transactionRef) {\r\n        return new Promise(resolve => {\r\n            let extraProperties = {\r\n                emailInputCallback: email => resolve({ completed: true, email }),\r\n                goBackCallback: () => resolve({ completed: false })\r\n            };\r\n\r\n            _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_2__.KioskEventUtils.triggerTransactionEvent(\"working\", \"print-at-home\", \"Waiting print at home\", transactionRef, extraProperties);\r\n        });\r\n    }\r\n\r\n    #prepareGenerateMediaReqForPrintTickets() {\r\n        return {\r\n            Sale: {\r\n                SaleId: this.transactionRef.saleId\r\n            },\r\n            ReturnPrintItems: true,\r\n            PrintMediaMethod: DELIVERY_OPTIONS.PRINT.value,\r\n            ReturnPrintItemsPrintData: true\r\n        };\r\n    }\r\n\r\n    #prepareGenerateMediaReqForPrintAtHome(emailAddress) {\r\n        return {\r\n            Sale: {\r\n                SaleId: this.transactionRef.saleId\r\n            },\r\n            PrintMediaMethod: DELIVERY_OPTIONS.PRINT_AT_HOME.value,\r\n            Transaction: {\r\n                DeliveryOptions: {\r\n                    SendOrderConfirmation: true,\r\n                    IncludeTickets: true,\r\n                    ReceipientEmailAddress: emailAddress,\r\n                    DocTemplate: {\r\n                        DocTemplateId: this._getRights().KSK_OrderConfirmationDocTemplateId\r\n                    }\r\n                }\r\n            }\r\n       };\r\n    }\r\n\r\n    #prepareRequestForPrintTickets() {\r\n        return {\r\n            Sale: {\r\n                SaleId: this.transactionRef.saleId\r\n            },\r\n            ReturnPrintItems: true,\r\n            GenerateMedia: true,\r\n            ReturnPrintItemsPrintData: true\r\n        };\r\n    }\r\n\r\n    #prepareRequestForVirtualTickets() {\r\n        return {\r\n            Sale: {\r\n                SaleId: this.transactionRef.saleId\r\n            }\r\n        };\r\n    }\r\n\r\n    #prepareRequestForPrintAtHome(emailAddress) {\r\n        return {\r\n            Sale: {\r\n                SaleId: this.transactionRef.saleId\r\n            },\r\n            Transaction: {\r\n                DeliveryOptions: {\r\n                    SendOrderConfirmation: true,\r\n                    IncludeTickets: true,\r\n                    ReceipientEmailAddress: emailAddress,\r\n                    DocTemplate: {\r\n                        DocTemplateId: this._getRights().KSK_OrderConfirmationDocTemplateId\r\n                    }\r\n                }\r\n            }\r\n        };\r\n    }\r\n\r\n    #callSaleCompleteAPI(req) {  \r\n        SNP_LOGGER.debug(null, null, \"Sale/CompleteOrder API call\");\r\n        _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_2__.KioskEventUtils.triggerTransactionEvent(\"working\", \"post-transaction\", \"Encoding tickets\");\r\n\r\n        return this._snappAPI.cmd(\"SALE\", \"Complete\", req)\r\n            .then(ans => {\r\n                const result = {};\r\n                result.transactionRecap = ans.TransactionRecap;\r\n                result.itemsToPrint = ans.ItemsToPrint ? ans.ItemsToPrint : [];\r\n                return result;\r\n            })\r\n            .catch(e => {\r\n                SNP_LOGGER.error(null, null, \"SALE/Complete API failed with error: \" + e.message);\r\n                throw e;\r\n            });\r\n    } \r\n\r\n    #callSaleGenerateMediaAPI(req) {  \r\n        SNP_LOGGER.debug(null, null, \"Sale/GenerateMedia API call\");\r\n        _kiosk_event_utils__WEBPACK_IMPORTED_MODULE_2__.KioskEventUtils.triggerTransactionEvent(\"working\", \"post-transaction\", \"Encoding tickets\");\r\n\r\n        return this._snappAPI.cmd(\"SALE\", \"GenerateMedia\", req)\r\n            .then(ans => {\r\n                const result = {};\r\n                result.transactionRecap = ans.TransactionRecap;\r\n                result.itemsToPrint = ans.ItemsToPrint ? ans.ItemsToPrint : [];\r\n                return result;\r\n            })\r\n            .catch(e => {\r\n                SNP_LOGGER.error(null, null, \"SALE/GenerateMedia API failed with error: \" + e.message);\r\n                throw e;\r\n            });\r\n    } \r\n\r\n    #sendOrderConfirmation(emailAddress) {\r\n        SNP_LOGGER.debug(null, null, \"Sending order confirmation\");\r\n        let req = {\r\n            SaleId: this.transactionRef.saleId,\r\n            DocTemplateId: this._getRights().KSK_OrderConfirmationDocTemplateId,\r\n            EmailAddress: emailAddress,\r\n            SendImmediately: true,\r\n            IncludeTickets: true\r\n        }\r\n        return this._snappAPI.cmd(\"SALE\", \"SendOrderConfirmation\", req);\r\n    }\r\n\r\n    get deliveryOptionsMap() {\r\n        return {\r\n            [DELIVERY_OPTIONS.PRINT.code]: this.#printPhysicalTickets,\r\n            [DELIVERY_OPTIONS.GO_GREEN.code]: this.#dispatchEventForVirtualTickets,\r\n            [DELIVERY_OPTIONS.PRINT_AT_HOME.code]: this.#printAtHome\r\n        };\r\n    }\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc2NyaXB0L3N0ZXBzL3N0ZXAtcHJpbnQtdGlja2V0LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBbUM7QUFDMkI7QUFDUDtBQUNQO0FBQ0k7QUFDcEQ7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDTyw4QkFBOEIsNENBQUk7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3Qyx1RUFBbUI7QUFDM0QseUJBQXlCLHdEQUFjO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQiw4REFBVywwQkFBMEIsNkJBQTZCO0FBQ3hGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0Esc0JBQXNCLDhEQUFXO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsK0RBQWU7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsOERBQVc7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMsZ0NBQWdDLHdCQUF3QiwyQkFBMkI7QUFDN0g7QUFDQTtBQUNBO0FBQ0EsWUFBWSwrREFBZTtBQUMzQixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVEQUF1RCx3QkFBd0I7QUFDL0UsZ0RBQWdELGtCQUFrQjtBQUNsRTtBQUNBO0FBQ0EsWUFBWSwrREFBZTtBQUMzQixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSwrREFBZTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLCtEQUFlO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2tpb3NrLWNvbnRyb2xsZXIvLi4vc2NyaXB0L3N0ZXBzL3N0ZXAtcHJpbnQtdGlja2V0LmpzPzRlOTUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3RlcCB9IGZyb20gJy4vc3RlcC1iYXNlJztcclxuaW1wb3J0IHsgUHJpbnRNZWRpYVByb2Nlc3NvciB9IGZyb20gJy4vcHJpbnQtbWVkaWEtcHJvY2Vzc29yJztcclxuaW1wb3J0IHsgS2lvc2tFdmVudFV0aWxzIH0gZnJvbSAnLi4va2lvc2stZXZlbnQtdXRpbHMnO1xyXG5pbXBvcnQgeyBLSU9TS19DSEVDS09VVCB9IGZyb20gXCIuLi9raW9zay1tb2RlbFwiO1xyXG5pbXBvcnQgeyBFUHJpbnRFcnJvciB9IGZyb20gJ0Bjb21tb24tc2NyaXB0L2Vycm9ycyc7XHJcblxyXG5leHBvcnQgY29uc3QgREVMSVZFUllfT1BUSU9OUyA9IE9iamVjdC5mcmVlemUoeyBcclxuICAgIFBSSU5UOiB7XHJcbiAgICAgICAgY29kZTogXCJQUklOVFwiLCBcclxuICAgICAgICB2YWx1ZTogMVxyXG4gICAgfSxcclxuICAgIEdPX0dSRUVOOiB7XHJcbiAgICAgICAgY29kZTogXCJHTy1HUkVFTlwiLFxyXG4gICAgICAgIHZhbHVlOiAyXHJcbiAgICB9LFxyXG4gICAgUFJJTlRfQVRfSE9NRToge1xyXG4gICAgICAgIGNvZGU6IFwiUFJJTlQtQVQtSE9NRVwiLFxyXG4gICAgICAgIHZhbHVlOiAzXHJcbiAgICB9IFxyXG59KTtcclxuXHJcbmV4cG9ydCBjbGFzcyBTdGVwUHJpbnRUaWNrZXQgZXh0ZW5kcyBTdGVwIHtcclxuICAgICNwcmludE1lZGlhUHJvY2Vzc29yO1xyXG4gICAgI29yZGVyQ29uZmlybWF0aW9uVGVtcGxhdGVJZDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihzbmFwcEFQSSkge1xyXG4gICAgICAgIHN1cGVyKHNuYXBwQVBJKTtcclxuICAgICAgICB0aGlzLiNwcmludE1lZGlhUHJvY2Vzc29yID0gbmV3IFByaW50TWVkaWFQcm9jZXNzb3IoREVWSUNFX01BTkFHRVIpO1xyXG4gICAgICAgIHRoaXMuX3N0ZXBUeXBlID0gS0lPU0tfQ0hFQ0tPVVQuUFJJTlRfVElDS0VUO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG9yZGVyQ29uZmlybWF0aW9uVGVtcGxhdGVJZFxyXG4gICAgICovXHJcbiAgICBzZXQgb3JkZXJDb25maXJtYXRpb25UZW1wbGF0ZUlkKG9yZGVyQ29uZmlybWF0aW9uVGVtcGxhdGVJZCkge1xyXG4gICAgICAgIHRoaXMuI29yZGVyQ29uZmlybWF0aW9uVGVtcGxhdGVJZCA9IG9yZGVyQ29uZmlybWF0aW9uVGVtcGxhdGVJZDtcclxuICAgIH1cclxuXHJcbiAgICBfZG9FeGVjdXRlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLiNwcmludEl0ZW1zKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHRyYW5zYWN0aW9uUmVmKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wYXJhbXMudHJhbnNhY3Rpb25SZWY7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgI3ByaW50SXRlbXMoKSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IHtwcmludGVkTWVkaWE6IFtdLCBwcmludENvbXBsZXRlZDogZmFsc2UsIHNhbGVDb21wbGV0ZWQ6IGZhbHNlfTtcclxuIFxyXG4gICAgICAgIGNvbnN0IGRlbGl2ZXJ5T3B0aW9uRnVuY3Rpb24gPSB0aGlzLmRlbGl2ZXJ5T3B0aW9uc01hcFt0aGlzLl9wYXJhbXMuZGVsaXZlcnlPcHRpb25dO1xyXG4gICAgICAgIGlmICghZGVsaXZlcnlPcHRpb25GdW5jdGlvbikgXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFUHJpbnRFcnJvcihgU2VsZWN0ZWQgcHJpbnQgb3B0aW9uICR7dGhpcy5fcGFyYW1zLmRlbGl2ZXJ5T3B0aW9ufSBub3QgcmVjb2duaXplZGAsIG51bGwpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICByZXN1bHQgPSBhd2FpdCBkZWxpdmVyeU9wdGlvbkZ1bmN0aW9uLmNhbGwodGhpcyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgcHJpbnRBdEhvbWVJc0VuYWJsZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuICEhdGhpcy5fcGFyYW1zLnJpZ2h0cy5LU0tfT3JkZXJDb25maXJtYXRpb25Eb2NUZW1wbGF0ZUlkO1xyXG4gICAgfVxyXG5cclxuICAgICNwcmludFRpY2tldFJlcXVpcmVkKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wYXJhbXMuaXRlbXNUb1ByaW50ICYmIHRoaXMuX3BhcmFtcy5pdGVtc1RvUHJpbnQuUHJpbnRJdGVtTGlzdCAmJiAodGhpcy5fcGFyYW1zLml0ZW1zVG9QcmludC5QcmludEl0ZW1MaXN0Lmxlbmd0aCA+IDApO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jICNwcmludFBoeXNpY2FsVGlja2V0cygpIHtcclxuICAgICAgICBsZXQgc2FsZUNvbXBsZXRlZCA9IHRoaXMuX3BhcmFtcy5zYWxlQ29tcGxldGVkO1xyXG4gICAgICAgIGlmICh0aGlzLnByaW50QXRIb21lSXNFbmFibGVkICYmICF0aGlzLl9wYXJhbXMuaXRlbXNUb1ByaW50LlByaW50SXRlbUxpc3QpIHtcclxuICAgICAgICAgICAgbGV0IHJlc3VsdDtcclxuICAgICAgICAgICAgaWYgKHNhbGVDb21wbGV0ZWQpXHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBhd2FpdCB0aGlzLiNjYWxsU2FsZUdlbmVyYXRlTWVkaWFBUEkodGhpcy4jcHJlcGFyZUdlbmVyYXRlTWVkaWFSZXFGb3JQcmludFRpY2tldHMoKSk7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IHRoaXMuI2NhbGxTYWxlQ29tcGxldGVBUEkodGhpcy4jcHJlcGFyZVJlcXVlc3RGb3JQcmludFRpY2tldHMoKSk7XHJcbiAgICAgICAgICAgIHNhbGVDb21wbGV0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLl9wYXJhbXMuaXRlbXNUb1ByaW50ID0gcmVzdWx0Lml0ZW1zVG9QcmludDtcclxuICAgICAgICAgICAgdGhpcy50cmFuc2FjdGlvblJlZi50aWNrZXRDb3VudCA9ICByZXN1bHQuaXRlbXNUb1ByaW50LlByaW50SXRlbUxpc3QgPyByZXN1bHQuaXRlbXNUb1ByaW50LlByaW50SXRlbUxpc3QubGVuZ3RoIDogMDtcclxuICAgICAgICB9ICAgICAgICBcclxuXHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0ge3ByaW50ZWRNZWRpYTogW10sIHByaW50Q29tcGxldGVkOiB0cnVlLCBzYWxlQ29tcGxldGVkOiBzYWxlQ29tcGxldGVkfTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX3BhcmFtcy5pdGVtc1RvUHJpbnQgJiYgdGhpcy5fcGFyYW1zLml0ZW1zVG9QcmludC5Ob3RQcmludGFibGVJdGVtc0NvdW50ID4gMClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVQcmludEVycm9yKFwiVGhlcmUgYXJlIHByb2R1Y3RzIG5vdCBwcmludGFibGUgYXQgdGhpcyBzdGF0aW9uXCIsIG51bGwpO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuI3ByaW50VGlja2V0UmVxdWlyZWQoKSkge1xyXG4gICAgICAgICAgICBTTlBfTE9HR0VSLmRlYnVnKG51bGwsIG51bGwsIFwiUHJpbnQgdGlja2V0IG5vdCByZXF1aXJlZFwiKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9IFxyXG4gXHJcbiAgICAgICAgbGV0IGV4dHJhUHJvcGVydGllcyA9IHtcclxuICAgICAgICAgICAgdGlja2V0UHJpbnQ6IHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRUaWNrZXRObzogMFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgS2lvc2tFdmVudFV0aWxzLnRyaWdnZXJUcmFuc2FjdGlvbkV2ZW50KFwid29ya2luZ1wiLCBcInByaW50LXRpY2tldFwiLCBcIlByaW50aW5nIHRpY2tldFwiLCB0aGlzLnRyYW5zYWN0aW9uUmVmLCBleHRyYVByb3BlcnRpZXMpO1xyXG5cclxuICAgICAgICBTTlBfTE9HR0VSLmRlYnVnKG51bGwsIG51bGwsIFwiUHJpbnRpbmcgdGlja2V0c1wiKTtcclxuICAgICAgICByZXN1bHQucHJpbnRlZE1lZGlhID0gYXdhaXQgdGhpcy4jcHJpbnRNZWRpYVByb2Nlc3Nvci5wcmludCh0aGlzLl9wYXJhbXMuaXRlbXNUb1ByaW50LlByaW50SXRlbUxpc3QsIHRoaXMudHJhbnNhY3Rpb25SZWYpO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jICNkaXNwYXRjaEV2ZW50Rm9yVmlydHVhbFRpY2tldHMoKSB7XHJcbiAgICAgICAgbGV0IHByaW50Q29tcGxldGVkID0gdHJ1ZTtcclxuICAgICAgICBsZXQgc2FsZUNvbXBsZXRlZCA9IHRoaXMuX3BhcmFtcy5zYWxlQ29tcGxldGVkO1xyXG4gICAgICAgIGlmICghc2FsZUNvbXBsZXRlZCAmJiB0aGlzLnByaW50QXRIb21lSXNFbmFibGVkICYmICF0aGlzLl9wYXJhbXMuaXRlbXNUb1ByaW50LlByaW50SXRlbUxpc3QpIHtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy4jY2FsbFNhbGVDb21wbGV0ZUFQSSh0aGlzLiNwcmVwYXJlUmVxdWVzdEZvclZpcnR1YWxUaWNrZXRzKCkpO1xyXG4gICAgICAgICAgICBzYWxlQ29tcGxldGVkID0gdHJ1ZTtcclxuICAgICAgICB9ICAgICAgICBcclxuXHJcbiAgICAgICAgcHJpbnRDb21wbGV0ZWQgPSBhd2FpdCB0aGlzLiN0cmlnZ2VyVmlydHVhbFByaW50RXZlbnQoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtwcmludGVkTWVkaWE6IFtdLCBwcmludENvbXBsZXRlZDogcHJpbnRDb21wbGV0ZWQsIHNhbGVDb21wbGV0ZWQ6IHNhbGVDb21wbGV0ZWR9O1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jICNwcmludEF0SG9tZSgpIHtcclxuICAgICAgICBsZXQgcHJpbnRDb21wbGV0ZWQgPSBmYWxzZTtcclxuICAgICAgICBsZXQgc2FsZUNvbXBsZXRlZCA9IHRoaXMuX3BhcmFtcy5zYWxlQ29tcGxldGVkO1xyXG4gXHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IGF3YWl0IHRoaXMuI3RyaWdnZXJFbWFpbEltcHV0RXZlbnQodGhpcy50cmFuc2FjdGlvblJlZik7XHJcbiAgICAgICAgaWYgKHJlc3VsdC5jb21wbGV0ZWQpIHtcclxuICAgICAgICAgICAgaWYgKCFyZXN1bHQuZW1haWwpXHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRVByaW50RXJyb3IoXCJFbWFpbCBub3QgdmFsaWRcIiwgW10pO1xyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIFNOUF9MT0dHRVIuZGVidWcobnVsbCwgbnVsbCwgXCJTZW5kaW5nIG9yZGVyIGNvbmZpcm1hdGlvblwiKTtcclxuICAgICAgICAgICAgICAgIGlmIChzYWxlQ29tcGxldGVkKVxyXG4gICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy4jY2FsbFNhbGVHZW5lcmF0ZU1lZGlhQVBJKHRoaXMuI3ByZXBhcmVHZW5lcmF0ZU1lZGlhUmVxRm9yUHJpbnRBdEhvbWUocmVzdWx0LmVtYWlsID8gcmVzdWx0LmVtYWlsIDogXCJcIikpO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy4jY2FsbFNhbGVDb21wbGV0ZUFQSSh0aGlzLiNwcmVwYXJlUmVxdWVzdEZvclByaW50QXRIb21lKHJlc3VsdC5lbWFpbCA/IHJlc3VsdC5lbWFpbCA6IFwiXCIpKTtcclxuICAgICAgICAgICAgICAgIHNhbGVDb21wbGV0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgcHJpbnRDb21wbGV0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7cHJpbnRlZE1lZGlhOiBbXSwgcHJpbnRDb21wbGV0ZWQ6IHByaW50Q29tcGxldGVkLCBzYWxlQ29tcGxldGVkOiBzYWxlQ29tcGxldGVkfTtcclxuICAgIH1cclxuXHJcbiAgICAjdHJpZ2dlclZpcnR1YWxQcmludEV2ZW50KCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgICAgICAgbGV0IGV4dHJhUHJvcGVydGllcyA9IHtcclxuICAgICAgICAgICAgICAgIHZpcnR1YWxUaWNrZXRMaXN0OiB0aGlzLl9wYXJhbXMuaXRlbXNUb1ByaW50LlByaW50SXRlbUxpc3QsXHJcbiAgICAgICAgICAgICAgICB2aXJ0dWFsUHJpbnRDYWxsYmFjazogKCkgPT4gcmVzb2x2ZSh0cnVlKSxcclxuICAgICAgICAgICAgICAgIHZpcnR1YWxHb0JhY2tDYWxsYmFjazogKCkgPT4gcmVzb2x2ZShmYWxzZSlcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5fZ2V0UmlnaHRzKCkuTW9iaWxlV2FsbGV0U2FsZVRlbXBsYXRlSWQgfHwgIXRoaXMuX2dldFJpZ2h0cygpLkJhY2tvZmZpY2VVUkwpXHJcbiAgICAgICAgICAgICAgICBTTlBfTE9HR0VSLndhcm4obnVsbCwgbnVsbCwgXCJNb2JpbGVXYWxsZXRTYWxlVGVtcGxhdGVJZCBvciBCYWNrb2ZmaWNlVVJMIGNvbmZpZ3VyYXRpb24gcmlnaHQgbm90IHNldFwiKTtcclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhZGRUb1dhbGxldFVybCA9IGAke3RoaXMuX2dldFJpZ2h0cygpLkJhY2tvZmZpY2VVUkx9L2IyYz9wYWdlPW13bHQmc2FsZWlkPSR7dGhpcy50cmFuc2FjdGlvblJlZi5zYWxlSWR9YDtcclxuICAgICAgICAgICAgICAgIGV4dHJhUHJvcGVydGllcy5hZGRUb1dhbGxldFVybCA9IGFkZFRvV2FsbGV0VXJsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBLaW9za0V2ZW50VXRpbHMudHJpZ2dlclRyYW5zYWN0aW9uRXZlbnQoXCJ3b3JraW5nXCIsIFwidmlydHVhbC1wcmludFwiLCBcIldhaXRpbmcgdmlydHVhbCBwcmludFwiLCB0aGlzLnRyYW5zYWN0aW9uUmVmLCBleHRyYVByb3BlcnRpZXMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgI3RyaWdnZXJFbWFpbEltcHV0RXZlbnQodHJhbnNhY3Rpb25SZWYpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBleHRyYVByb3BlcnRpZXMgPSB7XHJcbiAgICAgICAgICAgICAgICBlbWFpbElucHV0Q2FsbGJhY2s6IGVtYWlsID0+IHJlc29sdmUoeyBjb21wbGV0ZWQ6IHRydWUsIGVtYWlsIH0pLFxyXG4gICAgICAgICAgICAgICAgZ29CYWNrQ2FsbGJhY2s6ICgpID0+IHJlc29sdmUoeyBjb21wbGV0ZWQ6IGZhbHNlIH0pXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBLaW9za0V2ZW50VXRpbHMudHJpZ2dlclRyYW5zYWN0aW9uRXZlbnQoXCJ3b3JraW5nXCIsIFwicHJpbnQtYXQtaG9tZVwiLCBcIldhaXRpbmcgcHJpbnQgYXQgaG9tZVwiLCB0cmFuc2FjdGlvblJlZiwgZXh0cmFQcm9wZXJ0aWVzKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAjcHJlcGFyZUdlbmVyYXRlTWVkaWFSZXFGb3JQcmludFRpY2tldHMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgU2FsZToge1xyXG4gICAgICAgICAgICAgICAgU2FsZUlkOiB0aGlzLnRyYW5zYWN0aW9uUmVmLnNhbGVJZFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBSZXR1cm5QcmludEl0ZW1zOiB0cnVlLFxyXG4gICAgICAgICAgICBQcmludE1lZGlhTWV0aG9kOiBERUxJVkVSWV9PUFRJT05TLlBSSU5ULnZhbHVlLFxyXG4gICAgICAgICAgICBSZXR1cm5QcmludEl0ZW1zUHJpbnREYXRhOiB0cnVlXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAjcHJlcGFyZUdlbmVyYXRlTWVkaWFSZXFGb3JQcmludEF0SG9tZShlbWFpbEFkZHJlc3MpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBTYWxlOiB7XHJcbiAgICAgICAgICAgICAgICBTYWxlSWQ6IHRoaXMudHJhbnNhY3Rpb25SZWYuc2FsZUlkXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIFByaW50TWVkaWFNZXRob2Q6IERFTElWRVJZX09QVElPTlMuUFJJTlRfQVRfSE9NRS52YWx1ZSxcclxuICAgICAgICAgICAgVHJhbnNhY3Rpb246IHtcclxuICAgICAgICAgICAgICAgIERlbGl2ZXJ5T3B0aW9uczoge1xyXG4gICAgICAgICAgICAgICAgICAgIFNlbmRPcmRlckNvbmZpcm1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBJbmNsdWRlVGlja2V0czogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBSZWNlaXBpZW50RW1haWxBZGRyZXNzOiBlbWFpbEFkZHJlc3MsXHJcbiAgICAgICAgICAgICAgICAgICAgRG9jVGVtcGxhdGU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRG9jVGVtcGxhdGVJZDogdGhpcy5fZ2V0UmlnaHRzKCkuS1NLX09yZGVyQ29uZmlybWF0aW9uRG9jVGVtcGxhdGVJZFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAjcHJlcGFyZVJlcXVlc3RGb3JQcmludFRpY2tldHMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgU2FsZToge1xyXG4gICAgICAgICAgICAgICAgU2FsZUlkOiB0aGlzLnRyYW5zYWN0aW9uUmVmLnNhbGVJZFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBSZXR1cm5QcmludEl0ZW1zOiB0cnVlLFxyXG4gICAgICAgICAgICBHZW5lcmF0ZU1lZGlhOiB0cnVlLFxyXG4gICAgICAgICAgICBSZXR1cm5QcmludEl0ZW1zUHJpbnREYXRhOiB0cnVlXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAjcHJlcGFyZVJlcXVlc3RGb3JWaXJ0dWFsVGlja2V0cygpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBTYWxlOiB7XHJcbiAgICAgICAgICAgICAgICBTYWxlSWQ6IHRoaXMudHJhbnNhY3Rpb25SZWYuc2FsZUlkXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgICNwcmVwYXJlUmVxdWVzdEZvclByaW50QXRIb21lKGVtYWlsQWRkcmVzcykge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIFNhbGU6IHtcclxuICAgICAgICAgICAgICAgIFNhbGVJZDogdGhpcy50cmFuc2FjdGlvblJlZi5zYWxlSWRcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgVHJhbnNhY3Rpb246IHtcclxuICAgICAgICAgICAgICAgIERlbGl2ZXJ5T3B0aW9uczoge1xyXG4gICAgICAgICAgICAgICAgICAgIFNlbmRPcmRlckNvbmZpcm1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBJbmNsdWRlVGlja2V0czogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBSZWNlaXBpZW50RW1haWxBZGRyZXNzOiBlbWFpbEFkZHJlc3MsXHJcbiAgICAgICAgICAgICAgICAgICAgRG9jVGVtcGxhdGU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRG9jVGVtcGxhdGVJZDogdGhpcy5fZ2V0UmlnaHRzKCkuS1NLX09yZGVyQ29uZmlybWF0aW9uRG9jVGVtcGxhdGVJZFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgI2NhbGxTYWxlQ29tcGxldGVBUEkocmVxKSB7ICBcclxuICAgICAgICBTTlBfTE9HR0VSLmRlYnVnKG51bGwsIG51bGwsIFwiU2FsZS9Db21wbGV0ZU9yZGVyIEFQSSBjYWxsXCIpO1xyXG4gICAgICAgIEtpb3NrRXZlbnRVdGlscy50cmlnZ2VyVHJhbnNhY3Rpb25FdmVudChcIndvcmtpbmdcIiwgXCJwb3N0LXRyYW5zYWN0aW9uXCIsIFwiRW5jb2RpbmcgdGlja2V0c1wiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NuYXBwQVBJLmNtZChcIlNBTEVcIiwgXCJDb21wbGV0ZVwiLCByZXEpXHJcbiAgICAgICAgICAgIC50aGVuKGFucyA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB7fTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC50cmFuc2FjdGlvblJlY2FwID0gYW5zLlRyYW5zYWN0aW9uUmVjYXA7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuaXRlbXNUb1ByaW50ID0gYW5zLkl0ZW1zVG9QcmludCA/IGFucy5JdGVtc1RvUHJpbnQgOiBbXTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChlID0+IHtcclxuICAgICAgICAgICAgICAgIFNOUF9MT0dHRVIuZXJyb3IobnVsbCwgbnVsbCwgXCJTQUxFL0NvbXBsZXRlIEFQSSBmYWlsZWQgd2l0aCBlcnJvcjogXCIgKyBlLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9IFxyXG5cclxuICAgICNjYWxsU2FsZUdlbmVyYXRlTWVkaWFBUEkocmVxKSB7ICBcclxuICAgICAgICBTTlBfTE9HR0VSLmRlYnVnKG51bGwsIG51bGwsIFwiU2FsZS9HZW5lcmF0ZU1lZGlhIEFQSSBjYWxsXCIpO1xyXG4gICAgICAgIEtpb3NrRXZlbnRVdGlscy50cmlnZ2VyVHJhbnNhY3Rpb25FdmVudChcIndvcmtpbmdcIiwgXCJwb3N0LXRyYW5zYWN0aW9uXCIsIFwiRW5jb2RpbmcgdGlja2V0c1wiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NuYXBwQVBJLmNtZChcIlNBTEVcIiwgXCJHZW5lcmF0ZU1lZGlhXCIsIHJlcSlcclxuICAgICAgICAgICAgLnRoZW4oYW5zID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnRyYW5zYWN0aW9uUmVjYXAgPSBhbnMuVHJhbnNhY3Rpb25SZWNhcDtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5pdGVtc1RvUHJpbnQgPSBhbnMuSXRlbXNUb1ByaW50ID8gYW5zLkl0ZW1zVG9QcmludCA6IFtdO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgU05QX0xPR0dFUi5lcnJvcihudWxsLCBudWxsLCBcIlNBTEUvR2VuZXJhdGVNZWRpYSBBUEkgZmFpbGVkIHdpdGggZXJyb3I6IFwiICsgZS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIHRocm93IGU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfSBcclxuXHJcbiAgICAjc2VuZE9yZGVyQ29uZmlybWF0aW9uKGVtYWlsQWRkcmVzcykge1xyXG4gICAgICAgIFNOUF9MT0dHRVIuZGVidWcobnVsbCwgbnVsbCwgXCJTZW5kaW5nIG9yZGVyIGNvbmZpcm1hdGlvblwiKTtcclxuICAgICAgICBsZXQgcmVxID0ge1xyXG4gICAgICAgICAgICBTYWxlSWQ6IHRoaXMudHJhbnNhY3Rpb25SZWYuc2FsZUlkLFxyXG4gICAgICAgICAgICBEb2NUZW1wbGF0ZUlkOiB0aGlzLl9nZXRSaWdodHMoKS5LU0tfT3JkZXJDb25maXJtYXRpb25Eb2NUZW1wbGF0ZUlkLFxyXG4gICAgICAgICAgICBFbWFpbEFkZHJlc3M6IGVtYWlsQWRkcmVzcyxcclxuICAgICAgICAgICAgU2VuZEltbWVkaWF0ZWx5OiB0cnVlLFxyXG4gICAgICAgICAgICBJbmNsdWRlVGlja2V0czogdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5fc25hcHBBUEkuY21kKFwiU0FMRVwiLCBcIlNlbmRPcmRlckNvbmZpcm1hdGlvblwiLCByZXEpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBkZWxpdmVyeU9wdGlvbnNNYXAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgW0RFTElWRVJZX09QVElPTlMuUFJJTlQuY29kZV06IHRoaXMuI3ByaW50UGh5c2ljYWxUaWNrZXRzLFxyXG4gICAgICAgICAgICBbREVMSVZFUllfT1BUSU9OUy5HT19HUkVFTi5jb2RlXTogdGhpcy4jZGlzcGF0Y2hFdmVudEZvclZpcnR1YWxUaWNrZXRzLFxyXG4gICAgICAgICAgICBbREVMSVZFUllfT1BUSU9OUy5QUklOVF9BVF9IT01FLmNvZGVdOiB0aGlzLiNwcmludEF0SG9tZVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///../script/steps/step-print-ticket.js\n");

/***/ }),

/***/ "../../../common-script/cors-worker.js":
/*!*********************************************!*\
  !*** ../../../common-script/cors-worker.js ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CorsWorker: () => (/* binding */ CorsWorker)\n/* harmony export */ });\nclass CorsWorker {\r\n  #worker;\r\n\r\n  constructor(url) {\r\n    const workerHref = JSON.stringify(url.toString());\r\n    const workerScript = `\r\n                    importScripts(${workerHref});\r\n                    `;\r\n\r\n    const blob = new Blob([workerScript], { type: 'application/javascript' });\r\n    const workerUrl = URL.createObjectURL(blob);\r\n    this.#worker = new Worker(workerUrl);\r\n    URL.revokeObjectURL(workerUrl);\r\n  }\r\n\r\n  getWorker() {\r\n    return this.#worker;\r\n  }\r\n\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vY29tbW9uLXNjcmlwdC9jb3JzLXdvcmtlci5qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLFdBQVc7QUFDL0M7QUFDQTtBQUNBLDRDQUE0QyxnQ0FBZ0M7QUFDNUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9raW9zay1jb250cm9sbGVyLy4uLy4uLy4uL2NvbW1vbi1zY3JpcHQvY29ycy13b3JrZXIuanM/MGNkZiJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgQ29yc1dvcmtlciB7XHJcbiAgI3dvcmtlcjtcclxuXHJcbiAgY29uc3RydWN0b3IodXJsKSB7XHJcbiAgICBjb25zdCB3b3JrZXJIcmVmID0gSlNPTi5zdHJpbmdpZnkodXJsLnRvU3RyaW5nKCkpO1xyXG4gICAgY29uc3Qgd29ya2VyU2NyaXB0ID0gYFxyXG4gICAgICAgICAgICAgICAgICAgIGltcG9ydFNjcmlwdHMoJHt3b3JrZXJIcmVmfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYDtcclxuXHJcbiAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW3dvcmtlclNjcmlwdF0sIHsgdHlwZTogJ2FwcGxpY2F0aW9uL2phdmFzY3JpcHQnIH0pO1xyXG4gICAgY29uc3Qgd29ya2VyVXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcclxuICAgIHRoaXMuI3dvcmtlciA9IG5ldyBXb3JrZXIod29ya2VyVXJsKTtcclxuICAgIFVSTC5yZXZva2VPYmplY3RVUkwod29ya2VyVXJsKTtcclxuICB9XHJcblxyXG4gIGdldFdvcmtlcigpIHtcclxuICAgIHJldHVybiB0aGlzLiN3b3JrZXI7XHJcbiAgfVxyXG5cclxufSJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../../../common-script/cors-worker.js\n");

/***/ }),

/***/ "../../../common-script/device-manager/dm-model.js":
/*!*********************************************************!*\
  !*** ../../../common-script/device-manager/dm-model.js ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CONNECTOR_STATUS: () => (/* binding */ CONNECTOR_STATUS),\n/* harmony export */   DEVICE_STATUS: () => (/* binding */ DEVICE_STATUS),\n/* harmony export */   DEVICE_TYPE: () => (/* binding */ DEVICE_TYPE),\n/* harmony export */   LOG_LEVEL: () => (/* binding */ LOG_LEVEL),\n/* harmony export */   PLUGIN_STATUS: () => (/* binding */ PLUGIN_STATUS)\n/* harmony export */ });\nconst DEVICE_STATUS = { \r\n  INIT: \"INITIALIZING\",\r\n  READY: \"READY\",\r\n  ERROR: \"ERROR\"\r\n}\r\n\r\nconst CONNECTOR_STATUS = { \r\n  INIT: \"INITIALIZING\",\r\n  READY: \"READY\",\r\n  ERROR: \"ERROR\"\r\n}\r\n\r\nconst DEVICE_TYPE = { \r\n  PRINTER: 1,\r\n  EXT_PAY_DEVICE: 6,\r\n  READER: 7,\r\n  DEVICE_CONNECTOR: 13\r\n}\r\n\r\nconst PLUGIN_STATUS = Object.freeze({\r\n  DISABLED: \"DISABLED\",\r\n  ACTIVE: \"ACTIVE\",\r\n  DOWNLOADING: \"DOWNLOADING\",\r\n  WARNING: \"WARNING\",\r\n  ERROR: \"ERROR\"\r\n});\r\n\r\nconst LOG_LEVEL = {\r\n\tFATAL: 1,\r\n\tERROR: 2,\r\n\tWARN: 3,\r\n\tINFO: 4,\r\n\tDEBUG: 5,\r\n\tTRACE: 6\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vY29tbW9uLXNjcmlwdC9kZXZpY2UtbWFuYWdlci9kbS1tb2RlbC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2tpb3NrLWNvbnRyb2xsZXIvLi4vLi4vLi4vY29tbW9uLXNjcmlwdC9kZXZpY2UtbWFuYWdlci9kbS1tb2RlbC5qcz80YTBhIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBERVZJQ0VfU1RBVFVTID0geyBcclxuICBJTklUOiBcIklOSVRJQUxJWklOR1wiLFxyXG4gIFJFQURZOiBcIlJFQURZXCIsXHJcbiAgRVJST1I6IFwiRVJST1JcIlxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgQ09OTkVDVE9SX1NUQVRVUyA9IHsgXHJcbiAgSU5JVDogXCJJTklUSUFMSVpJTkdcIixcclxuICBSRUFEWTogXCJSRUFEWVwiLFxyXG4gIEVSUk9SOiBcIkVSUk9SXCJcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IERFVklDRV9UWVBFID0geyBcclxuICBQUklOVEVSOiAxLFxyXG4gIEVYVF9QQVlfREVWSUNFOiA2LFxyXG4gIFJFQURFUjogNyxcclxuICBERVZJQ0VfQ09OTkVDVE9SOiAxM1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgUExVR0lOX1NUQVRVUyA9IE9iamVjdC5mcmVlemUoe1xyXG4gIERJU0FCTEVEOiBcIkRJU0FCTEVEXCIsXHJcbiAgQUNUSVZFOiBcIkFDVElWRVwiLFxyXG4gIERPV05MT0FESU5HOiBcIkRPV05MT0FESU5HXCIsXHJcbiAgV0FSTklORzogXCJXQVJOSU5HXCIsXHJcbiAgRVJST1I6IFwiRVJST1JcIlxyXG59KTtcclxuXHJcbmV4cG9ydCBjb25zdCBMT0dfTEVWRUwgPSB7XHJcblx0RkFUQUw6IDEsXHJcblx0RVJST1I6IDIsXHJcblx0V0FSTjogMyxcclxuXHRJTkZPOiA0LFxyXG5cdERFQlVHOiA1LFxyXG5cdFRSQUNFOiA2XHJcbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///../../../common-script/device-manager/dm-model.js\n");

/***/ }),

/***/ "../../../common-script/errors.js":
/*!****************************************!*\
  !*** ../../../common-script/errors.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ECCPaymentError: () => (/* binding */ ECCPaymentError),\n/* harmony export */   EPaymentError: () => (/* binding */ EPaymentError),\n/* harmony export */   EPrintError: () => (/* binding */ EPrintError),\n/* harmony export */   ESnAppError: () => (/* binding */ ESnAppError),\n/* harmony export */   PAYMENT_ERROR: () => (/* binding */ PAYMENT_ERROR)\n/* harmony export */ });\nclass ESnAppError extends Error {\r\n\t#errorCode;\r\n\t\r\n\tconstructor(message, errorCode) {\r\n\t\tsuper(message);\r\n\t\tthis.name = this.constructor.name;\r\n\t\tthis.#errorCode = errorCode;\r\n\t}\r\n\t\r\n  static getClassName() {\r\n    return this.name;\r\n  }\r\n  \r\n  static isSameClass(e) {\r\n    return e.constructor.name === this.name;\r\n  }\r\n\t\r\n\tget errorCode() {\r\n\t\treturn this.#errorCode;\r\n\t}\r\n}\r\n\r\nclass ECCPaymentError extends ESnAppError {\r\n\t#processorResult;\r\n\r\n\tconstructor(message, errorCode, processorResult) {\r\n\t\tsuper(message, errorCode);\r\n\t\tthis.#processorResult = processorResult;\r\n\t}\t\r\n\t\r\n\tget processorResult() {\r\n\t\treturn this.#processorResult;\r\n\t}\r\n}\r\n\r\nclass EPaymentError extends ESnAppError {\r\n\t#paymentResult;\r\n\r\n\tconstructor(message, errorCode, paymentResult) {\r\n\t\tsuper(message, errorCode);\r\n\t\tthis.#paymentResult = paymentResult;\r\n\t}\t\r\n\t\r\n\tget paymentResult() {\r\n\t\treturn this.#paymentResult;\r\n\t}\r\n\r\n}\r\n\r\nclass EPrintError extends Error {\r\n\t#printedMediaList;\r\n\r\n\tconstructor(message, printedMediaList) {\r\n\t\tsuper(message);\r\n\t\tthis.#printedMediaList = printedMediaList;\r\n\t}\t\r\n\t\r\n\tget printedMediaList() {\r\n\t\treturn this.#printedMediaList;\r\n\t}\r\n}\r\n\r\nconst PAYMENT_ERROR = { \r\n  ABORT: \"ABORT\",\r\n  FAILED: \"FAILED\"\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vY29tbW9uLXNjcmlwdC9lcnJvcnMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9raW9zay1jb250cm9sbGVyLy4uLy4uLy4uL2NvbW1vbi1zY3JpcHQvZXJyb3JzLmpzP2UyOGMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIEVTbkFwcEVycm9yIGV4dGVuZHMgRXJyb3Ige1xyXG5cdCNlcnJvckNvZGU7XHJcblx0XHJcblx0Y29uc3RydWN0b3IobWVzc2FnZSwgZXJyb3JDb2RlKSB7XHJcblx0XHRzdXBlcihtZXNzYWdlKTtcclxuXHRcdHRoaXMubmFtZSA9IHRoaXMuY29uc3RydWN0b3IubmFtZTtcclxuXHRcdHRoaXMuI2Vycm9yQ29kZSA9IGVycm9yQ29kZTtcclxuXHR9XHJcblx0XHJcbiAgc3RhdGljIGdldENsYXNzTmFtZSgpIHtcclxuICAgIHJldHVybiB0aGlzLm5hbWU7XHJcbiAgfVxyXG4gIFxyXG4gIHN0YXRpYyBpc1NhbWVDbGFzcyhlKSB7XHJcbiAgICByZXR1cm4gZS5jb25zdHJ1Y3Rvci5uYW1lID09PSB0aGlzLm5hbWU7XHJcbiAgfVxyXG5cdFxyXG5cdGdldCBlcnJvckNvZGUoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy4jZXJyb3JDb2RlO1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEVDQ1BheW1lbnRFcnJvciBleHRlbmRzIEVTbkFwcEVycm9yIHtcclxuXHQjcHJvY2Vzc29yUmVzdWx0O1xyXG5cclxuXHRjb25zdHJ1Y3RvcihtZXNzYWdlLCBlcnJvckNvZGUsIHByb2Nlc3NvclJlc3VsdCkge1xyXG5cdFx0c3VwZXIobWVzc2FnZSwgZXJyb3JDb2RlKTtcclxuXHRcdHRoaXMuI3Byb2Nlc3NvclJlc3VsdCA9IHByb2Nlc3NvclJlc3VsdDtcclxuXHR9XHRcclxuXHRcclxuXHRnZXQgcHJvY2Vzc29yUmVzdWx0KCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuI3Byb2Nlc3NvclJlc3VsdDtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBFUGF5bWVudEVycm9yIGV4dGVuZHMgRVNuQXBwRXJyb3Ige1xyXG5cdCNwYXltZW50UmVzdWx0O1xyXG5cclxuXHRjb25zdHJ1Y3RvcihtZXNzYWdlLCBlcnJvckNvZGUsIHBheW1lbnRSZXN1bHQpIHtcclxuXHRcdHN1cGVyKG1lc3NhZ2UsIGVycm9yQ29kZSk7XHJcblx0XHR0aGlzLiNwYXltZW50UmVzdWx0ID0gcGF5bWVudFJlc3VsdDtcclxuXHR9XHRcclxuXHRcclxuXHRnZXQgcGF5bWVudFJlc3VsdCgpIHtcclxuXHRcdHJldHVybiB0aGlzLiNwYXltZW50UmVzdWx0O1xyXG5cdH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBFUHJpbnRFcnJvciBleHRlbmRzIEVycm9yIHtcclxuXHQjcHJpbnRlZE1lZGlhTGlzdDtcclxuXHJcblx0Y29uc3RydWN0b3IobWVzc2FnZSwgcHJpbnRlZE1lZGlhTGlzdCkge1xyXG5cdFx0c3VwZXIobWVzc2FnZSk7XHJcblx0XHR0aGlzLiNwcmludGVkTWVkaWFMaXN0ID0gcHJpbnRlZE1lZGlhTGlzdDtcclxuXHR9XHRcclxuXHRcclxuXHRnZXQgcHJpbnRlZE1lZGlhTGlzdCgpIHtcclxuXHRcdHJldHVybiB0aGlzLiNwcmludGVkTWVkaWFMaXN0O1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IFBBWU1FTlRfRVJST1IgPSB7IFxyXG4gIEFCT1JUOiBcIkFCT1JUXCIsXHJcbiAgRkFJTEVEOiBcIkZBSUxFRFwiXHJcbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///../../../common-script/errors.js\n");

/***/ }),

/***/ "../../../common-script/snapp-api.js":
/*!*******************************************!*\
  !*** ../../../common-script/snapp-api.js ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SNAPP_API_STATUS: () => (/* binding */ SNAPP_API_STATUS),\n/* harmony export */   SNAPP_API_STATUS_CHANGED: () => (/* binding */ SNAPP_API_STATUS_CHANGED),\n/* harmony export */   ServiceError: () => (/* binding */ ServiceError),\n/* harmony export */   SnappAPI: () => (/* binding */ SnappAPI)\n/* harmony export */ });\n/* harmony import */ var _timed_task__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./timed-task */ \"../../../common-script/timed-task.js\");\n/* harmony import */ var _common_script_utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @common-script/utils */ \"../../../common-script/utils.js\");\n\r\n\r\n\r\nconst SNAPP_API_STATUS = { \r\n  ONLINE: \"ONLINE\",\r\n  OFFLINE: \"OFFLINE\",\r\n  ONLINE_DIFFERENT_VER: \"ONLINE_DIFFERENT_VER\"\r\n}\r\n\r\nconst SNAPP_API_STATUS_CHANGED = \"snapp-api-status\";\r\n \r\nclass SnappAPI {\r\n  #status = SNAPP_API_STATUS.OFFLINE;  \r\n  #snappURL;\r\n\t#watchdogTask;\r\n\t#currentVersion;\r\n  \r\n\tconstructor (snappURL, workstationId, userId, token) {\r\n    this.#snappURL = snappURL;\r\n    this.commandHeader = { WorkstationId: workstationId }\r\n    \r\n    if (userId)\r\n      this.commandHeader.Header.UserAccountId = userId;\r\n    \r\n    if (token)\r\n      this.commandHeader.Header.Token = token; \r\n    \r\n    this.#watchdogTask = new _timed_task__WEBPACK_IMPORTED_MODULE_0__.TimedTask(60000, () => this.#sendWatchDog());\r\n    this.#watchdogTask.startWithImmediateExecution();\r\n  }\r\n  \r\n  paymentMethod(cmd, req) {   \r\n    return this.cmd(\"PaymentMethod\", cmd, req);\r\n  }\r\n  \r\n  getAccoutIdFromBiometricTemplate(bioTemplate) {\r\n    let req = {\r\n      Biometric : {\r\n        Base64Template: bioTemplate,\r\n        BiometricFormat: 1\r\n      }\r\n    }\r\n    \r\n    return this.account('BiometricSearch', req);\r\n  }\r\n  \r\n  account(cmd, req) {\r\n    return this.cmd('ACCOUNT', cmd, req);\r\n  }\r\n  \r\n  postTransaction(reqDO) {\r\n\t  reqDO.WorkstationId = this.commandHeader.WorkstationId;\r\n\t  reqDO.UserAccountId = this.commandHeader.UserAccountId;\r\n\t  \r\n    return new Promise((resolve, reject) => {\r\n      this.sendSnappRequest(\"PostTransaction\", reqDO)\r\n        .then(ans => resolve(ans))\r\n        .catch(error => reject(error));\r\n    });\r\n\t  \r\n  }\r\n\r\n\tcmd(entity, cmd, req) {\r\n\t\tlet reqDO = { \"Command\": cmd };\r\n\t\treqDO[cmd] = req;\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.sendSnappRequest(entity, reqDO)\r\n\t\t\t\t.then(ans => {\r\n\t\t\t\t\tlet answer = ans || {};\t\t\t\t\t\r\n\t\t\t\t\tresolve(answer[cmd] || {})\r\n\t\t\t\t})\r\n\t\t\t\t.catch(error => reject(error));\r\n\t\t});\r\n\t}\r\n\t\r\n\tsendSnappRequest(entity, reqDO) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet ajReq = {\r\n\t\t\t\tHeader: this.commandHeader,\r\n\t\t\t\tRequest: reqDO\r\n\t\t\t};\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: this.#snappURL + \"/service?cmd=\" + entity + \"&format=json&ts=\" + (new Date()).getTime(),\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: \"message=\" + encodeURIComponent(JSON.stringify(ajReq)),\r\n\t\t\t\tdataType: \"json\"\r\n\t\t\t}).always(ans => {\r\n\t\t\t\tlet error = SnappAPI.getServiceError(ans);\r\n\t\t\t\tif (error) {\r\n\t\t\t\t\tif (error.code == -1)\r\n\t\t\t\t\t\tthis.#setStatus(SNAPP_API_STATUS.OFFLINE);\r\n\t\t\t\t\treject(error);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.#watchdogTask.reset();\r\n\t\t\t\t\tif (!this.#isSameVersion(ans.Header.Ver))\r\n\t\t\t\t\t\tthis.#setStatus(SNAPP_API_STATUS.ONLINE_DIFFERENT_VER);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tthis.#setStatus(SNAPP_API_STATUS.ONLINE);\r\n\r\n\t\t\t\t\tresolve(ans.Answer);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n  \r\n  static getServiceError(ans) {\r\n    ans = (ans) ? ans : {};\r\n    \r\n    if ((ans.status != null) && (ans.status == 0))\r\n      return new ServiceError(-1, \"Server is unreacheable or the request timed out.\\nPlease try again.\");\r\n\r\n    if ((ans.status != null) && (ans.status != 200)) \r\n      return new ServiceError(-1, ans.status + \": \" + ans.statusText);\r\n\r\n    if (ans.Header == null)\r\n      return new ServiceError(-1, \"Unreadable response\");\r\n    \r\n    if (ans.Header.StatusCode != 200)\r\n      return new ServiceError(ans.Header.StatusCode, ans.Header.ErrorMessage || \"unknown error\");\r\n\r\n    return null;\r\n  }\r\n  \r\n  get status() {\r\n\t  return this.#status;\r\n  }\r\n  \r\n  #setStatus(newStatus) {\r\n    if (newStatus !== this.#status) {\r\n      this.#status = newStatus;\r\n      this.#triggerStatusChanged(this.#status);\r\n    }\r\n  }\r\n  \r\n  #triggerStatusChanged(status) {\r\n    this.#triggerEvent(\"snapp-api-status\", status);\r\n  }\r\n\r\n  #triggerEvent(eventCode, payload) {\r\n    $(document).trigger(eventCode, payload);\r\n  }\r\n\r\n  async #sendWatchDog() {\r\n\t  SNP_LOGGER.debug(null, null, \"Sending watchdog\");\r\n\t\tawait this.cmd(\"WATCHDOG\", \"WATCHDOG\", {}).catch(e => SNP_LOGGER.error(null, null, e));\r\n  }\r\n  \r\n  #isSameVersion(newVersion) {\r\n\t  let result = true;\r\n\t  if (!this.#currentVersion)\r\n\t  \tthis.#currentVersion = newVersion;\r\n\t  else if (this.#currentVersion !== newVersion)\r\n\t  \tresult = false;\r\n\t  \r\n\t  return result;\r\n  }\r\n  \r\n\tasync #fetchBase64File(url, timeout=5000) {\r\n\t\ttry {\r\n\t\t\tlet controller = new AbortController();\r\n      let id = setTimeout(() => controller.abort(), timeout);\r\n      \r\n\t    let response = await fetch(url, {\r\n\t\t\t\t method: 'GET',\r\n         signal: controller.signal\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tclearTimeout(id);\r\n\t\t\t\r\n\t    if (!response.ok) {\r\n      \tthrow new Error('API call failed with status: ' + response.status);\r\n\t    }\t\r\n\t    return await _common_script_utils__WEBPACK_IMPORTED_MODULE_1__.Utils.streamToBase64(response.body);\r\n    } catch (error) {\r\n      SNP_LOGGER.error(null, null, error);\r\n      throw error;\r\n    }\r\n\t}\t\r\n\t\t\r\n\tasync downloadBase64SdmInstaller(installerFileName) {\r\n\t\tlet url = this.#snappURL + '/storerepository?folder=frameworks/SDM/WIN32/&file=' + installerFileName;\r\n\t\treturn await this.#fetchBase64File(url, 50000);\r\n\t}\r\n\t\r\nasync downloadExtensionPackageAndFrameworks(extensionPackageId, frameworkList) {\r\n    let result = {\r\n        frameworkFiles: [],\r\n        pluginBase64Content: null\r\n    };\r\n\r\n    let urls = [];\r\n    let extensionPackageUrl = {\r\n        url: this.#snappURL + '/ext-package',\r\n        params: {\r\n            extensionPackageId: extensionPackageId\r\n        }\r\n    };\r\n    urls.push(extensionPackageUrl);\r\n\r\n    for (let fkw of frameworkList) {\r\n        if (fkw.Platform === 'WIN32' && !fkw.FileName.includes('snapp-device-manager')) {\r\n            let fkwUrl = {\r\n                url: this.#snappURL + '/storerepository',\r\n                params: {\r\n                    folder: 'frameworks/' + fkw.SourceFolder,\r\n                    file: fkw.FileName\r\n                }\r\n            };\r\n            urls.push(fkwUrl);\r\n        }\r\n    }\r\n\r\n    let fetchPromises = urls.map(({\r\n        url,\r\n        params\r\n    }) => {\r\n        let queryParams = new URLSearchParams(params).toString();\r\n        return fetch(`${url}?${queryParams}`).\r\n        \tthen(response => response).\r\n        \tcatch(error => console.error(error));\r\n    });\r\n\r\n    let responses = await Promise.all(fetchPromises);\r\n\r\n    // Process the first response\r\n    result.pluginBase64Content = await _common_script_utils__WEBPACK_IMPORTED_MODULE_1__.Utils.streamToBase64(responses[0].body);\r\n\r\n    // Process the remaining responses\r\n    await Promise.all(responses.map(async (response, index) => {\r\n\t\t\tif (response.ok && index > 0) {\r\n        let frameworkFile = {\r\n            fileName: urls[index].params.file,\r\n            fileBase64Content: await _common_script_utils__WEBPACK_IMPORTED_MODULE_1__.Utils.streamToBase64(response.body)\r\n        };\r\n        result.frameworkFiles.push(frameworkFile);\t\t\t\t\r\n\t\t\t}\r\n    }));\r\n\r\n    return result;\r\n\t}\r\n\t\r\n\r\n\t/*\r\n\tasync downloadBase64FrameworkFile(folder, file_name) {\r\n\t\tlet url = this.#snappURL + '/storerepository?folder=frameworks' + folder +'&file=' + file_name;\r\n\t\treturn await this.#fetchBase64File(url, 50000);\r\n\t}\t\r\n\t*/  \r\n}\r\n\r\nclass ServiceError extends Error {\r\n  constructor(code, message) {\r\n    super(message);\r\n    this.code = code;\r\n  }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vY29tbW9uLXNjcmlwdC9zbmFwcC1hcGkuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQXlDO0FBQ0k7QUFDN0M7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixrREFBUztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCO0FBQzlCLEtBQUs7QUFDTDtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQix1REFBSztBQUN2QixNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLHdCQUF3QixJQUFJLEdBQUcsWUFBWTtBQUMzQztBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLHVEQUFLO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyx1REFBSztBQUMxQztBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9raW9zay1jb250cm9sbGVyLy4uLy4uLy4uL2NvbW1vbi1zY3JpcHQvc25hcHAtYXBpLmpzPzFlYzkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGltZWRUYXNrIH0gZnJvbSBcIi4vdGltZWQtdGFza1wiO1xyXG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJ0Bjb21tb24tc2NyaXB0L3V0aWxzJztcclxuXHJcbmV4cG9ydCBjb25zdCBTTkFQUF9BUElfU1RBVFVTID0geyBcclxuICBPTkxJTkU6IFwiT05MSU5FXCIsXHJcbiAgT0ZGTElORTogXCJPRkZMSU5FXCIsXHJcbiAgT05MSU5FX0RJRkZFUkVOVF9WRVI6IFwiT05MSU5FX0RJRkZFUkVOVF9WRVJcIlxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgU05BUFBfQVBJX1NUQVRVU19DSEFOR0VEID0gXCJzbmFwcC1hcGktc3RhdHVzXCI7XHJcbiBcclxuZXhwb3J0IGNsYXNzIFNuYXBwQVBJIHtcclxuICAjc3RhdHVzID0gU05BUFBfQVBJX1NUQVRVUy5PRkZMSU5FOyAgXHJcbiAgI3NuYXBwVVJMO1xyXG5cdCN3YXRjaGRvZ1Rhc2s7XHJcblx0I2N1cnJlbnRWZXJzaW9uO1xyXG4gIFxyXG5cdGNvbnN0cnVjdG9yIChzbmFwcFVSTCwgd29ya3N0YXRpb25JZCwgdXNlcklkLCB0b2tlbikge1xyXG4gICAgdGhpcy4jc25hcHBVUkwgPSBzbmFwcFVSTDtcclxuICAgIHRoaXMuY29tbWFuZEhlYWRlciA9IHsgV29ya3N0YXRpb25JZDogd29ya3N0YXRpb25JZCB9XHJcbiAgICBcclxuICAgIGlmICh1c2VySWQpXHJcbiAgICAgIHRoaXMuY29tbWFuZEhlYWRlci5IZWFkZXIuVXNlckFjY291bnRJZCA9IHVzZXJJZDtcclxuICAgIFxyXG4gICAgaWYgKHRva2VuKVxyXG4gICAgICB0aGlzLmNvbW1hbmRIZWFkZXIuSGVhZGVyLlRva2VuID0gdG9rZW47IFxyXG4gICAgXHJcbiAgICB0aGlzLiN3YXRjaGRvZ1Rhc2sgPSBuZXcgVGltZWRUYXNrKDYwMDAwLCAoKSA9PiB0aGlzLiNzZW5kV2F0Y2hEb2coKSk7XHJcbiAgICB0aGlzLiN3YXRjaGRvZ1Rhc2suc3RhcnRXaXRoSW1tZWRpYXRlRXhlY3V0aW9uKCk7XHJcbiAgfVxyXG4gIFxyXG4gIHBheW1lbnRNZXRob2QoY21kLCByZXEpIHsgICBcclxuICAgIHJldHVybiB0aGlzLmNtZChcIlBheW1lbnRNZXRob2RcIiwgY21kLCByZXEpO1xyXG4gIH1cclxuICBcclxuICBnZXRBY2NvdXRJZEZyb21CaW9tZXRyaWNUZW1wbGF0ZShiaW9UZW1wbGF0ZSkge1xyXG4gICAgbGV0IHJlcSA9IHtcclxuICAgICAgQmlvbWV0cmljIDoge1xyXG4gICAgICAgIEJhc2U2NFRlbXBsYXRlOiBiaW9UZW1wbGF0ZSxcclxuICAgICAgICBCaW9tZXRyaWNGb3JtYXQ6IDFcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gdGhpcy5hY2NvdW50KCdCaW9tZXRyaWNTZWFyY2gnLCByZXEpO1xyXG4gIH1cclxuICBcclxuICBhY2NvdW50KGNtZCwgcmVxKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jbWQoJ0FDQ09VTlQnLCBjbWQsIHJlcSk7XHJcbiAgfVxyXG4gIFxyXG4gIHBvc3RUcmFuc2FjdGlvbihyZXFETykge1xyXG5cdCAgcmVxRE8uV29ya3N0YXRpb25JZCA9IHRoaXMuY29tbWFuZEhlYWRlci5Xb3Jrc3RhdGlvbklkO1xyXG5cdCAgcmVxRE8uVXNlckFjY291bnRJZCA9IHRoaXMuY29tbWFuZEhlYWRlci5Vc2VyQWNjb3VudElkO1xyXG5cdCAgXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICB0aGlzLnNlbmRTbmFwcFJlcXVlc3QoXCJQb3N0VHJhbnNhY3Rpb25cIiwgcmVxRE8pXHJcbiAgICAgICAgLnRoZW4oYW5zID0+IHJlc29sdmUoYW5zKSlcclxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4gcmVqZWN0KGVycm9yKSk7XHJcbiAgICB9KTtcclxuXHQgIFxyXG4gIH1cclxuXHJcblx0Y21kKGVudGl0eSwgY21kLCByZXEpIHtcclxuXHRcdGxldCByZXFETyA9IHsgXCJDb21tYW5kXCI6IGNtZCB9O1xyXG5cdFx0cmVxRE9bY21kXSA9IHJlcTtcclxuXHJcblx0XHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cdFx0XHR0aGlzLnNlbmRTbmFwcFJlcXVlc3QoZW50aXR5LCByZXFETylcclxuXHRcdFx0XHQudGhlbihhbnMgPT4ge1xyXG5cdFx0XHRcdFx0bGV0IGFuc3dlciA9IGFucyB8fCB7fTtcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRyZXNvbHZlKGFuc3dlcltjbWRdIHx8IHt9KVxyXG5cdFx0XHRcdH0pXHJcblx0XHRcdFx0LmNhdGNoKGVycm9yID0+IHJlamVjdChlcnJvcikpO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cdFxyXG5cdHNlbmRTbmFwcFJlcXVlc3QoZW50aXR5LCByZXFETykge1xyXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHRcdFx0bGV0IGFqUmVxID0ge1xyXG5cdFx0XHRcdEhlYWRlcjogdGhpcy5jb21tYW5kSGVhZGVyLFxyXG5cdFx0XHRcdFJlcXVlc3Q6IHJlcURPXHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHQkLmFqYXgoe1xyXG5cdFx0XHRcdHVybDogdGhpcy4jc25hcHBVUkwgKyBcIi9zZXJ2aWNlP2NtZD1cIiArIGVudGl0eSArIFwiJmZvcm1hdD1qc29uJnRzPVwiICsgKG5ldyBEYXRlKCkpLmdldFRpbWUoKSxcclxuXHRcdFx0XHR0eXBlOiBcIlBPU1RcIixcclxuXHRcdFx0XHRkYXRhOiBcIm1lc3NhZ2U9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkoYWpSZXEpKSxcclxuXHRcdFx0XHRkYXRhVHlwZTogXCJqc29uXCJcclxuXHRcdFx0fSkuYWx3YXlzKGFucyA9PiB7XHJcblx0XHRcdFx0bGV0IGVycm9yID0gU25hcHBBUEkuZ2V0U2VydmljZUVycm9yKGFucyk7XHJcblx0XHRcdFx0aWYgKGVycm9yKSB7XHJcblx0XHRcdFx0XHRpZiAoZXJyb3IuY29kZSA9PSAtMSlcclxuXHRcdFx0XHRcdFx0dGhpcy4jc2V0U3RhdHVzKFNOQVBQX0FQSV9TVEFUVVMuT0ZGTElORSk7XHJcblx0XHRcdFx0XHRyZWplY3QoZXJyb3IpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHRoaXMuI3dhdGNoZG9nVGFzay5yZXNldCgpO1xyXG5cdFx0XHRcdFx0aWYgKCF0aGlzLiNpc1NhbWVWZXJzaW9uKGFucy5IZWFkZXIuVmVyKSlcclxuXHRcdFx0XHRcdFx0dGhpcy4jc2V0U3RhdHVzKFNOQVBQX0FQSV9TVEFUVVMuT05MSU5FX0RJRkZFUkVOVF9WRVIpO1xyXG5cdFx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0XHR0aGlzLiNzZXRTdGF0dXMoU05BUFBfQVBJX1NUQVRVUy5PTkxJTkUpO1xyXG5cclxuXHRcdFx0XHRcdHJlc29sdmUoYW5zLkFuc3dlcik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdH0pO1xyXG5cdH1cclxuICBcclxuICBzdGF0aWMgZ2V0U2VydmljZUVycm9yKGFucykge1xyXG4gICAgYW5zID0gKGFucykgPyBhbnMgOiB7fTtcclxuICAgIFxyXG4gICAgaWYgKChhbnMuc3RhdHVzICE9IG51bGwpICYmIChhbnMuc3RhdHVzID09IDApKVxyXG4gICAgICByZXR1cm4gbmV3IFNlcnZpY2VFcnJvcigtMSwgXCJTZXJ2ZXIgaXMgdW5yZWFjaGVhYmxlIG9yIHRoZSByZXF1ZXN0IHRpbWVkIG91dC5cXG5QbGVhc2UgdHJ5IGFnYWluLlwiKTtcclxuXHJcbiAgICBpZiAoKGFucy5zdGF0dXMgIT0gbnVsbCkgJiYgKGFucy5zdGF0dXMgIT0gMjAwKSkgXHJcbiAgICAgIHJldHVybiBuZXcgU2VydmljZUVycm9yKC0xLCBhbnMuc3RhdHVzICsgXCI6IFwiICsgYW5zLnN0YXR1c1RleHQpO1xyXG5cclxuICAgIGlmIChhbnMuSGVhZGVyID09IG51bGwpXHJcbiAgICAgIHJldHVybiBuZXcgU2VydmljZUVycm9yKC0xLCBcIlVucmVhZGFibGUgcmVzcG9uc2VcIik7XHJcbiAgICBcclxuICAgIGlmIChhbnMuSGVhZGVyLlN0YXR1c0NvZGUgIT0gMjAwKVxyXG4gICAgICByZXR1cm4gbmV3IFNlcnZpY2VFcnJvcihhbnMuSGVhZGVyLlN0YXR1c0NvZGUsIGFucy5IZWFkZXIuRXJyb3JNZXNzYWdlIHx8IFwidW5rbm93biBlcnJvclwiKTtcclxuXHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbiAgXHJcbiAgZ2V0IHN0YXR1cygpIHtcclxuXHQgIHJldHVybiB0aGlzLiNzdGF0dXM7XHJcbiAgfVxyXG4gIFxyXG4gICNzZXRTdGF0dXMobmV3U3RhdHVzKSB7XHJcbiAgICBpZiAobmV3U3RhdHVzICE9PSB0aGlzLiNzdGF0dXMpIHtcclxuICAgICAgdGhpcy4jc3RhdHVzID0gbmV3U3RhdHVzO1xyXG4gICAgICB0aGlzLiN0cmlnZ2VyU3RhdHVzQ2hhbmdlZCh0aGlzLiNzdGF0dXMpO1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICAjdHJpZ2dlclN0YXR1c0NoYW5nZWQoc3RhdHVzKSB7XHJcbiAgICB0aGlzLiN0cmlnZ2VyRXZlbnQoXCJzbmFwcC1hcGktc3RhdHVzXCIsIHN0YXR1cyk7XHJcbiAgfVxyXG5cclxuICAjdHJpZ2dlckV2ZW50KGV2ZW50Q29kZSwgcGF5bG9hZCkge1xyXG4gICAgJChkb2N1bWVudCkudHJpZ2dlcihldmVudENvZGUsIHBheWxvYWQpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgI3NlbmRXYXRjaERvZygpIHtcclxuXHQgIFNOUF9MT0dHRVIuZGVidWcobnVsbCwgbnVsbCwgXCJTZW5kaW5nIHdhdGNoZG9nXCIpO1xyXG5cdFx0YXdhaXQgdGhpcy5jbWQoXCJXQVRDSERPR1wiLCBcIldBVENIRE9HXCIsIHt9KS5jYXRjaChlID0+IFNOUF9MT0dHRVIuZXJyb3IobnVsbCwgbnVsbCwgZSkpO1xyXG4gIH1cclxuICBcclxuICAjaXNTYW1lVmVyc2lvbihuZXdWZXJzaW9uKSB7XHJcblx0ICBsZXQgcmVzdWx0ID0gdHJ1ZTtcclxuXHQgIGlmICghdGhpcy4jY3VycmVudFZlcnNpb24pXHJcblx0ICBcdHRoaXMuI2N1cnJlbnRWZXJzaW9uID0gbmV3VmVyc2lvbjtcclxuXHQgIGVsc2UgaWYgKHRoaXMuI2N1cnJlbnRWZXJzaW9uICE9PSBuZXdWZXJzaW9uKVxyXG5cdCAgXHRyZXN1bHQgPSBmYWxzZTtcclxuXHQgIFxyXG5cdCAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcbiAgXHJcblx0YXN5bmMgI2ZldGNoQmFzZTY0RmlsZSh1cmwsIHRpbWVvdXQ9NTAwMCkge1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0bGV0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XHJcbiAgICAgIGxldCBpZCA9IHNldFRpbWVvdXQoKCkgPT4gY29udHJvbGxlci5hYm9ydCgpLCB0aW1lb3V0KTtcclxuICAgICAgXHJcblx0ICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwge1xyXG5cdFx0XHRcdCBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICBzaWduYWw6IGNvbnRyb2xsZXIuc2lnbmFsXHJcblx0XHRcdH0pO1xyXG5cdFx0XHRcclxuXHRcdFx0Y2xlYXJUaW1lb3V0KGlkKTtcclxuXHRcdFx0XHJcblx0ICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgXHR0aHJvdyBuZXcgRXJyb3IoJ0FQSSBjYWxsIGZhaWxlZCB3aXRoIHN0YXR1czogJyArIHJlc3BvbnNlLnN0YXR1cyk7XHJcblx0ICAgIH1cdFxyXG5cdCAgICByZXR1cm4gYXdhaXQgVXRpbHMuc3RyZWFtVG9CYXNlNjQocmVzcG9uc2UuYm9keSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBTTlBfTE9HR0VSLmVycm9yKG51bGwsIG51bGwsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcblx0fVx0XHJcblx0XHRcclxuXHRhc3luYyBkb3dubG9hZEJhc2U2NFNkbUluc3RhbGxlcihpbnN0YWxsZXJGaWxlTmFtZSkge1xyXG5cdFx0bGV0IHVybCA9IHRoaXMuI3NuYXBwVVJMICsgJy9zdG9yZXJlcG9zaXRvcnk/Zm9sZGVyPWZyYW1ld29ya3MvU0RNL1dJTjMyLyZmaWxlPScgKyBpbnN0YWxsZXJGaWxlTmFtZTtcclxuXHRcdHJldHVybiBhd2FpdCB0aGlzLiNmZXRjaEJhc2U2NEZpbGUodXJsLCA1MDAwMCk7XHJcblx0fVxyXG5cdFxyXG5hc3luYyBkb3dubG9hZEV4dGVuc2lvblBhY2thZ2VBbmRGcmFtZXdvcmtzKGV4dGVuc2lvblBhY2thZ2VJZCwgZnJhbWV3b3JrTGlzdCkge1xyXG4gICAgbGV0IHJlc3VsdCA9IHtcclxuICAgICAgICBmcmFtZXdvcmtGaWxlczogW10sXHJcbiAgICAgICAgcGx1Z2luQmFzZTY0Q29udGVudDogbnVsbFxyXG4gICAgfTtcclxuXHJcbiAgICBsZXQgdXJscyA9IFtdO1xyXG4gICAgbGV0IGV4dGVuc2lvblBhY2thZ2VVcmwgPSB7XHJcbiAgICAgICAgdXJsOiB0aGlzLiNzbmFwcFVSTCArICcvZXh0LXBhY2thZ2UnLFxyXG4gICAgICAgIHBhcmFtczoge1xyXG4gICAgICAgICAgICBleHRlbnNpb25QYWNrYWdlSWQ6IGV4dGVuc2lvblBhY2thZ2VJZFxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICB1cmxzLnB1c2goZXh0ZW5zaW9uUGFja2FnZVVybCk7XHJcblxyXG4gICAgZm9yIChsZXQgZmt3IG9mIGZyYW1ld29ya0xpc3QpIHtcclxuICAgICAgICBpZiAoZmt3LlBsYXRmb3JtID09PSAnV0lOMzInICYmICFma3cuRmlsZU5hbWUuaW5jbHVkZXMoJ3NuYXBwLWRldmljZS1tYW5hZ2VyJykpIHtcclxuICAgICAgICAgICAgbGV0IGZrd1VybCA9IHtcclxuICAgICAgICAgICAgICAgIHVybDogdGhpcy4jc25hcHBVUkwgKyAnL3N0b3JlcmVwb3NpdG9yeScsXHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHtcclxuICAgICAgICAgICAgICAgICAgICBmb2xkZXI6ICdmcmFtZXdvcmtzLycgKyBma3cuU291cmNlRm9sZGVyLFxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGU6IGZrdy5GaWxlTmFtZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB1cmxzLnB1c2goZmt3VXJsKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGZldGNoUHJvbWlzZXMgPSB1cmxzLm1hcCgoe1xyXG4gICAgICAgIHVybCxcclxuICAgICAgICBwYXJhbXNcclxuICAgIH0pID0+IHtcclxuICAgICAgICBsZXQgcXVlcnlQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHBhcmFtcykudG9TdHJpbmcoKTtcclxuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dXJsfT8ke3F1ZXJ5UGFyYW1zfWApLlxyXG4gICAgICAgIFx0dGhlbihyZXNwb25zZSA9PiByZXNwb25zZSkuXHJcbiAgICAgICAgXHRjYXRjaChlcnJvciA9PiBjb25zb2xlLmVycm9yKGVycm9yKSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBsZXQgcmVzcG9uc2VzID0gYXdhaXQgUHJvbWlzZS5hbGwoZmV0Y2hQcm9taXNlcyk7XHJcblxyXG4gICAgLy8gUHJvY2VzcyB0aGUgZmlyc3QgcmVzcG9uc2VcclxuICAgIHJlc3VsdC5wbHVnaW5CYXNlNjRDb250ZW50ID0gYXdhaXQgVXRpbHMuc3RyZWFtVG9CYXNlNjQocmVzcG9uc2VzWzBdLmJvZHkpO1xyXG5cclxuICAgIC8vIFByb2Nlc3MgdGhlIHJlbWFpbmluZyByZXNwb25zZXNcclxuICAgIGF3YWl0IFByb21pc2UuYWxsKHJlc3BvbnNlcy5tYXAoYXN5bmMgKHJlc3BvbnNlLCBpbmRleCkgPT4ge1xyXG5cdFx0XHRpZiAocmVzcG9uc2Uub2sgJiYgaW5kZXggPiAwKSB7XHJcbiAgICAgICAgbGV0IGZyYW1ld29ya0ZpbGUgPSB7XHJcbiAgICAgICAgICAgIGZpbGVOYW1lOiB1cmxzW2luZGV4XS5wYXJhbXMuZmlsZSxcclxuICAgICAgICAgICAgZmlsZUJhc2U2NENvbnRlbnQ6IGF3YWl0IFV0aWxzLnN0cmVhbVRvQmFzZTY0KHJlc3BvbnNlLmJvZHkpXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXN1bHQuZnJhbWV3b3JrRmlsZXMucHVzaChmcmFtZXdvcmtGaWxlKTtcdFx0XHRcdFxyXG5cdFx0XHR9XHJcbiAgICB9KSk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuXHR9XHJcblx0XHJcblxyXG5cdC8qXHJcblx0YXN5bmMgZG93bmxvYWRCYXNlNjRGcmFtZXdvcmtGaWxlKGZvbGRlciwgZmlsZV9uYW1lKSB7XHJcblx0XHRsZXQgdXJsID0gdGhpcy4jc25hcHBVUkwgKyAnL3N0b3JlcmVwb3NpdG9yeT9mb2xkZXI9ZnJhbWV3b3JrcycgKyBmb2xkZXIgKycmZmlsZT0nICsgZmlsZV9uYW1lO1xyXG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMuI2ZldGNoQmFzZTY0RmlsZSh1cmwsIDUwMDAwKTtcclxuXHR9XHRcclxuXHQqLyAgXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBTZXJ2aWNlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XHJcbiAgY29uc3RydWN0b3IoY29kZSwgbWVzc2FnZSkge1xyXG4gICAgc3VwZXIobWVzc2FnZSk7XHJcbiAgICB0aGlzLmNvZGUgPSBjb2RlO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///../../../common-script/snapp-api.js\n");

/***/ }),

/***/ "../../../common-script/snapp-log-worker.js":
/*!**************************************************!*\
  !*** ../../../common-script/snapp-log-worker.js ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LOG_WORKER_MESSAGE_TYPE: () => (/* binding */ LOG_WORKER_MESSAGE_TYPE),\n/* harmony export */   LogWorkerMessage: () => (/* binding */ LogWorkerMessage)\n/* harmony export */ });\n/* harmony import */ var _common_script_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @common-script/utils */ \"../../../common-script/utils.js\");\n/* harmony import */ var _timed_task__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./timed-task */ \"../../../common-script/timed-task.js\");\n\r\n\r\n\r\nlet oldLogRecoveryTask = new _timed_task__WEBPACK_IMPORTED_MODULE_1__.TimedTask(15000, () => recoveryOldLogs());\r\n\r\nconst requestQueue = [];\r\nconst logFileMaxSize = 50 * 1024 //Max size 50 kB\r\nlet processing = false;\r\nlet currentFileLog = null; \r\nlet logDirectoryHandle = null;\r\nlet snappAPIParams = null;\r\nconst uploadQueue = [];\r\n\r\nconst LOGSTART_LABEL = '{\\\"Logs\\\": ['\r\nconst LOGEND_LABEL = ']}'\r\n\r\n\r\nself.onmessage = async (e) => {\r\n\tif (navigator.storage && navigator.storage.estimate) {\r\n\t\t //Use this queue if you experiment some writing issues on file.\r\n\t\trequestQueue.push(e.data);\r\n\t\tif (!processing) {\r\n\t\t\tprocessing = true;\r\n\t\t\ttry {\r\n\t\t\t\tawait processQueue();\t\t\t\t\r\n\t\t\t} \r\n\t\t\tfinally {\r\n\t\t\t\tprocessing = false;\r\n\t\t\t}\r\n\t\t}\r\n\t} \r\n\telse {\r\n\t\tconsole.error('Local storage is full')\r\n\t}\r\n};\r\n\r\n\r\nasync function processQueue() {\r\n\twhile (requestQueue.length > 0) {\r\n\t\tconst request = requestQueue.shift();\r\n\t\tawait handleRequest(request);\r\n\t}\r\n}\r\n\r\nfunction createLogFileName(sequence) {\r\n\tlet currentDate = new Date();\r\n\tlet currentYear = currentDate.getFullYear();\r\n\tlet currentMonth = currentDate.getMonth() + 1;\r\n\tlet currentDay = currentDate.getDate();\r\n\tlet currentHour = currentDate.getHours();\r\n\tlet currentMin = currentDate.getMinutes();\r\n\t\r\n\treturn 'log_' + currentYear + currentMonth.toString().padStart(2, '0') + \r\n\t\t\t\t\t\t\t\t\tcurrentDay.toString().padStart(2, '0') +\r\n\t\t\t\t\t\t\t\t\tcurrentHour.toString().padStart(2, '0') +\r\n\t\t\t\t\t\t\t\t\tcurrentMin.toString().padStart(2, '0') +\r\n\t\t\t\t\t\t\t\t\t'_' +\r\n\t\t\t\t\t\t\t\t\tsequence + \r\n\t\t\t\t\t\t\t\t\t'_' +\r\n\t\t\t\t\t\t\t\t\t_common_script_utils__WEBPACK_IMPORTED_MODULE_0__.Utils.createUUID() +\r\n\t\t\t\t\t\t\t\t\t'_tmp.txt'\r\n}\r\n\r\n\r\n\r\nasync function createNewFileLogger(fileName) {\r\n\tlet logFileName = null;\r\n\tif (fileName == null)\t\r\n\t logFileName = createLogFileName(0);\r\n\telse\r\n\t\tlogFileName = fileName;\r\n\tlet logFileHandle =  await logDirectoryHandle.getFileHandle(logFileName, {create: true,});\r\n\tlet logFileAccessHandle = await logFileHandle.createSyncAccessHandle();\r\n\treturn new FileLogger(logFileName, logFileHandle, logFileAccessHandle)\r\n}\r\n\r\nasync function isOverSize(logFileHandle) {\r\n\treturn (await logFileHandle.getFile()).size >= logFileMaxSize;\r\n}\r\n\r\nasync function rollLogFileIfNeeded(logFileName, logFileHandle, logFileAccessHandle) {\t\r\n\tlet rolledLogFileName = null;\r\n\tlet rolledLogFileHandle = null;\r\n\tlet rolledLogFileAccessHandle = null;\r\n\t\t\t\r\n\tif (logFileName == null || !isInTheSameMinute(logFileName)) { //If is invalid\r\n\t\tif (logFileName != null && currentFileLog != null && currentFileLog.getLogFileName() == logFileName)\r\n\t\t\tawait closeFileLogger(currentFileLog.getLogFileName(), currentFileLog.getLogFileAccessHandle());\r\n\t\treturn await createNewFileLogger();\r\n\t} \r\n\telse {\r\n\t\tif (logFileHandle == null)\r\n\t\t\tlogFileHandle = await logDirectoryHandle.getFileHandle(logFileName, {create: true,});\r\n\t\t\r\n\t\tif (await isOverSize(logFileHandle)) { //If size exceed max\r\n\t\t\tlet sequenceNumber = logFileName.split('_')[2]; //extract sequence number\r\n\t\t \tlet newSequenceNumber = parseInt(sequenceNumber) + 1;\r\n\t\t \trolledLogFileName = createLogFileName(newSequenceNumber);\r\n\t\t} else {\r\n\t\t\trolledLogFileName = logFileName;\r\n\t\t}\t\r\n\t\t\r\n\t\tif (rolledLogFileName != logFileName) {\r\n\t\t\tif (logFileAccessHandle != null) {\r\n\t\t\t\tawait closeFileLogger(logFileName, logFileAccessHandle);\r\n\t\t\t}\r\n\t\t\treturn await createNewFileLogger(rolledLogFileName);\r\n\t\t}\telse {\r\n\t\t\trolledLogFileName = logFileName;\r\n\t\t\trolledLogFileHandle = logFileHandle;\r\n\t\t\t\r\n\t\t\tif (logFileAccessHandle == null)\r\n\t\t\t\trolledLogFileAccessHandle = await rolledLogFileHandle.createSyncAccessHandle();\r\n\t\t\telse\r\n\t\t\t\trolledLogFileAccessHandle = logFileAccessHandle;\r\n\t\t}\r\n\t}\r\n\treturn new FileLogger(rolledLogFileName, rolledLogFileHandle, rolledLogFileAccessHandle)\r\n}\r\n\r\nasync function tryToUseFileLogOnFileSystem() {\r\n\tlet logFileName = null;\r\n\tlet fileNameList = await getLogFileList(logDirectoryHandle); //list files in log directory\r\n\tfileNameList.sort();\r\n\tlogFileName = fileNameList[fileNameList.length - 1];\r\n\treturn  await rollLogFileIfNeeded(logFileName, null, null);\r\n}\r\n\r\nfunction parseDateFromLogFileName(logFileName) {\r\n\tlet logFileDate = logFileName.split('_')[1]\r\n\tlet logYear = logFileDate.substring(0, 4);\r\n\tlet logMonth = logFileDate.substring(4, 6);\r\n\tlet logDay = logFileDate.substring(6, 8);\r\n\tlet logHour = logFileDate.substring(8, 10);\r\n\tlet logMinute = logFileDate.substring(10, 12);\r\n\treturn new Date(logYear, logMonth -1, logDay, logHour, logMinute, 0, 0);\r\n}\r\n\r\nfunction parseUUIDFromLogFileName(logFileName) {\r\n\treturn logFileName.split('_')[3];\r\n}\r\n\r\nfunction isAnOldLog(logFileName) {\r\n\tlet dateNow = new Date();\r\n\tdateNow.setSeconds(0);\r\n\tdateNow.setMilliseconds(0);\r\n\tlet parsedDate = parseDateFromLogFileName(logFileName);\r\n\tlet diff = dateNow - parsedDate;\r\n\treturn diff > 60 * 1000 ;\r\n}\r\n\r\nasync function recoveryOldLogs() {\r\n\tconsole.log('--- recoveryOldLogs start');\r\n\tlet fileNameList = await getLogFileList(logDirectoryHandle); //list files in log directory\r\n\tfor (let logFileName of fileNameList) {\r\n\t\tif (!uploadQueue.includes(logFileName) && isAnOldLog(logFileName)) {\r\n\t\t\ttry {\r\n\t\t\t\tif (currentFileLog != null && currentFileLog.getLogFileName() == logFileName) //current log file is expired without logs\r\n\t\t\t\t\tawait closeFileLogger(currentFileLog.getLogFileName(), currentFileLog.getLogFileAccessHandle());\r\n\t\t\t\tawait writeLogEndIfNeeded(logFileName);\r\n\t\t\t\taddToUploadQueue(logFileName);\t\t\t\t\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error(error)\r\n\t\t\t}\r\n\t\t\tconsole.log('--- recoverying' + logFileName);\r\n\t\t}\r\n\t}\r\n\tprocessUploadQueue();\r\n\tconsole.log('--- recoveryOldLogs end');\r\n}\r\n\r\nasync function tryToUseCurrentFileLogger() {\r\n\tlet logFileName = currentFileLog.getLogFileName();\r\n\tlet logFileHandle = currentFileLog.getLogFileHandle();\r\n\tlet logFileAccessHandle = currentFileLog.getLogFileAccessHandle();\r\n\treturn await rollLogFileIfNeeded(logFileName, logFileHandle, logFileAccessHandle);\r\n}\r\n\r\nasync function initFileLogger() {\r\n\tlet rootDirectory = await navigator.storage.getDirectory();\r\n\tlogDirectoryHandle = await rootDirectory.getDirectoryHandle('kioskJSLogs', {create: true,});\r\n\treturn await tryToUseFileLogOnFileSystem();\r\n}\r\n\r\nasync function closeFileLogger(fileName, fileAccessHandle) {\r\n\tif (fileAccessHandle != null) {\r\n\t\ttry {\r\n\t\t\tawait fileAccessHandle.flush();\r\n\t\t\tawait writeLogEnd(fileAccessHandle); \r\n\t\t\tawait fileAccessHandle.flush();\r\n\t\t\tawait fileAccessHandle.close();\r\n\t\t\taddToUploadQueue(fileName);\t\t\t\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log('File is already closed. It may be recovery task has already closed it');\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nasync function configureFileLogger() {\t\r\n\tif (currentFileLog == null) {\r\n\t\tcurrentFileLog = await initFileLogger();\r\n\t\toldLogRecoveryTask.startWithImmediateExecution();\r\n\t}\r\n\telse  // Use last log\r\n\t\tcurrentFileLog = await tryToUseCurrentFileLogger();\r\n}\r\n\r\nasync function getLogFileList(logDirectoryHandle) {\r\n\tlet fileNames = [];\r\n\tfor await (const entry of logDirectoryHandle.values()) {\r\n\t\tif (entry.kind === 'file') {\r\n\t\t\tfileNames.push(entry.name);\r\n\t\t}\r\n\t}\r\n\treturn fileNames;\r\n}\r\n\r\nfunction isInTheSameMinute(logFileName) {\r\n\tlet result = false\r\n\tif (logFileName != null) {\r\n\t\tlet dateNow = new Date();\r\n\t\tdateNow.setSeconds(0);\r\n\t\tdateNow.setMilliseconds(0);\r\n\t\tlet parsedDate = parseDateFromLogFileName(logFileName);\r\n\t\tresult = (dateNow - parsedDate == 0);\r\n\t}\r\n\treturn result;\r\n}\r\n\r\n\r\nasync function writeLogStart(logFileAccessHandle) {\r\n\tlet data = new TextEncoder().encode(LOGSTART_LABEL + '\\n');\r\n\tawait logFileAccessHandle.write(data);\r\n\treturn await logFileAccessHandle.flush();\r\n}\r\n\r\nasync function writeLogEnd(logFileAccessHandle) {\r\n\tlet fileSize = await logFileAccessHandle.getSize();\r\n\tlet data = new TextEncoder().encode('\\n' + LOGEND_LABEL);\r\n\tawait logFileAccessHandle.write(data, { at: fileSize - 2 });\r\n\treturn await logFileAccessHandle.flush();\r\n}\r\n\r\nasync function writeOnLogFile(logFileAccessHandle, request) {\r\n\tlet result = false;\r\n\tlet fileSize = await logFileAccessHandle.getSize();\r\n\tif (fileSize == 0) {\r\n\t\tawait writeLogStart(logFileAccessHandle);\r\n\t}\r\n\tfileSize = await logFileAccessHandle.getSize();\r\n\tlet rawText = request + ',' + '\\n';\r\n\tlet data = new TextEncoder().encode(rawText);\r\n\tresult = await logFileAccessHandle.write(data, { at: fileSize });\r\n\t//console.log(\"File size:\" + fileSize);\r\n\tresult = await logFileAccessHandle.flush();\r\n\treturn result;\r\n}\r\n\r\nasync function handleRequest(request) {\r\n\tlet result = false;\r\n\tswitch(request.type) {\r\n\t\tcase LOG_WORKER_MESSAGE_TYPE.LOG: {\r\n\t\t\tresult = await handleLog(request.payload);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase LOG_WORKER_MESSAGE_TYPE.CONFIG_PARAMS: {\r\n\t\t\tconfigureSnappAPI(request.payload);\r\n\t\t\tbreak;\t\t\r\n\t\t}\r\n\t\tdefault:\r\n\t\t\tbreak;\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nasync function handleLog(request) {\r\n\tawait configureFileLogger();\r\n\tlet currentLogFileAccessHandle = currentFileLog.getLogFileAccessHandle();\r\n\treturn await writeOnLogFile(currentLogFileAccessHandle, JSON.stringify(request));\r\n}\r\n\r\nfunction configureSnappAPI(params) {\r\n\tsnappAPIParams = params;\r\n}\r\n\r\nasync function writeLogEndIfNeeded(fileName) {\r\n\tlet logFileHandle = await logDirectoryHandle.getFileHandle(fileName, {create: false,});\r\n\tlet file = await logFileHandle.getFile();\r\n\tlet start = file.size - 2 < 0 ? 0 : file.size - 2;\r\n\tconst blob = file.slice(start);\r\n\tconst text = await blob.text();\r\n\t\r\n\tif (text != LOGEND_LABEL) {\r\n\t\tlet logFileAccessHandle = await logFileHandle.createSyncAccessHandle();\r\n\t\tawait writeLogEnd(logFileAccessHandle);\r\n\t\tawait logFileAccessHandle.close();\r\n\t}\r\n}\r\n\r\nasync function addToUploadQueue(logFileName) {\r\n\tif (!uploadQueue.includes(logFileName))\r\n\t\tuploadQueue.push(logFileName);\r\n}\r\n\r\nfunction getUploadRequest(logFileName, base64Logs) {\r\n\tlet result = {\r\n\t\t'Header': {\r\n\t\t\t'WorkstationId': snappAPIParams.workstationId,\r\n\t\t\t'UserAccountId': snappAPIParams.userId,\r\n\t\t\t'Token': snappAPIParams.token\r\n\t\t},\r\n\t\t'Request': {\r\n\t\t\t'Command': 'ADD',\r\n\t\t\t'Add': {\r\n\t\t\t\t'UploadId':parseUUIDFromLogFileName(logFileName),\r\n\t\t\t\t'UploadType': 4,\r\n\t\t\t\t'MsgRequest': base64Logs\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\treturn result;\r\n}\r\n\r\n//https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch\r\nasync function uploadLogFile(logFileName) {\r\n\tlet logFileHandle = await logDirectoryHandle.getFileHandle(logFileName, {create: true,});\r\n\tlet file = await logFileHandle.getFile();\r\n\tlet logs = await file.text()\r\n\tlet base64Logs = await _common_script_utils__WEBPACK_IMPORTED_MODULE_0__.Utils.encodeBase64URLEncoded(logs);\r\n\t  \r\n\tconst urlEncodedBody = new URLSearchParams({\r\n\t\tmessage: JSON.stringify(getUploadRequest(logFileName, base64Logs))\r\n\t});\r\n\r\n\treturn new Promise((resolve, reject) => {\r\n\t    // Perform the API call using fetch or any other suitable method\r\n\t    fetch(snappAPIParams.apiUrl + '/service?cmd=UPLOAD&format=json', {\r\n\t      method: 'POST',\r\n\t      headers: {\r\n\t        'Content-Type': 'application/x-www-form-urlencoded'\r\n\t      },\r\n\t      body: urlEncodedBody\r\n\t    })\r\n\t    .then(response => {\r\n\t        if (response.ok) {\r\n\t          // Resolve the Promise with the response data\r\n\t          resolve(response.json());\r\n\t          \r\n\t          logFileHandle.remove(); //Remove if upload succeded\r\n\t        } else {\r\n\t\t\t\t\t\tconsole.error(error);\r\n\t          // Reject the Promise with an error message\r\n\t          reject('API call failed with status: ' + response.status);\r\n\t        }\r\n\t      })\r\n\t      .catch(error => {\r\n\t      \tconsole.error(error);\r\n\t        reject(error);\r\n\t      });\r\n  });\r\n}\r\n\r\nasync function processUploadQueue() {\r\n\twhile (uploadQueue.length > 0) {\r\n\t\ttry {\r\n\t\t\tlet uploadFile = uploadQueue.shift();\r\n\t\t\tawait uploadLogFile(uploadFile);\t\t\t\r\n\t\t} catch(e) {\r\n\t\t\tconsole.error(e);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nclass FileLogger {\r\n\t#logFileName;\r\n\t#logFileHandle;\r\n\t#logFileAccessHandle;\r\n\t\r\n\tconstructor(logFileName, logFileHandle, logFileAccessHandle) {\r\n\t   this.#logFileName = logFileName;\r\n\t   this.#logFileHandle = logFileHandle;\r\n\t   this.#logFileAccessHandle = logFileAccessHandle;\r\n\t}\r\n\t\r\n\tgetLogFileName() {\r\n\t\treturn this.#logFileName;\r\n\t}\r\n\t\r\n\tgetLogFileHandle() {\r\n\t\treturn this.#logFileHandle;\r\n\t}\r\n\t\r\n\tgetLogFileAccessHandle() {\r\n\t\treturn this.#logFileAccessHandle;\r\n\t}\r\n}\r\n\r\n\r\nclass LogWorkerMessage {\r\n\ttype;\r\n\tpayload;\r\n\t\r\n\tconstructor(type, payload) {\r\n\t\tthis.type = type;\r\n\t\tthis.payload = payload;\r\n\t}\r\n}\r\n\r\nconst LOG_WORKER_MESSAGE_TYPE = {\r\n\tLOG: 1,\r\n\tCONFIG_PARAMS: 2\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vY29tbW9uLXNjcmlwdC9zbmFwcC1sb2ctd29ya2VyLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBNkM7QUFDSjtBQUN6QztBQUNBLDZCQUE2QixrREFBUztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIsd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLHVEQUFLO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJFQUEyRSxjQUFjO0FBQ3pGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0RBQStEO0FBQy9EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdFQUF3RSxjQUFjO0FBQ3RGO0FBQ0EseUNBQXlDO0FBQ3pDLG1EQUFtRDtBQUNuRDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhEQUE4RDtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4REFBOEQ7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkVBQTZFLGNBQWM7QUFDM0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLGtCQUFrQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0QsY0FBYztBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1RUFBdUUsZUFBZTtBQUN0RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwRUFBMEUsY0FBYztBQUN4RjtBQUNBO0FBQ0Esd0JBQXdCLHVEQUFLO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DO0FBQ25DLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1IsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2tpb3NrLWNvbnRyb2xsZXIvLi4vLi4vLi4vY29tbW9uLXNjcmlwdC9zbmFwcC1sb2ctd29ya2VyLmpzPzVhZGEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVXRpbHMgfSBmcm9tICdAY29tbW9uLXNjcmlwdC91dGlscyc7XHJcbmltcG9ydCB7IFRpbWVkVGFzayB9IGZyb20gXCIuL3RpbWVkLXRhc2tcIjtcclxuXHJcbmxldCBvbGRMb2dSZWNvdmVyeVRhc2sgPSBuZXcgVGltZWRUYXNrKDE1MDAwLCAoKSA9PiByZWNvdmVyeU9sZExvZ3MoKSk7XHJcblxyXG5jb25zdCByZXF1ZXN0UXVldWUgPSBbXTtcclxuY29uc3QgbG9nRmlsZU1heFNpemUgPSA1MCAqIDEwMjQgLy9NYXggc2l6ZSA1MCBrQlxyXG5sZXQgcHJvY2Vzc2luZyA9IGZhbHNlO1xyXG5sZXQgY3VycmVudEZpbGVMb2cgPSBudWxsOyBcclxubGV0IGxvZ0RpcmVjdG9yeUhhbmRsZSA9IG51bGw7XHJcbmxldCBzbmFwcEFQSVBhcmFtcyA9IG51bGw7XHJcbmNvbnN0IHVwbG9hZFF1ZXVlID0gW107XHJcblxyXG5jb25zdCBMT0dTVEFSVF9MQUJFTCA9ICd7XFxcIkxvZ3NcXFwiOiBbJ1xyXG5jb25zdCBMT0dFTkRfTEFCRUwgPSAnXX0nXHJcblxyXG5cclxuc2VsZi5vbm1lc3NhZ2UgPSBhc3luYyAoZSkgPT4ge1xyXG5cdGlmIChuYXZpZ2F0b3Iuc3RvcmFnZSAmJiBuYXZpZ2F0b3Iuc3RvcmFnZS5lc3RpbWF0ZSkge1xyXG5cdFx0IC8vVXNlIHRoaXMgcXVldWUgaWYgeW91IGV4cGVyaW1lbnQgc29tZSB3cml0aW5nIGlzc3VlcyBvbiBmaWxlLlxyXG5cdFx0cmVxdWVzdFF1ZXVlLnB1c2goZS5kYXRhKTtcclxuXHRcdGlmICghcHJvY2Vzc2luZykge1xyXG5cdFx0XHRwcm9jZXNzaW5nID0gdHJ1ZTtcclxuXHRcdFx0dHJ5IHtcclxuXHRcdFx0XHRhd2FpdCBwcm9jZXNzUXVldWUoKTtcdFx0XHRcdFxyXG5cdFx0XHR9IFxyXG5cdFx0XHRmaW5hbGx5IHtcclxuXHRcdFx0XHRwcm9jZXNzaW5nID0gZmFsc2U7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9IFxyXG5cdGVsc2Uge1xyXG5cdFx0Y29uc29sZS5lcnJvcignTG9jYWwgc3RvcmFnZSBpcyBmdWxsJylcclxuXHR9XHJcbn07XHJcblxyXG5cclxuYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc1F1ZXVlKCkge1xyXG5cdHdoaWxlIChyZXF1ZXN0UXVldWUubGVuZ3RoID4gMCkge1xyXG5cdFx0Y29uc3QgcmVxdWVzdCA9IHJlcXVlc3RRdWV1ZS5zaGlmdCgpO1xyXG5cdFx0YXdhaXQgaGFuZGxlUmVxdWVzdChyZXF1ZXN0KTtcclxuXHR9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZUxvZ0ZpbGVOYW1lKHNlcXVlbmNlKSB7XHJcblx0bGV0IGN1cnJlbnREYXRlID0gbmV3IERhdGUoKTtcclxuXHRsZXQgY3VycmVudFllYXIgPSBjdXJyZW50RGF0ZS5nZXRGdWxsWWVhcigpO1xyXG5cdGxldCBjdXJyZW50TW9udGggPSBjdXJyZW50RGF0ZS5nZXRNb250aCgpICsgMTtcclxuXHRsZXQgY3VycmVudERheSA9IGN1cnJlbnREYXRlLmdldERhdGUoKTtcclxuXHRsZXQgY3VycmVudEhvdXIgPSBjdXJyZW50RGF0ZS5nZXRIb3VycygpO1xyXG5cdGxldCBjdXJyZW50TWluID0gY3VycmVudERhdGUuZ2V0TWludXRlcygpO1xyXG5cdFxyXG5cdHJldHVybiAnbG9nXycgKyBjdXJyZW50WWVhciArIGN1cnJlbnRNb250aC50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJykgKyBcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y3VycmVudERheS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJykgK1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRjdXJyZW50SG91ci50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJykgK1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRjdXJyZW50TWluLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKSArXHJcblx0XHRcdFx0XHRcdFx0XHRcdCdfJyArXHJcblx0XHRcdFx0XHRcdFx0XHRcdHNlcXVlbmNlICsgXHJcblx0XHRcdFx0XHRcdFx0XHRcdCdfJyArXHJcblx0XHRcdFx0XHRcdFx0XHRcdFV0aWxzLmNyZWF0ZVVVSUQoKSArXHJcblx0XHRcdFx0XHRcdFx0XHRcdCdfdG1wLnR4dCdcclxufVxyXG5cclxuXHJcblxyXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVOZXdGaWxlTG9nZ2VyKGZpbGVOYW1lKSB7XHJcblx0bGV0IGxvZ0ZpbGVOYW1lID0gbnVsbDtcclxuXHRpZiAoZmlsZU5hbWUgPT0gbnVsbClcdFxyXG5cdCBsb2dGaWxlTmFtZSA9IGNyZWF0ZUxvZ0ZpbGVOYW1lKDApO1xyXG5cdGVsc2VcclxuXHRcdGxvZ0ZpbGVOYW1lID0gZmlsZU5hbWU7XHJcblx0bGV0IGxvZ0ZpbGVIYW5kbGUgPSAgYXdhaXQgbG9nRGlyZWN0b3J5SGFuZGxlLmdldEZpbGVIYW5kbGUobG9nRmlsZU5hbWUsIHtjcmVhdGU6IHRydWUsfSk7XHJcblx0bGV0IGxvZ0ZpbGVBY2Nlc3NIYW5kbGUgPSBhd2FpdCBsb2dGaWxlSGFuZGxlLmNyZWF0ZVN5bmNBY2Nlc3NIYW5kbGUoKTtcclxuXHRyZXR1cm4gbmV3IEZpbGVMb2dnZXIobG9nRmlsZU5hbWUsIGxvZ0ZpbGVIYW5kbGUsIGxvZ0ZpbGVBY2Nlc3NIYW5kbGUpXHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGlzT3ZlclNpemUobG9nRmlsZUhhbmRsZSkge1xyXG5cdHJldHVybiAoYXdhaXQgbG9nRmlsZUhhbmRsZS5nZXRGaWxlKCkpLnNpemUgPj0gbG9nRmlsZU1heFNpemU7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHJvbGxMb2dGaWxlSWZOZWVkZWQobG9nRmlsZU5hbWUsIGxvZ0ZpbGVIYW5kbGUsIGxvZ0ZpbGVBY2Nlc3NIYW5kbGUpIHtcdFxyXG5cdGxldCByb2xsZWRMb2dGaWxlTmFtZSA9IG51bGw7XHJcblx0bGV0IHJvbGxlZExvZ0ZpbGVIYW5kbGUgPSBudWxsO1xyXG5cdGxldCByb2xsZWRMb2dGaWxlQWNjZXNzSGFuZGxlID0gbnVsbDtcclxuXHRcdFx0XHJcblx0aWYgKGxvZ0ZpbGVOYW1lID09IG51bGwgfHwgIWlzSW5UaGVTYW1lTWludXRlKGxvZ0ZpbGVOYW1lKSkgeyAvL0lmIGlzIGludmFsaWRcclxuXHRcdGlmIChsb2dGaWxlTmFtZSAhPSBudWxsICYmIGN1cnJlbnRGaWxlTG9nICE9IG51bGwgJiYgY3VycmVudEZpbGVMb2cuZ2V0TG9nRmlsZU5hbWUoKSA9PSBsb2dGaWxlTmFtZSlcclxuXHRcdFx0YXdhaXQgY2xvc2VGaWxlTG9nZ2VyKGN1cnJlbnRGaWxlTG9nLmdldExvZ0ZpbGVOYW1lKCksIGN1cnJlbnRGaWxlTG9nLmdldExvZ0ZpbGVBY2Nlc3NIYW5kbGUoKSk7XHJcblx0XHRyZXR1cm4gYXdhaXQgY3JlYXRlTmV3RmlsZUxvZ2dlcigpO1xyXG5cdH0gXHJcblx0ZWxzZSB7XHJcblx0XHRpZiAobG9nRmlsZUhhbmRsZSA9PSBudWxsKVxyXG5cdFx0XHRsb2dGaWxlSGFuZGxlID0gYXdhaXQgbG9nRGlyZWN0b3J5SGFuZGxlLmdldEZpbGVIYW5kbGUobG9nRmlsZU5hbWUsIHtjcmVhdGU6IHRydWUsfSk7XHJcblx0XHRcclxuXHRcdGlmIChhd2FpdCBpc092ZXJTaXplKGxvZ0ZpbGVIYW5kbGUpKSB7IC8vSWYgc2l6ZSBleGNlZWQgbWF4XHJcblx0XHRcdGxldCBzZXF1ZW5jZU51bWJlciA9IGxvZ0ZpbGVOYW1lLnNwbGl0KCdfJylbMl07IC8vZXh0cmFjdCBzZXF1ZW5jZSBudW1iZXJcclxuXHRcdCBcdGxldCBuZXdTZXF1ZW5jZU51bWJlciA9IHBhcnNlSW50KHNlcXVlbmNlTnVtYmVyKSArIDE7XHJcblx0XHQgXHRyb2xsZWRMb2dGaWxlTmFtZSA9IGNyZWF0ZUxvZ0ZpbGVOYW1lKG5ld1NlcXVlbmNlTnVtYmVyKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHJvbGxlZExvZ0ZpbGVOYW1lID0gbG9nRmlsZU5hbWU7XHJcblx0XHR9XHRcclxuXHRcdFxyXG5cdFx0aWYgKHJvbGxlZExvZ0ZpbGVOYW1lICE9IGxvZ0ZpbGVOYW1lKSB7XHJcblx0XHRcdGlmIChsb2dGaWxlQWNjZXNzSGFuZGxlICE9IG51bGwpIHtcclxuXHRcdFx0XHRhd2FpdCBjbG9zZUZpbGVMb2dnZXIobG9nRmlsZU5hbWUsIGxvZ0ZpbGVBY2Nlc3NIYW5kbGUpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBhd2FpdCBjcmVhdGVOZXdGaWxlTG9nZ2VyKHJvbGxlZExvZ0ZpbGVOYW1lKTtcclxuXHRcdH1cdGVsc2Uge1xyXG5cdFx0XHRyb2xsZWRMb2dGaWxlTmFtZSA9IGxvZ0ZpbGVOYW1lO1xyXG5cdFx0XHRyb2xsZWRMb2dGaWxlSGFuZGxlID0gbG9nRmlsZUhhbmRsZTtcclxuXHRcdFx0XHJcblx0XHRcdGlmIChsb2dGaWxlQWNjZXNzSGFuZGxlID09IG51bGwpXHJcblx0XHRcdFx0cm9sbGVkTG9nRmlsZUFjY2Vzc0hhbmRsZSA9IGF3YWl0IHJvbGxlZExvZ0ZpbGVIYW5kbGUuY3JlYXRlU3luY0FjY2Vzc0hhbmRsZSgpO1xyXG5cdFx0XHRlbHNlXHJcblx0XHRcdFx0cm9sbGVkTG9nRmlsZUFjY2Vzc0hhbmRsZSA9IGxvZ0ZpbGVBY2Nlc3NIYW5kbGU7XHJcblx0XHR9XHJcblx0fVxyXG5cdHJldHVybiBuZXcgRmlsZUxvZ2dlcihyb2xsZWRMb2dGaWxlTmFtZSwgcm9sbGVkTG9nRmlsZUhhbmRsZSwgcm9sbGVkTG9nRmlsZUFjY2Vzc0hhbmRsZSlcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gdHJ5VG9Vc2VGaWxlTG9nT25GaWxlU3lzdGVtKCkge1xyXG5cdGxldCBsb2dGaWxlTmFtZSA9IG51bGw7XHJcblx0bGV0IGZpbGVOYW1lTGlzdCA9IGF3YWl0IGdldExvZ0ZpbGVMaXN0KGxvZ0RpcmVjdG9yeUhhbmRsZSk7IC8vbGlzdCBmaWxlcyBpbiBsb2cgZGlyZWN0b3J5XHJcblx0ZmlsZU5hbWVMaXN0LnNvcnQoKTtcclxuXHRsb2dGaWxlTmFtZSA9IGZpbGVOYW1lTGlzdFtmaWxlTmFtZUxpc3QubGVuZ3RoIC0gMV07XHJcblx0cmV0dXJuICBhd2FpdCByb2xsTG9nRmlsZUlmTmVlZGVkKGxvZ0ZpbGVOYW1lLCBudWxsLCBudWxsKTtcclxufVxyXG5cclxuZnVuY3Rpb24gcGFyc2VEYXRlRnJvbUxvZ0ZpbGVOYW1lKGxvZ0ZpbGVOYW1lKSB7XHJcblx0bGV0IGxvZ0ZpbGVEYXRlID0gbG9nRmlsZU5hbWUuc3BsaXQoJ18nKVsxXVxyXG5cdGxldCBsb2dZZWFyID0gbG9nRmlsZURhdGUuc3Vic3RyaW5nKDAsIDQpO1xyXG5cdGxldCBsb2dNb250aCA9IGxvZ0ZpbGVEYXRlLnN1YnN0cmluZyg0LCA2KTtcclxuXHRsZXQgbG9nRGF5ID0gbG9nRmlsZURhdGUuc3Vic3RyaW5nKDYsIDgpO1xyXG5cdGxldCBsb2dIb3VyID0gbG9nRmlsZURhdGUuc3Vic3RyaW5nKDgsIDEwKTtcclxuXHRsZXQgbG9nTWludXRlID0gbG9nRmlsZURhdGUuc3Vic3RyaW5nKDEwLCAxMik7XHJcblx0cmV0dXJuIG5ldyBEYXRlKGxvZ1llYXIsIGxvZ01vbnRoIC0xLCBsb2dEYXksIGxvZ0hvdXIsIGxvZ01pbnV0ZSwgMCwgMCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBhcnNlVVVJREZyb21Mb2dGaWxlTmFtZShsb2dGaWxlTmFtZSkge1xyXG5cdHJldHVybiBsb2dGaWxlTmFtZS5zcGxpdCgnXycpWzNdO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc0FuT2xkTG9nKGxvZ0ZpbGVOYW1lKSB7XHJcblx0bGV0IGRhdGVOb3cgPSBuZXcgRGF0ZSgpO1xyXG5cdGRhdGVOb3cuc2V0U2Vjb25kcygwKTtcclxuXHRkYXRlTm93LnNldE1pbGxpc2Vjb25kcygwKTtcclxuXHRsZXQgcGFyc2VkRGF0ZSA9IHBhcnNlRGF0ZUZyb21Mb2dGaWxlTmFtZShsb2dGaWxlTmFtZSk7XHJcblx0bGV0IGRpZmYgPSBkYXRlTm93IC0gcGFyc2VkRGF0ZTtcclxuXHRyZXR1cm4gZGlmZiA+IDYwICogMTAwMCA7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHJlY292ZXJ5T2xkTG9ncygpIHtcclxuXHRjb25zb2xlLmxvZygnLS0tIHJlY292ZXJ5T2xkTG9ncyBzdGFydCcpO1xyXG5cdGxldCBmaWxlTmFtZUxpc3QgPSBhd2FpdCBnZXRMb2dGaWxlTGlzdChsb2dEaXJlY3RvcnlIYW5kbGUpOyAvL2xpc3QgZmlsZXMgaW4gbG9nIGRpcmVjdG9yeVxyXG5cdGZvciAobGV0IGxvZ0ZpbGVOYW1lIG9mIGZpbGVOYW1lTGlzdCkge1xyXG5cdFx0aWYgKCF1cGxvYWRRdWV1ZS5pbmNsdWRlcyhsb2dGaWxlTmFtZSkgJiYgaXNBbk9sZExvZyhsb2dGaWxlTmFtZSkpIHtcclxuXHRcdFx0dHJ5IHtcclxuXHRcdFx0XHRpZiAoY3VycmVudEZpbGVMb2cgIT0gbnVsbCAmJiBjdXJyZW50RmlsZUxvZy5nZXRMb2dGaWxlTmFtZSgpID09IGxvZ0ZpbGVOYW1lKSAvL2N1cnJlbnQgbG9nIGZpbGUgaXMgZXhwaXJlZCB3aXRob3V0IGxvZ3NcclxuXHRcdFx0XHRcdGF3YWl0IGNsb3NlRmlsZUxvZ2dlcihjdXJyZW50RmlsZUxvZy5nZXRMb2dGaWxlTmFtZSgpLCBjdXJyZW50RmlsZUxvZy5nZXRMb2dGaWxlQWNjZXNzSGFuZGxlKCkpO1xyXG5cdFx0XHRcdGF3YWl0IHdyaXRlTG9nRW5kSWZOZWVkZWQobG9nRmlsZU5hbWUpO1xyXG5cdFx0XHRcdGFkZFRvVXBsb2FkUXVldWUobG9nRmlsZU5hbWUpO1x0XHRcdFx0XHJcblx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XHJcblx0XHRcdFx0Y29uc29sZS5lcnJvcihlcnJvcilcclxuXHRcdFx0fVxyXG5cdFx0XHRjb25zb2xlLmxvZygnLS0tIHJlY292ZXJ5aW5nJyArIGxvZ0ZpbGVOYW1lKTtcclxuXHRcdH1cclxuXHR9XHJcblx0cHJvY2Vzc1VwbG9hZFF1ZXVlKCk7XHJcblx0Y29uc29sZS5sb2coJy0tLSByZWNvdmVyeU9sZExvZ3MgZW5kJyk7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHRyeVRvVXNlQ3VycmVudEZpbGVMb2dnZXIoKSB7XHJcblx0bGV0IGxvZ0ZpbGVOYW1lID0gY3VycmVudEZpbGVMb2cuZ2V0TG9nRmlsZU5hbWUoKTtcclxuXHRsZXQgbG9nRmlsZUhhbmRsZSA9IGN1cnJlbnRGaWxlTG9nLmdldExvZ0ZpbGVIYW5kbGUoKTtcclxuXHRsZXQgbG9nRmlsZUFjY2Vzc0hhbmRsZSA9IGN1cnJlbnRGaWxlTG9nLmdldExvZ0ZpbGVBY2Nlc3NIYW5kbGUoKTtcclxuXHRyZXR1cm4gYXdhaXQgcm9sbExvZ0ZpbGVJZk5lZWRlZChsb2dGaWxlTmFtZSwgbG9nRmlsZUhhbmRsZSwgbG9nRmlsZUFjY2Vzc0hhbmRsZSk7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGluaXRGaWxlTG9nZ2VyKCkge1xyXG5cdGxldCByb290RGlyZWN0b3J5ID0gYXdhaXQgbmF2aWdhdG9yLnN0b3JhZ2UuZ2V0RGlyZWN0b3J5KCk7XHJcblx0bG9nRGlyZWN0b3J5SGFuZGxlID0gYXdhaXQgcm9vdERpcmVjdG9yeS5nZXREaXJlY3RvcnlIYW5kbGUoJ2tpb3NrSlNMb2dzJywge2NyZWF0ZTogdHJ1ZSx9KTtcclxuXHRyZXR1cm4gYXdhaXQgdHJ5VG9Vc2VGaWxlTG9nT25GaWxlU3lzdGVtKCk7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGNsb3NlRmlsZUxvZ2dlcihmaWxlTmFtZSwgZmlsZUFjY2Vzc0hhbmRsZSkge1xyXG5cdGlmIChmaWxlQWNjZXNzSGFuZGxlICE9IG51bGwpIHtcclxuXHRcdHRyeSB7XHJcblx0XHRcdGF3YWl0IGZpbGVBY2Nlc3NIYW5kbGUuZmx1c2goKTtcclxuXHRcdFx0YXdhaXQgd3JpdGVMb2dFbmQoZmlsZUFjY2Vzc0hhbmRsZSk7IFxyXG5cdFx0XHRhd2FpdCBmaWxlQWNjZXNzSGFuZGxlLmZsdXNoKCk7XHJcblx0XHRcdGF3YWl0IGZpbGVBY2Nlc3NIYW5kbGUuY2xvc2UoKTtcclxuXHRcdFx0YWRkVG9VcGxvYWRRdWV1ZShmaWxlTmFtZSk7XHRcdFx0XHJcblx0XHR9IGNhdGNoIChlcnJvcikge1xyXG5cdFx0XHRjb25zb2xlLmxvZygnRmlsZSBpcyBhbHJlYWR5IGNsb3NlZC4gSXQgbWF5IGJlIHJlY292ZXJ5IHRhc2sgaGFzIGFscmVhZHkgY2xvc2VkIGl0Jyk7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5cclxuYXN5bmMgZnVuY3Rpb24gY29uZmlndXJlRmlsZUxvZ2dlcigpIHtcdFxyXG5cdGlmIChjdXJyZW50RmlsZUxvZyA9PSBudWxsKSB7XHJcblx0XHRjdXJyZW50RmlsZUxvZyA9IGF3YWl0IGluaXRGaWxlTG9nZ2VyKCk7XHJcblx0XHRvbGRMb2dSZWNvdmVyeVRhc2suc3RhcnRXaXRoSW1tZWRpYXRlRXhlY3V0aW9uKCk7XHJcblx0fVxyXG5cdGVsc2UgIC8vIFVzZSBsYXN0IGxvZ1xyXG5cdFx0Y3VycmVudEZpbGVMb2cgPSBhd2FpdCB0cnlUb1VzZUN1cnJlbnRGaWxlTG9nZ2VyKCk7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGdldExvZ0ZpbGVMaXN0KGxvZ0RpcmVjdG9yeUhhbmRsZSkge1xyXG5cdGxldCBmaWxlTmFtZXMgPSBbXTtcclxuXHRmb3IgYXdhaXQgKGNvbnN0IGVudHJ5IG9mIGxvZ0RpcmVjdG9yeUhhbmRsZS52YWx1ZXMoKSkge1xyXG5cdFx0aWYgKGVudHJ5LmtpbmQgPT09ICdmaWxlJykge1xyXG5cdFx0XHRmaWxlTmFtZXMucHVzaChlbnRyeS5uYW1lKTtcclxuXHRcdH1cclxuXHR9XHJcblx0cmV0dXJuIGZpbGVOYW1lcztcclxufVxyXG5cclxuZnVuY3Rpb24gaXNJblRoZVNhbWVNaW51dGUobG9nRmlsZU5hbWUpIHtcclxuXHRsZXQgcmVzdWx0ID0gZmFsc2VcclxuXHRpZiAobG9nRmlsZU5hbWUgIT0gbnVsbCkge1xyXG5cdFx0bGV0IGRhdGVOb3cgPSBuZXcgRGF0ZSgpO1xyXG5cdFx0ZGF0ZU5vdy5zZXRTZWNvbmRzKDApO1xyXG5cdFx0ZGF0ZU5vdy5zZXRNaWxsaXNlY29uZHMoMCk7XHJcblx0XHRsZXQgcGFyc2VkRGF0ZSA9IHBhcnNlRGF0ZUZyb21Mb2dGaWxlTmFtZShsb2dGaWxlTmFtZSk7XHJcblx0XHRyZXN1bHQgPSAoZGF0ZU5vdyAtIHBhcnNlZERhdGUgPT0gMCk7XHJcblx0fVxyXG5cdHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcblxyXG5hc3luYyBmdW5jdGlvbiB3cml0ZUxvZ1N0YXJ0KGxvZ0ZpbGVBY2Nlc3NIYW5kbGUpIHtcclxuXHRsZXQgZGF0YSA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShMT0dTVEFSVF9MQUJFTCArICdcXG4nKTtcclxuXHRhd2FpdCBsb2dGaWxlQWNjZXNzSGFuZGxlLndyaXRlKGRhdGEpO1xyXG5cdHJldHVybiBhd2FpdCBsb2dGaWxlQWNjZXNzSGFuZGxlLmZsdXNoKCk7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHdyaXRlTG9nRW5kKGxvZ0ZpbGVBY2Nlc3NIYW5kbGUpIHtcclxuXHRsZXQgZmlsZVNpemUgPSBhd2FpdCBsb2dGaWxlQWNjZXNzSGFuZGxlLmdldFNpemUoKTtcclxuXHRsZXQgZGF0YSA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZSgnXFxuJyArIExPR0VORF9MQUJFTCk7XHJcblx0YXdhaXQgbG9nRmlsZUFjY2Vzc0hhbmRsZS53cml0ZShkYXRhLCB7IGF0OiBmaWxlU2l6ZSAtIDIgfSk7XHJcblx0cmV0dXJuIGF3YWl0IGxvZ0ZpbGVBY2Nlc3NIYW5kbGUuZmx1c2goKTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gd3JpdGVPbkxvZ0ZpbGUobG9nRmlsZUFjY2Vzc0hhbmRsZSwgcmVxdWVzdCkge1xyXG5cdGxldCByZXN1bHQgPSBmYWxzZTtcclxuXHRsZXQgZmlsZVNpemUgPSBhd2FpdCBsb2dGaWxlQWNjZXNzSGFuZGxlLmdldFNpemUoKTtcclxuXHRpZiAoZmlsZVNpemUgPT0gMCkge1xyXG5cdFx0YXdhaXQgd3JpdGVMb2dTdGFydChsb2dGaWxlQWNjZXNzSGFuZGxlKTtcclxuXHR9XHJcblx0ZmlsZVNpemUgPSBhd2FpdCBsb2dGaWxlQWNjZXNzSGFuZGxlLmdldFNpemUoKTtcclxuXHRsZXQgcmF3VGV4dCA9IHJlcXVlc3QgKyAnLCcgKyAnXFxuJztcclxuXHRsZXQgZGF0YSA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShyYXdUZXh0KTtcclxuXHRyZXN1bHQgPSBhd2FpdCBsb2dGaWxlQWNjZXNzSGFuZGxlLndyaXRlKGRhdGEsIHsgYXQ6IGZpbGVTaXplIH0pO1xyXG5cdC8vY29uc29sZS5sb2coXCJGaWxlIHNpemU6XCIgKyBmaWxlU2l6ZSk7XHJcblx0cmVzdWx0ID0gYXdhaXQgbG9nRmlsZUFjY2Vzc0hhbmRsZS5mbHVzaCgpO1xyXG5cdHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVJlcXVlc3QocmVxdWVzdCkge1xyXG5cdGxldCByZXN1bHQgPSBmYWxzZTtcclxuXHRzd2l0Y2gocmVxdWVzdC50eXBlKSB7XHJcblx0XHRjYXNlIExPR19XT1JLRVJfTUVTU0FHRV9UWVBFLkxPRzoge1xyXG5cdFx0XHRyZXN1bHQgPSBhd2FpdCBoYW5kbGVMb2cocmVxdWVzdC5wYXlsb2FkKTtcclxuXHRcdFx0YnJlYWs7XHJcblx0XHR9XHJcblx0XHRjYXNlIExPR19XT1JLRVJfTUVTU0FHRV9UWVBFLkNPTkZJR19QQVJBTVM6IHtcclxuXHRcdFx0Y29uZmlndXJlU25hcHBBUEkocmVxdWVzdC5wYXlsb2FkKTtcclxuXHRcdFx0YnJlYWs7XHRcdFxyXG5cdFx0fVxyXG5cdFx0ZGVmYXVsdDpcclxuXHRcdFx0YnJlYWs7XHJcblx0fVxyXG5cdHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZyhyZXF1ZXN0KSB7XHJcblx0YXdhaXQgY29uZmlndXJlRmlsZUxvZ2dlcigpO1xyXG5cdGxldCBjdXJyZW50TG9nRmlsZUFjY2Vzc0hhbmRsZSA9IGN1cnJlbnRGaWxlTG9nLmdldExvZ0ZpbGVBY2Nlc3NIYW5kbGUoKTtcclxuXHRyZXR1cm4gYXdhaXQgd3JpdGVPbkxvZ0ZpbGUoY3VycmVudExvZ0ZpbGVBY2Nlc3NIYW5kbGUsIEpTT04uc3RyaW5naWZ5KHJlcXVlc3QpKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY29uZmlndXJlU25hcHBBUEkocGFyYW1zKSB7XHJcblx0c25hcHBBUElQYXJhbXMgPSBwYXJhbXM7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHdyaXRlTG9nRW5kSWZOZWVkZWQoZmlsZU5hbWUpIHtcclxuXHRsZXQgbG9nRmlsZUhhbmRsZSA9IGF3YWl0IGxvZ0RpcmVjdG9yeUhhbmRsZS5nZXRGaWxlSGFuZGxlKGZpbGVOYW1lLCB7Y3JlYXRlOiBmYWxzZSx9KTtcclxuXHRsZXQgZmlsZSA9IGF3YWl0IGxvZ0ZpbGVIYW5kbGUuZ2V0RmlsZSgpO1xyXG5cdGxldCBzdGFydCA9IGZpbGUuc2l6ZSAtIDIgPCAwID8gMCA6IGZpbGUuc2l6ZSAtIDI7XHJcblx0Y29uc3QgYmxvYiA9IGZpbGUuc2xpY2Uoc3RhcnQpO1xyXG5cdGNvbnN0IHRleHQgPSBhd2FpdCBibG9iLnRleHQoKTtcclxuXHRcclxuXHRpZiAodGV4dCAhPSBMT0dFTkRfTEFCRUwpIHtcclxuXHRcdGxldCBsb2dGaWxlQWNjZXNzSGFuZGxlID0gYXdhaXQgbG9nRmlsZUhhbmRsZS5jcmVhdGVTeW5jQWNjZXNzSGFuZGxlKCk7XHJcblx0XHRhd2FpdCB3cml0ZUxvZ0VuZChsb2dGaWxlQWNjZXNzSGFuZGxlKTtcclxuXHRcdGF3YWl0IGxvZ0ZpbGVBY2Nlc3NIYW5kbGUuY2xvc2UoKTtcclxuXHR9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGFkZFRvVXBsb2FkUXVldWUobG9nRmlsZU5hbWUpIHtcclxuXHRpZiAoIXVwbG9hZFF1ZXVlLmluY2x1ZGVzKGxvZ0ZpbGVOYW1lKSlcclxuXHRcdHVwbG9hZFF1ZXVlLnB1c2gobG9nRmlsZU5hbWUpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRVcGxvYWRSZXF1ZXN0KGxvZ0ZpbGVOYW1lLCBiYXNlNjRMb2dzKSB7XHJcblx0bGV0IHJlc3VsdCA9IHtcclxuXHRcdCdIZWFkZXInOiB7XHJcblx0XHRcdCdXb3Jrc3RhdGlvbklkJzogc25hcHBBUElQYXJhbXMud29ya3N0YXRpb25JZCxcclxuXHRcdFx0J1VzZXJBY2NvdW50SWQnOiBzbmFwcEFQSVBhcmFtcy51c2VySWQsXHJcblx0XHRcdCdUb2tlbic6IHNuYXBwQVBJUGFyYW1zLnRva2VuXHJcblx0XHR9LFxyXG5cdFx0J1JlcXVlc3QnOiB7XHJcblx0XHRcdCdDb21tYW5kJzogJ0FERCcsXHJcblx0XHRcdCdBZGQnOiB7XHJcblx0XHRcdFx0J1VwbG9hZElkJzpwYXJzZVVVSURGcm9tTG9nRmlsZU5hbWUobG9nRmlsZU5hbWUpLFxyXG5cdFx0XHRcdCdVcGxvYWRUeXBlJzogNCxcclxuXHRcdFx0XHQnTXNnUmVxdWVzdCc6IGJhc2U2NExvZ3NcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH07XHJcblx0cmV0dXJuIHJlc3VsdDtcclxufVxyXG5cclxuLy9odHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRmV0Y2hfQVBJL1VzaW5nX0ZldGNoXHJcbmFzeW5jIGZ1bmN0aW9uIHVwbG9hZExvZ0ZpbGUobG9nRmlsZU5hbWUpIHtcclxuXHRsZXQgbG9nRmlsZUhhbmRsZSA9IGF3YWl0IGxvZ0RpcmVjdG9yeUhhbmRsZS5nZXRGaWxlSGFuZGxlKGxvZ0ZpbGVOYW1lLCB7Y3JlYXRlOiB0cnVlLH0pO1xyXG5cdGxldCBmaWxlID0gYXdhaXQgbG9nRmlsZUhhbmRsZS5nZXRGaWxlKCk7XHJcblx0bGV0IGxvZ3MgPSBhd2FpdCBmaWxlLnRleHQoKVxyXG5cdGxldCBiYXNlNjRMb2dzID0gYXdhaXQgVXRpbHMuZW5jb2RlQmFzZTY0VVJMRW5jb2RlZChsb2dzKTtcclxuXHQgIFxyXG5cdGNvbnN0IHVybEVuY29kZWRCb2R5ID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7XHJcblx0XHRtZXNzYWdlOiBKU09OLnN0cmluZ2lmeShnZXRVcGxvYWRSZXF1ZXN0KGxvZ0ZpbGVOYW1lLCBiYXNlNjRMb2dzKSlcclxuXHR9KTtcclxuXHJcblx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHQgICAgLy8gUGVyZm9ybSB0aGUgQVBJIGNhbGwgdXNpbmcgZmV0Y2ggb3IgYW55IG90aGVyIHN1aXRhYmxlIG1ldGhvZFxyXG5cdCAgICBmZXRjaChzbmFwcEFQSVBhcmFtcy5hcGlVcmwgKyAnL3NlcnZpY2U/Y21kPVVQTE9BRCZmb3JtYXQ9anNvbicsIHtcclxuXHQgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuXHQgICAgICBoZWFkZXJzOiB7XHJcblx0ICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCdcclxuXHQgICAgICB9LFxyXG5cdCAgICAgIGJvZHk6IHVybEVuY29kZWRCb2R5XHJcblx0ICAgIH0pXHJcblx0ICAgIC50aGVuKHJlc3BvbnNlID0+IHtcclxuXHQgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xyXG5cdCAgICAgICAgICAvLyBSZXNvbHZlIHRoZSBQcm9taXNlIHdpdGggdGhlIHJlc3BvbnNlIGRhdGFcclxuXHQgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5qc29uKCkpO1xyXG5cdCAgICAgICAgICBcclxuXHQgICAgICAgICAgbG9nRmlsZUhhbmRsZS5yZW1vdmUoKTsgLy9SZW1vdmUgaWYgdXBsb2FkIHN1Y2NlZGVkXHJcblx0ICAgICAgICB9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRjb25zb2xlLmVycm9yKGVycm9yKTtcclxuXHQgICAgICAgICAgLy8gUmVqZWN0IHRoZSBQcm9taXNlIHdpdGggYW4gZXJyb3IgbWVzc2FnZVxyXG5cdCAgICAgICAgICByZWplY3QoJ0FQSSBjYWxsIGZhaWxlZCB3aXRoIHN0YXR1czogJyArIHJlc3BvbnNlLnN0YXR1cyk7XHJcblx0ICAgICAgICB9XHJcblx0ICAgICAgfSlcclxuXHQgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG5cdCAgICAgIFx0Y29uc29sZS5lcnJvcihlcnJvcik7XHJcblx0ICAgICAgICByZWplY3QoZXJyb3IpO1xyXG5cdCAgICAgIH0pO1xyXG4gIH0pO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBwcm9jZXNzVXBsb2FkUXVldWUoKSB7XHJcblx0d2hpbGUgKHVwbG9hZFF1ZXVlLmxlbmd0aCA+IDApIHtcclxuXHRcdHRyeSB7XHJcblx0XHRcdGxldCB1cGxvYWRGaWxlID0gdXBsb2FkUXVldWUuc2hpZnQoKTtcclxuXHRcdFx0YXdhaXQgdXBsb2FkTG9nRmlsZSh1cGxvYWRGaWxlKTtcdFx0XHRcclxuXHRcdH0gY2F0Y2goZSkge1xyXG5cdFx0XHRjb25zb2xlLmVycm9yKGUpO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuXHJcbmNsYXNzIEZpbGVMb2dnZXIge1xyXG5cdCNsb2dGaWxlTmFtZTtcclxuXHQjbG9nRmlsZUhhbmRsZTtcclxuXHQjbG9nRmlsZUFjY2Vzc0hhbmRsZTtcclxuXHRcclxuXHRjb25zdHJ1Y3Rvcihsb2dGaWxlTmFtZSwgbG9nRmlsZUhhbmRsZSwgbG9nRmlsZUFjY2Vzc0hhbmRsZSkge1xyXG5cdCAgIHRoaXMuI2xvZ0ZpbGVOYW1lID0gbG9nRmlsZU5hbWU7XHJcblx0ICAgdGhpcy4jbG9nRmlsZUhhbmRsZSA9IGxvZ0ZpbGVIYW5kbGU7XHJcblx0ICAgdGhpcy4jbG9nRmlsZUFjY2Vzc0hhbmRsZSA9IGxvZ0ZpbGVBY2Nlc3NIYW5kbGU7XHJcblx0fVxyXG5cdFxyXG5cdGdldExvZ0ZpbGVOYW1lKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuI2xvZ0ZpbGVOYW1lO1xyXG5cdH1cclxuXHRcclxuXHRnZXRMb2dGaWxlSGFuZGxlKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuI2xvZ0ZpbGVIYW5kbGU7XHJcblx0fVxyXG5cdFxyXG5cdGdldExvZ0ZpbGVBY2Nlc3NIYW5kbGUoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy4jbG9nRmlsZUFjY2Vzc0hhbmRsZTtcclxuXHR9XHJcbn1cclxuXHJcblxyXG5leHBvcnQgY2xhc3MgTG9nV29ya2VyTWVzc2FnZSB7XHJcblx0dHlwZTtcclxuXHRwYXlsb2FkO1xyXG5cdFxyXG5cdGNvbnN0cnVjdG9yKHR5cGUsIHBheWxvYWQpIHtcclxuXHRcdHRoaXMudHlwZSA9IHR5cGU7XHJcblx0XHR0aGlzLnBheWxvYWQgPSBwYXlsb2FkO1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IExPR19XT1JLRVJfTUVTU0FHRV9UWVBFID0ge1xyXG5cdExPRzogMSxcclxuXHRDT05GSUdfUEFSQU1TOiAyXHJcbn1cclxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///../../../common-script/snapp-log-worker.js\n");

/***/ }),

/***/ "../../../common-script/snapp-logger.js":
/*!**********************************************!*\
  !*** ../../../common-script/snapp-logger.js ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SnappLogger: () => (/* binding */ SnappLogger)\n/* harmony export */ });\n/* harmony import */ var _common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @common-script/device-manager/dm-model */ \"../../../common-script/device-manager/dm-model.js\");\n/* harmony import */ var _common_script_snapp_log_worker__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @common-script/snapp-log-worker */ \"../../../common-script/snapp-log-worker.js\");\n/* harmony import */ var _common_script_cors_worker__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @common-script/cors-worker */ \"../../../common-script/cors-worker.js\");\n\r\n\r\n\r\n\r\nclass SnappLogger {\r\n  #logWorker;\r\n  #workstation;\r\n  #logConfiguration;\r\n\r\n  #LOCAL_STORAGE_LOG_KEY = 'SNP_CONSOLE_LOG_LEVEL';\r\n\r\n\r\n  constructor() {\r\n    try {\r\n      this.#createLogWorker();\r\n    }\r\n    catch (error) {\r\n      this.#logWorker = undefined;\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  setConfigurationParams(params) {\r\n    let apiUrl = new URL(params.apiUrl, window.location.origin);\r\n    let snappAPIParams = {\r\n      'apiUrl': apiUrl.href,\r\n      'workstationId': params.workstationId,\r\n      'userId': params.userId,\r\n      'token': params.token\r\n    }\r\n    if (!this.#logWorker)\r\n      this.#createLogWorker();\r\n    let message = new _common_script_snapp_log_worker__WEBPACK_IMPORTED_MODULE_1__.LogWorkerMessage(_common_script_snapp_log_worker__WEBPACK_IMPORTED_MODULE_1__.LOG_WORKER_MESSAGE_TYPE.CONFIG_PARAMS, snappAPIParams);\r\n    this.#logWorker.postMessage(message); //send workstation to log worker\r\n  }\r\n\r\n  setWorkstation(workstation) {\r\n    this.#workstation = workstation;\r\n    this.#logConfiguration = workstation.LogConfig;\r\n  }\r\n\r\n  fatal(entityId, entityType, message, duration) {\r\n    this.#doLog(_common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_0__.LOG_LEVEL.FATAL, entityId, entityType, message, duration);\r\n  }\r\n\r\n  error(entityId, entityType, message, duration) {\r\n    this.#doLog(_common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_0__.LOG_LEVEL.ERROR, entityId, entityType, message, duration);\r\n  }\r\n\r\n  warn(entityId, entityType, message, duration) {\r\n    this.#doLog(_common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_0__.LOG_LEVEL.WARN, entityId, entityType, message, duration);\r\n  }\r\n\r\n  info(entityId, entityType, message, duration) {\r\n    this.#doLog(_common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_0__.LOG_LEVEL.INFO, entityId, entityType, message, duration);\r\n  }\r\n\r\n  debug(entityId, entityType, message, duration) {\r\n    this.#doLog(_common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_0__.LOG_LEVEL.DEBUG, entityId, entityType, message, duration);\r\n  }\r\n\r\n  trace(entityId, entityType, message, duration) {\r\n    this.#doLog(_common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_0__.LOG_LEVEL.TRACE, entityId, entityType, message, duration);\r\n  }\r\n\r\n  /**\r\n   * log message already formatted in DOLog format\r\n   */\r\n  log(logDO) {\r\n    this.#writeOnConsoleIfConfigured(logDO);\r\n    this.#logOnFile(logDO);\r\n  }\r\n\r\n  #doLog(logLevel, entityId, entityType, message, duration) {\r\n    let logDO = this.#createLogDO(logLevel, entityId, entityType, message, duration);\r\n    this.#writeOnConsoleIfConfigured(logDO);\r\n    if (this.#isLogToBeSent(logDO))\r\n      this.#logOnFile(logDO);\r\n  }\r\n\r\n  #createLogDO(logLevel, entityId, entityType, message, duration) {\r\n    let workstationId = this.#workstation ? this.#workstation.WorkstationId : null;\r\n    let logDateTime = this.#getFormattedCurrentDateTime();\r\n    return new DOLog(logDateTime, logLevel, message, duration, entityType, entityId, workstationId);\r\n  }\r\n\r\n  #getFormattedCurrentDateTime() {\r\n    //2024-04-05T12:28:20\r\n    let dateNow = new Date();\r\n    return dateNow.getFullYear() +\r\n      '-' +\r\n      (dateNow.getMonth() + 1).toString().padStart(2, '0') +\r\n      '-' +\r\n      (dateNow.getDate()).toString().padStart(2, '0') +\r\n      'T' +\r\n      (dateNow.getHours()).toString().padStart(2, '0') +\r\n      ':' +\r\n      (dateNow.getMinutes()).toString().padStart(2, '0') +\r\n      ':' +\r\n      (dateNow.getSeconds()).toString().padStart(2, '0');\r\n  }\r\n\r\n  #getConsoleLogLevelConfiguration() {\r\n    let level = 0;\r\n    let result = localStorage.getItem(this.#LOCAL_STORAGE_LOG_KEY);\r\n    if (result != null) {\r\n      result = result.toUpperCase();\r\n      level = _common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_0__.LOG_LEVEL[result];\r\n    }\r\n    return level;\r\n  }\r\n\r\n  #writeOnConsoleIfConfigured(logDO) {\r\n    let configuredLevel = this.#getConsoleLogLevelConfiguration();\r\n    if (configuredLevel >= logDO.LogLevel) {\r\n      if (configuredLevel == _common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_0__.LOG_LEVEL.ERROR || configuredLevel == _common_script_device_manager_dm_model__WEBPACK_IMPORTED_MODULE_0__.LOG_LEVEL.FATAL)\r\n        console.error(logDO.LogData);\r\n      else\r\n        console.log(logDO.LogData);\r\n    }\r\n  }\r\n\r\n  #isLogToBeSent(logDO) {\r\n    let logCfg = this.#logConfiguration;\r\n    return logCfg != null && logCfg.WriteItemList && this.#matchesWriteRule(logCfg.WriteItemList, logDO);\r\n  }\r\n\r\n  #matchesWriteRule(writeItemList, logDO) {\r\n    return writeItemList.some(msgFilter => \r\n      msgFilter.LogLevel >= logDO.LogLevel &&\r\n        (!msgFilter.EntityType || msgFilter.EntityType == logDO.EntityType) &&\r\n        (!msgFilter.AltEntityId || msgFilter.AltEntityId == logDO.EntityId) &&\r\n        (!msgFilter.EntityId || msgFilter.EntityId == logDO.EntityId)\r\n    );\r\n  }\r\n\r\n  #logOnFile(logDO) {\r\n    if (this.#logWorker) {\r\n      let message = new _common_script_snapp_log_worker__WEBPACK_IMPORTED_MODULE_1__.LogWorkerMessage(_common_script_snapp_log_worker__WEBPACK_IMPORTED_MODULE_1__.LOG_WORKER_MESSAGE_TYPE.LOG, logDO);\r\n      this.#logWorker.postMessage(message);\r\n    }\r\n  }\r\n\r\n  #createLogWorker() {\r\n    if (window.Worker) {   \r\n      this.#logWorker = new _common_script_cors_worker__WEBPACK_IMPORTED_MODULE_2__.CorsWorker(new URL(/* webpackChunkName: \"snapp-log-worker\" *//* worker import */ __webpack_require__.p + __webpack_require__.u(\"snapp-log-worker\"), __webpack_require__.b)).getWorker();\r\n      this.#logWorker.onerror = function (error) {\r\n        console.error('Worker error: ' + error.message);\r\n      };\r\n    }\r\n    else {\r\n      console.error('Your browser doesn\\'t support web workers.');\r\n    }\r\n  }\r\n}\r\n\r\nclass DOLog {\r\n  LogDateTime;\r\n  LogLevel;\r\n  LogType;\r\n  LogDataType;\r\n  LogData;\r\n  DurationMS;\r\n  EntityType;\r\n  EntityId;\r\n  SourceWorkstationId;\r\n\r\n  constructor(logDateTime, logLevel, message, duration, entityType, entityId, workstationId) {\r\n    this.LogDateTime = logDateTime;\r\n    this.LogLevel = logLevel;\r\n    this.LogType = 1;\r\n    this.LogDataType = 1;\r\n    this.LogData = message;\r\n    this.DurationMS = duration;\r\n    this.EntityId = entityId;\r\n    this.EntityType = entityType;\r\n    this.SourceWorkstationId = workstationId;\r\n  }\r\n\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vY29tbW9uLXNjcmlwdC9zbmFwcC1sb2dnZXIuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFtRTtBQUN5QjtBQUMxQjtBQUNsRTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLDZFQUFnQixDQUFDLG9GQUF1QjtBQUM5RCwwQ0FBMEM7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQiw2RUFBUztBQUN6QjtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsNkVBQVM7QUFDekI7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDZFQUFTO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQiw2RUFBUztBQUN6QjtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsNkVBQVM7QUFDekI7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDZFQUFTO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLDZFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLDZFQUFTLDZCQUE2Qiw2RUFBUztBQUM1RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qiw2RUFBZ0IsQ0FBQyxvRkFBdUI7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLGtFQUFNLG1EQUFtRCw0R0FBc0M7QUFDM0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2tpb3NrLWNvbnRyb2xsZXIvLi4vLi4vLi4vY29tbW9uLXNjcmlwdC9zbmFwcC1sb2dnZXIuanM/NjQwNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMT0dfTEVWRUwgfSBmcm9tICdAY29tbW9uLXNjcmlwdC9kZXZpY2UtbWFuYWdlci9kbS1tb2RlbCc7XHJcbmltcG9ydCB7IExvZ1dvcmtlck1lc3NhZ2UsIExPR19XT1JLRVJfTUVTU0FHRV9UWVBFIH0gZnJvbSAnQGNvbW1vbi1zY3JpcHQvc25hcHAtbG9nLXdvcmtlcic7XHJcbmltcG9ydCB7IENvcnNXb3JrZXIgYXMgV29ya2VyIH0gZnJvbSAnQGNvbW1vbi1zY3JpcHQvY29ycy13b3JrZXInO1xyXG5cclxuZXhwb3J0IGNsYXNzIFNuYXBwTG9nZ2VyIHtcclxuICAjbG9nV29ya2VyO1xyXG4gICN3b3Jrc3RhdGlvbjtcclxuICAjbG9nQ29uZmlndXJhdGlvbjtcclxuXHJcbiAgI0xPQ0FMX1NUT1JBR0VfTE9HX0tFWSA9ICdTTlBfQ09OU09MRV9MT0dfTEVWRUwnO1xyXG5cclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICB0aGlzLiNjcmVhdGVMb2dXb3JrZXIoKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLiNsb2dXb3JrZXIgPSB1bmRlZmluZWQ7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2V0Q29uZmlndXJhdGlvblBhcmFtcyhwYXJhbXMpIHtcclxuICAgIGxldCBhcGlVcmwgPSBuZXcgVVJMKHBhcmFtcy5hcGlVcmwsIHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4pO1xyXG4gICAgbGV0IHNuYXBwQVBJUGFyYW1zID0ge1xyXG4gICAgICAnYXBpVXJsJzogYXBpVXJsLmhyZWYsXHJcbiAgICAgICd3b3Jrc3RhdGlvbklkJzogcGFyYW1zLndvcmtzdGF0aW9uSWQsXHJcbiAgICAgICd1c2VySWQnOiBwYXJhbXMudXNlcklkLFxyXG4gICAgICAndG9rZW4nOiBwYXJhbXMudG9rZW5cclxuICAgIH1cclxuICAgIGlmICghdGhpcy4jbG9nV29ya2VyKVxyXG4gICAgICB0aGlzLiNjcmVhdGVMb2dXb3JrZXIoKTtcclxuICAgIGxldCBtZXNzYWdlID0gbmV3IExvZ1dvcmtlck1lc3NhZ2UoTE9HX1dPUktFUl9NRVNTQUdFX1RZUEUuQ09ORklHX1BBUkFNUywgc25hcHBBUElQYXJhbXMpO1xyXG4gICAgdGhpcy4jbG9nV29ya2VyLnBvc3RNZXNzYWdlKG1lc3NhZ2UpOyAvL3NlbmQgd29ya3N0YXRpb24gdG8gbG9nIHdvcmtlclxyXG4gIH1cclxuXHJcbiAgc2V0V29ya3N0YXRpb24od29ya3N0YXRpb24pIHtcclxuICAgIHRoaXMuI3dvcmtzdGF0aW9uID0gd29ya3N0YXRpb247XHJcbiAgICB0aGlzLiNsb2dDb25maWd1cmF0aW9uID0gd29ya3N0YXRpb24uTG9nQ29uZmlnO1xyXG4gIH1cclxuXHJcbiAgZmF0YWwoZW50aXR5SWQsIGVudGl0eVR5cGUsIG1lc3NhZ2UsIGR1cmF0aW9uKSB7XHJcbiAgICB0aGlzLiNkb0xvZyhMT0dfTEVWRUwuRkFUQUwsIGVudGl0eUlkLCBlbnRpdHlUeXBlLCBtZXNzYWdlLCBkdXJhdGlvbik7XHJcbiAgfVxyXG5cclxuICBlcnJvcihlbnRpdHlJZCwgZW50aXR5VHlwZSwgbWVzc2FnZSwgZHVyYXRpb24pIHtcclxuICAgIHRoaXMuI2RvTG9nKExPR19MRVZFTC5FUlJPUiwgZW50aXR5SWQsIGVudGl0eVR5cGUsIG1lc3NhZ2UsIGR1cmF0aW9uKTtcclxuICB9XHJcblxyXG4gIHdhcm4oZW50aXR5SWQsIGVudGl0eVR5cGUsIG1lc3NhZ2UsIGR1cmF0aW9uKSB7XHJcbiAgICB0aGlzLiNkb0xvZyhMT0dfTEVWRUwuV0FSTiwgZW50aXR5SWQsIGVudGl0eVR5cGUsIG1lc3NhZ2UsIGR1cmF0aW9uKTtcclxuICB9XHJcblxyXG4gIGluZm8oZW50aXR5SWQsIGVudGl0eVR5cGUsIG1lc3NhZ2UsIGR1cmF0aW9uKSB7XHJcbiAgICB0aGlzLiNkb0xvZyhMT0dfTEVWRUwuSU5GTywgZW50aXR5SWQsIGVudGl0eVR5cGUsIG1lc3NhZ2UsIGR1cmF0aW9uKTtcclxuICB9XHJcblxyXG4gIGRlYnVnKGVudGl0eUlkLCBlbnRpdHlUeXBlLCBtZXNzYWdlLCBkdXJhdGlvbikge1xyXG4gICAgdGhpcy4jZG9Mb2coTE9HX0xFVkVMLkRFQlVHLCBlbnRpdHlJZCwgZW50aXR5VHlwZSwgbWVzc2FnZSwgZHVyYXRpb24pO1xyXG4gIH1cclxuXHJcbiAgdHJhY2UoZW50aXR5SWQsIGVudGl0eVR5cGUsIG1lc3NhZ2UsIGR1cmF0aW9uKSB7XHJcbiAgICB0aGlzLiNkb0xvZyhMT0dfTEVWRUwuVFJBQ0UsIGVudGl0eUlkLCBlbnRpdHlUeXBlLCBtZXNzYWdlLCBkdXJhdGlvbik7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBsb2cgbWVzc2FnZSBhbHJlYWR5IGZvcm1hdHRlZCBpbiBET0xvZyBmb3JtYXRcclxuICAgKi9cclxuICBsb2cobG9nRE8pIHtcclxuICAgIHRoaXMuI3dyaXRlT25Db25zb2xlSWZDb25maWd1cmVkKGxvZ0RPKTtcclxuICAgIHRoaXMuI2xvZ09uRmlsZShsb2dETyk7XHJcbiAgfVxyXG5cclxuICAjZG9Mb2cobG9nTGV2ZWwsIGVudGl0eUlkLCBlbnRpdHlUeXBlLCBtZXNzYWdlLCBkdXJhdGlvbikge1xyXG4gICAgbGV0IGxvZ0RPID0gdGhpcy4jY3JlYXRlTG9nRE8obG9nTGV2ZWwsIGVudGl0eUlkLCBlbnRpdHlUeXBlLCBtZXNzYWdlLCBkdXJhdGlvbik7XHJcbiAgICB0aGlzLiN3cml0ZU9uQ29uc29sZUlmQ29uZmlndXJlZChsb2dETyk7XHJcbiAgICBpZiAodGhpcy4jaXNMb2dUb0JlU2VudChsb2dETykpXHJcbiAgICAgIHRoaXMuI2xvZ09uRmlsZShsb2dETyk7XHJcbiAgfVxyXG5cclxuICAjY3JlYXRlTG9nRE8obG9nTGV2ZWwsIGVudGl0eUlkLCBlbnRpdHlUeXBlLCBtZXNzYWdlLCBkdXJhdGlvbikge1xyXG4gICAgbGV0IHdvcmtzdGF0aW9uSWQgPSB0aGlzLiN3b3Jrc3RhdGlvbiA/IHRoaXMuI3dvcmtzdGF0aW9uLldvcmtzdGF0aW9uSWQgOiBudWxsO1xyXG4gICAgbGV0IGxvZ0RhdGVUaW1lID0gdGhpcy4jZ2V0Rm9ybWF0dGVkQ3VycmVudERhdGVUaW1lKCk7XHJcbiAgICByZXR1cm4gbmV3IERPTG9nKGxvZ0RhdGVUaW1lLCBsb2dMZXZlbCwgbWVzc2FnZSwgZHVyYXRpb24sIGVudGl0eVR5cGUsIGVudGl0eUlkLCB3b3Jrc3RhdGlvbklkKTtcclxuICB9XHJcblxyXG4gICNnZXRGb3JtYXR0ZWRDdXJyZW50RGF0ZVRpbWUoKSB7XHJcbiAgICAvLzIwMjQtMDQtMDVUMTI6Mjg6MjBcclxuICAgIGxldCBkYXRlTm93ID0gbmV3IERhdGUoKTtcclxuICAgIHJldHVybiBkYXRlTm93LmdldEZ1bGxZZWFyKCkgK1xyXG4gICAgICAnLScgK1xyXG4gICAgICAoZGF0ZU5vdy5nZXRNb250aCgpICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpICtcclxuICAgICAgJy0nICtcclxuICAgICAgKGRhdGVOb3cuZ2V0RGF0ZSgpKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJykgK1xyXG4gICAgICAnVCcgK1xyXG4gICAgICAoZGF0ZU5vdy5nZXRIb3VycygpKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJykgK1xyXG4gICAgICAnOicgK1xyXG4gICAgICAoZGF0ZU5vdy5nZXRNaW51dGVzKCkpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKSArXHJcbiAgICAgICc6JyArXHJcbiAgICAgIChkYXRlTm93LmdldFNlY29uZHMoKSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpO1xyXG4gIH1cclxuXHJcbiAgI2dldENvbnNvbGVMb2dMZXZlbENvbmZpZ3VyYXRpb24oKSB7XHJcbiAgICBsZXQgbGV2ZWwgPSAwO1xyXG4gICAgbGV0IHJlc3VsdCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMuI0xPQ0FMX1NUT1JBR0VfTE9HX0tFWSk7XHJcbiAgICBpZiAocmVzdWx0ICE9IG51bGwpIHtcclxuICAgICAgcmVzdWx0ID0gcmVzdWx0LnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgIGxldmVsID0gTE9HX0xFVkVMW3Jlc3VsdF07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbGV2ZWw7XHJcbiAgfVxyXG5cclxuICAjd3JpdGVPbkNvbnNvbGVJZkNvbmZpZ3VyZWQobG9nRE8pIHtcclxuICAgIGxldCBjb25maWd1cmVkTGV2ZWwgPSB0aGlzLiNnZXRDb25zb2xlTG9nTGV2ZWxDb25maWd1cmF0aW9uKCk7XHJcbiAgICBpZiAoY29uZmlndXJlZExldmVsID49IGxvZ0RPLkxvZ0xldmVsKSB7XHJcbiAgICAgIGlmIChjb25maWd1cmVkTGV2ZWwgPT0gTE9HX0xFVkVMLkVSUk9SIHx8IGNvbmZpZ3VyZWRMZXZlbCA9PSBMT0dfTEVWRUwuRkFUQUwpXHJcbiAgICAgICAgY29uc29sZS5lcnJvcihsb2dETy5Mb2dEYXRhKTtcclxuICAgICAgZWxzZVxyXG4gICAgICAgIGNvbnNvbGUubG9nKGxvZ0RPLkxvZ0RhdGEpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgI2lzTG9nVG9CZVNlbnQobG9nRE8pIHtcclxuICAgIGxldCBsb2dDZmcgPSB0aGlzLiNsb2dDb25maWd1cmF0aW9uO1xyXG4gICAgcmV0dXJuIGxvZ0NmZyAhPSBudWxsICYmIGxvZ0NmZy5Xcml0ZUl0ZW1MaXN0ICYmIHRoaXMuI21hdGNoZXNXcml0ZVJ1bGUobG9nQ2ZnLldyaXRlSXRlbUxpc3QsIGxvZ0RPKTtcclxuICB9XHJcblxyXG4gICNtYXRjaGVzV3JpdGVSdWxlKHdyaXRlSXRlbUxpc3QsIGxvZ0RPKSB7XHJcbiAgICByZXR1cm4gd3JpdGVJdGVtTGlzdC5zb21lKG1zZ0ZpbHRlciA9PiBcclxuICAgICAgbXNnRmlsdGVyLkxvZ0xldmVsID49IGxvZ0RPLkxvZ0xldmVsICYmXHJcbiAgICAgICAgKCFtc2dGaWx0ZXIuRW50aXR5VHlwZSB8fCBtc2dGaWx0ZXIuRW50aXR5VHlwZSA9PSBsb2dETy5FbnRpdHlUeXBlKSAmJlxyXG4gICAgICAgICghbXNnRmlsdGVyLkFsdEVudGl0eUlkIHx8IG1zZ0ZpbHRlci5BbHRFbnRpdHlJZCA9PSBsb2dETy5FbnRpdHlJZCkgJiZcclxuICAgICAgICAoIW1zZ0ZpbHRlci5FbnRpdHlJZCB8fCBtc2dGaWx0ZXIuRW50aXR5SWQgPT0gbG9nRE8uRW50aXR5SWQpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgI2xvZ09uRmlsZShsb2dETykge1xyXG4gICAgaWYgKHRoaXMuI2xvZ1dvcmtlcikge1xyXG4gICAgICBsZXQgbWVzc2FnZSA9IG5ldyBMb2dXb3JrZXJNZXNzYWdlKExPR19XT1JLRVJfTUVTU0FHRV9UWVBFLkxPRywgbG9nRE8pO1xyXG4gICAgICB0aGlzLiNsb2dXb3JrZXIucG9zdE1lc3NhZ2UobWVzc2FnZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAjY3JlYXRlTG9nV29ya2VyKCkge1xyXG4gICAgaWYgKHdpbmRvdy5Xb3JrZXIpIHsgICBcclxuICAgICAgdGhpcy4jbG9nV29ya2VyID0gbmV3IFdvcmtlcihuZXcgVVJMKC8qIHdlYnBhY2tDaHVua05hbWU6IFwic25hcHAtbG9nLXdvcmtlclwiICovXCJzbmFwcC1sb2ctd29ya2VyLmpzXCIsIGltcG9ydC5tZXRhLnVybCkpLmdldFdvcmtlcigpO1xyXG4gICAgICB0aGlzLiNsb2dXb3JrZXIub25lcnJvciA9IGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1dvcmtlciBlcnJvcjogJyArIGVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1lvdXIgYnJvd3NlciBkb2VzblxcJ3Qgc3VwcG9ydCB3ZWIgd29ya2Vycy4nKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIERPTG9nIHtcclxuICBMb2dEYXRlVGltZTtcclxuICBMb2dMZXZlbDtcclxuICBMb2dUeXBlO1xyXG4gIExvZ0RhdGFUeXBlO1xyXG4gIExvZ0RhdGE7XHJcbiAgRHVyYXRpb25NUztcclxuICBFbnRpdHlUeXBlO1xyXG4gIEVudGl0eUlkO1xyXG4gIFNvdXJjZVdvcmtzdGF0aW9uSWQ7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGxvZ0RhdGVUaW1lLCBsb2dMZXZlbCwgbWVzc2FnZSwgZHVyYXRpb24sIGVudGl0eVR5cGUsIGVudGl0eUlkLCB3b3Jrc3RhdGlvbklkKSB7XHJcbiAgICB0aGlzLkxvZ0RhdGVUaW1lID0gbG9nRGF0ZVRpbWU7XHJcbiAgICB0aGlzLkxvZ0xldmVsID0gbG9nTGV2ZWw7XHJcbiAgICB0aGlzLkxvZ1R5cGUgPSAxO1xyXG4gICAgdGhpcy5Mb2dEYXRhVHlwZSA9IDE7XHJcbiAgICB0aGlzLkxvZ0RhdGEgPSBtZXNzYWdlO1xyXG4gICAgdGhpcy5EdXJhdGlvbk1TID0gZHVyYXRpb247XHJcbiAgICB0aGlzLkVudGl0eUlkID0gZW50aXR5SWQ7XHJcbiAgICB0aGlzLkVudGl0eVR5cGUgPSBlbnRpdHlUeXBlO1xyXG4gICAgdGhpcy5Tb3VyY2VXb3Jrc3RhdGlvbklkID0gd29ya3N0YXRpb25JZDtcclxuICB9XHJcblxyXG59XHJcblxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///../../../common-script/snapp-logger.js\n");

/***/ }),

/***/ "../../../common-script/timed-task.js":
/*!********************************************!*\
  !*** ../../../common-script/timed-task.js ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TimedTask: () => (/* binding */ TimedTask)\n/* harmony export */ });\nclass TimedTask {\r\n\t#timer;\r\n\t#timeoutTime;\r\n\t#task;\r\n\t\r\n\tconstructor(timeoutTime, task) {\r\n\t\tthis.#timeoutTime = timeoutTime;\r\n\t\tthis.#task = task;\r\n\t}\r\n\t\r\n\tstartWithImmediateExecution() {\r\n\t\tthis.#executeTask();\r\n\t}\r\n\t\r\n\tstartTimer() {\r\n\t\tthis.reset();\r\n\t}\r\n\t\r\n\t#executeTask() {\r\n\t\tthis.#clearTimer();\r\n\t\ttry {\r\n\t\t\tthis.#task();\r\n\t\t}\r\n\t\tfinally {\r\n\t\t\tthis.reset();\r\n\t\t}\r\n\t}\r\n\r\n\t#clearTimer() {\r\n\t\tif (this.#timer)\r\n\t\t\tclearTimeout(this.#timer);\r\n\t}\r\n\r\n\treset() {\r\n\t\tthis.#clearTimer();\r\n\t\tthis.#timer = setTimeout(() => this.#executeTask(), this.#timeoutTime);\r\n\t}\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vY29tbW9uLXNjcmlwdC90aW1lZC10YXNrLmpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8va2lvc2stY29udHJvbGxlci8uLi8uLi8uLi9jb21tb24tc2NyaXB0L3RpbWVkLXRhc2suanM/ZTVhOSJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgVGltZWRUYXNrIHtcclxuXHQjdGltZXI7XHJcblx0I3RpbWVvdXRUaW1lO1xyXG5cdCN0YXNrO1xyXG5cdFxyXG5cdGNvbnN0cnVjdG9yKHRpbWVvdXRUaW1lLCB0YXNrKSB7XHJcblx0XHR0aGlzLiN0aW1lb3V0VGltZSA9IHRpbWVvdXRUaW1lO1xyXG5cdFx0dGhpcy4jdGFzayA9IHRhc2s7XHJcblx0fVxyXG5cdFxyXG5cdHN0YXJ0V2l0aEltbWVkaWF0ZUV4ZWN1dGlvbigpIHtcclxuXHRcdHRoaXMuI2V4ZWN1dGVUYXNrKCk7XHJcblx0fVxyXG5cdFxyXG5cdHN0YXJ0VGltZXIoKSB7XHJcblx0XHR0aGlzLnJlc2V0KCk7XHJcblx0fVxyXG5cdFxyXG5cdCNleGVjdXRlVGFzaygpIHtcclxuXHRcdHRoaXMuI2NsZWFyVGltZXIoKTtcclxuXHRcdHRyeSB7XHJcblx0XHRcdHRoaXMuI3Rhc2soKTtcclxuXHRcdH1cclxuXHRcdGZpbmFsbHkge1xyXG5cdFx0XHR0aGlzLnJlc2V0KCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQjY2xlYXJUaW1lcigpIHtcclxuXHRcdGlmICh0aGlzLiN0aW1lcilcclxuXHRcdFx0Y2xlYXJUaW1lb3V0KHRoaXMuI3RpbWVyKTtcclxuXHR9XHJcblxyXG5cdHJlc2V0KCkge1xyXG5cdFx0dGhpcy4jY2xlYXJUaW1lcigpO1xyXG5cdFx0dGhpcy4jdGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHRoaXMuI2V4ZWN1dGVUYXNrKCksIHRoaXMuI3RpbWVvdXRUaW1lKTtcclxuXHR9XHJcbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///../../../common-script/timed-task.js\n");

/***/ }),

/***/ "../../../common-script/utils.js":
/*!***************************************!*\
  !*** ../../../common-script/utils.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Utils: () => (/* binding */ Utils)\n/* harmony export */ });\nclass Utils {\r\n\tstatic beautifyJSONString(str) {\r\n\t\treturn JSON.stringify(str, null, 4)\r\n\t}\t\r\n\r\n\tstatic decodeBase64(str) {\r\n\t\tif (str[str.length-1] === \"=\")\r\n    \tstr = str.slice(0,-1);\r\n\t\treturn atob(str);\r\n\t}\r\n\r\n\tstatic encodeBase64(str) {\r\n\t\treturn btoa(str);\r\n\t}\r\n\t\r\n\tstatic createUUID() {\r\n    let dt = new Date().getTime();\r\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\r\n      let r = (dt + Math.random() * 16) % 16 | 0;\r\n      dt = Math.floor(dt / 16);\r\n      return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);\r\n    });\r\n  }\r\n  \r\n\tstatic async encodeBase64URLEncoded(str) {\r\n\t\tlet blob = new Blob([str], { type: 'text/plain; charset=UTF-8' });\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tlet reader = new FileReader();\r\n\t\t\t\treader.onloadend = () => {\r\n\t\t\t\t\tlet base64data = reader.result.split(',')[1];\r\n\t\t\t\t\tresolve(base64data);\r\n\t\t\t\t};\r\n\t\t\treader.onerror = reject;\r\n\t\t\treader.readAsDataURL(blob);\r\n\t\t});\r\n\t}\r\n\t\r\n\tstatic async streamToBase64(stream) {\r\n    // Convert the stream to blob\r\n    const blob = await new Response(stream).blob();\r\n\r\n    // Create a FileReader instance\r\n    const reader = new FileReader();\r\n\r\n    // Convert the blob to base64\r\n    return new Promise((resolve, reject) => {\r\n        reader.onloadend = () => resolve(reader.result.split(',')[1]); // Remove the Data URL prefix\r\n        reader.onerror = reject;\r\n        reader.readAsDataURL(blob);\r\n    });\r\n\t}\t\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vY29tbW9uLXNjcmlwdC91dGlscy5qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixtQkFBbUIsZ0JBQWdCO0FBQ2xFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVFQUF1RTtBQUN2RTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9raW9zay1jb250cm9sbGVyLy4uLy4uLy4uL2NvbW1vbi1zY3JpcHQvdXRpbHMuanM/NjE2YyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgVXRpbHMge1xyXG5cdHN0YXRpYyBiZWF1dGlmeUpTT05TdHJpbmcoc3RyKSB7XHJcblx0XHRyZXR1cm4gSlNPTi5zdHJpbmdpZnkoc3RyLCBudWxsLCA0KVxyXG5cdH1cdFxyXG5cclxuXHRzdGF0aWMgZGVjb2RlQmFzZTY0KHN0cikge1xyXG5cdFx0aWYgKHN0cltzdHIubGVuZ3RoLTFdID09PSBcIj1cIilcclxuICAgIFx0c3RyID0gc3RyLnNsaWNlKDAsLTEpO1xyXG5cdFx0cmV0dXJuIGF0b2Ioc3RyKTtcclxuXHR9XHJcblxyXG5cdHN0YXRpYyBlbmNvZGVCYXNlNjQoc3RyKSB7XHJcblx0XHRyZXR1cm4gYnRvYShzdHIpO1xyXG5cdH1cclxuXHRcclxuXHRzdGF0aWMgY3JlYXRlVVVJRCgpIHtcclxuICAgIGxldCBkdCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgcmV0dXJuICd4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgnLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24oYykge1xyXG4gICAgICBsZXQgciA9IChkdCArIE1hdGgucmFuZG9tKCkgKiAxNikgJSAxNiB8IDA7XHJcbiAgICAgIGR0ID0gTWF0aC5mbG9vcihkdCAvIDE2KTtcclxuICAgICAgcmV0dXJuIChjID09ICd4JyA/IHIgOiAociAmIDB4MyB8IDB4OCkpLnRvU3RyaW5nKDE2KTtcclxuICAgIH0pO1xyXG4gIH1cclxuICBcclxuXHRzdGF0aWMgYXN5bmMgZW5jb2RlQmFzZTY0VVJMRW5jb2RlZChzdHIpIHtcclxuXHRcdGxldCBibG9iID0gbmV3IEJsb2IoW3N0cl0sIHsgdHlwZTogJ3RleHQvcGxhaW47IGNoYXJzZXQ9VVRGLTgnIH0pO1xyXG5cdFx0XHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG5cdFx0XHRcdGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG5cdFx0XHRcdHJlYWRlci5vbmxvYWRlbmQgPSAoKSA9PiB7XHJcblx0XHRcdFx0XHRsZXQgYmFzZTY0ZGF0YSA9IHJlYWRlci5yZXN1bHQuc3BsaXQoJywnKVsxXTtcclxuXHRcdFx0XHRcdHJlc29sdmUoYmFzZTY0ZGF0YSk7XHJcblx0XHRcdFx0fTtcclxuXHRcdFx0cmVhZGVyLm9uZXJyb3IgPSByZWplY3Q7XHJcblx0XHRcdHJlYWRlci5yZWFkQXNEYXRhVVJMKGJsb2IpO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cdFxyXG5cdHN0YXRpYyBhc3luYyBzdHJlYW1Ub0Jhc2U2NChzdHJlYW0pIHtcclxuICAgIC8vIENvbnZlcnQgdGhlIHN0cmVhbSB0byBibG9iXHJcbiAgICBjb25zdCBibG9iID0gYXdhaXQgbmV3IFJlc3BvbnNlKHN0cmVhbSkuYmxvYigpO1xyXG5cclxuICAgIC8vIENyZWF0ZSBhIEZpbGVSZWFkZXIgaW5zdGFuY2VcclxuICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcblxyXG4gICAgLy8gQ29udmVydCB0aGUgYmxvYiB0byBiYXNlNjRcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgcmVhZGVyLm9ubG9hZGVuZCA9ICgpID0+IHJlc29sdmUocmVhZGVyLnJlc3VsdC5zcGxpdCgnLCcpWzFdKTsgLy8gUmVtb3ZlIHRoZSBEYXRhIFVSTCBwcmVmaXhcclxuICAgICAgICByZWFkZXIub25lcnJvciA9IHJlamVjdDtcclxuICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChibG9iKTtcclxuICAgIH0pO1xyXG5cdH1cdFxyXG59Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///../../../common-script/utils.js\n");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = __webpack_modules__;
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/get javascript chunk filename */
/******/ 	(() => {
/******/ 		// This function allow to reference async chunks
/******/ 		__webpack_require__.u = (chunkId) => {
/******/ 			// return url for filenames based on template
/******/ 			return "" + chunkId + ".js";
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/global */
/******/ 	(() => {
/******/ 		__webpack_require__.g = (function() {
/******/ 			if (typeof globalThis === 'object') return globalThis;
/******/ 			try {
/******/ 				return this || new Function('return this')();
/******/ 			} catch (e) {
/******/ 				if (typeof window === 'object') return window;
/******/ 			}
/******/ 		})();
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/publicPath */
/******/ 	(() => {
/******/ 		var scriptUrl;
/******/ 		if (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + "";
/******/ 		var document = __webpack_require__.g.document;
/******/ 		if (!scriptUrl && document) {
/******/ 			if (document.currentScript)
/******/ 				scriptUrl = document.currentScript.src;
/******/ 			if (!scriptUrl) {
/******/ 				var scripts = document.getElementsByTagName("script");
/******/ 				if(scripts.length) {
/******/ 					var i = scripts.length - 1;
/******/ 					while (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;
/******/ 				}
/******/ 			}
/******/ 		}
/******/ 		// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration
/******/ 		// or pass an empty string ("") and set the __webpack_public_path__ variable from your code to use your own logic.
/******/ 		if (!scriptUrl) throw new Error("Automatic publicPath is not supported in this browser");
/******/ 		scriptUrl = scriptUrl.replace(/#.*$/, "").replace(/\?.*$/, "").replace(/\/[^\/]+$/, "/");
/******/ 		__webpack_require__.p = scriptUrl;
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/jsonp chunk loading */
/******/ 	(() => {
/******/ 		__webpack_require__.b = document.baseURI || self.location.href;
/******/ 		
/******/ 		// object to store loaded and loading chunks
/******/ 		// undefined = chunk not loaded, null = chunk preloaded/prefetched
/******/ 		// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded
/******/ 		var installedChunks = {
/******/ 			"kiosk-controller": 0
/******/ 		};
/******/ 		
/******/ 		// no chunk on demand loading
/******/ 		
/******/ 		// no prefetching
/******/ 		
/******/ 		// no preloaded
/******/ 		
/******/ 		// no HMR
/******/ 		
/******/ 		// no HMR manifest
/******/ 		
/******/ 		// no on chunks loaded
/******/ 		
/******/ 		// no jsonp function
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval-source-map devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("../script/kiosk.js");
/******/ 	globalThis["kiosk-controller"] = __webpack_exports__;
/******/ 	
/******/ })()
;